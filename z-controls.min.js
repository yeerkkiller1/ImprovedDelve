Uize=function(){"use strict";function _(e){return e.replace(/([\^\$\|\{\}\[\]\(\)\?\.\*\+\\])/g,"\\$1").replace(/[\n\r\t]/g,function(e){return"\\"+M[e]})}function D(e){return e.length==1&&x(e[0])?e[0]:e}function P(e){return w(e)?e:e?{constructor:t,toLocaleString:t,toString:t,valueOf:t}:{}}function H(e,t,n){var r=!n;if(r)n=e[0];if(!r||E(n)){var i=e[+r],s=e.length;E(i)&&t(n,i);if(s>r+1){for(var o=+r;++o<s;)E(i=e[o])&&t(n,i)}}return n}function B(e,t){for(var n in t)e[n]=t[n];return e}function j(e,t){var n,r;for(var i in t)S(r=t[i])&&S(n=e[i])?j(n,r):e[i]=r}function K(e){return e.replace(/\.([^\.]+)/g,function(e,t){return"['"+t+"']"})}var e=function(){},t,n="string",r="object",i="number",s="boolean",o="function",u=Function,a=Array,f=false,l=true,c=null,h={},p=Object.prototype.toString,d,v,m,g,y,b,w,E,S,x,T,N,C,k=0,L=[],A,O=!!(a.indexOf&&a.lastIndexOf),M={"\n":"n","\r":"r","	":"t"};B(e,{capFirstChar:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},clone:v=function(e){if(e==t)return e;var r=typeof e;if(r==n||r==i||r==s||N(e))return e;var o=e.constructor;if(o==Date||o==String||o==Number||o==Boolean){return new o(e.valueOf())}else if(o==RegExp){return new RegExp(e.source,(e.global?"g":"")+(e.ignoreCase?"i":"")+(e.multiline?"m":""))}var u=o==Object,a=!u&&x(e);if(u||a){var f,l,c=u?{}:[];if(a)c.length=e.length;for(var h in e)c[h]=(l=typeof (f=e[h]))==n||l==i||l==s||f==t?f:v(f);return c}return e},constrain:m=function(e,t,n){return t<n?e<t?t:e>n?n:e:e<n?n:e>t?t:e},inRange:function(e,t,n){return e==m(e,t,n)},copyInto:function(){return H(arguments,B)},copy:function(){return H(arguments,B,{})},mergeInto:function(){return H(arguments,j)},merge:function(){return H(arguments,j,{})},forEach:g=function(t,r,s,o){if(t){var a=w(t),f=a&&x(t);if(!f||t.length){if(typeof r==n)r=u("value,key,source",r);if(a){if(f||e.isArguments(t)){var l=L.forEach;if(l&&!(f&&o)){l.call(t,r,s)}else{for(var c=-1,h=t.length;++c<h;)(o||c in t)&&r.call(s,t[c],c,t)}}else{for(var c in t)r.call(s,t[c],c,t)}}else if(typeof t==i){for(var c=-1;++c<t;)r.call(s,c,c,t)}}}},resolveTransformer:y=function(n){var r=typeof n;return n==t?e.returnX:r==o?n:r=="string"?u("value,key","return "+n):r=="object"?e.isRegExp(n)?function(e){return n.test(e+"")}:x(n)?function(e){return n[+e]}:function(e){return n.hasOwnProperty(e)?n[e]:e}:function(){return n}},resolveMatcher:function(n){return n==t?e.returnTrue:y(n)},map:function(e,t,n){if(typeof e==i){e=new a(e);if(typeof n!=r)n=e}t=y(t);if(typeof n!=r)n=n===f?e:x(e)?[]:{};g(e,function(r,i){var s=t.call(e,r,i);if(n)n[i]=s},0,l);return n},applyAll:function(e,t,n){n||(n=L);for(var r=-1,i=t.length;++r<i;)t[r].apply(e,n)},callOn:function(e,n,r){function o(e){if(e!=t)S(e)||x(e)?g(e,o,0,l):s||i&&N(e[n])?(s?n:e[n]).apply(e,r):0}var i=d(n),s=!i&&N(n);r||(r=L);if(i||s)o(e)},defaultNully:function(e,n){return e!=t?e:n},indexIn:function(t,n,r,i){var s=T(t),o=-1;if(s||w(t)){var u=s?t:b(t);if((i=i!==f)&&O){o=a[r?"lastIndexOf":"indexOf"](u,n)}else{for(var l=u.length,c=r?l:-1,h=r?-1:1;--l>=0;){var p=u[c+=h];if(i?p===n:p==n){o=c;break}}}if(!s&&o>-1)o=e.keys(t)[o]}return o},keys:function(e){var t=[];if(!d(e))for(var n in e)t.push(n);return t},totalKeys:function(e){var t=0;if(!d(e))for(var n in e)t++;return t},values:b=function(e){if(x(e))return e;var t=[];if(!d(e))for(var n in e)t.push(e[n]);return t},meldKeysValues:function(e,t){var n={};for(var r=-1,i=Math.min(e.length,t.length);++r<i;)n[e[r]]=t[r];return n},min:function(e){return Math.min.apply(0,b(e))},max:function(e){return Math.max.apply(0,b(e))},reverseLookup:function(e,t){var n=P(t);if(!d(e))for(var r in e)n[e[r]+""]=r;return n},lookup:function(e,n,r){var i=P(r);if(arguments.length==1)n=l;if(e!=t){for(var s=-1,o=e.length;++s<o;)i[e[s]]=n}return i},isObject:w=function(e){return!!e&&typeof e==r},canExtend:E=function(e){var t=typeof e;return!!e&&(t==r||t==o)},isPlainObject:S=function(e){var t=e&&e.constructor;return!!(t&&(t==Object||typeof t.prototype.hasOwnProperty==o&&t.prototype.hasOwnProperty("hasOwnProperty")))},isArray:x=function(e){return e instanceof a||!!e&&N(e.splice)},isList:T=function(e){return w(e)&&typeof e.length==i},isArguments:function(e){return T(e)&&(p.call(e)=="[object Arguments]"||typeof e.callee==o)},isFunction:N=function(e){var t=e&&e.constructor;return!!(t&&t==t.constructor)},isNumber:function(e){return typeof e==i&&e===e},isString:d=function(e){return typeof e==n},isBoolean:function(e){return typeof e==s},isNully:function(e){return e==t},isPrimitive:C=function(e){return e!=t&&!(e instanceof e.constructor)},isRegExp:function(e){return p.call(e)=="[object RegExp]"},isIn:function(t,n,r){return e.indexIn(t,n,f,r)!==-1},isEmpty:function(e){if(w(e)&&w(e=e.valueOf())){if(x(e))return!e.length;for(var t in e)return f;return l}return!e},isNaN:function(e){return e!==e},isSameAs:function(e,t){return e===t||e!==e&&t!==t},emptyOut:function(e){if(w(e)){if(x(e)){e.length=0}else{for(var t in e)delete e[t]}}return e},recordMatches:function(e,t){if(!e)return!t;if(N(t))return t(e);for(var n in t){if(e[n]!==t[n])return f}return l},toNumber:function(e,n){if(typeof e==i){if(e==e)return e}else{if(N(e))e=e();if(w(e))e=e.valueOf()}return(e=e==t||e===""||e!==e||!C(e)?NaN:+e)!=e&&arguments.length>1?n:e},copyList:function(e){return L.slice.call(e)},push:function(t,n){L.push.apply(t,x(n)?n:e.copyList(n));return t},findRecordNo:function(t,n,r){for(var i=-1,s=t?t.length:0;++i<s;)if(e.recordMatches(t[i],n))return i;return m(e.toNumber(r,-1),-1,s-1)},findRecord:function(t,n,r){var i=e.findRecordNo(t,n,r);return i>-1?t[i]:null},getClass:function(e){return e==t?t:typeof e==o?e:e.constructor},getGuid:function(){return"uizeGuid"+k++},global:u("return (function () {return this}) ()"),eval:u("'use strict'; return eval (arguments [0])"),laxEval:u("return eval (arguments [0])"),quarantine:function(e){var t=(e+="").slice(e.indexOf("(")+1,e.indexOf(")")),n=e.slice(e.indexOf("{")+1,e.lastIndexOf("}"));return t?u(t,n):u(n)},isInstance:function(e){return!!(typeof e==r&&e&&e.constructor.subclass)},nop:u(),returnFalse:u("return false"),returnTrue:u("return true"),returnX:u("x","return x"),"package":function(e){return B(function(){},e)},pairUp:function(e){var t={},n=D(arguments),r=n.length;if(r<3){t[n[0]]=n[1]}else{for(var i=-2;(i+=2)<r;)t[n[i]]=n[i+1]}return t},escapeRegExpLiteral:_,substituteInto:function(e,n,r){if(!(e=e==t?"":e+"")||n==t)return e;if(C(n))n=[n];var i=(r||"[#KEY]").split("KEY"),s=[];for(var o in n)s.push(_(o));return e.replace(new RegExp(_(i[0])+"("+s.join("|")+")"+_(i[1]),"g"),function(e,t){return n[t]+""})},noNew:function(e){function r(){if(n){n=f;return this}else{var i=this;if(i==t||i.constructor!=r){n=l;i=new r}e.apply(i,arguments);return i}}var n;return r},now:u("return "+(Date.now?"Date.now()":"+new Date")),since:function(e){return Uize.now()-e}});var F=function(){var e=this;e.a_aa={};e.a_ba={};e.a_ca={}},I=F.prototype;I.done=function(e,t){var n=this,r=n.a_ca[e];n.a_aa[e]=h;n.a_ba[e]=t;if(r){delete n.a_ca[e];for(var i=-1,s=r.length;++i<s;)r[i](t)}};I.once=function(e,n){var r=this;if(T(e)&&e.length<2)e=e[0];if(e==t){n()}else if(T(e)){var i=[],s=e.length,o=0;g(e,function(e,t){r.once(e,function(e){i[t]=e;++o==s&&n.apply(0,i)})})}else{r.a_aa[e]==h?n(r.a_ba[e]):(r.a_ca[e]||(r.a_ca[e]=[])).push(n)}};var q="[#modulePath]",R={},U={},z={},W=new F,X=[],V,$,J;B(e,{getModuleByName:$=function(e){var t;return typeof e==n?R[e]||e=="*"&&R||(t=u("try {return "+K(e)+"} catch (e) {}")())&&(R[e]=t):e},resolveModuleDefinition:J=function(e){if(d(e))e={name:e};var t=e.name=e.name||"",n=e.host=t.substr(0,t.lastIndexOf(".")),r=e.superclass||n,i=e.required;i=e.required=d(i)?i.split(","):i||[];n&&i.push(n);r!=n&&i.push(r);return e},require:function(t,r){if(typeof t==n)t=[t];r&&W.once(t,r);g(t,function(t){if(z[t]!=h){z[t]=h;e.moduleLoader(t,function(t){t&&e.laxEval(t)})}})},getPathToLibrary:function(e,t){if(typeof document!="undefined"&&document.getElementsByTagName){for(var n=-1,r=document.getElementsByTagName("SCRIPT"),i=r.length,s,o;++n<i;){if((o=(s=r[n].src).indexOf(e))>-1)return t?s.replace(e,t):s.slice(0,s.lastIndexOf("/",o)+1)}}return""},module:function(t){var n=(t=J(t)).name;if(!n||U[n]!=h){U[n]=z[n]=h;var r=t.required;e.require(r,function(){var i,s=t.builder;if(s){for(var o=r.length,a={};--o>=0;){var f=r[o];a[f]=R[f]}i=s(R[t.superclass||t.host||""],a)}if(n){i=R[n]=i||function(){};u(K(n)+"=arguments[0]")(i);var l=n.lastIndexOf(".");if(l>-1)($(n.slice(0,l)).nonInheritableStatics||{})[n.slice(l+1)]=1}if(N(i)){i.moduleName=n;i.pathToResources=i==e?e.getPathToLibrary("Uize.js"):e.moduleUrlTemplate.replace(q,e.modulePathResolver(n).replace(/\./g,"_")+"/")}W.done(n,i)})}},moduleLoader:function(t,n){var r=document.createElement("script");r.async=true;r.type="text/javascript";r.src=e.moduleUrlResolver(t);(A||(A=document.getElementsByTagName("HEAD")[0])).appendChild(r)},modulePathResolver:function(e){var t=e.match(V);return t?t[1].replace(/\./g,"_")+t[2].replace(/\./g,"/"):e},addFolderOrgNamespaces:function(){V=new RegExp("^("+e.map(e.push(X,D(arguments)),_).join("|")+")(\\..+|$)")},moduleUrlResolver:function(t){return e.moduleUrlTemplate.replace(q,e.modulePathResolver(t)+".js")}});e.moduleUrlTemplate=e.getPathToLibrary("Uize.js",q);e.addFolderOrgNamespaces("Uize");e.module({name:"Uize",builder:function(){return e}});return e}();Uize.module("Uize.Event");Uize.module({name:"Uize.Event.Bus",builder:function(){var e=Uize.isFunction,t=Uize.isObject,n={};return Uize.mergeInto(function(){},{prototype:{fire:function(e){var t=this,n=t.c_c;if(n){if(typeof e!="object")e={name:e};var r=n[e.name],i=n["*"];if(r||i){var s=i&&r?i.concat(r):i||r,o=s.length;if(o==1){s[0].c_h(e)}else if(o==2){var u=s[0].c_h,a=s[1].c_h;u(e);a(e)}else{if(!i||!r)s=s.concat();for(var f=-1;++f<o;)s[f].c_h(e)}}}},wire:function(n,r){var i=this,s=i.c_c||(i.c_c={});if(t(n)){for(var o in n)i.wire(o,n[o])}else{i.wireUnwireWrapper(n,function(t){(s[t]||(s[t]=[])).push({c_m:t,c_h:e(r)?r:typeof r=="string"?Function(r):function(e){r.fire(e)},c_n:r})})}},unwire:function(e,n){var r=this,i=r.c_c;if(i){if(t(e)){for(var s in e)r.unwire(s,e[s])}else{r.wireUnwireWrapper(e,function(e){var t=i[e];if(t){if(n){for(var r=t.length;--r>=0;)t[r].c_n==n&&t.splice(r,1)}n&&t.length||delete i[e]}})}}},hasHandlers:function(e){return!!(this.c_c||n)[e]},wireUnwireWrapper:function(e,t){t(e)}}})}});Uize.module("Uize.Dom");Uize.module({name:"Uize.Dom.Basics",required:"Uize.Event.Bus",builder:function(){"use strict";function F(e){var n=document.getElementById(e);return!w||n&&n.id==e?n:t}function I(e){N.clientX=e.clientX;N.clientY=e.clientY;N.pageX=e.pageX;N.pageY=e.pageY}function q(e){var t=o.Dom.VirtualEvent;return t&&e.charCodeAt(e.length-1)==41?t.resolve(e):e.charCodeAt(0)==111&&e.charCodeAt(1)==110?e.slice(2):e}var e,t=null,n=true,r=false,i="string",s="object",o=Uize,u=o.copyInto,a=o.returnFalse,f,l,c,h,p,d,v,m,g=typeof navigator!="undefined",y=g?navigator:{userAgent:"",appName:""},b=y.userAgent.toLowerCase(),w=y.appName=="Microsoft Internet Explorer",E=+(w&&(b.match(/MSIE\s*(\d+)/i)||[0,0])[1]),S=b.indexOf("gecko")>-1,x=b.indexOf("opera")>-1,T=S||x,N={clientX:0,clientY:0,pageX:0,pageY:0},C=w&&ActiveXObject,k={},L={},A=0,O=w&&E<7,M="table-",_=M+"row",D=M+"cell",P=u({SPAN:"inline",THEAD:M+"header-group",TFOOT:M+"footer-group",LI:"list-item"},w&&typeof DOMImplementation=="undefined"?t:{TABLE:"table",TR:_,TH:D,TD:D,TBODY:_+"-group",COLGROUP:M+"column-group",COL:M+"column",CAPTION:M+"caption"}),H={borderColor:["border","Color"],borderWidth:["border","Width"],padding:1,margin:1},B={TABLE:n,THEAD:n,TFOOT:n,TBODY:n,TR:n,COL:n,COLGRPUP:n,FRAMESET:n,HEAD:n,HTML:n,STYLE:n,TITLE:n},j={};var R=o.package({c_z:k,c_N:I,display:function(t,n){n=n===e||!!n;l(t,function(e){e.style.display=n?P[e.tagName]||"block":"none"})},find:function(i){if(typeof i!=s||!i||typeof i.length=="number"||c(i))return i;var a=document,l=o.isPrimitive,h=[],d=u({},i),v="root"in d?f(d.root):a;delete d.root;if(v){var m=d.tagName;if("id"in d&&l(d.id)){var g=F(d.id);g&&h.push(g);delete d.id}else if("name"in d&&l(d.name)){h=a.getElementsByName(d.name);delete d.name}else{var y=l(m);y&&delete d.tagName;h=v.getElementsByTagName(m&&y?m:"*");v=t}if(v==a)v=t;if(!m||m=="*")delete d.tagName}var b=h.length;for(var w in d)break;if(!b||w==e&&!v)return h;var E=[],S;for(var x=-1;++x<b;){var g=h[x];if(S=v?p(g,v):n){for(var T in d){var N=g[T],C=d[T],k=o.isFunction;if(!(l(C)?N==C:C instanceof RegExp?C.test(N||""):k(C)?C.call(g,N):n)){S=r;break}}}S&&E.push(g)}return E},getById:f=function(n,r,s){if(typeof n!=i)return n;var o=s?s[n]:e;if(o===e){var u=h(r,n);(o=F(u))||(o=document.getElementsByName(u)).length<2&&(o=o[0]||t);if(s)s[n]=o}return o},getStyle:d=function(e,t){var n=typeof t==i,r=n?"":{};if(e=f(e)){if(n){var s=w&&t=="opacity",o=document.defaultView,u=o&&o.getComputedStyle(e,"");if(s)t="filter";if(u){if(!(r=u[t])){var a=H[t];if(a){var l=a[0]||t,c=a[1]||"",h=u[l+"Top"+c],p=u[l+"Right"+c],v=u[l+"Bottom"+c],m=u[l+"Left"+c];r=h==p&&p==v&&v==m?m:h+" "+p+" "+v+" "+m}}}else{var g=e.currentStyle;r=g?g.getAttribute(t):e.style[t]}if(s){var y=(r||"").match(/alpha\s*\(\s*opacity\s*=([^\)]*)\)/i);r=y?y[1]/100:1}}else{for(t in t)r[t]=d(e,t)}}return r},getValue:function(e){var t;if(e=f(e)){if(c(e)){var r=e.tagName;if(r=="TEXTAREA"){t=e.value}else if(r=="INPUT"){t=e.type=="checkbox"?e.checked:e.value}else if(r=="SELECT"){if(e.multiple){t=[];o.forEach(e.options,function(e){e.selected&&t.push(e.value)})}else{t=e.value}}else if(r=="IMG"){t=e.src}else{t=e.innerHTML.replace(/<br\/?>/gi,"\n").replace(/&nbsp;/g," ")}}else{t=(o.findRecord(e,{tagName:"INPUT",type:"radio",checked:n})||{}).value}}return t},injectHtml:function(e,t,i){var s,u,a,f,h,p,d=o.isList(t)||c(t)&&(t=[t]);(s=i=="inner replace")||(u=i=="outer replace")||(a=i=="inner top")||(f=i=="outer top")||(h=i=="outer bottom")||(p=n);d||(t+="");l(e,function(e){function l(e){return e&&/<script/i.test(e)}function v(){return l(t)}var i=e.childNodes;if((s||!i.length&&(a||p))&&!c&&!v()){e.innerHTML=t}else if(u&&w&&!c&&!v()){e.outerHTML=t}else{var m=[];if(s)if(w&&B[e.tagName]){var g=e.cloneNode();e.replaceNode(g);e=g}else e.innerHTML="";if(d){for(var y=-1,b=t.length;++y<b;){var E=t[y];if(E){if(E.parentNode)E=E.cloneNode(n);m.push(E)}}}else{if(C&&B[e.tagName]){var S=new C("Microsoft.XMLDOM");S.async=r;S.loadXML("<foo>"+t.replace(/&/g,"&")+"</foo>");var x=S.documentElement.childNodes,T=function(e){var t;switch(e.nodeType){case 1:t=document.createElement(e.tagName);for(var n=e.attributes,r=n.length;--r>=0;){var i=n[r];t.setAttribute(i.nodeName,i.nodeValue)}if(t.tagName=="SCRIPT")t.text=e.text;else{for(var s=-1,o=e.childNodes,u=o.length,a;++s<u;)(a=T(o[s]))&&t.appendChild(a)}break;case 3:t=document.createTextNode(e.nodeValue);break;case 8:t=document.createComment(e.nodeValue);break}return t};for(var y=-1;++y<x.length;)m.push(T(x[y]));d=n}else{var N=document.createElement(e.tagName);N.innerHTML="<i>e</i>"+t;m=N.childNodes}}var k=a?i[0]:h?e.nextSibling:e,L=e.parentNode,A=+!d,O=function(e){if(e.tagName=="SCRIPT"){var t=document.createElement("script");if(e.id)t.id=e.id;if(e.type)t.type=e.type;t.text=e.text;if(e.src)t.src=e.src;e.parentNode.replaceChild(t,e)}else if(l(e.innerHTML)){o.forEach(e.childNodes,O)}};while(m.length>A){var M=d?m.shift():m[A];if(p||s){e.appendChild(M)}else if(a){k?e.insertBefore(M,k):e.appendChild(M)}else if(f||u){L.insertBefore(M,k)}else if(h){k?L.insertBefore(M,k):L.appendChild(M)}d||O(M)}u&&L.removeChild(e)}})},isOnNodeTree:p=function(e,t){e=f(e);t=f(t);while(e){if(e==t)return n;e=e.parentNode}return r},isNode:c=function(e){return!!(e&&typeof e==s&&(e.nodeType||e.getAttribute||e.documentElement||e.self==e))},joinIdPrefixAndNodeId:h=function(e,t){return(e||"")+(e&&t?"-":"")+t},doForAll:l=function(t,n,r,o){if(typeof t==i)t=f(t,r,o);if(t!=e){if(c(t)){n(t)}else{var u=typeof t;if((u==s||u=="function")&&typeof t.length=="number"){for(var a=-1,h=t.length;++a<h;)l(t[a],n,r,o)}else if(u==s){for(var p in t)l(t[p],n,r,o)}}}},remove:function(e){l(e,function(e){e.parentNode.removeChild(e)})},setClipRect:function(e,t,n,r,i){var s="rect("+t+"px, "+n+"px, "+r+"px, "+i+"px)";l(e,function(e){e.style.clip=s})},setInnerHtml:function(e,t){t+="";l(e,function(e){e.innerHTML=t})},setOpacity:function(e,t){j.opacity=t;v(e,j)},setProperties:function(e,t){l(e,function(e){u(e,t)})},setStyle:v=function(t,n){l(t,function(t){var r=t.style,i;if(w&&"opacity"in n)r.filter=(i=Math.round((n.opacity+""||"#")*100))<100?"alpha(opacity="+i+")":"";for(var o in n)r[o]=(typeof (i=n[o])==s&&i?i=i.valueOf():i)!=e?typeof i=="number"&&o!="opacity"&&o!="zIndex"?Math.round(i)+"px":i+"":""})},setValue:function(t,n){n+="";l(t,function(t){var i=t.tagName,s=t.readOnly;if(s)t.readOnly=r;if(i=="TEXTAREA"){t.value=n}else if(i=="INPUT"){var u=t.type;if(u=="checkbox"){t.checked=n=="true"}else if(u=="radio"){t.checked=t.value==n}else{t.value=n}}else if(i=="SELECT"){if(!n){t.selectedIndex=-1}else{var a=t.options;if(t.multiple&&(n=="*"||n.indexOf(",")>-1)){var f=n!="*"?o.lookup(n.split(",")):e;for(var l=a.length,c;--l>=0;)(c=a[l]).selected=!f||f[c.value]}else{t.selectedIndex=o.findRecordNo(a,{value:n},t.selectedIndex)}}}else if(i=="IMG"){if(n)t.src=n}else{i=="PRE"&&w?t.innerText=n:t.innerHTML=n.replace(/</g,"&lt;").replace(/\n/g,"<br/>")}if(s)t.readOnly=s})},show:function(t,n){v(t,{visibility:n||n===e?"inherit":"hidden"})},unwire:m=function(t,n,r,i){if(typeof n==s&&n&&!n.virtualDomEvent){for(var o in n)m(t,o,n[o],r)}else{R.unwireEventsByOwnerId(i,t!==e||n!=e||r!=e?{node:t,eventName:n,handler:r}:e)}},unwireEventsByOwnerId:function(n,i){var s=L[n=n||""];if(s){var o=function(e){if(e!==t){var o=i&&i.eventName,u=i&&i.handler,a=e||o||u;if(o&&o.charCodeAt)o=q(o);for(var f=s.length;--f>=0;){var l=s[f],c=k[l],h=c.c_V,p=c.c_Q;if(!a||(!e||e==(c.c_xa||h))&&(!o||o==p)&&(!u||u==c.c_ya)){a&&s.splice(f,1);if(c.c_za){R.unwireEventsByOwnerId(c.c_za)}else{try{h==window&&O?U.unwire(p,c.c_Ba):w?h.detachEvent("on"+p,c.c_Ba):h.removeEventListener(p,c.c_Ba,r)}catch(d){}}delete k[l]}}a&&s.length||delete L[n]}};i&&i.node!==e?l(i.node,o):o()}},wire:function(){var t=o.quarantine,n=t(function(e){return function(t){var n=window.Uize&&Uize.Dom.Basics.c_z[e];return n&&n.c_ya.call(n.c_V,t.windowEvent)}}),i=t(function(e){return function(t){var n=window.Uize&&Uize.Dom.Basics.c_z[e];return n&&n.c_ya.call(n.c_V,t||window.event)}}),u={click:i,mouseover:t(function(e){return function(t){var n=Uize.Dom.Basics,r=window.Uize&&n.c_z[e],i=(t||(t=window.event)).fromElement||t.relatedTarget;if(r){if(i){try{if(!i.Uize_Widget_Drag_shield&&!n.isOnNodeTree(i,r.c_V))i=null}catch(s){i=null}}if(!i){n.c_N(t);return r.c_ya.call(r.c_V,t)}}}}),mouseout:t(function(e){return function(t){var n=Uize.Dom.Basics,r=window.Uize&&n.c_z[e],i=(t||(t=window.event)).toElement||t.relatedTarget;if(r){if(i){try{if(!i.Uize_Widget_Drag_shield&&!n.isOnNodeTree(i,r.c_V))i=null}catch(s){i=null}}if(!i)return r.c_ya.call(r.c_V,t)}}}),mousedown:i,mouseup:i};return function(t,f,c,h){if(!f)return;if(h==e)h="";var p;if(f.charCodeAt)f=q(f);if(typeof f==s&&!(p=!!f.virtualDomEvent)){h=arguments[2]||"";for(var d in f)R.wire(t,d,f[d],h);return}l(t,function(e){var t=e.tagName,s=e==window&&O;(L[h]||(L[h]=[])).push(A);var l=(p?a:s?n:u[f]||i)(A);var d=k[A++]={c_V:e,c_Q:f,c_ya:c,c_Ba:l};if(T&&t=="BODY"&&f=="scroll"){d.c_xa=e;e=d.c_V=document}if(l){var v="on"+f;s?U.wire(f,l):e.attachEvent?e.attachEvent(v,l):e.addEventListener(f,l,r);if(t=="A"&&(f=="mousedown"||f=="click"||f=="touchstart")&&!e[v])e[v]=a}else if(p){f.wire(e,c,d.c_za=o.getGuid())}})}}(),ieMajorVersion:E,isIe:w,isSafari:b.indexOf("applewebkit")>-1,isMozilla:S,mousePos:N});if(g){R.wire(document.documentElement,"mousemove",I);if(O){var U=new o.Event.Bus,z=setTimeout(function(){U.fire("load")},15e3);o.forEach(["focus","blur","load","beforeunload","unload","resize","scroll","hashchange"],function(e){var t="on"+e,n=window[t]||a;window[t]=function(t){e=="load"&&clearTimeout(z);n.call(window,t||(t=window.event));U.fire({name:e,windowEvent:t})}})}}return R}});Uize.module({name:"Uize.Dom.Util",required:"Uize.Dom.Basics",builder:function(){"use strict";var e=Uize.Dom.Basics,t,n,r=e.isIe&&e.ieMajorVersion<9;return Uize.package({getEffectiveBgColor:function(t){var n="";t=e.getById(t);while((!n||n=="transparent"||n=="none")&&t){n=e.getStyle(t,"backgroundColor");t=t.parentNode}return n},getOpacityProperties:t=function(t){return e.isIe?{filter:"alpha(opacity="+Math.round(t*100)+")"}:{opacity:t+""}},getOpacityStr:function(e){return n(t(e))},showClickable:function(t,n){e.setStyle(t,{cursor:n||n===undefined?r?"hand":"pointer":"default"})},showInLayoutFlow:function(e,t){t=t!==c_i;c_j(e,{position:t?"static":"absolute",visibility:t?"inherit":c_k})},stylePropertiesAsStr:n=function(e){var t=[];for(var n in e)t.push(n,":",e[n],"; ");return t.join("")}})}});Uize.module({name:"Uize.Dom.Pos",required:"Uize.Dom.Basics",builder:function(){"use strict";var e,t=Uize,n=Math,r=Uize.Dom.Basics,i,s,o,u,a,f,l,c=r.getStyle,h=r.doForAll,p=r.getById,d=r.isNode,v=r.isIe,m=r.setStyle,g=["left","top","width","height"];return t.package({getDocumentScrollElement:f=function(){return document[r.isSafari?"body":"documentElement"]},doRectanglesOverlap:l=function(e,t,n,r,i,s,o,u){return n-1+ +e>=i&&o-1+ +i>=e&&r-1+ +t>=s&&u-1+ +s>=t},getCoords:i=function(e){function y(){t+=m.scrollLeft;r+=m.scrollTop}var t=0,r=0,s=0,u=0,a=true,h=100,m=f(),g=o(window);if(e==window){y();s=g.width;u=g.height}else if(d(e=p(e))){s=e.offsetWidth;u=e.offsetHeight;if(!(s&&u)&&e.tagName=="DIV"){for(var b=e.childNodes,w=b.length;--w>=0;){if(b[w].nodeName.charAt(0)!="#"){var E=i(b[w]);if(E.width||E.height){s=n.max(s,E.right-t+1);u=n.max(u,E.bottom-r+1)}}}}if(e.tagName=="A"&&e.childNodes.length==1&&e.childNodes[0].tagName=="IMG")e=e.childNodes[0];var S=function(e){return c(e,"display")=="none"||c(e,"visibility")=="hidden"},x=a=!S(e),T=e,N=e,C=g.width,k=g.height,L=m.scrollLeft,A=m.scrollTop,O=L+C,M=A+k;while(N.parentNode&&typeof N.parentNode!="unknown"){var _=N.offsetLeft||0,D=N.offsetTop||0,P=N.offsetWidth,H=N.offsetHeight;if(a&&S(N))a=false;if(N==T){t+=_+(parseInt(c(N,"borderLeftWidth"))||0);r+=D+(parseInt(c(N,"borderTopWidth"))||0);T=N.offsetParent;c(N,"position")=="fixed"&&y()}if(N!=e&&N!=document.body&&N!=document.documentElement&&(N.scrollWidth>P||N.scrollHeight>H)){t-=N.scrollLeft;r-=N.scrollTop;if(v){t+=N.clientLeft;r+=N.clientTop}if(a)a=l(t,r,s,u,_,D,P,H)}var B=N.style,j=B.transform||B.webkitTransform;if(j){var F=j.toLowerCase().replace(/ /g,"").match(/(translate[a-z0-9]*)\((-?[0-9a-z\.]+),?(-?[0-9a-z\.]+)?.*?\)/);if(F!==null)switch(F[1]){case"translate":case"translate3d":t+=parseInt(F[2]);r+=parseInt(F[3]);break;case"translatex":t+=parseInt(F[2]);break;case"translatey":r+=parseInt(F[2]);break}}N=N.parentNode}if(a)a=l(t,r,s,u,L,A,C,k);h=a?(n.min(t+s,O)-n.min(n.max(t,L),O))*(n.min(r+u,M)-n.min(n.max(r,A),M))/(s*u)*100:0}return{x:t,y:r,width:s,height:u,area:s*u,left:t,top:r,right:t+s-1,bottom:r+u-1,seen:a,percentSeen:h}},getDimensions:o=function(e){if(e==window){var t=document.documentElement;return{width:t.clientWidth||window.innerWidth||t.offsetWidth,height:t.clientHeight||window.innerHeight||t.offsetHeight}}else if(e=p(e)){return{width:e.offsetWidth||parseInt(c(e,"width"))||0,height:e.offsetHeight||parseInt(c(e,"height"))||0}}else{return{width:0,height:0}}},setCoords:s=function(e,n){m(e,t.isArray(n)?t.meldKeysValues(g,n):n)},centerInWindow:function(e){var t=i(window);h(e,function(e){var n=o(e);s(e,{left:t.x+(t.width-n.width>>1),top:t.y+(t.height-n.height>>1)})})},getEventAbsPos:a=function(t){var n=(t||(t=r.mousePos)).targetTouches;if(n&&n.length)t=n[0];if(t.pageX!=e){return{left:t.pageX,top:t.pageY}}else{var i=f();return{left:t.clientX+i.scrollLeft,top:t.clientY+i.scrollTop}}},setAbsPos:u=function(e,t,r){r=typeof r=="number"?{x:r,y:r}:r||{x:0,y:0};var i=f(),s=o(window);h(e,function(e){function u(e,o,u,f){var l=t[e],c=r[f],h=l-i[o],p=c+a[u];return l+(h+p>s[u]?n.max(-p,-h):c)}var a=o(e);m(e,{left:u("left","scrollLeft","width","x"),top:u("top","scrollTop","height","y"),right:"auto",bottom:"auto"})})},setAbsPosAdjacentTo:function(e,t,n){t=p(t);var r=i(t),s=r.width/2,o=r.height/2,f=n=="x"?-1:1;if(!s&&!o)r=a();h(e,function(e){u(e,{left:r.left+s,top:r.top+o},{x:-s*f,y:o*f})})}})}});Uize.module("Uize.Oop");Uize.module({name:"Uize.Oop.mTreeInheritance",builder:function(){"use strict";var e,t=Uize;return function(n){n.staticMethods({treeInheritedStateProperties:function(n){var r=this;t.forEach(n,function(n,i){function a(){var t=this,n=t[i];if(n=="inherit"||n===e)n=t.parent?t.parent[o]:u;if(n===e)n=u;if(n!=t[o])t.set(o,n)}var s=n.name||i,o=s+"Inherited",u=n.value;r.stateProperties(t.pairUp(i,{name:s,onChange:a,value:"inherit"},o,{onChange:function(){t.callOn(this.children,a)},value:u}))})}});n.instanceMethods({getProvider:function(t){var n=this,r;while(((r=n.get(t))==="inherit"||r===e)&&(n=n.parent));return n},getInherited:function(e){var t=this.getProvider(e);return t&&t.get(e)},setInherited:function(e){var t;for(var n in e){if(t=this.getProvider(n))t.set(n,e[n])}},callInherited:function(e){var n=this;return function(){var r=n.getProvider(e);if(r){var i=r.get(e);if(t.isFunction(i))return i.apply(r,arguments)}}}})}}});Uize.module("Uize.Util");Uize.module({name:"Uize.Util.Dependencies",builder:function(){"use strict";function t(e){return!e?[]:typeof e=="string"?e.split(","):e}var e={};return Uize.package({resolveDependenciesList:t,traceDependencies:function(n,r,i){function u(t){Uize.forEach(t.sort(),function(t){if(s[t]!=e){s[t]=e;u(r(t));o.push(t)}})}var s=Uize.lookup(t(i),e),o=[];u(t(n));return o}})}});Uize.module({name:"Uize.Class",required:["Uize.Util.Dependencies","Uize.Event.Bus"],builder:function(){"use strict";function w(e,t,i){function s(){return this[x(this,"value")]}var o=n.noNew(function(){var e=arguments;p(this,c,e);p(this,h,e)}),u=o.prototype;var a=e.nonInheritableStatics||m,f=n.clone;for(var l in e)if(!a[l]&&l!="prototype")o[l]=f(e[l]);r(u,e.prototype);u.valueOf=s;u.Class=o;o.nonInheritableStatics={b_G:1,nonInheritableStatics:1,valueOf:0};o.superclass=e;o.valueOf=s;var c=o.b_A=(e.b_A||v).concat(),h=o.b_B=(e.b_B||v).concat();t&&c.push(t);i&&h.push(i);o.b_H||(o.b_H={});o.b_I||(o.b_I={});return o}function S(e,t){var n=u(e);return n.b_I[t]||n.b_H[t]}function x(e,t){var n=S(e,t);return n?n.b_4:t}function T(e){function u(e){return e.replace(/\s+/g,"").replace("/**/","").split(",")}var r=e+"",o=b[r];if(!o){var l,c;if(f(e)){l=u((e+"").match(/\(([^\)]*)\)/)[1]);c=e}else{if(typeof e=="string"){var h=e.indexOf(":");if(h>-1){c=t(l=u(e.slice(0,h)),"return "+e.slice(h+1))}else{e=u(e)}}if(a(e)){l=[];if(e.length){var p=[],d=[];i(e,function(e,t){var n=e.charCodeAt(0)==33,r="a"+t;l.push(n?e.slice(1):e);p.push(r);d.push((n?"!":"")+r)});c=t(p,"return "+d.join(" && "))}else{c=n.returnTrue}}}o=b[r]={b___:l,b_i_:t("return ["+s(l,'"this.get(\'" + value + "\')"').join(",")+"]"),b_a_:c,b_j_:s(l,'"Changed." + value')}}return o}function N(e,t,n,r){function h(){var t=u.call(e),r=a.apply(e,t);if(i||s)r=!!r;if(f||r!==l){f=false;i&&r&&c&&e.unwire(c);i||s?r&&(i||!r!=!l)&&n.apply(0,t):n.call(0,r,t);l=r}}var i=r==g,s=r==y,t=T(t),u=t.b_i_,a=t.b_a_,f=true,l,c;h();i&&l?c={}:e.wire(c=o(t.b_j_,h));return c}var e="string",t=Function,n=Uize,r=n.copyInto,i=n.forEach,s=n.map,o=n.lookup,u=n.getClass,a=n.isArray,f=n.isFunction,l=n.isInstance,c=n.isObject,h=n.Util.Dependencies.traceDependencies,p=n.applyAll,d=Uize.Event.Bus,v=[],m={},g=1,y=2,b={};var E=w(function(){},function(){var e=this;(e.b_J=new d).wireUnwireWrapper=function(t,n){if(t.charCodeAt(0)==67&&!t.indexOf("Changed.")){var r=t.slice(8),i=S(e,r);if(i&&r!=i.b_P)t="Changed."+(r=i.b_P);n(t);(e.b_Q||(e.b_Q={}))[r]=this.hasHandlers(t)}else{n(t)}};e.instanceId=n.getGuid()},function(e){e||(e=m);var t={},n=this.Class.b_T,r,i;for(r in n){if(r in e)t[r]=e[r];else if((i=n[r])!==undefined)t[r]=i}for(r in e)r in t||(t[r]=e[r]);this.set(t)});E.instanceMethods=E.instanceProperties=function(e){r(this.prototype,e)};E.staticMethods=E.staticProperties=function(e){r(this,e)};E.dualContextMethods=E.dualContextProperties=function(e){r(this,e);r(this.prototype,e)};E.declare=function(e){for(var t in e)this[t](e[t]);return this};E.mixins=function(e){function s(e){if(!n.isIn(r,e)){r.push(e);f(e)?e(t):a(e)?i(e,s):t.declare(e)}}var t=this,r=t.b_1||(t.b_1=[]);s(e)};return E.declare({instanceMethods:{onChange:function(e,t){return N(this,e,t)},once:function(e,t){return N(this,e,t,g)},whenever:function(e,t){return N(this,e,t,y)},is:function(e){return!!this[x(this,e)]},isMet:function(e){var t=T(e);return t.b_a_.apply(this,t.b_i_.call(this))},met:function(e){this.set(e,true)},unmet:function(e){this.set(e,false)},kill:function(){var e=this.instanceId;n.eval("if(typeof "+e+"!='undefined')"+e+"=null")}},staticMethods:{subclass:function(e,t){return arguments.length==1&&!f(e)?w(this).declare(e):w(this,e,t)},alphastructor:function(e){this.b_A.push(e)},omegastructor:function(e){this.b_B.push(e)},stateProperties:function(e){var r=this,i=r.b_H,u=r.b_I,a;for(var f in e){var l=e[f],p=c(l),d=(p?l.name:l)||f,g=d,y=u[f]||i[f];if(!y){y=i[f]={b_4:f};if(d.indexOf("|")>-1){var b=d.split("|");g=b[0];o(b,y,u)}else{u[d]=y}y.b_P=g}if(p){var w=l.onChange;if(w){var E=y.b_k_;y.b_k_=E?[].concat(E,w):w}if(l.conformer)y.b_J_=l.conformer;if(l.derived){a=true;var S=T(l.derived);S.b_K_=t("o","return "+s(S.b___,"'\"' + value + '\" in o'").join(" || "));y.b_6=S}if("value"in l)r[f]=l.value}}var x=r.b_T=r.get();if(a){for(var N=function(e){return(u[e]||m).b_6},C=r.b_M_=[],k=h(n.keys(x),function(e){var t=N(e);return t?t.b___:v}),L=k.length,d,A=-1;++A<L;){N(d=k[A])&&C.push(d)}}},doMy:function(e,t,n){return this.prototype[t].apply(e,n||v)},singleton:function(e,t){var n=this,r=n.b_G||(n.b_G={}),i=r[e||(e="")];i?t&&i.set(t):i=r[e]=n(t);return i}},dualContextMethods:{get:function(t){if(typeof t==e){return this[x(this,t)]}else{var n=this,r={};if(!t){var i=u(n),s=i.b_H;for(var o in s)r[s[o].b_P]=n[o];if(l(n)){var f=n.b_U_;if(f)for(t in f)r[t]=n[t]}}else if(a(t)){for(var c=-1,h=t.length;++c<h;){var p=t[c];r[p]=n[x(n,p)]}}else{for(var p in t)r[p]=n[x(n,p)]}return r}},set:function(t){var r=this,s=arguments,u=s.length;if(u>1)t=u>2||typeof t==e?n.pairUp.apply(0,s):o(t,s[1]);var c=l(r),h=c?r.Class:r,p=h.b_I,d=h.b_H,m,g,y={},b,w,E=c&&r.b_Q,S=E&&E["*"],x,T,N,C,k,L,A,O=h.b_M_||v,M=[],_;for(_ in t){m=p[_]||d[_];if(!m||!m.b_6)M.push(_)}for(var D=-1,P=M.length,H=P+(c&&O.length);++D<H;){var B=D>=P;_=B?O[D-P]:M[D];m=p[_]||d[_];if(B){var j=m.b_6;if(j.b_K_(y)){L=j.b_a_.apply(r,j.b_i_.call(r))}else{continue}}else{L=t[_]}if(m){N=m.b_4;C=m.b_P}else{N=C=_;m=c?{}:{value:L};c?(r.b_U_||(r.b_U_={}))[_]=true:(k||(k={}))[_]=m}if(c)(A||(A={}))[C]=m.b_J_?L=m.b_J_.call(r,L,r[N]):L;if(L!==r[N]){if(c){y[C]=y[N]=1;S&&((x||(x={}))[C]=L);E&&E[C]&&(T||(T=[])).push(C,L);var F=function(t){if(f(t)){if(!g){g=[];b=r.instanceId+"_handlerAlreadyAdded"}if(!t[b]){t[b]=1;g.push(t)}}else if(typeof t==e){F(r[t])}else if(a(t)){i(t,F)}};m.b_k_&&F(m.b_k_)}r[N]=L}}k&&h.stateProperties(k);if(c){if(g){for(var I=-1,q=g.length;++I<q;){delete (w=g[I])[b];w.call(r,A)}}x&&r.fire({name:"Changed.*",properties:x});if(T){for(var R=-1,U=T.length/2;++R<U;)r.fire({name:"Changed."+T[R*2],newValue:T[R*2+1]})}}else{h.b_T=r.get()}},toggle:function(e){var t=!this.get(e);this.set(e,t);return t},wire:function(){var e=this.b_J||(this.b_J=new d);e.wire.apply(e,arguments)},fire:function(e){var t=this;if(typeof e!="object")e={name:e};e.source||(e.source=t);t.b_J&&t.b_J.fire(e);e.bubble&&t.parent&&l(t)&&t.parent.fire(e);return e},unwire:function(){var e=this.b_J;e&&e.unwire.apply(e,arguments)}}})}});Uize.module({name:"Uize.Widget",superclass:"Uize.Class",required:["Uize.Dom.Basics","Uize.Oop.mTreeInheritance"],builder:function(e){"use strict";function m(e,t){var n,r;e&&(n=window[r="$"+e])&&typeof n=="object"&&(!t||e!=t.c_p)?window[r]=f:n=f;return n}function g(e,t,n,r){return(!r||r==a)&&e!=f?e+(n!==""?"_":"")+n:r=="same as parent"?e:t}function y(e){var t=m(e.c_p,e.parent);t&&e.set(t)}function b(e){return e.c_B||e.getNode("shell")||e.getNode()}function w(e,t,n,r){var i="show"+s.capFirstChar(t);e.getProvider(i)?e.callInherited(i)(n):setTimeout(function(){var e=r();(n.callback||(e?n.yesHandler:n.noHandler)||s.nop)(e)},0)}var t=null,n=true,r=false,i="string",s=Uize,o=s.copyInto,u=s.isFunction,a="concatenated",f,l=s.Dom.Basics,c=l.doForAll,h=s.callOn,p=s.substituteInto,d=l.isNode,v=l.getById;return e.subclass({mixins:s.Oop.mTreeInheritance,alphastructor:function(e){var t=this;if(e){var n=m(e.idPrefix,e.parent);n&&o(e,n);delete e.widgetClass}t.c_I={};t.children=t.c_J={};t.addedChildren=t.c_K=new s.Class},instanceMethods:o(s.map({displayNode:1,getNodeStyle:1,getNodeValue:1,injectNodeHtml:1,setNodeClipRect:1,setNodeInnerHtml:1,setNodeOpacity:1,setNodeProperties:1,setNodeStyle:1,setNodeValue:1,showNode:1},function(e,t){return Function("arguments.length"+"?(arguments[0]=this.getNode(arguments[0]))"+":(arguments[arguments.length++]=this.getNode());"+"return Uize.Dom.Basics."+t.replace("Node","")+".apply(0,arguments)")}),{showInform:f,showConfirm:f,confirm:function(e){w(this,"confirm",e,function(){return confirm(e.message)})},inform:function(e){w(this,"inform",e,function(){alert(e.message);return n})},ajax:function(e,t){this.callInherited("performAjax")(e,u(t)?{callback:t}:t||{})},localize:function(e,t,n){var r,i=this;while(!(r=i.c_U?i.c_U[e]:f)&&(i=i.parent));return u(r)?r.call(this,t):p(r,t,n||"{KEY}")},getHtml:function(e){var t=this,r=t.c_W;if(r){if(r===n){var a=b(t);r=t.c_W=s.Template&&a?{process:s.Template.compile((l.find({root:a,tagName:"SCRIPT",type:"text/jst"})[0]||a).innerHTML,{openerToken:"[%",closerToken:"%]"})}:f;if(!r)return}t.c_p||t.set({c_p:t.instanceId});var c=o({pathToResources:s.pathToResources,blankGif:t.Class.getBlankImageUrl()},e||t.get()),h;r=typeof r!=i&&u(r.process)?r.process.call(t,c):u(r)?typeof (h=r(c))==="string"?p(h,c):h:p(r,c)}return r},buildHtml:function(e){var r=this,i=r.getHtml(e);if(i!=f){var s=b(r);l.injectHtml(s||document.body,i,r.c_0||(s?"inner replace":"inner bottom"));r.c_1=t;r.set({c_2:n})}},nodeId:function(e){return l.joinIdPrefixAndNodeId(this.c_p,e||"")},getNode:function(e){if(e==t){if(e===t)return t;e=""}var n=this;if(n.c_5&&typeof e==i){var r=n.c_5[e];if(r!==f)e=r}if(typeof e==i){return v(e,n.c_p,n.c_1||(n.c_1={}))}else if(d(e)){return e}else{var s=t;c(e,function(e){(s||(s=[])).push(e)},n.c_p,n.c_1||(n.c_1={}));return s}},flushNodeCache:function(e){if(this.c_1)e==f?this.c_1=t:delete this.c_1[e]},globalizeNode:function(e){var t=this,n=document.body;c(t.getNode(e),function(e){if(e.parentNode!=n){(t.c_a_||(t.c_a_=[])).push(e);l.setStyle(e,{position:"absolute",left:-1e4,top:-1e4});n.appendChild(e)}})},removeNode:function(e){l.remove(this.getNode(e));this.flushNodeCache(e)},wireNode:function(e,t,n){var r=this;arguments.length==3?l.wire(r.getNode(e),t,n,r.instanceId):l.wire(r.getNode(e),t,r.instanceId)},unwireNode:function(e,t,n){if(e!==f)e=this.getNode(e);arguments.length==2&&typeof t=="object"&&t&&!t.virtualDomEvent?l.unwire(e,t,this.instanceId):l.unwire(e,t,n,this.instanceId)},unwireNodeEventsByMatch:function(e,t){this.unwireNode(e,(t||(t={})).eventName,t.handler)},addChild:function(e,n,r){r||(r={});var i=this,u=i.c_p,l=s.isInstance(n)?n:t,c="idPrefix"in r?r.idPrefix:r.node,h=r.idPrefixConstruction;r.parent=i;if(e==f)e=r.name;if(l){if(e==f)e=l.c_h_;if(c==f)c=l.c_p;if(!h)h=l.c_x}r.idPrefix=g(u,c,r.name=e,r.idPrefixConstruction=h||(c==f?a:"explicit"));var p=i.c_I,d=p[e];if(d){o(r,d);delete p[e]}l&&l.set(r);l=i.c_J[e]=l||new n(r);i.c_K.met(e);return l},addChildren:function(e,t){for(var n in e){var r=s.copy(e[n],t),i=r.widgetClass;delete r.widgetClass;this.addChild(n,i,r)}},removeChild:function(e){var t=this,n=t.c_J,r=typeof e==i||s.isNumber(e)?e:e.c_h_,o=n[r];if(o){o.unwireUi();delete o.parent;delete n[r];t.c_K.unmet(r)}},childId:function(e){return g(this.c_p,this.c_p,e,this.c_x)},kill:function(){h(this.c_J,"kill");e.doMy(this,"kill")},insertOrWireUi:function(){this.c_2?this.wireUi():this.insertUi()},insertUi:function(){this.buildHtml();this.wireUi()},removeUi:function(){var e=this;e.unwireUi();e.removeNode();l.remove(e.c_a_);e.c_a_=f;h(e.c_J,"removeUi");e.set({c_2:r})},updateUi:function(){},wireUi:function(){var e=this;if(!e.isWired){y(e);e.set({wired:n});h(e.c_J,"insertOrWireUi");e.updateUi()}},unwireUi:function(){var e=this;if(e.isWired){e.c_1=t;e.unwireNode();h(e.c_J,"unwireUi");e.set({wired:r})}}}),stateProperties:{c_2:{name:"built",value:n},c_J:{name:"children",conformer:function(e){if(e){var t=this.c_J,n=this.c_I;for(var r in e){var i=e[r];t[r]?t[r].set(i):n[r]=i}}return this.c_J}},c_B:"container",c_W:"html",c_p:{name:"idPrefix|node",conformer:function(e){return d(e)?e.id||(e.id=s.getGuid()):e},onChange:function(){var e=this,n=e.c_p;e.c_1=t;if(n!=f){y(e);var i=e.c_J,s;for(var o in i)(s=i[o]).set({c_p:g(n,s.c_p,o,s.c_x)});if(e.isWired){e.set({wired:r});e.wireUi()}}}},c_x:"idPrefixConstruction",c_0:"insertionMode",c_U:"localized",c_h_:"name",c_5:"nodeMap",isWired:{name:"wired",value:r}},treeInheritedStateProperties:{c_o_:{name:"busy",value:r},c_p_:{name:"enabled",value:n}},staticMethods:{getBlankImageUrl:function(){return s.pathToResources+"Uize/blank.gif"},spawn:function(e,t){var n=this,r=[],i,o=t&&t.c_p?t.c_p+"_":"",u=o.length;c(l.find(e.idPrefix),function(a){e.idPrefix=a;t?i=t.addChild(a.id.slice(0,u)==o?a.id.slice(u):"generatedChildName"+s.getGuid(),n,e):(i=new n(e)).insertOrWireUi();r.push(i)});return r}}})}});Uize.module({name:"Uize.Widget.Button",required:["Uize.Dom.Util","Uize.Dom.Pos","Uize.Dom.Basics"],builder:function(e){"use strict";function v(e,t){return!!(e.get("enabledInherited")&&!e.get("busyInherited")&&(t||!e.d_p||e.d_q||e.d_r))}function m(){var e=this;e.d_t!=t&&e.isWired&&e.setNodeInnerHtml("text",e.d_t)}function g(){var e=this;if(e.isWired){var n=e.d_v,r=e.get("enabledInherited"),i=e.get("busyInherited"),o=(!r?16:0)|(!e.d_z||i?8:0)|(e==s?4:0)|(e.d_z=="down"||e.d_p?2:0)|(e.d_A?1:0),d=e.d_C[o];if(d==t){for(var m=-1,g=e.d_E,y=g.length;++m<y;){var b=g[m];if(o&u[b]){d=b;break}}e.d_C[o]=d}if(e.d_H=="classes"){var w=n.className,E="";if(e.d_K=="disambiguated"){var S=e.d_L;if(S==t){var x=w.match(l);if(x){S=x[x.length-1].split(" ",2)[0]}else{x=w.replace(c,"").match(/(\S+)\s*$/);if(x)S=x[x.length-1]}if(e.d_L=S=S||"")e.d_N=p[S]||(p[S]=new RegExp(S+"(\\s+"+S+a+")?"))}var T=d?" "+S+Uize.capFirstChar(d):"";E=S?w.replace(e.d_N,S+T):w.replace(f,"")+T}else{var N=d=="grayed"?"disabled":d;E=h.test(w)?w.replace(h,N):w+(N?" ":"")+N}if(E!=w)n.className=E}else if(e.d_H=="frames"){e.d_Q.style.top="-"+e.d_R.d_S[d]*e.d_T.height+"px"}if(e.d_U&&Uize.Tooltip){var C=e.d_z=="over"&&r&&!e.d_p;C!=e.d_W&&Uize.Tooltip.showTooltip(e.d_U,e.d_W=C)}e.get("busyInherited")?e.setNodeStyle(n,{cursor:"wait"}):Uize.Dom.Util.showClickable(n,v(e));e.setNodeProperties(n,{disabled:!r})}}function y(e){var t=this;if(t.isWired){var r=e.type,i=r=="click";if(!t.d_1){t.d_1=n;var s=function(e){y.call(t,e)};t.wireNode(t.d_v,{mouseout:s,mousedown:s,mouseup:s,dblclick:s})}if(i)e.cancelBubble=n;if(v(t,r=="dblclick")){var o=d[r];t.set({d_z:o[0]});t.fire({name:o[1],domEvent:e});if(i){t.d_4&&t.d_4(e);(t.d_p?t.d_q:t.d_5)&&t.toggle("selected")}}}}var t,n=true,r=false,i,s,o={},u={grayed:16,"":8,over:4,active:2,playing:1},a="(Grayed|Over|Active|Playing)",f=new RegExp(a),l=new RegExp("(?:(?:(\\S+)\\s+\\1"+a+"))","g"),c=new RegExp("\\S*"+a+"\\b","g"),h=/\b(disabled|over|active|playing)\b/,p={},d={mouseover:["over","Over"],mouseout:["","Out"],mousedown:["down","Down"],mouseup:["over","Up"],click:["over","Click"],dblclick:["over","Double Click"]};return i=e.subclass({omegastructor:function(){function t(){if(e.isWired){v(e)||e.set({d_z:""});g.call(e)}}var e=this;e.wire({"Changed.busyInherited":t,"Changed.enabledInherited":t})},instanceProperties:{d_W:r},instanceMethods:{setStateAndFireEvent:y,updateUi:function(){if(this.isWired){g.call(this);m.call(this)}},wireUi:function(){var n=this;if(!n.isWired){n.d_Q=t;var r=n.d_v=n.getNode();if(r){var i=r.childNodes;if(i.length&&(i.length>1||i[0].nodeType!=3)&&(n.d_Q=n.getNode("frames"))){n.d_H="frames";n.d_T=Uize.Dom.Pos.getDimensions(n.d_Q.parentNode)}if(n.d_8&&r.tagName=="A"&&!r.onclick)r.onclick=Uize.returnTrue;var s=function(e){y.call(n,e)};n.wireNode(r,{mouseover:s,click:s});n.d_t==t&&n.set({d_t:n.getNodeValue("text")});e.doMy(n,"wireUi")}}}},staticMethods:{addChildButton:function(e,t){function o(){s.wire("Click",function(e){if(t)typeof t=="string"?r.fire(t):t(e);r.fire(e)})}var r=this,s;if(r==i){s=new i({idPrefix:e,name:e,d_8:n});o();(window[s.instanceId]=s).wireUi()}else{s=r.children[e];if(!s){s=r.addChild(e,i);o()}}return s}},stateProperties:{d_4:"action",d_r:{name:"allowClickWhenSelected",onChange:g},d_5:"clickToSelect",d_q:{name:"clickToDeselect",onChange:g},d_K:{name:"classNamingForStates",value:"disambiguated"},d_R:{name:"frameOrder",onChange:function(){var e=this.d_R;e.d_S||(e.d_S=Uize.reverseLookup(e))},value:["grayed","","over","active","playing"]},d_8:{name:"followLink",value:r},d_H:{name:"mode",value:"classes"},d_A:{name:"playing",onChange:g,value:r},d_p:{name:"selected",onChange:g,value:r},d_z:{name:"state",onChange:function(){var e=this;if(!e.d_z){if(s==e)s=t}else if(e.d_z=="over"){s&&s!=e&&s.set({d_z:""});s=e}e.isWired&&g.call(e)},value:""},d_E:{name:"statePrecedence",onChange:function(){var e=this,t=e.d_E.d_d_||(e.d_E.d_d_=e.d_E.join(","));e.d_C=o[t]||(o[t]={});e.isWired&&g.call(e)},value:["playing","active","grayed","over",""]},d_t:{name:"text",onChange:m},d_U:"tooltip"}})}});Uize.module({name:"Uize.Dom.Text",required:"Uize.Dom.Basics",builder:function(){"use strict";var e=Uize,t=e.Dom.Basics.getById;return e.package({getText:function(n){var r="";if(n=t(n)){var i=function(t){if(typeof t.innerText=="string"){r+=t.innerText.replace(/\r|\n|\r\n/g,"")}else if(typeof t.textContent=="string"){r+=t.textContent}else{if(t.nodeType==3)r+=t.data;t.childNodes&&e.forEach(t.childNodes,i)}};i(n)}return r}})}});Uize.module({name:"Uize.Node",required:["Uize.Dom.Basics","Uize.Dom.Pos","Uize.Dom.Text","Uize.Dom.Util"],builder:function(){"use strict";var e,t=Uize,n=t.Dom,r=n.Basics;return t.package(t.copyInto({showClickable:n.Util.showClickable},r,n.Pos,n.Text))}});Uize.module({name:"Uize.Dom.Event",builder:function(){"use strict";function e(){this.returnValue=false}function t(){this.cancelBubble=true}var n=Uize.copyInto(function(e){return e||event},{abort:function(e){n.preventDefault(e=n(e));n.stopPropagation(e)},charCode:function(e){e=n(e);if(e.ctrlKey||e.altKey||e.which<1)return 0;return"charCode"in e?e.charCode:n.keyCode(e)},fix:function(r){r=n(r);for(var i in{target:1,relatedTarget:1,charCode:1,keyCode:1})i in r||(r[i]=n[i](r));r.preventDefault||(r.preventDefault=e);r.stopPropagation||(r.stopPropagation=t);return r},keyCode:function(e){return"which"in(e=n(e))?e.which:e.keyCode},preventDefault:function(t){(t=n(t)).preventDefault?t.preventDefault():e.call(t)},relatedTarget:function(e){return"relatedTarget"in(e=n(e))?e.relatedTarget:e.type=="mouseout"?e.toElement:e.fromElement},stopPropagation:function(e){(e=n(e)).stopPropagation?e.stopPropagation():t.call(e)},target:function(e){return(e=n(e)).target||e.srcElement}});Uize.map({Backspace:8,Delete:46,Insert:45,Enter:13,Escape:27,Space:32,Tab:9,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,RightArrow:39,UpArrow:38,DownArrow:40},function(e,t){n["isKey"+t]=function(t){return n.keyCode(t)==e}});return n}});Uize.module({name:"Uize.Dom.Classes",required:"Uize.Dom.Basics",builder:function(){"use strict";function a(e){var t=e+"",n=o[t];if(!n&&t){(e=t.split(",")).length==1&&e.unshift("");var r="\\b(?:"+e.join("|").replace(/\|{2,}/g,"|").replace(/^\||\|$/g,"")+")\\b",i={"":-1},s=e.length;for(var u=s;--u>-1;)i[e[u]]=s>2?u:!!u;n=o[t]={c_h:e,c_o:new RegExp(r),c_p:new RegExp("(\\s*)"+r+"(\\s*)"),c_l:i}}return n}function f(e,t){var n=a(t);if(n){t=n.c_h;r(e,function(e){s(e,t,(i(e,t)+1)%t.length)})}}var e=Uize.Dom.Basics,t=e.isNode,n=e.getById,r=e.doForAll,i,s,o={},u=[""];return Uize.package({getState:i=function(e,r){var i=-1;if(t(e=n(e))){var s=a(r);if(s)i=s.c_l[(e.className.match(s.c_o)||u)[0]]}return i},hasClass:function(e,t){return i(e,t)==1},setState:s=function(e,t,n){var i=a(t);if(!i)return;var s=(t=i.c_h)[+n]||"",o;r(e,function(e){if((o=e.className)!=s){if(o){e.className=s?o.replace(i.c_o,function(){return s+(s="")})+(s&&" "+s):o.replace(i.c_p,function(e,t,n){return t&&n})}else{e.className=s}}})},removeState:function(e,t){s(e,t,-1)},addClass:function(e,t){s(e,t,1)},removeClass:function(e,t){s(e,t,0)},toggleClass:f,toggleState:f})}});Uize.module({name:"Uize.Widget.FormElementWarning",required:"Uize.Dom.Classes",builder:function(e){"use strict";function t(e){e.isWired&&Uize.Dom.Classes.setState(e.getNode(),["",e.d_a],e.d_b)}function n(e){e.isWired&&e.setNodeInnerHtml("text",e.getMessage())}function r(e){e.isWired&&e.displayNode("",e.d_e)}return e.subclass({instanceMethods:{getMessage:function(){var e=this.d_f;return Uize.isFunction(e)?e():e},updateUi:function(){var i=this;if(i.isWired){n(i);r(i);t(i);e.doMy(i,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){var n=function(e){t.set({d_b:e})};t.wireNode("",{mouseover:function(){n(true)},mouseout:function(){n(false)}});t.d_f==null&&t.set({d_f:t.getNodeValue("text")});e.doMy(t,"wireUi")}}},stateProperties:{d_a:"cssClassFocused",d_b:{name:"focused",onChange:function(){t(this)},value:false},d_f:{name:"message",onChange:function(){n(this)}},d_e:{name:"shown",onChange:function(){r(this)},value:false}}})}});Uize.module({name:"Uize.Widget.FormElement",required:["Uize.Node","Uize.Dom.Event","Uize.Dom.Classes","Uize.Widget.FormElementWarning"],builder:function(e){"use strict";function v(e){return e.getNode("input")}function m(e){var t=e.parent,n;if(t&&t.parent){n=t.parent;if(!n.isForm)n=r}return n}function g(e){if(e.isWired){var t=e.get("enabledInherited")&&!e.get("busyInherited");e.setNodeProperties(v(e),{disabled:!t})}}function y(e){if(e.isWired){var t=v(e),n=e.d_v;n!=e.getNodeValue(t)&&e.setNodeValue(t,n===i?"":n)}}function b(){var e=this,t=e.d_x,n=e.d_y;if(e.isWired){e.d_z&&e.d_z.set(s.copyInto({shown:t},n?{message:n}:r));Uize.Dom.Classes.setState([v(e),e.getNode("label"),e.getNode("shell")],e.d_A,t)}}var t=true,n=false,r=null,i,s=Uize,o=s.Node,u=s.Dom.Event,a="checkWarningShown",f="never",l="tentativeValueChanged",c="valueChanged",h="validated",p="finished",d="validatedAfterFirstFinish";return e.subclass({omegastructor:function(){var e=this,n=e.d_z=e.addChild("warning",e.d_B||s.Widget.FormElementWarning),r=function(){g(e)};e.wire({"Changed.busyInherited":r,"Changed.enabledInherited":r});e.d_D=t;e.d_E=-1},instanceMethods:{fireOkOnEnter:s.returnTrue,checkIsEmpty:function(){return this.d_v==r||this.d_v===""},checkWarningShown:function(){var e=this,t=e.d_F,r=m(e),i=e.d_x;e.set({d_x:e.d_H&&e.d_I==n&&(r?r.get("warningShown"):e.d_J&&(t==h||t==p&&(e.d_K||i)||t==d&&(e.d_L||i)))})},getMoreValidators:i,getRootNode:function(){return this.getNode()||this.getNode("input")},restore:function(){this.set({d_L:n,d_M:"inherit",d_v:this.d_N})},updateUi:function(){var t=this;if(t.isWired){g(t);y(t);b.call(t);e.doMy(t,"updateUi")}},valueConformer:function(e){return s.isFunction(this.d_O)?this.d_O(e):e},validate:function(){var e=this;if(e.d_D){var i=e.d_P,o=s.isArray(i)?i:i!=r?[i]:r,u=e.getMoreValidators?e.getMoreValidators():r;if(u)o=o?o.concat(u):u;var a=function(t){e.set({d_I:t})};if(o!=r){var f=e.d_T==l?e.d_U:e.d_v,c=o.length,h=-1,p=function(){if(++h<c){var i=function(t,r){if(t==n){e.set({d_y:r||e.d_0});a(n)}else p()},u=o[h],l=u.func||(s.isFunction(u)?u:r),d=l?l.call(e,f,i):u instanceof RegExp?u.test(f):f==u;if(d!=r)i(d,u.msg)}else a(t)};p()}else a(t)}},wireUi:function(){var r=this;if(!r.isWired){var a=v(r);if(a){r.d_3=a.type;r.d_4=a.name;var f=function(e,t){r.fire({name:e,domEvent:t})},l=function(e){f("Click",e)},c=function(e){f("Key Up",e)},h=function(e){r.set({d_v:r.getNodeValue(a)});!e&&r.d_M!=t&&r.set({d_M:t})},p={blur:function(){h();r.set({d_c_:n})},focus:function(){r.set({d_c_:t})},click:function(e){h();l(e)},keydown:function(e){r.d_E=e.keyCode;f("Key Down",e);u.isKeyEnter(e)&&r.d_3!="textarea"&&u.abort(e)}};switch(r.d_3){case"checkbox":break;case"radio":r.set({nodeMap:s.copyInto(r.get("nodeMap")||{},{input:o.find({tagName:"INPUT",type:"radio",name:r.d_4})})});a=v(r);break;case"select-one":case"select-multiple":p.change=h;p.keyup=function(e){h();c(e)};p.click=l;break;default:p.keyup=function(e){if(r.d_3!="textarea"&&r.d_E==e.keyCode&&u.isKeyEnter(e)){h();r.fireOkOnEnter()&&f("Ok",e)}else if(u.isKeyEscape(e)){y(r);f("Cancel",e);a.blur()}else{r.set({d_U:r.getNodeValue(a),d_K:n})}c(e)};p.click=l;break}r.wireNode(a,p);r.d_v===i?h(t):y(r)}r.validate();e.doMy(r,"wireUi")}}},stateProperties:{d_4:"elementName",d_A:{name:"errorClassName",value:"error"},d_c_:{name:"focused",onChange:function(){var e=this,t=e.children.warning,n=e.d_c_;t&&t.set({focused:n});if(e.isWired){var r=v(e);if(n&&r&&document.activeElement!=r){setTimeout(function(){try{(o.isNode(r)?r:r[0]).focus()}catch(e){}},50);e.setNodeValue("input",e.d_v)}}},value:n},d_e_:{name:"isEmpty",value:t},d_M:{name:"isDirty",onChange:function(){var e=this,t=m(e),r=e.d_M=="inherit"?t?t.get("isDirtyInherited"):n:e.d_M;e.set({d_J:r})},value:"inherit"},d_J:{name:"isDirtyInherited",onChange:a,value:n},d_K:{name:"isFinished",onChange:function(){var e=this;if(e.d_K&&e.d_D){e.d_T==p&&e.validate();e.d_L||e.set({d_L:t})}e.checkWarningShown()},value:t},d_I:{name:"isValid",onChange:a,value:n},d_U:{name:"tentativeValue",onChange:function(){var e=m(this);if(e){e.set({isSubmitting:false})}this.d_T==l&&this.validate()},value:r},d_3:"type",d_T:{name:"validateWhen",value:l},d_P:{name:"validator",onChange:"validate",value:r},d_v:{name:"value",conformer:function(e){var n=this;e=n.d_3=="checkbox"?e==t:e;return n.valueConformer(e)},onChange:function(){var e=this;if(!e.isWired)e.d_N=e.d_v;e.set({d_U:e.d_v,d_K:t,d_e_:e.checkIsEmpty()});e.d_T==c&&e.validate();y(e)}},d_O:"valueConformer",d_g_:{name:"warningAllowed",onChange:function(){var e=this,n=m(e),r=e.d_g_=="inherit"?n?n.get("warningAllowedInherited"):t:e.d_g_;e.set({d_H:r})},value:"inherit"},d_H:{name:"warningAllowedInherited",onChange:a,value:n},d_y:{name:"warningMessage",onChange:[function(){var e=this;if(!e.isWired)e.d_0=e.d_y},b]},d_x:{name:"warningShown",onChange:b,value:n},d_F:{name:"warningShownWhen",onChange:a,value:h},d_B:"warningWidgetClass",d_L:{onChange:a,value:n}}})}});Uize.module({name:"Uize.Widget.FormElement.Text",builder:function(e){"use strict";function r(){var e=this;e.e_c=[function(t){var n=t+"",r=t!=null?n.length:0;return r>=e.e_g&&r<=e.e_h}]}function i(){this.isWired&&n&&this.setNodeProperties("input",{placeholder:this.e_j})}var t,n=typeof document!="undefined"&&"placeholder"in document.createElement("input");return e.subclass({omegastructor:function(){var e=this;e.wire("Changed.focused",function(r){if(e.isWired){var i=r.newValue,s=e.e_j,o=e.valueOf();if(s&&!n){var u;if(i&&o==s)u="";else if(!i&&!o)u=s;u!=t&&e.setNodeValue("input",u)}i&&o&&e.setCaretPosition(o.length)}});r.call(e)},instanceMethods:{checkIsEmpty:function(){return e.doMy(this,"checkIsEmpty")||this.valueOf()==this.e_j},getCaretPosition:function(){var e=this,t=-1;if(e.isWired&&e.get("focused")){var n=e.getNode("input");if("selectionStart"in n)t=n.selectionStart;else if(n.createTextRange){var r=n.createTextRange();r.moveStart("character",-e.get("tentativeValue").length);t=r.text.length}}return t},select:function(e,n){var r=this;if(r.isWired){var i=r.getNode("input"),s=r.valueOf();r.set("focused",true);if(s){if(e==t)i.select();else{n=n==t?s.length:n;if(i.setSelectionRange)try{i.setSelectionRange(e,n)}catch(o){}else if(i.createTextRange){var u=i.createTextRange();u.collapse(true);u.moveEnd("character",n);u.moveStart("character",e);u.select()}}}}},setCaretPosition:function(e){this.select(e,e)},getMoreValidators:function(){return this.e_c},updateUi:function(){if(this.isWired){i.call(this);e.doMy(this,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){var r=t.e_j,i=t.getNode("input");if(r){if(n)t.setNodeProperties(i,{placeholder:r});else t.set("value",r)}e.doMy(t,"wireUi")}}},stateProperties:{e_j:{name:"placeholder|defaultValue",onChange:i,value:""},e_g:{name:"minLength",onChange:r,value:0},e_h:{name:"maxLength",onChange:r,value:32767}}})}});Uize.module({name:"Uize.Node.Classes",required:"Uize.Dom.Classes",builder:function(){return Uize.Dom.Classes}});Uize.module("Zazzle");Uize.module({name:"Zazzle.FormElementWarning",superclass:"Uize.Widget.FormElementWarning",required:"Uize.Node.Classes",builder:function(e){"use strict";var t=e.subclass(),n=t.prototype,r={Info:0,Warning:1,Error:2};n.e_c=function(){var e=this;e.isWired&&Uize.Node.Classes.setState(e.getNode(),[e.e_d,e.e_e,e.e_f],r[e.e_g])};n.updateUi=function(){var t=this;if(t.isWired){t.e_c();e.doMy(t,"updateUi")}};n.wireUi=function(){var t=this;if(!t.isWired){var n=t.getNode("icon"),r=false;n&&t.wire("Changed.shown",function(){if(t.get("shown")&&!r){r=true;t.callInherited("wireTooltip")({widget:t,node:n,message:function(){return t.getMessage()},direction:t.e_j,propertyName:"focused",evalFunc:function(e){return e&&t.get("shown")}})}});e.doMy(t,"wireUi")}};t.stateProperties({e_g:{name:"alert",onChange:n.e_c,value:"Warning"},e_f:"cssClassAlertError",e_d:"cssClassAlertInfo",e_e:"cssClassAlertWarning",e_j:"messageDirection"});return t}});Uize.module({name:"Uize.Data",builder:function(){"use strict";var e="string",t=true,n=false,r=null,i,s=Infinity,o=Uize.totalKeys;var u,a={};return u=Uize.package({getColumn:function(e,t,n){var i=[];if(e){var s=n?{}:r;for(var o=-1,u=e.length;++o<u;){var a=e[o][t];if(!n||!s[a]&&(s[a]=1))i.push(a)}}return i},findRecords:function(e,t){var n=[];if(e){for(var r=-1,i=e.length,s;++r<i;)Uize.recordMatches(s=e[r],t)&&n.push(s)}return n},filter:function(e,t){var n={};if(e&&t){for(var r=-1,i=t.length;++r<i;){var s=t[r];if(s in e)n[s]=e[s]}}return n},identical:function(e,t,r){function p(e,t){function v(){if(r=o(e)==o(t)){for(var i in e){if(!(i in t)||!p(e[i],t[i])){r=n;break}}}}var r,i=typeof e,a=i=="object",f=a&&e,d=i==typeof t;if(d&&f&&t){var m=e.constructor;if(e==t){r=h}else if(r=m==t.constructor){if(m==Date||m==String||m==Number||m==Boolean||m==RegExp){r=e+""==t+""}else{if(typeof e.splice=="function"&&typeof t.splice=="function"){if(r=e.length==t.length){for(var g=e.length;--g>=0;){if(!p(e[g],t[g])){r=n;break}}if(r){var y=e.splice(0,s),b=t.splice(0,s);v();Uize.push(e,y);Uize.push(t,b)}}}else{v()}}}}else{r=l?!f&&!(typeof t=="object"&&t):(u?e==t:d&&(c?e===t:!a||!e==!t))||d&&i=="number"&&e!=e&&t!=t}return r}if(!r)r=a;var i=r.equality,u=i=="loose",f=!u&&i=="type",l=!u&&!f&&i=="tree",c=!u&&!f&&!l,h=r.allowConjoined!==n;return p(e,t)},conjoined:function(e,t){function r(e){function n(e){if(typeof e=="object"){if(!Uize.isIn(t,e)){t.push(e);for(var r in e)n(e[r])}}}var t=[];n(e);return t}var i=n,s=r(e),o=s.length,u=r(t);for(var a=-1;++a<o&&!i;)i=Uize.isIn(u,s[a]);return i},clones:function(e,t){return u.identical(e,t,{allowConjoined:n})&&!u.conjoined(e,t)},intersection:function(e,t){var n={};if(e&&t){for(var r in e){var i=e[r];if(t[r]===i)n[r]=i}}return n}})}});Uize.module({name:"Uize.Data.NameValueRecords",builder:function(){"use strict";var e,t=Uize.defaultNully;return Uize.package({fromHash:function(e,n,r){var i=[];if(Uize.isObject(e)){var s=typeof n=="number"&&typeof r=="number",o;n=t(n,"name");r=t(r,"value");for(var u in e){i.push(o=s?[]:{});o[n]=u;o[r]=e[u]}}return i},toHash:function(n,r,i){var s={},o=Uize.isArray(n)&&n.length;if(o){var u=Uize.isArray(n[0]);r=t(r,u?0:"name");i=t(i,u?1:"value");for(var a=-1,f,l;++a<o;){l=(f=n[a])[r];if(l!=e)s[l]=f[i]}}return s}})}});Uize.module("Uize.Str");Uize.module({name:"Uize.Str.CharClass",builder:function(){"use strict";function r(e,t,r,i,s){var o=e.c_g,u=t.length;if(u){s=s!=undefined?s:-i*Infinity;var a=i==1?u:-1;if((s-a)*i<0){if(u==1){return o[t]==n==r?0:-1}else{for(var f=i==1?Math.max(s,0)-1:Math.min(s,u-1)+1;(f+=i)!=a;)if(o[t.charAt(f)]==n==r)return f}}}return-1}var e=true,t=false,n={};return Uize.copyInto(Uize.noNew(function(e){this.setChars(e)}),{prototype:{setChars:function(e){this.c_g=e?Uize.lookup(Uize.map(e,function(e){return typeof e=="string"?e:String.fromCharCode(+e)}),n):{}},isClassChars:function(e){return!!e&&r(this,e,t,-1)==-1},isNonClassChars:function(t){return!!t&&r(this,t,e,-1)==-1},hasClassChars:function(t){return!!t&&r(this,t,e,-1)>-1},hasNonClassChars:function(e){return!!e&&r(this,e,t,-1)>-1},indexOfClassChar:function(t,n){return r(this,t,e,1,n)},lastIndexOfClassChar:function(t,n){return r(this,t,e,-1,n)},indexOfNonClassChar:function(e,n){return r(this,e,t,1,n)},lastIndexOfNonClassChar:function(e,n){return r(this,e,t,-1,n)}}})}});Uize.module({name:"Uize.Str.Whitespace",required:"Uize.Str.CharClass",builder:function(){"use strict";var e=Uize.Str.CharClass([9,10,11,12,13,32,160,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8203,8232,8233,12288]);return Uize.package(Uize.map({isWhitespace:"isClassChars",isNonWhitespace:"isNonClassChars",hasWhitespace:"hasClassChars",hasNonWhitespace:"hasNonClassChars",indexOfWhitespace:"indexOfClassChar",lastIndexOfWhitespace:"lastIndexOfClassChar",indexOfNonWhitespace:"indexOfNonClassChar",lastIndexOfNonWhitespace:"lastIndexOfNonClassChar"},function(t){var n=e[t];return function(){return n.apply(e,arguments)}}))}});Uize.module({name:"Uize.Str.Trim",required:"Uize.Str.Whitespace",builder:function(){"use strict";var e=Uize.Str.Whitespace,t=e.isWhitespace,n=e.indexOfNonWhitespace,r=e.lastIndexOfNonWhitespace,i;return Uize.package({hasPadding:function(e){var n=e.length;return!!(n&&(t(e.charAt(0))||t(e.charAt(n-1))))},trim:i=function(e,t){if(!e)return e;var i=e.length,s=t!=1?(n(e)+1||i+1)-1:0,o=t!=-1?r(e)+1:i;return s>0||o<i?e.slice(s,o):e},trimLeft:function(e){return i(e,-1)},trimRight:function(e){return i(e,1)}})}});Uize.module({name:"Uize.Web",required:["Uize.Dom.Basics","Uize.Dom.Classes","Uize.Dom.Pos","Uize.Dom.Text"],builder:function(){"use strict";var e=true,t=false,n=null,r,i=Uize,s=i.Dom,o=s.Basics,u=s.Classes,a=s.Pos,f=i.isString,l=i.isArray,c=i.isList,h=i.isFunction,p=i.isPlainObject,d=i.isBoolean,v=o.getStyle,m=o.setStyle,g=o.isNode,y=i.global(),b=y.document,w={width:{marginRight:1,marginLeft:1},height:{marginTop:1,marginBottom:1}},E=["webkit","ms","moz","o"],S=E.length,x=0,T=0,N=function(e,t,n){var r=e;if(e){var s=n,o=function(e){if(h(e)){var t=s||"_handlerWrapper";return e[t]||(e[t]=function(t){var n=this;i.require("Uize.Dom.Event",function(r){r.fix(t);P(t.target,s)&&e.call(n,t)})})}else if(d(e))return e?i.returnTrue:i.returnFalse};if(f(e))r=i.pairUp(e,o(t));else if(l(e))r=i.lookup(e,o(t));else{s=t;var u={};for(var a in r)u[a]=o(r[a]);r=u}}return r},C=function(e){return o.getById(e)},k=function(e,t){var n=a.getDimensions(e);if(t){for(var r in w){var i=w[r],s=v(e,i);for(var o in i){var u=s[o];n[r]+=u=="auto"?0:parseInt(u,10)}}}return n},L=function(e){return e.b_X||(e.b_X=i.getGuid())},A=function(e,t){var n=e,r;while(n=n.offsetParent){if(P(n,t)){r=n;break}}return r},O=function(e,t,n){var r;t=t||b;if(t){var i=M(e),s=-1;for(;++s<S+1;){var o=i[s];if(o in t){r=n?o:t[o];break}}}return r},M=function(e){var t=[e],n=i.capFirstChar(e),r=-1;for(;++r<S;)t.push(E[r]+n);return t},_=function(e,t){var n;if(e){n={};for(var r in e){var i=j(r,t);if(i)n[i]=e[r]}}return n},D=function(){return F.b_h_=F.b_h_||b.createElement("DIV")},P=function(e,t){e=C(e);return t===r||f(t)&&F.matches(e,t)||g(t)&&e==t||H(t)&&i.isIn(t.b_j_,e)||l(t)&&i.isIn(t,e)},H=function(e){return i.getClass(e)==F},B=function(t,n){var r;if(t&&f(t))r=F.selectCss(t,B(n)[0]);else if(g(t))r=[t];else if(H(t))r=t.element();else if(c(t)){var i={};r=[];for(var s=-1;++s<t.length;){var o=t[s];if(g(o)){var u=L(o);if(!i[u]){r.push(o);i[u]=e}}}}else r=[];return r},j=function(t,n){var i=F.b_r_[t];if(i==r)i=O(t,(C(n)||D()).style,e);return F.b_r_[t]=i};var F=Uize.noNew(function(e,t){var n=this,r=n.b_j_=B(e,t),i=n.length=r.length,s=-1;n.supportsTouch=F.supportsTouch;for(;++s<i;)n[s]=r[s];n.atEndOfConstructor(r)}),I=F.prototype;if(y&&!y.U)y.U=F;F.b_h_=r;F.b_r_={};F.supportsTouch="ontouchstart"in y;F.getPrefixedProperty=O;F.matches=function(e,n){var r=C(e),i=t;if(r){var s=r.matches||r.msMatchesSelector||r.mozMatchesSelector||r.webkitMatchesSelector||r.oMatchesSelector;if(s)i=s.call(r,n)}return i};F.selectCss=function(e,t){var n=t?C(t):b,r=n.querySelectorAll&&n.querySelectorAll(e);if(r){var i=[];for(var s=-1,o=r.length;++s<o;)i[s]=r[s];r=i}return r||[]};F.supportsCss=j;F.getNodeUid=L;F.isMatch=P;F.isWeb=H;F.select=B;I.b_B_=function(e){var i=this,s=o.display;i.b_E_(function(){var i=this,o=e,u=v(i,"display"),a=u=="none";if(o==n)o=a;if(a==o){if(!o){i.b_B_=u;s(i,t)}else{var f=i.b_B_||"";m(i,{display:f});!f&&v(i,"display")=="none"&&s(i);i.b_B_=r}}});return i};I.b_J_=function(e,t,n,r){o[e](this.b_j_,N(t,n,r));return this};I.atEndOfConstructor=i.nop;I.handleGetAction=I.b_L_=function(e,t){var r=this.b_j_,s=n;if(t)s=i.map(r,e);else if(r.length)s=e(r[0],0);return s};I.handleGetOrSetAction=I.b_O_=function(e,t,n){return t==r||d(t)?this.b_L_(e,t):this.b_R_(t,n)};I.handleSetAction=I.b_R_=function(e,t){var n=this,r=n.b_j_;if(h(e)){for(var i=-1,s=r.length;++i<s;){var o=r[i];t(o,e.call(o,i,o))}}else n.b_E_(function(){t(this,e)});return n};var q=function(e,t,n){I[e]=function(e,r){var s=p(e),o=l(e)?i.lookup(e):e;return this.b_O_(function(e){return t(e,o)},s?e:r,function(t,r){n(t,s?e:i.pairUp(e,r))})}},R=function(e){var t=function(n,r){var i=f(r),s=i?"":{};if(n){if(i)s=e(n,r);else{for(var o in r)s[o]=t(n,o)}}return s};return t};I.each=I.b_E_=function(e){h(e)&&i.forEach(this.b_j_,function(t,n){e.call(t,n,t)});return this};I.element=function(e){var t=this.b_j_;return e!=r?t[e]:t.concat()};I.getPrefixedProperty=function(e,t){return this.b_L_(function(t){return O(e,t)},t)};I.splice=i.nop;var U=function(e){I[e]=function(t){return this.b_R_(t,function(t,n){u[e](t,n)})}},z=function(e,t){I[e]=function(){u[t].apply(0,[this.b_j_].concat(Array.prototype.slice.call(arguments)));return this}};U("addClass");I.getClassState=function(e,t){return this.b_L_(function(t){return u.getState(t,e)},t)};I.hasClass=function(n){var r=this,i=r.b_j_,s=i.length,o=-1;for(;++o<s;)if(u.hasClass(i[o],n))return e;return t};U("removeClass");z("removeClassState","removeState");z("setClassState","setState");U("toggleClass");z("toggleClassState","toggleState");I.domReady=function(e){o.wire(b,"DOMContentLoaded",e);return this};I.hover=function(e,t){return this.mouseover(e).mouseout(t||e)};I.trigger=function(t){var n=this;if(t){var r;if(b.createEvent){r=b.createEvent("HTMLEvents");r.initEvent(t,e,e)}else{r=b.createEventObject();r.eventType=t}n.b_E_(function(){var e=this;b.dispatchEvent?e.dispatchEvent(r):e.fireEvent("on"+r.eventType,r)})}return n};I.unwire=function(e,t,n){return this.b_J_("unwire",e,t,n)};I.wire=function(e,t,n){return this.b_J_("wire",e,t,n)};I.wireOnce=function(e,t,n){var r=this,s=N(e,t,n),u=function(e,t,n){var r=function(i){o.unwire(e,t,r);n(i)};o.wire(e,t,r)};i.forEach(s,function(e,t){e&&r.b_E_(function(){u(this,t,e)})});return r};var W=function(e,t){I[e]=function(n,r){return this.wire(t||e,n,r)}},X=function(e,t,n,r){var s=0,o=i.isNumber(n);return h(t)?this.wire(e,o?function(e){if(!s){s=setTimeout(function(){s=0;t(e)},n)}}:t,o?r:n):this.trigger(e)},V=function(e){I[e]=function(t,n,r){return X.call(this,e,t,n,r)}};V("blur");V("change");V("click");V("dblclick");W("error");V("focus");V("keydown");V("keypress");V("keyup");W("load");V("mousedown");V("mousemove");V("mouseout");V("mouseover");V("mouseup");I.resize=function(e,t){var n=this;return X.call(n,"resize",h(e)&&n.length>0&&n[0]==y&&o.isIe&&o.ieMajorVersion<9?function(t){var r=n.dimensions();if(r.width!=x||r.height!=T){x=r.width;T=r.height;e(t)}}:e,t)};V("scroll");V("select");V("submit");V("touchcancel");V("touchend");V("touchleave");V("touchmove");V("touchstart");W("transitionend",["transitionend","webkitTransitionEnd","oTransitionEnd","otransitionend"]);W("unload");var $="ModClick",J="Remain",K=function(e){i.forEach(e,function(e,t){I[t]=function(n,r){var s=this;i.require("Uize.Dom.VirtualEvents."+e,function(e){o.wire(s.b_j_,e[t](r),n)});return s}})};K({altClick:$,ctrlAltClick:$,ctrlClick:$,keyRemainDown:J,keyRemainUp:J,mouseRemainDown:J,mouseRemainOut:J,mouseRemainOver:J,mouseRemainUp:J,mouseRest:J,remainBlurred:J,remainFocused:J,shiftAltClick:$,shiftClick:$,shiftCtrlAltClick:$,shiftCtrlClick:$});q("css",function(e,t){return v(e,f(t)?j(t,e)||t:_(t,e))},function(e,t){m(e,_(t,e))});var Q=function(e,t){I[e]=function(e){var n=this,r=n.css(t,e);return n==r?r:f(r)?parseInt(r,10):i.map(r,"parseInt(value, 10)")}};Q("contentHeight","height");Q("contentWidth","width");Q("opacity","opacity");I.rotate=function(e){return this.b_R_(e,function(e,t){var n=j("transform",e);n&&m(e,i.pairUp(n,"rotate("+(i.isNumber(t)?t+"deg":t)+")"))})};I.supportsCss=function(e,t){return this.b_L_(function(t){return j(e,t)},t)};var G=function(e,t){I[e]=function(){return this.b_B_(t)}};I.display=function(e){return this.b_B_(e===r||!!e)};G("show",e);G("hide",t);G("toggleShow");I.visible=function(){this.visibility(e)};I.invisible=function(){this.visibility(t)};I.visibility=function(e){this.b_R_(e,o.show)};var Y=function(e,t){I[e]=function(n){return this.property(t||e,n)}},Z=function(e){var t=e?"pageXOffset":"pageYOffset",n=e?"scrollLeft":"scrollTop",r=function(e){return e==y?t:n};I[n]=function(e){return this.b_O_(function(e){return e[r(e)]},e,function(e,t){e[r(e)]=t})}};q("attribute",R(function(e,t){return e.getAttribute(t)}),function(e,t){for(var n in t)e.setAttribute(n,t[n])});I.coords=function(e,t){return this.b_O_(function(t){var n=a.getCoords(t),r=b.documentElement,i=b.body;return{left:n.left-(e?y.pageXOffset||r.scrollLeft||i.scrollLeft:0),top:n.top-(e?y.pageYOffset||r.scrollTop||i.scrollTop:0)}},e==r||d(e)?t:e,function(e,n){var i=v(e,"position");m(e,{position:i=="static"?"relative":i,left:"auto",right:"auto",top:"auto",bottom:"auto"});var s=a.getCoords(e);m(e,{left:-s.left+(n.left==r?s.left:n.left)+(t?y.pageXOffset:0),top:-s.top+(n.top==r?s.top:n.top)+(t?y.pageYOffset:0)})})};I.dimensions=function(e,t){return this.b_L_(function(t){return k(t,e)},t)};I.height=function(e,t){return this.b_L_(function(t){return k(t,e).height},t)};I.html=function(e){return this.b_O_(function(e){return e.innerHTML},e,o.setInnerHtml)};I.innerHeight=function(e){return this.b_L_(function(e){return e.clientHeight},e)};I.innerWidth=function(e){return this.b_L_(function(e){return e.clientWidth},e)};I.offset=function(e,t){var n=!i.isBoolean(e)&&e;return this.b_L_(function(t){if(n){var r=a.getCoords(t),i=A(t,e),s=i?a.getCoords(i):{top:0,left:0};return{top:r.top-s.top,left:r.left-s.left}}else return{top:t.offsetTop,left:t.offsetLeft}},n?t:e)};I.offsetParent=function(t){return F(this.b_L_(function(e){return A(e,t)},e))};q("property",R(function(e,t){return e[t]}),o.setProperties);I.removeAttribute=function(e){var t=l(e)?e:[e],n=t.length,r;return this.b_R_(t,function(e){for(r=-1;++r<n;)e.removeAttribute(t[r])})};Z(e);Y("scrollHeight");Z();Y("scrollWidth");I.text=function(e){return this.b_O_(s.Text.getText,e,function(e,t){e.appendChild(b.createTextNode(t+""))})};I.value=function(e){return this.b_O_(o.getValue,e,o.setValue)};I.width=function(e,t){return this.b_L_(function(t){return k(t,e).width},t)};return F}});Uize.module({name:"Uize.Widget.mWeb",required:"Uize.Web",builder:function(){"use strict";var e=Uize;return function(t){t.declare({instanceMethods:{web:function(t){return e.Web(e.isObject(t)&&e.isFunction(t.getNode)?t.getNode():this.getNode(t))}}})}}});Uize.module({name:"Uize.Widget.Button.ValueDisplay",builder:function(e){"use strict";return e.subclass({stateProperties:{e__:"defaultValueDetails",e_a:"value",e_b:{name:"valueDetails",conformer:function(e){return e||this.e__}}}})}});Uize.module({name:"Uize.Widget.Button.ValueDisplay.Selector",required:["Uize.Dom.Classes","Uize.Widget.mWeb"],builder:function(e){"use strict";function n(e,t){e.isWired&&e.setNodeProperties("input",t)}function r(e){var t=e.get("valueDetails");if(e.isWired){if(t){t.value!=null&&n(e,{value:t.name});t.displayName!=null&&e.setNodeInnerHtml("displayName",t.displayName)}e.web().display(t)}}function i(e){if(e.isWired){var r=e.get("state"),i=e.get("enabledInherited")&&!e.get("busyInherited");n(e,{readOnly:!i,disabled:!i});t.setState(e.getNode(),["",e.f_h,e.f_i,e.f_j],!i?3:(r=="down"?2:r=="over"&&1)||0)}}function s(e){if(e.isWired){var r=e.get("selected");n(e,{checked:r});t.setState(e.getNode(),e.f_m,r)}}var t=Uize.Dom.Classes;return e.subclass({mixins:Uize.Widget.mWeb,omegastructor:function(){function t(){i(e)}var e=this;e.wire({"Changed.busyInherited":t,"Changed.enabledInherited":t,"Changed.state":t,"Changed.selected":function(){s(e)},"Changed.valueDetails":function(){r(e)}})},instanceMethods:{updateUi:function(){var t=this;if(t.isWired){r(t);i(t);s(t);e.doMy(t,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){var n=t.getNode("input"),r=t.getNode("displayName");t.wireNode(n,"change",function(e){var r=n.checked;if(r&&!t.get("clickToSelect")||!r&&!t.get("clickToDeselect")){t.set({selected:r});t.fire({name:"Click",domEvent:e})}});r&&r.removeAttribute("for");e.doMy(t,"wireUi")}}},stateProperties:{f_i:"cssClassActive",f_j:"cssClassDisabled",f_m:"cssClassSelected",f_h:"cssClassTentativeSelected"}})}});Uize.module({name:"Uize.Widget.Options",required:"Uize.Widget.Button",builder:function(e){"use strict";function i(e){if(e.isWired&&e.d_d!=e.d_e){var n=function(t,n){t>=0&&Uize.callOn(e.children["option"+t],"set",[{selected:n}])};n(e.d_e,t);n(e.d_e=e.d_d,true)}}function s(e){var t=e.getValueNoFromValue(e.d_j);e.set({d_d:t,d_k:t});i(e)}function o(e){var t=this,n=this.d_m;return!t.d_n||!n||!n.length||t.getValueNoFromValue(e)>-1?e:typeof n[0]=="object"?n[0].name:n[0]}var t=false,n=null,r;return e.subclass({omegastructor:function(){this.d_e=-1;this.d_o=0},instanceMethods:{forAll:function(e){for(var n=-1,r=this.d_m.length,i=this.children;++n<r;)if(e(i["option"+n],n)===t)break},getValueNoFromValue:function(e){var n=this.d_m;return n.length?typeof n[0]=="object"?Uize.findRecordNo(n,{name:e}):Uize.indexIn(n,e,t,t):-1},getValueObject:function(e){var t=this,i=t.getValueNoFromValue(e===r?t.d_j:e);return i>-1?t.d_m[i]:n},getOptionProperties:function(){return n},updateUi:function(){var t=this;if(t.isWired){i(t);e.doMy(t,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){t.d_d=-1;var r=t.d_s||Uize.Widget.Button,i=t.d_t,o=t.d_m,u=t.d_o=o.length,a,f,l=function(){a=n;t.set({d_x:t.d_j,d_k:t.d_d})},c=function(){a&&clearTimeout(a);f&&clearTimeout(f)};Uize.forEach(o,function(n,s){var o=(typeof n=="object"&&n||(n={name:n})).name,u=function(){t.set(t.d_C?{d_j:o}:{d_x:o,d_k:s})};t.addChild("option"+s,r,Uize.copy(i,t.getOptionProperties(s,n))).wire("*",function(e){if(e.name=="Click"){t.fire({name:"Before Value Change",value:o,valueNo:s}).cancel||t.set({d_j:o});t.fire(e)}else if(e.name=="Over"){c();t.d_E?f=setTimeout(u,t.d_E):u()}else if(e.name=="Out"){c();a=setTimeout(l,50)}t.fire({name:"Option Event",value:o,childEvent:e})})});if(u){var h=t.getNode();if(h){for(var p=-1,d,v,m,g=h.childNodes||[],y=g.length,b=t.children,w=t.get("idPrefix"),E=w.length;++p<y;){if((v=(d=g[p]).id)&&!v.indexOf(w)&&(m=b[v.slice(E+1)]))m.set({nodeMap:{"":d,shell:n,bed:n}})}}}e.doMy(t,"wireUi");s(t)}}},stateProperties:{d_n:{name:"ensureValueInValues",onChange:function(){var e=this;e.set({d_j:o.call(e,e.d_j)})},value:t},d_s:"optionWidgetClass",d_t:"optionWidgetProperties",d_C:"setValueOnMouseover",d_E:{name:"tentativeRestTime",value:0},d_x:{name:"tentativeValue",value:n},d_k:{name:"tentativeValueNo",value:-1},d_j:{name:"value",conformer:o,onChange:function(){var e=this;s(e);e.set({d_k:e.d_d,d_x:e.d_j})},value:n},d_d:{name:"valueNo",value:-1},d_m:{name:"values",onChange:function(){var e=this;if(e.isWired){for(var n=-1,i=e.d_o||0;++n<i;)e.removeChild("option"+n);e.unwireUi();e.get("html")!=r&&e.set({built:t});e.set({d_j:o.call(e,e.d_j)});e.insertOrWireUi()}},value:[]}}})}});Uize.module({name:"Uize.Widget.Options.Selector",required:"Uize.Widget.Button.ValueDisplay.Selector",builder:function(e){"use strict";return e.subclass({omegastructor:function(){function s(e,t){if(t!=null)r[e]=t}function o(t){var n=e.get(t),o=r[n];if(o===i){var u=Uize.findRecord(e.get("values"),{name:n});s(t,o=u?u.valueDetails:null)}e.set(t+"Details",o)}var e=this,t="value",n="tentativeValue",r={},i;e.wire({"Changed.tentativeValue":function(){o(n)},"Changed.value":function(){o(t)},"Changed.tentativeValueDetails":function(){s(e.get(n),e.e_k)},"Changed.valueDetails":function(){s(e.get(t),e.e_f)},"Changed.values":function(){r={};s(e.valueOf(),e.e_f);o(t)}});o(t);o(n)},instanceMethods:{getOptionProperties:function(t,n){return Uize.copyInto(e.doMy(this,"getOptionProperties",[t,n])||{},{value:n.name,valueDetails:n.valueDetails})},wireUi:function(){var t=this;if(!t.isWired){t.set({container:t.getNode("options")});e.doMy(t,"wireUi")}}},stateProperties:{e_k:"tentativeValueDetails",e_f:"valueDetails"},set:{optionWidgetClass:Uize.Widget.Button.ValueDisplay.Selector}})}});Uize.module({name:"Uize.Widget.AutoSuggest",superclass:"Uize.Widget.FormElement.Text",required:["Uize.Data.NameValueRecords","Uize.Node","Uize.Dom.Event","Uize.Str.Trim","Uize.Widget.Options.Selector"],builder:function(e){"use strict";function p(e){return function(t){return Uize.constrain(t,e,Infinity)}}function d(e,t){return(e%t+t)%t}function v(e){var r=e.f_s,i=e.addChild("suggestions",e.f_u||o.Widget.Options.Selector,o.copyInto({built:n,html:t,optionWidgetProperties:{cssClassActive:r,cssClassSelected:r,cssClassTentativeSelected:r},values:[]},e.f_v));i.wire({"Changed.tentativeValue":function(){e.f_w&&e.f_x(i.get("tentativeValue"))},"Option Event":function(r){if(r.childEvent.name==="Click"){e.f_w||e.f_x(i.get("tentativeValue"));e.f_z=n;e.set("focused",t);m(e,r.childEvent.source)}}});i.wireUi();return i}function m(e,t){e.fire({name:"Suggestion Selected",option:t});e.f_C=e.f_D;e.children.suggestions.set({tentativeValue:r,tentativeValueNo:-1,value:r,values:[]});S(e)}function g(e,t){var n=e.tokens.concat(),r=e.tokenIndex,i;if(t){n[r]=t;i=n.join("")}else i=e.query;return{text:i,position:n.splice(0,r+1).join("").length}}function y(e,t){var n=t&&l(t.tokens.concat()[t.tokenIndex]).replace(/\s+/g," ");return t?!c&&n==e.get("defaultValue")?s:n:s}function b(e,r,i){var a=e.f_Q,f=e.f_S,l=r.length,c=i,h=[],p=-1,d=s,v=s,m=n,g=s,y=0;if(a){a=o.lookup(o.isArray(a)?a:[a]);f=f?u.NameValueRecords.toHash(o.isArray(f)?typeof f[0]==="object"?f:o.map(f,function(e){return{open:e,close:e}}):typeof f==="object"?[f]:[{open:f,close:f}],"open","close"):{};while(++p<l){v=r[p];if(!m&&(g=f[v])){m=t;d+=v}else if(m&&v===g){m=n;d+=v}else if(!m&&a[v]){h.push(d);h.push(v);d=s}else{d+=v}}if(d||!h.length)h.push(d)}else h.push(r);if(i==-1)y=-1;else while(y<h.length-1&&(i-=h[y].length)>0)y++;return{query:r,queryIndex:c,tokens:h,tokenIndex:y}}function w(e,t){var n=e.children.suggestions;if(e.isWired){if(e.f_3&&n&&e.getNodeStyle("suggestionsPalette","display")!="none"){if(f.isKeyUpArrow(t)||f.isKeyDownArrow(t)){var r=n.get("values").length,i=f.isKeyUpArrow(t)?-1:f.isKeyDownArrow(t)?1:0,o=n.get("tentativeValueNo"),u=n.children["option"+o],a=n.children["option"+(d(o+1+i,r+1)-1)];if(i&&u){u.set("state",s);u.fire("Out")}if(i&&a){a.set("state","over");a.fire("Over")}e.f_9||e.f_x(n.get("tentativeValue"))}else if(n.get("tentativeValue")&&(f.isKeyEnter(t)||f.isKeyTab(t))){m(e,n.children["option"+n.get("tentativeValueNo")])}else if(f.isKeyTab(t)){var l=n.children["option0"];l.set("state","over");l.fire("Over");m(e,l)}}}}function E(e){function t(t){return'<span class="'+e.f_b_+'">'+t+"</span>"}var n=e.children,s=n.suggestions,u=y(e,e.f_C),a=e.get("defaultValue");e.f_z&&e.set({lastTypedQuery:u});if((u!=a||u==a&&!a)&&u.length>=e.f_e_&&e.f_f_&&e.f_g_!=i){e.ajax(o.copyInto(o.pairUp("serviceUrl",e.f_g_,e.f_h_,u,e.f_i_,e.f_f_),e.f_j_||{}),{cache:"memory",callbackSuccess:function(n){(s||v(e)).set({tentativeValue:r,tentativeValueNo:-1,values:o.map(e.f_l_(u,n),function(n){var r=n.fullWord,i=e.f_n_,s=i==="none"?r:i==="query"?n.prefix+t(u)+n.suffix:n.fullWord.indexOf(u)===0?t(n.prefix)+u+t(n.suffix):t(n.fullWord);return e.f_p_(r,s)})});S(e)}})}else if(s){s.set({tentativeValue:r,tentativeValueNo:-1,values:[]});S(e)}}function S(e){if(e.isWired){var t=e.getNode("input"),i=e.getNode("suggestionsPalette"),s=e.get("focused"),o=e.children.suggestions,u=o&&o.get("values").length;if(s&&u){e.displayNode("trending",!e.f_u_);e.showNode(i,n);e.displayNode(i);if(e.get("autoPositionSuggestionsPalette")){a.setAbsPosAdjacentTo(i,t,"y");e.setNodeStyle(i,{minWidth:a.getDimensions(t).width})}e.showNode(i)}else if(e.getNodeStyle("suggestionsPalette","display")!="none"){setTimeout(function(){e.displayNode(i,n);o&&o.set({tentativeValue:r,tentativeValueNo:-1,value:r,values:[]})},200)}}}var t=true,n=false,r=null,i,s="",o=Uize,u=o.Data,a=o.Node,f=o.Dom.Event,l=Uize.Str.Trim.trim,c=typeof document!="undefined"&&"placeholder"in document.createElement("input"),h={none:1,query:1,remaining:1};return e.subclass({omegastructor:function(){function s(t,n){if(e.f_Q){if(t.tokenIndex!=n.tokenIndex){e.f_C=n;e.children.suggestions.set({tentativeValue:r,tentativeValueNo:-1,value:r,values:[]});S(e)}}}var e=this,i="";e.f_w_=n;e.f_x_=n;e.f_C=r;e.f_D=r;e.f_z=t;e.f_x=function(r){var i=r?g(e.f_D,r):g(e.f_C);e.f_x_=t;if(i.text===e+"")e.set("value","");e.set("value",i.text);e.f_x_=n;e.setCaretPosition(i.position);e.f_D=b(e,i.text,i.position)};e.wire({Cancel:function(){e.f_x_=t;e.set("value",i);e.f_x_=n},"Changed.focused":function(){if(e.get("focused")){i=e+"";e.f_C=e.f_D=b(e,e.get("tentativeValue"),e.getCaretPosition());E(e)}S(e)},"Changed.tentativeValue":function(){if(!e.f_x_&&e.get("focused")){clearTimeout(e.f_C_);if(e.f_w_){e.f_w_=n;E(e)}else e.f_C_=setTimeout(function(){E(e)},e.f_D_)}},"Key Up":function(t){var n=e.f_D,r=t.domEvent;if(f.isKeyEscape(r)){e.f_C=e.f_D=b(e,i,-1)}else if(!(e.isWired&&e.f_3&&e.getNodeStyle("suggestionsPalette","display")!="none"&&(f.isKeyUpArrow(r)||f.isKeyDownArrow(r)))){e.f_D=b(e,e.get("tentativeValue"),e.getCaretPosition());if(!e.f_x_&&e.get("focused"))e.f_C=e.f_D}n&&s(n,e.f_D);w(e,t.domEvent)},Click:function(){var t=e.f_D;e.f_D=b(e,e.get("tentativeValue"),e.getCaretPosition());t&&s(t,e.f_D)},Ok:function(){e.set("focused",n)}})},instanceMethods:{fireOkOnEnter:function(){var e=this.children.suggestions;return!(e&&e.get("tentativeValue"))},updateUi:function(){var t=this;if(t.isWired){S(t);e.doMy(t,"updateUi")}},wireUi:function(){var n=this,r=document.body,i=n.getNode("suggestionsPalette");if(!n.isWired){n.wireNode("input",{paste:function(){n.f_w_=t},keydown:function(e){var t=n.children.suggestions;n.f_3&&(f.isKeyUpArrow(e)||f.isKeyDownArrow(e)||f.isKeyTab(e)&&t&&t.get("values").length||f.isKeyEnter(e)&&t&&t.get("tentativeValue"))&&f.preventDefault(e)}});if(n.f_F_&&i&&i.parentNode!=r)r.insertBefore(i,r.childNodes[0]);n.setNodeStyle(i,{display:"none",position:"absolute",zIndex:1e4,left:"",top:"",right:"",bottom:""});n.setNodeProperties("input",{autocomplete:"off"});e.doMy(n,"wireUi")}}},stateProperties:{f_j_:{name:"additionalAutoSuggestParams",value:{}},f_3:{name:"allowKeypress",value:t},f_G_:{name:"autoPositionSuggestionsPalette",value:true},f_b_:{name:"cssClassHighlight",value:"suggestionHighlight"},f_s:{name:"cssClassSelected",value:"selectedSuggestion"},f_n_:{name:"highlightMode",conformer:function(e){return h[e]?e:"query"},value:"query"},f_u_:{name:"lastTypedQuery"},f_F_:{name:"moveSuggestionsPaletteToRoot",value:t},f_e_:{name:"numCharsBeforeSuggest",conformer:p(0),value:1},f_f_:{name:"numSuggestions",conformer:p(0),value:10},f_p_:{name:"optionDataAdapter",value:function(e,t){return{name:e,valueDetails:{name:e,displayName:t}}}},f_u:"optionsWidgetClass",f_v:"optionsWidgetProperties",f_S:"queryQuotes",f_Q:"querySeparators",f_l_:{name:"responseAdapter",value:function(e,t){return o.map(t,function(t){return{prefix:"",suffix:t.substr(e.length),fullWord:t}})}},f_g_:"serviceUrl",f_h_:{name:"serviceQueryParamName",value:"q"},f_i_:{name:"serviceNumSuggestionsParamName",value:"num"},f_9:{name:"showOnMouseover",value:n},f_D_:{name:"typeSuggestDelay",conformer:p(0),value:10}}})}});Uize.module({name:"Uize.Str.Replace",builder:function(){"use strict";var e;return Uize.package({replacerByLookup:e=function(e){var t=[],n=[];Uize.forEach(Uize.keys(e),function(e){if(e)(e.length>1?t:n).push(Uize.escapeRegExpLiteral(e))});n.length&&t.unshift("["+n.join("")+"]");var r=new RegExp(t.join("|"),"g");return function(t){return(t+="")&&t.replace(r,function(t){return e[t]})}},replaceByLookup:function(t,n){return e(n)(t)}})}});Uize.module({name:"Uize.Str.Split",builder:function(){"use strict";var e,t=[],n="a,,b".split(/,/)!=3||"1-2".split(/(-)/).join("|")!="1|-|2";return Uize.package({split:function(t,r,i){if(n&&r instanceof RegExp){if(i==e)i=Infinity;if(!i)return[];t+="";r=new RegExp(r.source,"g"+(r.multiline?"m":"")+(r.ignoreCase?"i":""));var s=t.length;if(s){var o=[],u=1,a,f=0;while(u&&f<s&&o.length<i){if((u=r.exec(t))&&!(a=u[0]))u.index=f+1;o.push(t.slice(f,u?u.index:s));if(u){u.length>1&&u.index<s&&Uize.push(o,u.slice(1));f=r.lastIndex=u.index+a.length;a&&f==s&&o.push("")}}return o}else{return r.test("")?[]:[""]}}else{var l=[r+"",i];l.length=arguments.length-1;return t.split.apply(t,l)}},splitInTwo:function(n,r){if(r instanceof RegExp)r=(n.match(r)||t)[0];var i=r!=e?n.indexOf(r):-1;return i>-1?[n.substr(0,i),n.substr(i+r.length)]:[n,""]}})}});Uize.module({name:"Uize.Template",required:["Uize.Str.Replace","Uize.Str.Split","Uize.Str.Trim"],builder:function(){"use strict";function b_o(e,t,n,r){if(t){t=t.split(b_m);for(var i=-1,s=t.length,o,u,a,f;++i<s;){if(u=b_d((o=b_c(t[n?s-i-1:i],"{"))[0])){if(a=b_j.test(u))u=u.replace(b_j,"");if(f=b_$.encodings[u]){if(n)a=!a;var l=b_d(o[1]),c=a?"from":"to",h=f[c];r&&r(u+":"+c,h.required);e=h.expansion(e,l?"{"+l:"")}}}}return e}var b_$=function(){},b__=true,b_a=false,b_b="string",b_c=Uize.Str.Split.splitInTwo,b_d=Uize.Str.Trim.trim,b_e=Uize.Str.Replace.replacerByLookup({"\\":"\\\\","\n":"\\n","\r":"\\r","'":"\\'"}),b_f={},b_g=/^\s*=/,b_h=/^\s*@/,b_i=/^\s*\./,b_j=/^!\s*/,b_k=/(\r|\n|\r\n)[ \t]*$/,b_l=/^[ \t]*(\r|\n|\r\n)[ \t]*/,b_m="->",b_n={};b_$.compile=function(b_C,b_D){function b_Y(e){if(b_P.length){b_O.push("output.push ("+b_P.join(",")+");");b_P=[]}b_O.push(e)}function required(e){var t=arguments;Uize.forEach(t.length!=1?t:typeof e==b_b?e.split(","):e,function(e){if(!b_F[e]){b_E.push(e);b_F[e]=1}})}function input(e){Uize.copyInto(b_H,e)}function startBlock(e,t){b_Y("function "+e+" ("+(t||"")+") {"+b_M)}function endBlock(){b_Y(b_N+"}")}b_D=b_D||b_f;var b_E=[],b_F={},b_G={},b_H={},b_I=b_D.openerToken||"<%",b_J=b_D.closerToken||"%>",b_K=b_D.gobbleWhitespace!==b_a,b_L=b_C.length,b_M="var output = [];",b_N="return output.join ('');",b_O=["var m = this, output = [];"],b_P=[],b_Q=0,b_R,b_S=b__,b_T,b_U,b_V,b_W,b_X;while(b_S){b_R=b_C.indexOf(b_I,b_Q);if(b_R<0)b_R=b_L;b_T=b_C.slice(b_Q,b_R);if(b_S=b_R<b_L){b_Q=b_C.indexOf(b_J,b_R+=2);b_W=b_g.test(b_U=b_C.slice(b_R,b_Q));b_X=b_W||b_i.test(b_U);b_V=!b_X&&b_h.test(b_U);b_Q+=2}if(b_T){if(b_K&&b_S&&!b_X&&b_k.test(b_T)&&b_l.test(b_C.substr(b_Q)))b_T=b_T.replace(b_k,"");b_T&&b_P.push("'"+b_e(b_T)+"'")}if(b_S){if(b_X){var b_5=b_c(b_W?b_U.replace(b_g,""):"input"+b_U,b_m);b_P.push(b_o(b_d(b_5[0]),b_5[1],b_a,function(e,t){if(!b_G[e]){required(t);b_G[e]=1}}))}else if(b_V){eval(b_U.replace(b_h,""))}else{b_Y(b_U)}}}b_Y(b_N);var b_8=b_O.join("\n"),b_9=Function("input",b_8);return b_D.result=="full"?{input:b_H,required:b_E,code:b_8,templateFunction:b_9}:b_9};b_$.encode=function(e,t,n){var r=(n?"! ":"")+t;return(b_n[r]||(b_n[r]=Function("e","return "+b_o("e",t,n))))(e)};b_$.decode=function(e,t){return b_$.encode(e,t,b__)};var b_b_=b_$.defineStandardEncoding=function(e,t,n,r){var i=t+"."+r+" (",s=t+"."+n+" (";b_$.encodings[e]={to:{required:t,expansion:function(e,t){return s+e+(t&&",")+t+")"}},from:{required:t,expansion:function(e,t){return i+e+(t&&",")+t+")"}}}};b_$.encodings={};b_b_("iso8601","Uize.Date","toIso8601","fromIso8601");b_b_("json","Uize.Json","to","from");b_b_("miniJson","Uize.Json","to","from");b_$.encodings.miniJson.to.expansion=function(e){return"Uize.Json.to ("+e+",'mini')"};b_b_("tagAttributes","Uize.Xml","toAttributes","fromAttributes");b_b_("tagAttributeValue","Uize.Xml","toAttributeValue","fromAttributeValue");b_b_("url","Uize.Url","resolve","from");b_b_("urlParams","Uize.Url","toParams","fromParams");b_b_("urlPiece","Uize.Url","toPiece","fromPiece");return b_$}});Uize.module({name:"Uize.Cookie",builder:function(){"use strict";var e,t=null;return Uize.package({setCookie:function(n,r,i,s){if(r===e||r==t){r="";s="Mon, 1 Jan 1990 12:00:00 UTC"}else{if(s===e){var o=new Date;o.setFullYear(o.getFullYear()+1);s=o.toGMTString()}}document.cookie=escape(n)+"="+escape(r)+";"+(i!==e&&i!=t?"path="+i+";":"")+(s!==t?"expires="+s+";":"")},getCookie:function(e){var t="",n=document.cookie;if(typeof n=="string"){n=n.replace(/ /g,"");for(var r=-1,i=n.split(";"),s=i.length;++r<s;){var o=i[r].split("=");if(unescape(o[0])==e){t=typeof o[1]=="string"?unescape(o[1]):"";break}}}return t}})}});Uize.module({name:"Uize.Url",builder:function(){"use strict";function h(e,t){var n=(e+="").indexOf("?");if(n<0&&!t)n=e.length;return{b_o:e.slice(0,n),b_p:e.slice(n+1)}}var e,t=Uize.isArray,n,r,i,s,o,u=[],a={},f=0,l={favorQuery:false},c=/^(\.\.\/)*/;return Uize.package({from:n=function(e){function n(e){return t?t[e]||"":""}var t=e&&e.match(/^(([^:\\\/]+:)\/\/(([^:\\\/]*)(:(\d+))?)?)?(([^\?#]*[\\\/])?(([^\\\/\?#]*?)(\.([^\.\?#]+))?))(\?([^#]*))?(#(.*))?$/);return{href:e,fullDomain:n(1),protocol:n(2),host:n(3),hostname:n(4),port:n(6),pathname:n(7),folderPath:n(8),file:n(9),fileName:n(10),extension:n(11),fileType:n(12),search:n(13),query:n(14),hash:n(15),anchor:n(16)}},fromParams:r=function(e,t){var n={};if(e=h(e,(t||a).favorQuery!==false).b_p){for(var r=-1,i=e.split("&"),o=i.length,u,f;++r<o;){if(f=(u=i[r].split("="))[0])n[s(f)]=s(u[1])}}return n},fromPiece:s=function(t){return t!=e?decodeURIComponent(t):""},getCacheDefeatStr:function(){return Uize.now()+""+Math.round(Math.random()*1e3)+f++},toRelative:function(e,t){if(!e){return t}else{var r=t.charAt(0)=="/";if(r==(e.charAt(0)=="/")&&t.match(c)[0].length==e.match(c)[0].length&&n(t).fullDomain==n(e).fullDomain){var i="",s=e.slice(0,e.lastIndexOf("/")+1),o=false,u;while(!o){if(!(o=t.slice(0,s.length)==s)){o=(u=s.lastIndexOf("/",s.length-2))<0;i+="../";s=s.slice(0,u+1)}}return i+t.slice(s.length)}else{return n(t).fullDomain?t:null}}},toAbsolute:function(e,t){var r=t?n(t):a;r.fullDomain?t="":r=n(e);var i,s=r.folderPath+t;while(s!=i){i=s;s=s.replace(/([\/\\])[^\/\\]*[\/\\]\.\.(?:[\/\\]|$)/,"$1")}return r.fullDomain+s.replace(/\.\.([\/\\]|$)/g,"")},toParams:i=function(n){var r=[],i;if(t(n))n=n.length<2?n[0]:Uize.copyInto.apply(Uize,[{}].concat(n));for(var s in n)s&&(i=n[s])!=e&&r.push(o(s)+"="+o(i));return r.join("&")},toPiece:o=function(t){return encodeURIComponent(t+"")},resolve:function(e,n){if(t(e)){n=e.slice(1).concat(n||u);e=e[0]}var s=i([r(e,l)].concat(t(n)?n:[n]));return h(e).b_o+(s?"?":"")+s}})}});Uize.module({name:"Uize.Node.Event",required:"Uize.Dom.Event",builder:function(){return Uize.Dom.Event}});Uize.module("ZazzleWww");Uize.module({name:"ZazzleWww.SearchInput",superclass:"Uize.Widget.AutoSuggest",required:["Uize.Cookie","Uize.Url","Uize.Node","Uize.Node.Event","Uize.Widget.Button"],builder:function(e){var t,n=Uize,r=true;var i=e.subclass(null,function(){function s(s){if(e.isWired&&!i){i=r;var o=e.getNodeValue("input"),u={qs:o===e.get("placeholder")?"":o,pg:1,cg:!e.getNode("inCategory")||!e.getNode("inCategory").checked?0:t};e.fire({name:"Track Event",bubble:r,extra:Uize.copyInto({ax:"search",pos:s?s:0,q:e.get("lastTypedQuery")},u)});n.Cookie.setCookie("ax",n.Url.toParams(n.copyInto({hs:true},u)),"/");function a(t){if(e.g_k){location.href=Uize.Url.resolve(e.getInherited("env").www+e.g_k,Uize.copyInto(e.g_l?e.getInherited("env").params:{},t))}else{location.href=e.callInherited("wwwSearchPag")(Uize.copyInto(e.g_l?e.getInherited("env").params:{},t))}}if(e.getInherited("env").lang=="ja-JP")e.ajax({serviceUrl:"/svc/search/tokenizer/tokenize",term:u.qs},function(e){e.success&&e.data.terms!=null&&(u.qs=e.data.terms.toString().replace(/,/g," "));a(u)});else a(u)}}var e=this,i=false;if(e.g_n){e.wire({Ok:function(){s(0)},"Suggestion Selected":function(e){s(e.option.get("name").substr(6)+1)}});e.wireNode("searchButton","click",function(t){if(e.g_p)s(0)})}}),s=i.prototype;s.wireUi=function(){var t=this;if(!t.isWired){var n=t.getNode("form");t.wireNode("form","submit",function(e){Uize.Node.Event.preventDefault(e)});e.doMy(t,"wireUi")}};i.stateProperties({g_l:{name:"useEnvParams",value:r},g_n:{name:"useZazzleSearch",value:r},g_k:{name:"targetPath",value:null},g_p:{name:"searchOnClick",value:true}});return i}});Uize.module({name:"ZazzleWww.BasicPromotion",superclass:"Uize.Widget",required:"Uize.Node",builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize;var s=e.subclass(),o=s.prototype;o.launchDetailsDialog=function(){var e=this;e.callInherited("useDialog")({component:{name:"ZazzleWww.Dialog.PromotionDetails",params:{promotion:e.d_f}},widgetClassName:"Uize.Widget.Dialog",widgetProperties:{name:"promotionDetailsDialog"}})};o.wireUi=function(){var t=this;if(!t.isWired){t.wireNode("details","click",function(){t.launchDetailsDialog()});e.doMy(t,"wireUi")}};s.stateProperties({d_f:"promotionId"});return s}});Uize.module({name:"ZazzleWww.BasicPromotion.Header",required:["Uize.Node","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize;var s=e.subclass(),o=s.prototype;s.mixins(i.Widget.mWeb);o.e_f=function(e){this.web("title").setClassState("active",e)};o.wireUi=function(){var r=this;if(!r.isWired){if(r.e_h){var s=document.documentElement,o=document.body;i.Node.wire(window,{load:function(){r.e_k&&setTimeout(function(){r.e_f(t);setTimeout(function(){r.e_f(n)},r.e_l)},r.e_m)},scroll:function(){var e=s&&s.scrollTop||o&&o.scrollTop||window.pageYOffset&&window.pageYOffset||0;r.e_o&&clearTimeout(r.e_o);r.e_o=setTimeout(function(){r.e_f(e>r.e_p)},e>r.e_p?r.e_q:r.e_r)}})}e.doMy(r,"wireUi")}};s.stateProperties({e_k:{name:"allowAnimationOnLoad",value:n},e_h:{name:"useAnimation",value:t},e_m:{name:"afterLoadAnimationDelay",value:1e3},e_l:{name:"afterLoadAnimationDuration",value:500},e_q:{name:"afterScrollAnimationDelay",value:10},e_r:{name:"afterScrollAnimationDuration",value:100},e_p:{name:"scrollThreshold",value:120}});return s}});Uize.module({name:"Uize.Widget.Collection",required:["Uize.Widget.Button","Uize.Dom.Event"],builder:function(e){"use strict";function i(e){e.fire("Items Changed")}function s(e){e.set({d_e:e.getSelected().length})}function o(e){e.isWired&&e.setNodeValue("totalItems",e.d_g)}function u(e){e.forAll(function(t){a(e,t)});e.d_k.length=0}function a(e,t){t.removeUi();t.kill();e.removeChild(t)}var t=true,n=false,r;return e.subclass({alphastructor:function(){var e=this;e.d_l=0;e.d_k=e.itemWidgets=[];e.wire("Items Changed",function(){e.set({d_g:e.d_k.length});s(e)});e.set("items",[])},omegastructor:function(){var e=this;e.addControlButton("selectAll",function(){e.selectAll()},'allSelected,totalItems,selectionMode,isEmpty: !allSelected && !isEmpty && (selectionMode != "single" || totalItems == 1)');e.addControlButton("selectNone",function(){e.selectAll(n)},"someSelected");e.addControlButton("remove",function(){e.removeWithConfirm(e.getSelected(),t)},"someSelected")},instanceMethods:{addControlButton:function(e,t,r){var i=this,s=Uize.Widget.Button.addChildButton.call(i,e,t);if(r)i.onChange(r,function(e){s.set({enabled:e?"inherit":n})});return s},addChild:function(t,n,r){var s=this,o=e.doMy(s,"addChild",[t,n,r]);if(s.isCollectionItem(o)){s.wireItemWidget(o);s.d_k.push(o);if(s.d_v.length<s.d_k.length){(s.d_v=!s.d_v.length?[]:s.d_v).push(o.get("properties"));i(s)}}return o},isCollectionItem:function(e){return e.isCollectionItem},addItemWidget:function(e,t){var n=this,r=n.addChild(e,n.d_y,Uize.copyInto(t,n.getItemWidgetProperties()));n.isWired&&r.insertOrWireUi();return r},wireItemWidget:function(e){var r=this;e.wire({"Changed.selected":function(t){if(t.newValue){r.d_A=="single"&&r.selectAll(n,r.d_B=e);r.fire({name:"Item Selected",itemWidget:e})}else if(e==r.d_B)r.d_B=null;s(r)},"Click Selected":function(i){var s=i.domEvent,o=s&&s.shiftKey,u=!o&&i.forceToggle||s&&(s.ctrlKey||s.metaKey),a=u||o;a&&Uize.Dom.Event.abort(s);if(r.d_A=="single"&&!(u&&e.get("selected"))||!a){e.set({selected:t});r.selectAll(n,r.d_B=e)}else{o?r.selectRange(r.d_B,e):(r.d_B=e).toggle("selected")}},"Item Changed":function(){var t,n=r.d_k;for(var s=-1;++s<n.length;)if(n[s]==e)t=s;r.d_v[t]=Uize.clone(e.get("properties"));i(r)},Remove:function(t){r.removeWithConfirm(e.get("selected")&&r.d_H?r.getSelected():[e],t.byUser)}})},forAll:function(e){for(var t=-1,r=this.d_k,i=r.length;++t<i;){if(e(r[t],t)===n)break}},getItemWidgetProperties:function(){return this.d_L},makeItemWidgetName:function(e){var t=this;return e&&t.d_N&&e[t.d_N]||t.d_O+(t.d_k.length?++t.d_l:t.d_l=0)},getSelected:function(e){var t=[];this.forAll(function(e){e.get("selected")&&t.push(e)});return!t.length&&e?this.d_k.concat():t},getPropertyForItems:function(e,t){return Uize.map(t,function(t){var n=t.get("properties");return e==r?n:n[e]})},getPropertyForSelected:function(e,t){return this.getPropertyForItems(e,this.getSelected(t))},updateUi:function(){o(this)},remove:function(e,t){function r(e,t){n.finishRemove(e,t)}var n=this;n.fire({name:"Remove",itemWidgets:e,byUser:t,finishRemove:r}).handled||r(e,t)},removeWithConfirm:function(e,t){var n=this,r=e.length;if(r){var i=function(){n.remove(e,t)};if(t){n.confirm({message:n.localize(r==1?"removeItemConfirmation":"removeItemsConfirmation",{0:r,itemsToRemove:e}),title:n.localize(r==1?"removeItemConfirmationTitle":"removeItemsConfirmationTitle",{0:r,itemsToRemove:e}),yesHandler:i})}else{i()}}},finishRemove:function(e,t){var n=this,r=n.get("items"),s=n.itemWidgets,o=s.length,f=e,l=e.length;if(l==o){u(n);r.length=0}else{f=[];l=0;var c=null;n.forAll(function(t,i){if(Uize.isIn(e,t)){c=null;f.push(t);l++;a(n,t,i)}else{if(!c&&!t.get("locked"))c=t;if(l){r[i-l]=r[i];s[i-l]=t}}});r.length=s.length=o-l}if(l){n.fire({name:"Items Removed",byUser:t,totalBeforeRemove:o,itemWidgetsRemoved:f,totalRemoved:l,percentRemoved:l/o*100});i(n)}},selectAll:function(e,t){if(!(e=e!==n)||this.d_A!="single"||this.d_g==1)this.forAll(function(n){n!==t&&n.set({selected:e})})},selectRange:function(e,t){var r=this;if(e&&t&&(r.d_A=="multi"||e==t)){var i=n;r.forAll(function(n){var r=n==e||n==t;if(r)i=!i;n.set({selected:i||r})})}},selectNone:function(){this.selectAll(n)}},stateProperties:{d_6:{name:"allSelected",derived:"totalSelected,totalItems: totalSelected > 0 && totalSelected == totalItems"},d_7:{name:"isEmpty",derived:"totalItems: !totalItems"},d_N:{name:"itemPropertyForItemWidgetName",value:"id"},d_H:{name:"itemRemoveActsOnSelection",value:n},d_v:{name:"items",onChange:function(){var e=this;u(e);Uize.forEach(e.d_v,function(t){e.addItemWidget(e.makeItemWidgetName(t),{properties:t})});i(e)}},d_y:"itemWidgetClass",d_O:{name:"itemWidgetNamePrefix",value:"item"},d_L:"itemWidgetProperties",d_8:{name:"oneSelected",derived:"totalSelected: totalSelected == 1"},d_A:{name:"selectionMode",value:"multi"},d_9:{name:"someSelected",derived:"totalSelected: totalSelected > 0"},d_g:{name:"totalItems",onChange:function(){o(this)}},d_e:{name:"totalSelected",value:0}}})}});Uize.module("Uize.Math");Uize.module({name:"Uize.Math.Blend",builder:function(e){"use strict";var t,n="object",r=Uize,i=r.constrain,s=r.isFunction,o=r.clone,u;return r.package({blend:u=function(e,a,f,l,c,h,p){if(e===a){return h!==t&&e===h?p:o(e)}else{if(s(c)){f=c(f);c=t}if(typeof e==n&&e&&!(e instanceof RegExp)){var d=h&&typeof h==n,v=l&&typeof l==n,m=c&&typeof c==n,g=d?h:r.isArray(e)?[]:{},y;for(var b in e){var w=u(e[b],a[b],f,v?l[b]:l,m?c[b]:c,y=g[b],p);if(d)d=w==p||typeof w!=n&&w==y;if(w!=p)g[b]=w}return d?p:g}else{var g=!f?e:f==1?a:!l?e+(a-e)*f:(l<0?l*=-1:l)&&(f<0||f>1)?e+Math.round((a-e)*f/l)*l:l!=Infinity?i(e+Math.round((a-e)*f/l)*l,e,a):e;return h!==t&&g===h?p:g}}}})}});Uize.module({name:"Uize.Fade",superclass:"Uize.Class",required:"Uize.Math.Blend",builder:function(e){"use strict";function a(){if((i=!!r.length)!=!!s)s=i?setInterval(f,10):clearInterval(s)}function f(){for(var e=-1,t;++e<r.length;)(t=r[e]).c_k?c(t):r.splice(e--,1);a()}function l(){var e=this,t=u(e.c_o,e.c_p,e.c_q,e.c_r,e.c_s,e.c_n,o);if(t!=o)t!=e.c_n?e.set({c_n:t}):e.fire({name:"Changed.value",newValue:t})}function c(e){var t=Math.min((n()-e.c_u)/e.c_v,1);e.set({c_q:e.c_w?1-t:t});if(t==1){e.stop();e.fire("Done")}}function h(){var e=this;e.set({c_s:e.c_y||e.c_z?e.Class.celeration(e.c_y,e.c_z):null})}function p(){this.c_n=null;l.call(this)}var t=Uize.constrain,n=Uize.now,r=[],i=false,s,o={},u=Uize.Math.Blend.blend;return Uize.mergeInto(e.subclass({instanceMethods:{stop:function(){this.set({c_k:false})},start:function(e){this.stop();this.set(Uize.copyInto({c_k:true},e))}},staticMethods:{blendValues:u,celeration:function(e,n){var r=1-(e=e||0)-(n=n||0),i=2/(1+r),s=e?i/e:0,o=s/2,u=n?-i/n:0,a=u/2,f=e*e,l;return r>=1?Uize.returnX:function(s){return(s=(e?t(s*s,0,f)*o:0)+(r?i*t(s-e,0,r):0)+(n?(i+(l=t(s-e-r,0,n))*a)*l:0))>1?1:s}}},stateProperties:{c_y:{name:"acceleration",onChange:h},c_s:{name:"curve",onChange:p},c_z:{name:"deceleration",onChange:h},c_v:{name:"duration",value:2e3},c_p:{name:"endValue",onChange:p,value:100},c_k:{name:"inProgress",onChange:function(){var e=this;if(e.c_k){e.c_u=n();e.fire("Start");e.c_n=e.c_q=null;c(e);r.push(e);a()}},value:false},c_q:{name:"progress",onChange:l,value:0},c_w:"reverse",c_o:{name:"startValue",onChange:p,value:0},c_r:"quantization",c_n:{name:"value",value:0}}}),{nonInheritableStatics:{blendValues:1,celeration:1}})}});Uize.module({name:"Uize.Widget.PopupPalette",required:["Uize.Node","Uize.Fade","Uize.Widget.Button"],builder:function(e){"use strict";function o(e){for(var t in s){var r=s[t];r!=e&&r.d_i&&r.set({d_j:n})}}function u(){a=t}function l(e){e.d_p.set({selected:e.d_j})}function c(e){return e.d_j&&(e.d_r!==n||e.d_s!==n)}function h(e){c(e)&&v(e);e.fire("Over")}function p(e){c(e)&&m(e);e.fire("Out")}function d(e,n){e.displayNode("palette",n);n&&e.setNodeStyle("palette",{filter:""});e.fire({name:"Palette "+(n?"Shown":"Dismissed"),bubble:t})}function v(e){if(e.d_z){clearTimeout(e.d_z);e.d_z=null}}function m(e){function r(){e.set({d_j:n})}var t=!Uize.isNumber(e.d_s)?250:e.d_s;v(e);t?e.d_z=setTimeout(r,!Uize.isNumber(e.d_s)?250:e.d_s):r()}var t=true,n=false,r=Uize.Node,i=Uize.Widget.Button.addChildButton,s={};if(typeof navigator!="undefined"){var a=n,f=document.onmousedown;document.onmousedown=function(e){a?a=n:o();Uize.isFunction(f)&&f(e||event)}}return e.subclass({omegastructor:function(){function o(n){function o(){e.set({d_j:t})}var i=n.name=="Over",s=e.d_r;if(i){if(s===t||s===0)o();else if(s>0)r=setTimeout(o,s);h(e)}else{clearTimeout(r);p(e)}}var e=this;e.fade=Uize.Fade({duration:750,curve:Uize.Fade.celeration(0,1)});e.fade.wire({"Changed.value":function(t){e.setNodeOpacity("palette",t.newValue)},Done:function(){d(e,e.d_j)}});var n=e.d_p=i.call(e,"selector",function(){e.toggle("shown")}),r;n.set({clickToDeselect:t});l(e);n.wire({Down:u,Over:o,Out:o});s[e.instanceId]=e},instanceMethods:{kill:function(){delete s[this.instanceId];e.doMy(this,"kill")},wireUi:function(){var t=this;if(!t.isWired){t.wireNode("palette",{mousedown:u,mouseup:function(e){t.d_G&&e.target!=t.getNode("palette")&&t.set({d_j:n})},mouseover:function(){h(t)},mouseout:function(){p(t)}});t.wireNode("paletteClose","click",function(){t.set({d_j:n})});if(t.d_H!="none"){var r=document.body,i=t.getNode("palette");if(i&&i.parentNode!=r){r.insertBefore(i,r.childNodes[0]);t.setNodeStyle(i,{zIndex:1e4,position:"absolute",left:"",top:"",right:"",bottom:"",width:t.getNodeStyle(i,"width")})}}e.doMy(t,"wireUi")}}},stateProperties:{d_i:{name:"exclusive",value:t},d_s:{name:"hideWhenOut",value:n},d_G:{name:"hideOnClick",value:t},d_H:{name:"positioning",value:"none"},d_j:{name:"shown",onChange:function(){var e=this,i=e.d_j,s=e.d_H;e.d_p&&l(e);if(e.isWired){v(e);if(i){e.fire("Before Palette Shown");e.d_i&&o(e);if(s!="none"){var u=e.getNode("palette"),a=Uize.isFunction(s)?s(u):e.d_p.getNode(),f=function(t){e.showNode("palette",!t);e.displayNode("palette",t)};if(r.isNode(a)){f(t);r.setAbsPosAdjacentTo(u,a);f(n)}}}if(e.fade.get("duration")>0){i&&e.displayNode("palette");e.fade.start({startValue:i?0:1,endValue:i?1:0})}else{d(e,i)}}},value:n},d_r:{name:"showWhenOver",value:n}}})}});Uize.module({name:"ZazzleWww.HeaderNavSection2",superclass:"Uize.Widget.PopupPalette",required:["Uize.Widget.Collection","Uize.Widget.mWeb"],builder:function(e){var t=false;var n=e.subclass(null,function(){function i(){var t=n.find({root:e.children.selector.getNode(),className:"navColumns"});if(t.length){var r=t[0],i=n.find({root:r,tagName:"UL"}),s=2;for(var o=-1;++o<i.length;)s+=n.getDimensions(i[o]).width;n.setStyle(r,{width:s})}}var e=this,n=Uize.Node,r=t;e.fade.set({duration:0});e.wire({Over:function(){e.e_j()},"Changed.shown":function(){r&&e.set({shown:t});e.get("shown")&&e.e_j(i)}});e.children.selector.wire({Down:function(){if(e.get("showWhenOver")!==t)r=true},Up:function(){r=t}});if(e.e_k=="User"){e.addChild("userFlyoutSavedDesigns",Uize.Widget.Collection);e.addChild("userFlyoutWishlist",Uize.Widget.Collection)}}),r=n.prototype;n.mixins(Uize.Widget.mWeb);r.e_j=function(e){function n(){e&&e()}var t=this;if(t.e_o=="unloaded"){t.set({e_o:"loading"});t.callInherited("loadHtmlIntoNode")({node:t.getNode("palette")},Uize.copyInto({cp:t.e_p,idPrefix:t.get("idPrefix"),navNo:t.e_k,now:t.e_q,md:"ContentOnly"},t.e_r),function(){t.flushNodeCache();t.set({e_o:"loaded"});n();if(t.e_k=="User"&&window&&window.s){var e=window.s;function r(n,r){var i=t.web(n.getNode("imageLink"));i.click(function(t){t.preventDefault();e.c_w(e.headerFlyoutCookie,r);window.location.href=i.attribute("href")})}t.children.userFlyoutSavedDesigns.forAll(function(e){r(e,"product")});t.children.userFlyoutWishlist.forAll(function(e){r(e,"wishlist")})}})}else n()};r.wireUi=function(){var n=this;if(!n.isWired){n.wireNode("title","click",function(e){if(n.get("showWhenOver")!==t||n.get("shown"))location.href=n.getNode("title").href});e.doMy(n,"wireUi")}};r.loadContent=r.e_j;r.reloadContent=function(){var e=this;e.set({e_o:"unloaded"});e.e_j()};n.stateProperties({e_r:{name:"additionalPaletteProperties",value:{}},e_p:{name:"contentPath",value:"zazzlewww.headerNavSection"},e_o:{name:"contentState",value:"unloaded"},e_q:"now",e_k:"sectionName"});return n}});Uize.module({name:"ZazzleWww.HeaderNavigation",superclass:"Uize.Widget",required:"ZazzleWww.HeaderNavSection2",builder:function(e){"use strict";var t=true,n=false;var r=e.subclass(null,function(){var e=this,r=e.d_c,i=-1,s=e.d_f.length,o=e.d_g=e.getInherited("env").isMobile,u=function(i){var s=e.addChild("navSection"+i,e.d_k||ZazzleWww.HeaderNavSection2,{contentPath:e.d_l,hideWhenOut:t,sectionName:i,showWhenOver:o?n:r,hideOnClick:o,now:e.d_m,additionalPaletteProperties:e.d_n});s.wire({"Before Palette Shown":function(){e.fire("Before Menu Dropdown Shown");e.displayNode("shield",t)},"Palette Shown":function(){e.fire("Menu Dropdown Shown")},"Palette Dismissed":function(){e.displayNode("shield",n);e.fire("Menu Dropdown Dismissed")}});e.wireNode("shield",{mouseup:function(){s.set({shown:n})}});e.d_o.push(s)};for(;++i<s;)u(e.d_f[i]);e.getNode("SELLERSTORES")&&u("SELLERSTORES");e.getNode("SELLERSTORESZBAR")&&u("SELLERSTORESZBAR")}),i=r.prototype;i.wireUi=function(){var t=this;if(!t.isWired){var r=t.d_o,i=t.d_c,s=t.d_g?n:Uize.isNumber(i)?i:0,o=function(e){var t=-1,n=r.length,i=function(){++t<n&&e(r[t],i)};i()};if(t.d_w){t.wireNode("",{mouseover:function(){for(var e=0;e<r.length;++e)r[e].loadContent()},mouseout:function(){o(function(e,t){e.set({showWhenOver:s});t()})}});s>0&&t.wireNode("","mouserest("+s+")",function(){o(function(e,t){e.set({showWhenOver:0});t()})})}e.doMy(t,"wireUi")}};r.stateProperties({d_n:{name:"additionalPaletteProperties",value:{}},d_c:"delay",d_l:{name:"contentPath",value:"zazzlewww.headerNavSection"},d_o:{value:[]},d_f:{name:"sections",value:{}},d_k:"sectionWidgetClass",d_m:"now",d_w:{name:"deferWireSections",value:true}});return r}});Uize.module({name:"ZazzleWww.ZazzleHeader",superclass:"ZazzleWww.HeaderNavigation",required:["Uize.Node","Uize.Widget.Options","Uize.Widget.mWeb","ZazzleWww.SearchInput","ZazzleWww.BasicPromotion.Header"],builder:function(e){"use strict";var t=true,n=false,r=ZazzleWww;var i=e.subclass(null,function(){var e=this,i=e.addChild("cartContents",Uize.Widget.Options,{html:t,built:n,values:[]}),s=e.addChild("cartContents2",Uize.Widget.Options,{html:t,built:n,values:[]}),o=function(t){var i=e.addChild("headerSearch"+(t?"2":""),r.SearchInput,{useEnvParams:n});i.wire("Changed.focused",function(){var n=i.get("focused");e.isWired&&e.web().setClassState("searchActive",n);e.isWired&&!t&&e.displayNode("shield",n);if(t&&i.get("focused")){Uize.require("Uize.Fx.Scroll",function(e){setTimeout(function(){e.scrollToNode(i.getNode("input"),{scrollToTop:true,duration:250})},250)})}});!t&&e.web(i.getNode("searchButton")).mousedown(function(){var t=e.web().hasClass("searchActive");if(!t)i.set("focused",true);i.set("searchOnClick",t)})};o();o(t);e.addChild("promoGlobal",r.BasicPromotion.Header);if(!e.e_l){var u=e.children.navSectionCart;u&&u.set({contentState:"loaded"});u&&u.wire("Before Palette Shown",function(){e.retrieveCartItems(s)});if(e.e_n){var a=e.children.navSectionShop,f=e.children.navSectionMake,l=e.children.navSectionSell;a&&a.set({contentState:"loaded"});f&&f.set({contentState:"loaded"});l&&l.set({contentState:"loaded"})}}});i.mixins(Uize.Widget.mWeb);i.prototype.retrieveCartItems=function(e){var t=this;t.ajax({serviceUrl:"/co/cartservice",bg:"515151"},function(n){var r=n.records;if(r)(e||t.children.cartContents).set({values:r.slice(Math.max(r.length-t.e_u,0))})})};i.stateProperties({e_l:"compatibilityMode",e_u:{name:"maxCartItemsToShowInPalettes",value:3},e_n:"serverLoadMainSectionPalettes"});return i}});Uize.module({name:"Uize.Json",builder:function(){"use strict";var e,t="string",n=[],r={},i="       ",s=i.replace(/ /g,i).replace(/ /g,i),o={RegExp:1,Date:1,String:1,Number:1,Boolean:1},u=Uize.lookup(["break","boolean","case","catch","continue","const","debugger","default","delete","do","else","export","false","finally","for","function","if","import","in","instanceof","new","null","return","switch","this","throw","true","try","typeof","var","void","while","with","implements","interface","let","package","private","protected","public","static","yield"],r),a={indentChars:"	",keyAlign:"left",keyDelimiter:":",linebreakChars:"\n",padKeys:false,quoteChar:"'",sortKeys:false,whenToQuoteKeys:"auto"},f={whenToQuoteKeys:"always",quoteChar:'"'},l={indentChars:"",linebreakChars:""},c={mini:Uize.copy(a,l),miniStrict:Uize.copy(a,l,f),nice:a,strict:Uize.copy(a,f)};return Uize.package({encodingOptionsPresets:c,from:function(e){return e?Uize.eval("0,("+e+")"):null},to:function(i,a){function f(e,n){var r=a[e];return typeof r==t?r:n}function S(e){return s.substr(0,e)}function x(e){return d+e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(v,m)+d}function T(i,s,a,f){function d(e,t){l.push(a+(c++?"":s)+e+(t?",":""))}var c=0,p=typeof i;if(i==e||p=="number"||p=="boolean"||p=="function"){d(i,f)}else if(p==t){d(x(i),f)}else if(p=="object"){var v=i.constructor,m=v==Object||v==Array,N;if(!m)N=((v+"").match(typeof v=="object"?/\[object\s+([^\]]+)\]/:/^\s*function\s+([^\(]+)\s*\(/)||n)[1]||"";if(m||N=="Object"||N=="Array"){var C=a+h;if(i instanceof Array||i&&Uize.isFunction(i.splice)){var k=i.length;if(k){var L=k-1;d("[");for(var A=-1;++A<k;)T(i[A],"",C,A<L);d("]",f)}else{d("[]",f)}}else{var O=Uize.keys(i),M=O.length;if(M){g&&O.sort();var _=function(e){return isNaN(+e)?/[^\w\$]|^\d/.test(e)||u[e]==r:e!=+e+""||e<0};var D=E=="always";if(!D&&E=="auto all"){for(var P=-1;++P<M&&!D;)D=D||_(O[P])}var H=[];for(var P=-1;++P<M;){var B=O[P];H[P]=D||_(B)?x(B):B}var j=0;if(y){for(var P=-1;++P<M;)j=Math.max(j,H[P].length)}var F=M-1;d("{");for(var P=-1;++P<M;){var I="",q=H[P];if(y){var R=j-q.length,U=Math.round(w*R);I=S(U);q+=S(R-U)}T(i[O[P]],q+b,C+I,P<F)}d("}",f)}else{d("{}",f)}}}else{if(o[N]){d("new "+N+" ("+(N=="String"?x(i):i.valueOf())+")",f)}else{d("{}",f)}}}}a=(typeof a=="string"?c[a]:a)||c.nice;var l=[],h=f("indentChars","	"),p=f("linebreakChars","\n"),d=f("quoteChar","'"),v=new RegExp(d,"g"),m="\\"+d,g=a.sortKeys===true,y=a.padKeys===true,b=a.keyDelimiter||":",w={left:0,center:.5,right:1}[a.keyAlign||"left"],E=a.whenToQuoteKeys||"auto";T(i,"","");return l.join(p)}})}});Uize.module({name:"Zazzle.Widget",superclass:"Uize.Widget",required:"Uize.Widget.mWeb",builder:function(e){"use strict";return e.subclass({mixins:Uize.Widget.mWeb})}});Uize.module({name:"Zazzle.MediaGallery",superclass:"Zazzle.Widget",required:"Uize.Json",builder:function(e){"use strict";var t=true;var n=e.subclass(),r=n.prototype;r.clickHandler=function(e){var n=this,r=function(e){n.callInherited("loadHtmlIntoNode")({injectMode:"inner top"},{cp:"Zazzle.MediaGallerySlideshow",idPrefix:n.childId("gallerySlideshow"),selected:e.id,maxDim:n.e_e,imageRequestSize:n.e_f,galleryType:"SUPPORTING",productTypeName:n.e_g},{cache:"none",beforeInject:function(e,t){var r=n.children.gallerySlideshow;if(r){r.removeUi();n.removeChild(r)}e()},callback:function(){}})},i=n.children.gallerySlideshow;if(i){i.updateUi();n.web(i).display(t);i.clickHandler(e)}else{r(e)}};r.wireUi=function(){var t=this;if(!t.isWired){if(t.e_k&&t.e_k.length){Uize.forEach(t.e_k,function(e){t.web("item"+e.index).click(function(){t.clickHandler(e)})})}e.doMy(t,"wireUi")}};n.stateProperties({e_e:{name:"galleryImageSize",value:210},e_f:{name:"gallerySelectedSize",value:700},e_k:{name:"mediaData",value:[]},e_g:"productTypeName"});return n}});Uize.module({name:"Zazzle.SeeMoreUi",superclass:"Zazzle.Widget",builder:function(e){var t=e.subclass(),n=t.prototype;n.e_b=function(){var e=this;if(e.isWired){var t=e.e_c,n=e.web("container");n.css("maxHeight",t?e.e_e:"none");e.web("seeLess").display(!t);e.web("seeMore").display(t&&n.height()>=parseInt(n.css("maxHeight")))}};n.updateUi=function(){var t=this;if(t.isWired){t.e_b();e.doMy(t,"updateUi")}};n.wireUi=function(){var t=this;if(!t.isWired){t.web(["seeMore","seeLess"]).click(function(){t.toggle("collapsed")});e.doMy(t,"wireUi")}};t.stateProperties({e_c:{name:"collapsed",onChange:n.e_b,value:true},e_e:{name:"shortHeight",onChange:n.e_b}});return t}});Uize.module({name:"Zazzle.ProductValueMessagingUi",superclass:"Uize.Widget",required:["Uize.Node","Uize.Data","Uize.Url"],builder:function(e){"use strict";var t=Uize.Node,n=null;var r=e.subclass(),i=r.prototype;i.d_d=function(){var e=this;if(e.isWired){e.ajax({service:"product/maketimes/get",pt:e.d_e,pd:e.d_f,att:Uize.Url.toParams(e.d_g),accd:e.d_h,ppd:e.d_i,patt:Uize.Url.toParams(e.d_j)},{cache:"memory",callbackSuccess:function(t){if(t.success){var n=t.data;e.set({d_m:n.inStock,d_n:n.makeTimes})}}})}};i.d_o=function(){var e=this;if(e.isWired){var r=e.d_m,i=e.d_p,s=e.d_n,o=e.d_r,u=s&&s.minDays>0&&s.maxDays>=s.minDays,a=e.d_u.length,f=e.d_v,l=e.d_w,c=e.d_x,h=e.d_y,p=a,d=function(){return t.getDimensions(l).width>t.getDimensions(f).width};e.setNodeStyle(c.concat(e.d_y),{display:"inline",visibility:"hidden"});!r&&i&&e.displayNode([c[0],h[0]],false);!u&&o&&e.displayNode([c[i?1:0],h[i?1:0]],false);if(o&&u){var s=e.d_n,v=e.d_B,m;if(s.minDays==s.maxDays)m=s.minDays==1&&s.minDateTomorrow?e.localize("shipDateTomorrow"):e.localize("shipDateDate",{date:s.minDate});else if(!(s.minDays%v)&&!(s.maxDays%v))m=e.localize("shipDateWeekRange",{minWeek:s.minDays/v,maxWeek:s.maxDays/v});else m=e.localize("shipDateDayRange",{minDay:s.minDays,maxDay:s.maxDays});e.setNodeInnerHtml(c[i?1:0],m)}while((d()||p>3)&&--p>0){e.displayNode([c[p],p>0?h[p-1]:n],false)}e.showNode(e.d_x.concat(e.d_y),true)}};i.updateUi=function(){var t=this;if(t.isWired){t.d_o();e.doMy(t,"updateUi")}};i.wireUi=function(){var t=this;if(!t.isWired){t.d_p=t.d_u[0]=="InStock";t.d_r=t.d_u[t.d_p?1:0]=="ShipDate";t.d_t=t.d_u.length;t.d_v=t.getNode();t.d_w=t.getNode("messages");t.d_x=[];t.d_y=[];for(var n=-1;++n<t.d_t;){n>0&&t.d_y.push(t.getNode("separator"+n));t.d_x.push(t.getNode("message"+n))}e.doMy(t,"wireUi")}};r.stateProperties({d_h:{name:"accessoryId",onChange:i.d_d},d_m:{name:"inStock",onChange:i.d_o},d_n:{name:"makeTimes",onChange:i.d_o},d_u:{name:"messages",value:[]},d_i:{name:"parentProductId",onChange:i.d_d},d_j:{name:"parentProductOption",onChange:i.d_d},d_f:{name:"productId",onChange:i.d_d},d_g:{name:"productOption",conformer:function(e){return Uize.Data.identical(e,this.d_g)?this.d_g:e},onChange:i.d_d},d_e:{name:"productType",onChange:i.d_d},d_B:{name:"weekMultiplier",value:5}});return r}});Uize.module({name:"Uize.Widget.Fleeting",required:"Uize.Fade",builder:function(e){"use strict";function n(e){e.d_b!=t&&e.isWired&&e.setNodeInnerHtml("text",e.d_b)}var t;return e.subclass({alphastructor:function(){var e=this;e.d_c=null;e.d_d=Uize.Fade({curve:Uize.Fade.celeration(0,1),duration:750});e.d_d.wire({Start:function(){e.d_e&&e.displayNode("",e.d_e)},"Changed.value":function(){e.setNodeOpacity("",e.d_d)},Done:function(){!e.d_e&&e.displayNode("",e.d_e)}})},instanceMethods:{show:function(){var e=this;if(e.d_c!=null){clearTimeout(e.d_f);e.d_f=null}e.set({d_e:true})},updateUi:function(){var t=this;if(t.isWired){n(t);e.doMy(t,"updateUi")}},wireUi:function(){var n=this;if(!n.isWired){var r=n.d_g=n.getNode();if(r){n.d_b==t&&n.set({d_b:n.getNodeValue("text")});n.wireNode("","click",function(){if(n.d_h)n.set({d_e:false})});e.doMy(n,"wireUi")}}}},stateProperties:{d_h:{name:"clickToDismiss",value:false},d_i:{name:"maxOpacity",value:1},d_j:{name:"lifeSpan",value:5e3},d_e:{name:"shown",onChange:function(){var e=this;if(e.isWired){e.d_e&&e.fire("Before Show");e.d_d.start({startValue:e.d_e?0:e.d_i,endValue:e.d_e?e.d_i:0});if(e.d_e)e.d_c=setTimeout(function(){e.set({d_e:false})},e.d_j);!e.d_e&&e.fire("After Hide")}},value:false},d_b:{name:"text",onChange:function(){n(this)}}}})}});Uize.module({name:"ZazzleWww.AccessoryUi",superclass:"Uize.Widget.Button",required:["Uize.Url","Zazzle.SeeMoreUi","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=false,n=null;var r=e.subclass(n,function(){var e=this;e.addChild("seeMore",Zazzle.SeeMoreUi);e.addChild("add",Uize.Widget.Button).wire("Click",function(){e.e_c()})}),i=r.prototype;r.mixins(Uize.Widget.mWeb);i.e_c=function(){var e=this,r=e.e_e,i=r.isDependent,s=function(s){e.callInherited("useProductUiDialog")({action:i?"bundle":"addtocartservice",productId:r.productId,productAttributes:Uize.copyInto({},r.attributes,{context:null,view:null}),title:r.title,okText:e.children.add.get("text"),isEditable:t,allowOos:t,singleProductContext:true,accessoryId:r.accessoryId,parentProductOption:e.e_i,parentProductId:s,parentProductType:e.e_j,productTitle:r.title,showQuantitySelector:i?n:true,submitHandler:function(t){e.fire({name:"Accessory Added",widget:e,parentProductId:s,attributes:t.attributeValues,isDependent:i})},dismissHandler:function(){e.fire({name:"Cancel Add",widget:e,parentProductId:s})}})};!e.fire({name:"Before Add",handler:s}).handled&&s(e.e_h)};i.e_l=function(e){var t=this;if(t.isWired){}};i.e_n=function(){var e=this,t=e.e_e;if(e.isWired){e.web("title").html(t.title).property("title",t.title);e.web("description").html(t.description);e.web("price").html(t.price);e.web("thumbnail").value(Uize.Url.resolve(t.thumbnailUrl,{max_dim:e.e_o==="List"?e.e_p:e.e_q}));e.children.seeMore.updateUi()}};i.updateUi=function(){var t=this;if(t.isWired){t.e_n();e.doMy(t,"updateUi")}};i.wireUi=function(){var t=this;if(!t.isWired){t.web("thumbnail").click(function(){t.e_c()});e.doMy(t,"wireUi")}};r.stateProperties({e_e:{name:"info",onChange:i.e_n},e_i:"parentAttributes",e_h:"parentProductId",e_j:"parentProductType",e_q:{name:"thumbnailSizeGrid",value:152},e_p:{name:"thumbnailSizeList",value:92},e_o:{name:"view",value:"List"}});return r}});Uize.module({name:"ZazzleWww.AccessoriesUi",superclass:"Uize.Widget.Options",required:["ZazzleWww.AccessoryUi","Uize.Url","Uize.Data","Uize.Node","Uize.Widget.Fleeting","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=Uize,n=t.Node,r=t.Url.toParams,i=null,s;var o=e.subclass(i,function(){var e=this,i=e.addChild("added",t.Widget.Fleeting);e.wire({"Option Event":function(t){var s=t.childEvent,o=s.name;if(o=="Accessory Added"){var u=s.widget,a=s.widget.get("info"),f=i.getNodeStyle("",{paddingLeft:1,paddingRight:1});i.setNodeStyle("",{width:n.getDimensions(u.getNode("title")).width-parseInt(f.paddingLeft||0)-parseInt(f.paddingRight||0),top:n.getCoords(u.getNode()).top-n.getCoords(e.getNode()).top});i.set({text:e.localize("accessoryAdded",{accessoryName:a.productTypeDisplayName}),shown:true});a.isDependent?e.ajax({service:"product/bundle",ax:"createoradd",pd:a.productId,ea:r(s.attributes),qty:a.quantity,did:a.dependencyId,ppd:e.e_m,patt:r(e.e_n),pqty:e.e_o},function(t){if(t.success)e.fire({name:"Accessory Added",bundleId:t.bundleId});else e.inform({message:e.localize("accessoryAddFailed")})}):e.fire({name:"Accessory Added",isDependent:false,parentProductId:s.parentProductId})}else if(o=="Before Add"||o=="Cancel Add")e.fire(s)},"Changed.values":function(){e.e_q()}})}),u=o.prototype;o.mixins(t.Widget.mWeb);u.e_s=function(){var e=this;e.isWired&&e.getNode()&&(e.e_m||e.e_t)&&e.ajax({service:"product/accessories/get",pt:e.e_t,pd:e.e_m,ea:r(e.e_n),bg:e.e_u,ta:r(e.e_v)},{cache:"memory",callbackSuccess:function(n){if(n.success){var r=e.e_w,i=e.e_x,o=n.data;if(r==s)r=0;if(i==s)i=Infinity;if(r>0||i<Infinity){i=Math.min(o.length-1,i);var u=[];for(var a=r;a<=i;a++)u.push(o[a]);o=u}!t.Data.identical(o,e.get("values"))&&e.set({values:o})}}})};u.e_q=function(){var e=this;if(e.isWired){e.web().display(!t.isEmpty(e.get("values")));e.forAll(function(e){e.updateUi()})}};u.getOptionProperties=function(n,r){var i=this;return t.copyInto(e.doMy(i,"getOptionProperties",[n,r])||{},{backgroundColor:i.e_u,info:r.info,parentAttributes:i.e_n,parentProductId:i.e_m,parentProductType:i.e_t,thumbnailSizeGrid:i.e_E,thumbnailSizeList:i.e_F,view:i.e_G})};u.updateUi=function(){var t=this;if(t.isWired){t.e_q();e.doMy(t,"updateUi")}};u.wireUi=function(){var t=this;if(!t.isWired){e.doMy(t,"wireUi");!t.e_H&&t.e_I&&t.e_s();t.e_H=true}};o.stateProperties({e_n:{name:"attributes",conformer:function(e){return Uize.Data.identical(e,this.e_n)?this.e_n:e},onChange:u.e_s},e_u:{name:"backgroundColor",onChange:u.e_s},e_I:"clientSideLoaded",e_x:"endIndex",e_m:{name:"productId",onChange:u.e_s},e_t:{name:"productType",onChange:u.e_s},e_o:{name:"quantity",value:1},e_w:"startIndex",e_v:{name:"templateParams",onChange:u.e_s},e_E:{name:"thumbnailSizeGrid",value:152},e_F:{name:"thumbnailSizeList",value:92},e_G:{name:"view",value:"List"}});o.set({optionWidgetClass:ZazzleWww.AccessoryUi,html:true});return o}});Uize.module({name:"ZazzleWww.ProductPagePromotions",superclass:"Zazzle.Widget",builder:function(e){"use strict";var t=true,n=false;var r=e.subclass(),i=r.prototype;i.wireUi=function(){var r=this;if(!r.isWired){r.wireNode("seeBelow","click",function(){r.e_d&&Uize.require("Uize.Fx.Scroll",function(e){e.scrollToNode(r.e_d)})});if(r.e_f){r.web("close").click(function(){r.web().setClassState(r.e_g,t);r.web("closeTab").hide();r.web("offerTab").show();r.fire({name:"Changed.height",bubble:t})});r.web("offerTab").click(function(){r.web().setClassState(r.e_g,n);r.web("closeTab").show();r.web("offerTab").hide();r.fire({name:"Changed.height",bubble:t})});r.web().setClassState(r.e_h,n);r.web("closeTab").contentHeight(r.web("content").dimensions().height);r.web().setClassState(r.e_h,t)}if(r.e_i){r.web("content").click(function(e){if(e.target.tagName.toLowerCase()!=="a")r.web().toggleClassState(r.e_k)})}e.doMy(r,"wireUi")}};r.stateProperties({e_d:"scrollToNodeId",e_h:"cssClassOpen",e_g:"cssClassCollapsed",e_k:"cssClassToggled",e_f:{name:"allowTab",value:n},e_i:"toggleOnClick"});return r}});Uize.module({name:"Zazzle.SelectorValueDisplayBase",superclass:"Uize.Widget.Button.ValueDisplay.Selector",required:"Uize.Url",builder:function(e){"use strict";var t=false,n=null,r=Uize.Url,i="Alternate",s="None",o=function(){this.set({g_f:true});return this.canWire},u=function(){this.set({canWire:this.g_f&&!this.isWired&&this.g_h!==t})},a=function(){this.set({canUpdate:this.isWired&&this.g_h!==t})},f=function(){var e=this,o=e.get("valueDetails"),u=e.g_l;if(e.isWired&&o&&u){var a=function(e){return!!e},f=function(t,n,r){var i=e.web(t);i.display(r);r&&i.html(n)},l=u.showDisplayName==i?o.displayNameAlt||o.displayName:o.displayName,c=o.importantInfo,h=u.showDescription==i?o.descriptionAlt||o.description:o.description,p=u.showThumbnail==i?o.thumbnailUrlAlt||o.thumbnailUrl:o.thumbnailUrl,d=e.showDisplayName=u.showDisplayName!=s&&a(l),v=e.showImportantInfo=u.showImportantInfo&&a(c),m=e.showDescription=u.showDescription!=s&&a(h),g=e.showThumbnail=e.g_A!=t&&u.showThumbnail!=s&&a(p),y=e.showInput=u.showInput!=s,b=e.showData=d||v||m,w=e.web("thumbnail"),E=e.getInherited("env").assets;e.web("input").display(y);if(b){f("displayName",l,d);f("importantInfo",c,v);f("description",h,m)}w.display(g);if(g){var S=p.charAt(0)=="#",x=S?n:r.resolve(p,p.indexOf(E)<0||r.from(p).query?{max_dim:e.g_H,bg:u.thumbnailBgColor}:{});w.css({backgroundColor:S?p:"transparent",backgroundImage:x?'url("'+x+'")':"none"})}}},l=function(){this.set({g_h:this.g_A!==t||this.g_J!==t})};return e.subclass({omegastructor:function(){var e=this;e.wire({"Changed.valueDetails":function(){e.g_j()},"Changed.wired":function(){u.call(e);a.call(e)}})},instanceMethods:{g_j:f,insertOrWireUi:o,prepareToWire:o,unwireUi:function(){this.set({g_f:false});e.doMy(this,"unwireUi")},updateUi:function(){var t=this;if(t.isWired&&t.canUpdate){e.doMy(t,"updateUi");t.g_j()}},wireUi:function(){var t=this;!t.isWired&&t.prepareToWire()&&e.doMy(t,"wireUi")}},stateProperties:{g_H:{name:"thumbnailSize",onChange:f},g_l:{name:"valueDisplayInfo",onChange:f},canUpdate:{onChange:function(){this.canUpdate&&this.updateUi()}},canWire:{onChange:function(){if(this.canWire)this.get("built")?this.wireUi():this.insertUi()}},g_f:{name:"desiredWired",onChange:u},g_A:{name:"seen",onChange:l},g_h:{name:"usable",onChange:[u,a]},g_J:{name:"usableWhenNotSeen",onChange:l,value:t}},set:{mode:null}})}});Uize.module({name:"Zazzle.SelectorValueDisplay",superclass:"Zazzle.SelectorValueDisplayBase",required:"Uize.Widget.mWeb",builder:function(e){var t=function(){var e=this;e.web("label").value(e.h_a)},n=function(){var e=this,t=e.get("valueDetails"),n=e.get("valueDisplayInfo");if(e.isWired&&e.canUpdate&&t&&n){var r=t.attributes&&t.attributes.zazzicon,i=r&&r.indexOf("zazzicon-")===0,s=!!(e.showThumbnail||i),o=e.showData=e.showData||!!e.getNode("label")||e.h_i,u=e.getNode("inputImage");e.web(["inputCell","inputCellExtra"]).display(n.showInput);e.web("input").display(!u);e.web(u).display();e.web("displayData").display(o);e.web("thumbnailCell").display(s);if(s){!(e.h_k&&t.name!=null)&&e.web("thumbnail").property({alt:t.displayName,title:t.displayName})}e.web("thumbnailZazzicon").display(i);i&&e.web("thumbnailZazzicon").addClass(r);e.web("thumbDataExtra").display(o&&s)}};return e.subclass({mixins:[Uize.Widget.mWeb],omegastructor:function(){var e=this;e.wire("Changed.valueDetails",function(){e.h_b()})},instanceMethods:{h_b:n,h__:t,updateUi:function(){var t=this;if(t.isWired&&t.canUpdate){e.doMy(t,"updateUi");t.h_b();t.h__()}}},stateProperties:{h_a:{name:"label",onChange:t},h_i:{name:"showAfterDisplayNameContent",onChange:n}}})}});Uize.module({name:"Zazzle.SelectorValueDisplay.DroplistButton",required:["Uize.Widget.Button","Uize.Dom.Util"],builder:function(e){"use strict";var t=function(){var e=this,t=e.i_a;if(e.isWired){e.web(e.children.right).display(t);Uize.Dom.Util.showClickable(e.web("displayName")[0],t&&e.get("enabledInherited"))}};return e.subclass({omegastructor:function(){var e=this,t=e.addChild("left",Uize.Widget.Button),n=e.addChild("right",Uize.Widget.Button);e.wire("Changed.selected",function(){var r=e.get("selected");t.set({selected:r});n.set({selected:r})})},instanceMethods:{i__:t,updateUi:function(){var t=this;if(t.isWired&&t.canUpdate){t.i__();e.doMy(t,"updateUi")}}},stateProperties:{i_a:{name:"allowSelection",onChange:[function(){this.set({enabled:this.i_a?"inherit":false})},t],value:true}}})}});Uize.module({name:"Zazzle.OptionsSelector",superclass:"Uize.Widget.Options.Selector",required:["Uize.Node","Zazzle.SelectorValueDisplay","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=true,n=false,r=Uize.Node;var i=e.subclass(null,function(){var e=this;e.wire("Changed.values",function(){e.f_d=n;e.f_e();e.f_f()})}),s=i.prototype;i.mixins(Uize.Widget.mWeb);s.f_h=function(){var e=this;e.forAll(function(t){t&&t.set({valueDisplayInfo:e.f_j})})};s.f_k=function(){var e=this;if(e.isWired){var t=e.f_l||[],r=Uize.lookup(t),i=!!e.f_n,s=e.get("values");e.forAll(function(t,o){if(t){var u=!!r[s[o].name];t.set({enabled:u?n:"inherit"});if(i){e.web("option"+o).display(!u);e.web(t).display(!u)}}})}};s.f_f=function(){var e=this,n=e.f_j;if(e.isWired&&e.get("values")&&!e.f_d){var r=e.getNode("options");if(r&&n&&n.layout=="Vertical"){var i=0,s=0,o=t,u=t,a=n.showThumbnail!="None";e.forAll(function(t,n){var r=e.web("option"+n).dimensions(),a=r.height,f=r.width;i=a>i?a:i;s=f>s?f:s;o&=!n||a===i;u&=!n||f===s});i&&s&&!(o&&u)&&e.forAll(function(t,n){var r={};r.height=i;if(a)r.width=s;!Uize.isEmpty(r)&&e.web("option"+n).css(r)});if(i&&s)e.f_d=t}}};s.getOptionProperties=function(t,n){return Uize.copyInto(e.doMy(this,"getOptionProperties",[t,n])||{},{valueDisplayInfo:this.f_j})};s.updateUiOptionsSeen=s.f_e=function(){var e=this;if(e.isWired){var t=e.web("options");if(t.length){var i=e.get("valueNo"),s=0,o=0,u=0,a=0,f=null,l=function(){return f!==null?f:f=t.scrollHeight()>(a=a||t.height())||t.scrollWidth()>(u=u||t.width())},c=n;e.forAll(function(n,f){var h=function(){var n=e.web("option"+f),i=n.dimensions(),l=n.offset();return n.length&&r.doRectanglesOverlap(s=s||t.scrollLeft(),o=o||t.scrollTop(),u=u||t.width(),a=a||t.height(),l.left,l.top,i.width,i.height)},p=n.get("seen")||f==i;if(!p&&(!l()||h()))p=c=true;n.set({seen:p});return!c||p})}}};s.updateUi=function(){var t=this;if(t.isWired){t.f_e();t.f_f();t.f_k();e.doMy(t,"updateUi")}};s.wireUi=function(){var t=this;if(!t.isWired){t.web("options").scroll(function(){t.f_e()},500);e.doMy(t,"wireUi")}};i.stateProperties({f_n:{name:"hideDisabledOptions",value:n},f_l:{name:"disabledList",onChange:s.f_k},f_j:{name:"valueDisplayInfo",onChange:s.f_h}});i.set({optionWidgetClass:Zazzle.SelectorValueDisplay,html:true});return i}});Uize.module({name:"Uize.Util.Coupler",superclass:"Uize.Class",builder:function(e){"use strict";function n(){var e=this,n=e.c_b;if(n){for(var r=-1,i=n.length,s;++r<i;)(s=n[r]).c_f.unwire(s.c_g,s.c_h);n=e.c_b=null}if(e.c_i){var o=e.c_j,u=e.c_k;if(o&&u){Uize.callOn(o,"set",[o[0].get(u)]);var a=u.length,f=u.concat().sort()+"",l=t[f];if(!l){var c=["if (target.UIZE_UTIL_COUPLER_driver) return;"];if(a>1){c.push("var properties, changedMap = eventObj.properties;");for(var h=-1;++h<a;){var p="'"+u[h]+"'";c.push("if ("+p+" in changedMap) (properties || (properties = {})) ["+p+"] = changedMap ["+p+"];")}c.push("if (!properties) return;")}else{var p="'"+u[0]+"'";c.push("var properties = {"+p+":eventObj.source.get ("+p+")};")}c.push("var source = eventObj.source;","source.UIZE_UTIL_COUPLER_driver = 1;","target.set (properties);","delete source.UIZE_UTIL_COUPLER_driver;");l=t[f]=Function("eventObj,target",c.join(""))}n=e.c_b=[];var d="Changed."+(a>1?"*":u[0]),v=function(e,t){var r=function(e){l(e,t)};n.push({c_f:e,c_g:d,c_h:r});e.wire(d,r)};for(var m=-1,g=o.length;++m<o.length;)v(o[m],o[(m+1)%g])}}}var t={};return e.subclass({stateProperties:{c_i:{name:"coupled",onChange:n,value:true},c_j:{name:"instances",onChange:n},c_k:{name:"properties",onChange:n}}})}});Uize.module({name:"Uize.Widget.Button.Checkbox",builder:function(e){"use strict";var t=e.subclass(function(){var e=this;e.wire("Click",function(){e.toggle("selected")})});t.set({clickToDeselect:true});return t}});Uize.module({name:"Uize.Widget.Drag",required:["Uize.Node","Uize.Dom.Event"],builder:function(e){"use strict";function c(e){e.d_k=null;e.fire("Drag Rest")}function h(e){e.d_k&&clearTimeout(e.d_k);e.d_k=null}function p(e){if(e.isWired){var t=e.getNode();e.d_o?i.setStyle(e.d_p?[t,u]:t,{cursor:e.get("enabledInherited")?e.d_o:"not-allowed"}):e.set({d_o:i.getStyle(t,"cursor")})}}function d(e,o){function m(e){if(f.d_p){if(f.d_x){f.d_x.stop();f.d_x=t}T=n;if(f.d_k){h(f);c(f)}f.set({d_z:r,d_p:r,d_A:r,d_B:r});f.fire({name:"Drag Done",domEvent:e});f.set({d_C:r,d_D:r});if(S){f.unwireNode(o?"":e.target,{touchmove:null,touchend:null,touchcancel:null})}}}function g(t,r,i,s){f.set(t,n);(f.d_x=Uize.Fade.fade(b,[d[0],d[1]],r,i,s)).wire("Done",function(){m(e)})}function y(e){if(f.d_L&&Uize.Fade&&Uize.Fade.fade){var t=d[0]-v[0],n=d[1]-v[1];if(t||n){var r=Math.sqrt(Math.pow(t,2)+Math.pow(n,2)),i=f.d_L(r/(f.d_Q-f.d_R||1)*1e3),s=1+i.distance/r;g("inReleaseTravel",[v[0]+t*s,v[1]+n*s],i.duration*1e3,{curve:i.curve});return}}m(e)}function b(e,t){f.d_R=f.d_Q;f.d_Q=Uize.now();v[0]=d[0];v[1]=d[1];var n=[(d[0]=e)-l[0],(d[1]=t)-l[1]],r=[Math.abs(n[0]),Math.abs(n[1])];for(var i=-1;++i<2;)f.d_V[i]=f.d_Y=="both"||r[i]>r[1-i]||r[i]==r[1-i]&&i==1?n[i]:0;f.fire("Drag Update");h(f);f.d_k=setTimeout(function(){c(f)},f.d_Z)}function w(e){if(!T&&!f.d_C){if(!f.d_D){if(!S){f.Class.resizeShield(u);i.display(u)}f.set({d_D:n});f.fire({name:"Drag Start",domEvent:e})}var t=s(e);b(t.left,t.top)}}function E(e){f.set({d_C:n});if(f.d_3&&Uize.Fade&&Uize.Fade.fade){g("inCancel",l,500,f.d_3)}else{b(l[0],l[1]);m(e)}}var f=this,l=f.d_t,d=f.d_u,v=f.d_v;if(f.d_z||f.d_A)m(e);if(!f.d_p&&f.get("enabledInherited")){var S=!!e.targetTouches;f.set({d_p:n,d_B:S});p(f);Uize.Dom.Event.abort(e);f.d_Y=e.shiftKey?"one":"both";f.fire({name:"Before Drag Start",domEvent:e});var x=s(e);l[0]=d[0]=v[0]=x.left;l[1]=d[1]=v[1]=x.top;f.d_Q=f.d_R=Uize.now();var T=r,N;if(!S)N={onkeyup:document.onkeyup,onmousemove:document.onmousemove,onmouseup:document.onmouseup};if(S){f.wireNode(o?"":e.target,{touchmove:function(e){e.preventDefault();w(e)},touchend:function(e){e.preventDefault();y(e)},touchcancel:function(e){e.preventDefault();E(e)}})}else{var C=function(e){Uize.copyInto(document,N);i.display(u,r);f.d_C||y(e)};document.onmousemove=function(e){e||(e=window.event);a&&e.button==0?f.d_p&&C(e):w(e);return r};document.onmouseup=function(e){C(e||window.event);return r};document.onkeyup=function(e){Uize.Dom.Event.isKeyEscape(e)&&f.d_p&&E(e)}}}return r}var t,n=true,r=false,i=Uize.Node,s=i.getEventAbsPos,o=i.isIe,u,a=r,f=r;if(typeof navigator!="undefined"){var l=i.ieMajorVersion;a=o&&l<9;f=!o||l>6}return e.subclass({alphastructor:function(){var e=this;e.eventStartPos=e.d_t=[0,0];e.eventPos=e.d_u=[0,0];e.d_v=[0,0];e.d_Q=e.d_R=0;e.eventDeltaPos=e.d_V=[0,0]},instanceMethods:{initiate:d,mousedown:d,updateUi:function(){var e=this;e.isWired&&!e.get("enabledInherited")||e.d_o&&p(e)},wireUi:function(){var t=this;if(!t.isWired){var r=t.getNode();if(r){r.onmousedown=Uize.returnFalse;var s=function(e){return t.initiate(e,n)};t.wireNode(r,{mousedown:s,touchstart:s})}if(!u){u=t.Class.insertShield({zIndex:5e4});f||i.wire(window,"resize",function(){t.Class.resizeShield(u)})}t.wire({"Changed.enabledInherited":function(){p(t)}});e.doMy(t,"wireUi")}}},staticMethods:{insertShield:function(e){var t=this,r={display:"none",position:"absolute"};if(o)r.background="url("+t.getBlankImageUrl()+")";var s=document.createElement("div");i.setStyle(s,Uize.copyInto(r,e));s.Uize_Widget_Drag_shield=n;document.body.appendChild(s);t.resizeShield(s);return s},resizeShield:function(e){if(f){i.setStyle(e,{left:"0",top:"0",width:"100%",height:"100%",position:"fixed"})}else{var t=i.getStyle(e,"display"),n=document.documentElement,s=document.body;i.display(e,r);i.setStyle(e,{left:0,top:0,width:n.scrollWidth,height:Math.max(typeof window.innerHeight=="number"?window.innerHeight:n&&n.clientHeight?n.clientHeight:s&&s.clientHeight?s.clientHeight:0,n.scrollHeight),display:t})}}},stateProperties:{d_c_:{name:"animation",onChange:function(){this.set({d_3:this.d_c_?{duration:500}:t})}},d_3:"cancelFade",d_o:{name:"cursor",onChange:function(){p(this)}},d_C:"dragCancelled",d_Z:{name:"dragRestTime",value:250},d_D:"dragStarted",d_z:"inCancel",d_p:"inDrag",d_A:"inReleaseTravel",d_B:"isTouch",d_L:"releaseTravel"}})}});Uize.module({name:"Uize.Widget.Dialog",required:["Uize.Node","Uize.Widget.Button","Uize.Widget.Drag","Uize.Fade"],builder:function(e){"use strict";function p(e,t,n){var r=e.addChild(t,e.Class.buttonWidgetClass);r.wire("Click",n);return r}function d(e,t){e.fire(t).abort||e.set({d_r:n})}function v(){var e=this;if(e.isWired){var t=e.d_u||e.d_v;t!=r&&e.setNodeInnerHtml("title",t||"&nbsp;")}}function m(){function n(e,t){e&&t!=r&&e.set({text:t})}var e=this,t=e.children;n(t.ok,e.d_B||e.d_C);n(t.cancel,e.d_D||e.d_E)}var t=true,n=false,r,i=Uize.Node,s=Uize.Widget,o=s.Drag,u="updateUiDimsIfShown",a="updateUiPositionIfShown",f={},l={},c=0,h=i.ieMajorVersion==6;var g=e.subclass({alphastructor:function(){var e=this;(e.d_G=e.shieldFade=Uize.Fade({curve:Uize.Fade.celeration(0,1),duration:750})).wire("Changed.value",function(t){e.set({d_I:t.newValue})});e.wire({"Drag Start":function(){if(!e.d_J){e.d_J=t;e.fire("First Drag Since Shown");e.d_K&&e.set({d_L:n})}},"Drag Done":function(){var t=i.getById(e.d_M);if(t){var n=i.getCoords(t),r=e.getNode();e.set({offsetX:parseInt(i.getStyle(r,"left"))-n.left,offsetY:parseInt(i.getStyle(r,"top"))-n.top})}}})},omegastructor:function(){var e=this;var t,n=[0,0];(e.d_Q=e.addChild("drag",o,{cursor:"move"})).wire({"Before Drag Start":function(){t=e.getNode();n[0]=parseInt(i.getStyle(t,"left"));n[1]=parseInt(i.getStyle(t,"top"))},"Changed.inDrag":function(t){e.set({d_R:t.newValue})},"Drag Start":e,"Drag Update":function(){var r=e.d_Q.eventDeltaPos;i.setStyle(t,{left:n[0]+r[0],top:n[1]+r[1]})},"Drag Done":e});p(e,"close",function(){d(e,"Close")});p(e,"qualifiedOk",function(){d(e,"Qualified Ok")});p(e,"ok",function(){d(e,"Ok")});p(e,"cancel",function(){d(e,"Cancel")});m.call(e);e.atEndOfOmegaStructor()},instanceMethods:{atEndOfOmegaStructor:Uize.nop,afterWireUi:Uize.nop,responsiveUpdateUiPositionAndDimensions:function(){var e=this,t=e.getNode(),n=e.getNode(e.d_T);e.setNodeStyle(n,{maxWidth:"",maxHeight:""});var r=i.getCoords(window),s=i.getDimensions(t),o=n==t,u=o?s:i.getDimensions(n);e.setNodeStyle(n,{maxWidth:s.width>r.width?r.width-(s.width-u.width):"",maxHeight:s.height>r.height?r.height-(s.height-u.height):""});if(s.width>r.width||s.height>r.height)s=i.getDimensions(t);var a=r.x+(r.width-s.width>>1),f=r.y+(r.height-s.height>>1);e.setNodeStyle(t,{left:a>0?a:0,top:f>0?f:0})},updateUiPositionIfShown:function(){var e=this;if(e.isWired&&e.d_r&&!e.d_R){o.resizeShield(e.getNode("shield"));if(e.d_0){var t=e.getNode(),n=i.getById(e.d_M),s=e.d_1,u=e.d_2;if(!n||s==r||u==r){e.responsiveUpdateUiPositionAndDimensions()}if(n){if(s=="adjacent"||u=="adjacent"){i.setAbsPosAdjacentTo(t,n)}else{var a=i.getCoords(n);i.setStyle(t,Uize.copy(s!=r?{left:a.left+s}:r,u!=r?{top:a.top+u}:r))}}}}},updateUiDimsIfShown:function(){var e=this;e.isWired&&e.d_r&&!e.d_R&&e.setNodeStyle(e.getNode(e.d_T),{width:e.d_3,height:e.d_4})},updateUi:function(){var t=this;if(t.isWired){v.call(t);e.doMy(t,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){t.wireNode(window,"resize",function(){t.updateUiPositionIfShown()});t.d_Q.set({node:t.getNode("title")});t.wireNode("shield","click",function(){t.d_5&&d(t,"Close")});var n=function(e,n,r){if(!t.get(e)){var i=(n.getNode(r)||f).innerHTML;i&&t.set(e,i)}};n("defaultTitle",t,"title");n("defaultOkText",t.children.ok,"text");n("defaultCancelText",t.children.cancel,"text");e.doMy(t,"wireUi");t.afterWireUi()}}},stateProperties:{d_0:{name:"autoPosition",value:t,onChange:a},d_D:{name:"cancelText",onChange:m},d_I:{name:"currentShieldOpacity",onChange:function(){var e=this;e.isWired&&e.d_r&&e.setNodeOpacity("shield",e.d_I)}},d_E:{name:"defaultCancelText",onChange:m},d_C:{name:"defaultOkText",onChange:m},d_v:{name:"defaultTitle",onChange:v},d_5:{name:"dismissOnShieldClick",value:n},d_4:{name:"height",onChange:[u,a]},d_K:{name:"hideShieldOnDrag",value:t},d_R:{name:"inDrag",value:n},d_M:{name:"mooringNode",onChange:a},d_T:{name:"nodeToSetDimension",onChange:[u,a],value:""},d_1:{name:"offsetX",onChange:a,value:0},d_2:{name:"offsetY",onChange:a,value:0},d_$_:{name:"okEnabledOnShow",value:t},d_B:{name:"okText",onChange:m},d___:{name:"shieldOpacity",onChange:function(){this.d_L&&this.set({d_I:this.d___})},value:.3},d_L:{name:"shieldShown",onChange:function(){var e=this;if(e.isWired&&e.d_r){if(e.d_L){if(h&&e.getNode("shield")){if(!e.d_5&&!e.getNode("ie6SelectHackShield")){e.flushNodeCache("ie6SelectHackShield");e.injectNodeHtml("shield",'<iframe src="javascript:\'\'" id="'+e.d_a_+'-ie6SelectHackShield" style="position:absolute; left:0; top:0; width:100%; height:100%; filter:alpha(opacity=0);" frameborder="0" scrolling="no"></iframe>',"inner bottom")}}e.d_I=r;e.set({d_I:e.d___})}else{e.d_G.start({startValue:e.d___,endValue:.001})}}},value:n},d_r:{name:"shown",onChange:function(){var e=this;if(e.isWired){if(e.d_r){c++;g.openDialogs[e.get("name")]=e;e.d_J=n;typeof e.d_$_=="boolean"&&e.children.ok.set({enabled:e.d_$_?"inherit":n});e.fire("Before Show");e.setNodeStyle("",{position:"absolute"});var r=-1;for(var i in l)r=Math.max(r,i);l[e.d_c_=++r]=1;e.setNodeStyle(["","shield"],{zIndex:4e3+r*10});var s=function(t){e.showNode("",!t);e.displayNode("",t)};s(t);e.updateUiDimsIfShown();e.updateUiPositionIfShown();s(n)}else{c--;delete g.openDialogs[e.get("name")];delete l[e.d_c_];e.fire("Before Hide")}e.set({d_L:e.d_r});e.displayNode(["","shield"],e.d_r);e.fire(e.d_r?"After Show":"After Hide")}},value:n},d_u:{name:"title",onChange:v},d_3:{name:"width",onChange:[u,a]}},staticProperties:{buttonWidgetClass:Uize.Widget.Button,openDialogs:{}}});return g}});Uize.module({name:"Uize.Widget.Dialog.Picker",required:"Uize.Widget.Button.Checkbox",builder:function(e){"use strict";function r(e){e.e_c&&e.children.keepOpen.set({selected:e.e_d})}var t=false,n=true;return e.subclass({omegastructor:function(){function i(t){var r=e.children.value,i=r.get("valueDetails"),s;e.e_i=n;e.fireSubmissionComplete(t,Uize.copyInto({value:r.valueOf()},i!==s?{valueDetails:i}:s,e.e_j&&r.get(e.e_j)))}function s(){if(e.e_i){e.children.value.set({value:e.e_o});i(t)}}var e=this;e.addChild("value",e.e_k).wire("Changed.value",function(){!e.e_l&&setTimeout(function(){i(e.e_d);e.e_d||e.set({shown:t})},0)});e.addChild("keepOpen",Uize.Widget.Button.Checkbox).wire("Changed.selected",function(t){e.set({e_d:t.source.get("selected")})});e.wire({Ok:function(){i()},Cancel:s,Close:s,"Before Show":function(){e.e_l=n;e.children.value.set(e.get((e.e_j||[]).concat("value")));e.e_o=e.e_p;e.e_l=e.e_i=t}});e.e_c=n;r(e)},instanceMethods:{fireSubmissionComplete:function(e,t){var n=this;n.get("shown")&&n.fire({name:"Submission Complete",result:t,keepOpen:e})}},stateProperties:{e_d:{name:"keepOpen",onChange:function(){r(this)},value:t},e_k:"valueWidgetClass",e_r:"picker",e_j:"pipedProperties",e_p:"value"},set:{shieldOpacity:.01}})}});Uize.module({name:"Uize.Widget.Dialog.Picker.Palette",required:["Uize.Dom.Basics","Uize.Util.Coupler"],builder:function(e){"use strict";function t(e){if(e.isWired&&e.f_a){e.setNodeStyle("",{minWidth:e.f_a});Uize.Dom.Basics.isIe&&Uize.Dom.Basics.ieMajorVersion<=7&&e.setNodeStyle("valueShell",{minWidth:e.f_a})}}return e.subclass({omegastructor:function(){var e=this;Uize.Util.Coupler({instances:[e,e.children.value],properties:["tentativeValue","tentativeValueDetails"]});e.wire("After Show",function(){e.children.value.updateUi();t(e)})},stateProperties:{f_a:{name:"minWidth",onChange:function(){t(this)}},f_b:{name:"tentativeValue",onChange:function(){var e=this;setTimeout(function(){e.fireSubmissionComplete(true,{tentativeValue:e.f_b,tentativeValueDetails:e.f_c})},0)},value:null},f_c:"tentativeValueDetails"},set:{dismissOnShieldClick:true}})}});Uize.module({name:"Uize.Widget.Dialog.Picker.Palette.Selector",required:["Uize.Widget.Options.Selector","Uize.Util.Coupler"],builder:function(e){"use strict";function t(e){this.fireSubmissionComplete(true,e)}return e.subclass({omegastructor:function(){var e=this,t=e.children.value;e.wire("After Show",function(){t.updateUi()});Uize.Util.Coupler({instances:[e,t],properties:["valueNo","tentativeValueNo"]})},stateProperties:{g_c:{name:"tentativeValueNo",onChange:t,value:-1},g_d:{name:"valueNo",onChange:t,value:-1},g_e:{name:"values",value:[]}},set:{pipedProperties:["values"],valueWidgetClass:Uize.Widget.Options.Selector,shieldOpacity:.01}})}});Uize.module({name:"Zazzle.DroplistPalette",superclass:"Uize.Widget.Dialog.Picker.Palette.Selector",required:"Zazzle.OptionsSelector",builder:function(e){"use strict";var t=e.subclass();t.stateProperties({h_a:"disabledList",h_b:"hideDisabledOptions"});t.set({pipedProperties:(t.get("pipedProperties")||[]).concat("disabledList","hideDisabledOptions"),valueWidgetClass:Zazzle.OptionsSelector});return t}});Uize.module({name:"Uize.Widget.Picker",superclass:"Uize.Widget.FormElement",required:["Uize.Widget.Button.ValueDisplay","Uize.Dom.Event"],builder:function(e){"use strict";var t=null;return e.subclass({omegastructor:function(){var e=this,t=function(){e.pickValue()};e.wire("Changed.focused",function(){e.get("focused")&&!e.e_b&&t()});e.addChild("selector",e.e_c||Uize.Widget.Button.ValueDisplay,e.e_d).wire("Click",t)},instanceMethods:{getDialogWidgetProperties:function(){return t},getMoreDialogEventHandlers:function(){return t},getMooringNode:function(){return this.children.selector.getNode()||this.getNode("input")},handleDialogSubmit:function(e){var n=this,r=e.value,i=e.valueDetails,s;n.set(Uize.copy(i!==s?{valueDetails:i}:s,r!==s?{value:r!=t?n.e_i?n.e_i.call(n,r):r:""}:s))},pickValue:function(){function i(){e.e_b&&e.set({focused:true})}var e=this;e.set({focused:false});var n=e.getMooringNode(),r=Uize.Node.getDimensions(n);e.callInherited("useDialog")({component:e.e_m?Uize.copyInto(e.e_m,{value:e.get("value")}):t,widgetClassName:e.e_n,widgetProperties:Uize.copyInto({name:e.e_o||"dialog"+e.e_n.replace(/\./g,""),picker:e,mooringNode:n,offsetX:r.width>>1,offsetY:r.height>>1},e.getDialogWidgetProperties(),e.get((e.e_p||[]).concat("value","valueDetails"))),submitHandler:function(t,n){e.handleDialogSubmit(t);n&&n.keepOpen||i()},dismissHandler:i,widgetEventHandlers:e.getMoreDialogEventHandlers()})},wireUi:function(){var t=this;if(!t.isWired){t.wireNode("input","mousedown",function(e){if(!t.e_b){Uize.Dom.Event.abort(e);t.pickValue()}});e.doMy(t,"wireUi")}}},stateProperties:{e_b:{name:"allowManualEntry",value:true},e_m:"dialogComponent",e_o:"dialogName",e_n:"dialogWidgetClass",e_p:"pipedProperties",e_c:"selectorButtonWidgetClass",e_d:"selectorButtonWidgetProperties",e_g:{name:"valueDetails",onChange:function(){var e=this.children.selector;e&&e.set({valueDetails:this.e_g})}},e_i:"valueFormatter"},set:{value:t}})}});Uize.module({name:"Uize.Widget.Picker.Palette",required:"Uize.Node",builder:function(e){"use strict";function s(e){var t=e.getMooringNode();return t?r.getDimensions(t).width:undefined}function o(e){if(e.isWired){var t=e.children.selector.getNode("valueDisplayShell"),n=r.getDimensions(t).width,i=parseInt(e.getNodeStyle(t,"maxWidth")),o=e.f_j;if(o&&n<o){e.setNodeStyle(t,{minWidth:i?Math.min(o,i):o})}else if(n){e.f_j=n;e.palette&&e.palette.set({minWidth:s(e)})}}}var t=true,n=false,r=Uize.Node,i=Uize.copyInto;return e.subclass({omegastructor:function(){var e=this;e.wire("Changed.valueDetails",function(){e.set({f_k:e.get("valueDetails")});o(e)});e.f_j=0},instanceMethods:{getDialogWidgetProperties:function(){var t=this;return i(e.doMy(t,"getDialogWidgetProperties")||{},{parent:t,offsetX:"adjacent",offsetY:"adjacent",minWidth:s(t)})},getMoreDialogEventHandlers:function(){function f(e){return Uize.pairUp("Changed."+e,function(t){o.palette=t.source;var n=o.palette.get(e);n!==a&&o.set(e,n)})}var o=this,u=o.children.selector,a;return i(e.doMy(o,"getMoreDialogEventHandlers")||{},f("tentativeValue"),f("tentativeValueDetails"),{"Before Show":function(e){var n=o.palette=e.source;u.set({selected:t});o.set({focused:t});n.set({minWidth:s(o)});if(!o.f_s){o.f_s=t;var i=n.getNode(),a=document.body;if(i&&i.parentNode!=a){var f=n.getNode("shield");r.remove([i,f]);f&&a.appendChild(f);a.appendChild(i)}}},"After Hide":function(){o.set({focused:n});u.set({selected:n});o.palette=a}})},updateUi:function(){var t=this;if(t.isWired){o(t);e.doMy(t,"updateUi")}}},stateProperties:{f_w:{name:"syncTentativeValue",value:t},f_k:{name:"tentativeValueDetails",onChange:function(){var e=this;e.f_w&&e.children.selector.set({valueDetails:e.f_k});o(e)}}},set:{dialogName:"palette"}})}});Uize.module({name:"Uize.Widget.FormElement.Select",builder:function(e){"use strict";function t(e){if(e.isWired){var t=e.get("value"),n=e.e_b,r=e.getNode("input");if(n&&r&&e.get("type")=="select-one"){var i=false;e.e_e=-1;for(var s=-1,o=n.length,u=r.options,a=u.length;++s<o;){var f=n[s],l=f.name,c=t==l,h;if(s<a)h=u[s];else{h=document.createElement("option");try{r.add(h,null)}catch(p){r.add(h)}}e.setNodeProperties(h,{value:l,text:f.valueDetails&&f.valueDetails.displayName||f.displayName||l,selected:c});if(c)i=true}for(var d=a-1;d>=s;d--)r.remove(d);if(!(i&&t)&&n.length)e.set({value:n[0].name})}}}return e.subclass({alphastructor:function(){this.e_b=[]},omegastructor:function(){var e=this;e.wire("Changed.value",function(){if(e.isWired){var t=e.getNode("input");t&&e.set({e_e:t.selectedIndex})}})},instanceMethods:{wireUi:function(){var n=this;if(!n.isWired){e.doMy(n,"wireUi");var r=n.e_b||[],i=n.getNode("input");if(r.length)t(n);else if(i&&n.get("type")=="select-one"){for(var s=n.get("value"),o=i.options,u=-1,a=o.length;++u<a;){var f=o[u],l=f.value,c=f.text,h=l!=null?l:c;r.push({name:h,displayName:c});if(h==s)f.selected=true}(n.e_e=i.selectedIndex)>-1&&n.set({value:r[n.e_e].name})}}}},stateProperties:{e_e:{name:"valueNo",value:-1},e_b:{name:"values",onChange:function(){t(this)}}}})}});Uize.module({name:"Uize.Widget.mChildBindings",builder:function(){"use strict";function f(e,t,n,r,i){var s=e.get(t);n.set(r,i?i(s,e,n):s)}var e,t=Uize,n=t.forEach,r=t.isString,i=t.isArray,s=t.isPlainObject,o=t.resolveTransformer,u=t.pairUp,a=/^([<\->]+)?(\w+)(\.(.+))?$/;return function(t){t.declare({alphastructor:function(){var e=this,t=e.addedChildren;n(e.Class.mChildBindings_bindings,function(n,r){t.whenever(r,function(){for(var t in n)n[t](e)})})},staticMethods:{childBindings:function(t){var l=this.mChildBindings_bindings;n(t,function(t,c){function h(t){var n=r(t)&&t.match(a);if(n)t={child:n[2],property:n[4],direction:n[1]};if(s(t)&&t.child){var i=t.child,h=t.property||c,p=t.direction||"<->",d=p.length,v=t.valueAdapter,m=v&&v.aToB&&o(v.aToB),g=v&&v.bToA&&o(v.bToA),y=p.indexOf("->")==d-2,b=!p.indexOf("<-"),w=p.indexOf("<->"),E="Changed."+c,S="Changed."+h;(l[i]=l[i]||{})[c+"/"+h]=function(t){function o(){f(t,c,n,h,m)}function a(){f(n,h,t,c,g)}var n=t.children[i],r,s;if(y){(w||t.get(c)!==e)&&o();t.wire(r=u(E,o))}if(b){a();n.wire(s=u(S,a))}t.addedChildren.whenever("!"+i,function(){if(n){r&&t.unwire(r);s&&n&&n.unwire(s);n=undefined}})}}}i(t)?n(t,h):h(t)})}},staticProperties:{mChildBindings_bindings:{}}})}}});Uize.module({name:"Uize.Widget.Picker.Palette.Selector",required:"Uize.Widget.Button.ValueDisplay.Selector",builder:function(e){"use strict";return e.subclass({omegastructor:function(){function t(){var t=e.getValueObject();e.set({valueDetails:t?t.valueDetails:null})}var e=this;e.wire({"Changed.value":t,"Changed.values":t});t()},instanceMethods:{getValueObject:function(e){return Uize.findRecord(this.g_c,{name:e==undefined?this+"":e})},getMoreDialogEventHandlers:function(){function n(e){return Uize.pairUp("Changed."+e,function(n){var r=n.source.get(e);r!==undefined&&t.set(e,r)})}var t=this;return Uize.copyInto(e.doMy(t,"getMoreDialogEventHandlers")||{},n("valueNo"),n("tentativeValueNo"))}},stateProperties:{g_h:{name:"tentativeValueNo",value:-1},g_i:{name:"valueNo",value:-1},g_c:{name:"values",value:[]}},set:{pipedProperties:["values","valueNo","tentativeValueNo"],selectorButtonWidgetClass:Uize.Widget.Button.ValueDisplay.Selector,dialogWidgetClass:"Uize.Widget.Dialog.Picker.Palette.Selector"}})}});Uize.module("Zazzle.Picker");Uize.module("Zazzle.Picker.Palette");Uize.module({name:"Zazzle.Picker.Palette.Selector",superclass:"Uize.Widget.Picker.Palette.Selector",required:"Zazzle.SelectorValueDisplay.DroplistButton",builder:function(e){"use strict";var t=e.subclass();t.prototype.getMooringNode=function(){return this.children.selector.getNode("shell")||e.doMy(this,"getMooringNode")};t.stateProperties({h_a:"disabledList",h_b:"hideDisabledOptions"});t.set({selectorButtonWidgetClass:Zazzle.SelectorValueDisplay.DroplistButton,dialogWidgetClass:"Zazzle.DroplistPalette",pipedProperties:(t.get("pipedProperties")||[]).concat("disabledList","hideDisabledOptions")});return t}});Uize.module({name:"Zazzle.Droplist",superclass:"Zazzle.Picker.Palette.Selector",required:["Uize.Widget.FormElement.Select","Uize.Widget.mChildBindings","Uize.Widget.mWeb"],builder:function(e){"use strict";return e.subclass({mixins:[Uize.Widget.mWeb,Uize.Widget.mChildBindings],omegastructor:function(){var e=this,t=function(){var t=e.get("values"),n=[];if(t){for(var r=-1;++r<t.length;){var i=t[r];n.push({name:i.name,displayName:i.valueDetails?i.valueDetails.displayName:null})}}return t},n=e.addChild("select",Uize.Widget.FormElement.Select,{values:t(),value:e+""}),r=e.children.selector,i=function(t){r.children[t].wire("Click",function(){e.pickValue()})};e.wire({"Changed.value":function(){n.set({value:e+""});e.validate()},"Changed.values":function(){n.set({values:t()})}});i("left");i("right")},instanceMethods:{wireUi:function(){var t=this;if(!t.isWired){var n=t.children,r=n.selector.web("shell"),i=r.length,s=n.select,o=t.web(s.getRootNode());r.display();o.display(!i);if(!i&&o.length){var u=function(){var e=t.get("values");e&&e.length&&t.set({value:s.get("value")})};s.wire("Changed.value",u);u()}e.doMy(t,"wireUi")}}},stateProperties:{i_n:"label"},childBindings:{label:"selector.label"}})}});Uize.module({name:"Zazzle.Menu",superclass:"Zazzle.Droplist",builder:function(e){"use strict";var t=null;return e.subclass({omegastructor:function(){var e=this,n=e.children.selector,r=n.children,i=r.left,s=function(){!e.j_e?e.pickValue():e.fire("Default Action")};n.unwire("Click");i.unwire("Click");n.wire("Click",s);i.wire("Click",s);n.wire("Changed.selected",function(){e.j_e&&i.set({selected:false})});e.wire("Changed.value",function(){var n=e.valueOf();if(n!=t){var r=e.get("valueDetails");e.fire({name:"Item."+n,itemDetails:r});e.fire({name:"Item Selected",item:n,itemDetails:r});e.set("value",t)}})},instanceMethods:{getMooringNode:function(){return this.j_e?this.children.selector.children.right.getNode():e.doMy(this,"getMooringNode")},pickValue:function(){var t=this,n=t.get("values");n.length==1?t.set("value",n[0].name):e.doMy(t,"pickValue")}},stateProperties:{j_e:"isSplit"}})}});Uize.module({name:"Uize.Widget.DirectionalPad",required:["Uize.Widget.Button","Uize.Dom.Classes","Uize.Widget.mWeb"],builder:function(e){"use strict";function i(){var e=this;if(e.isWired){if(e.d_d){var t,n=e.d_f;for(t in n)e.web(t).display(e.d_g=="full"||t in r)}else{var i=e.children;for(var s in i)e.web(i[s]).display(e.d_g=="full"||s in r)}}}function s(e){var t=e.children,r=e.get("enabled"),i=e.d_l,s=e.d_f,o=e.d_d;if(typeof r=="object"){var u=r.defaultValue===undefined||r.defaultValue,a;for(a in s){var f=a in r;if(f||u!==undefined){var l=f?r[a]:u;if(o){n.setState(e.getNode(a),i,l)}else t[a].set({enabled:l})}}}else{if(o){var c;for(c in s){n.setState(e.getNode(c),i,r)}}else Uize.callOn(t,"set",[{enabled:r}])}}var t=Uize,n=t.Dom.Classes,r={north:1,south:1,east:1,west:1,center:1};return e.subclass({mixins:t.Widget.mWeb,omegastructor:function(){var e=this;if(!e.d_d){var n=t.Widget.Button,r=e.d_f;t.forEach(r,function(t,i){e.addChild(i,n).wire("Click",function(t){e.fire({name:"Move",direction:r[i],domEvent:t.domEvent})})})}},instanceMethods:{wireUi:function(){var n=this;if(!n.isWired){n.wire("Changed.enabled",function(){s(n)});n.d_d&&t.forEach(n.d_f,function(e,t){n.wireNode(t,"click",function(t){(n.get("enabled")||n.get("enabledInherited"))&&n.fire({name:"Move",direction:e,domEvent:t})})});e.doMy(n,"wireUi")}},updateUi:function(){var t=this;if(t.isWired){e.doMy(t,"updateUi");i.call(t);s(t)}}},stateProperties:{d_f:{name:"buttonDictionary",value:{north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",northEdge:"NorthEdge",southEdge:"SouthEdge",eastEdge:"EastEdge",westEdge:"WestEdge",northeastEdge:"NortheastEdge",southeastEdge:"SoutheastEdge",northwestEdge:"NorthwestEdge",southwestEdge:"SouthwestEdge",center:"Center"}},d_l:"cssClassDisabledButton",d_g:{name:"mode",onChange:i,value:"full"},d_d:"useLinks"}})}});Uize.module({name:"Zazzle.Validator",requires:["Uize.Comm.Ajax","Uize.Data"],builder:function(){"use strict";function o(e,t,n){(n.commObject||new Uize.Comm.Ajax).request({url:[n.envUrl+e,t],returnType:"json",requestMethod:"POST",cache:"memory",callback:n.callback})}var e=function(){},t=null,n=true,r=false,i="string",s;e.alphaNumeric=function(e){return typeof e==i&&/^\w+$/.test(e)};e.categoryId=function(t){return e.zid(t,103)};e.storeId=function(t){return e.zid(t,196)};e.checkbox=function(e){return e};e.comboBoxSelectOne=function(e,t){return!t||e.selectedIndex>0};e.email=function(e){return!!e&&typeof e==i&&e.length<=50&&/^(([A-Za-z0-9])|(\w[-\w\.\+]*[\w\+]))@([-A-Za-z0-9]+\.)+[A-Za-z]{2,4}$/.test(e)};e.emailList=function(e){return typeof e==i&&/^(([A-Za-z0-9])|(\w[-\w\.\+]*[\w\+]))@([-A-Za-z0-9]+\.)+[A-Za-z]{2,4}[\s,;]*([\s,;]+(([A-Za-z0-9])|(\w[-\w\.\+]*[\w\+]))@([-A-Za-z0-9]+\.)+[A-Za-z]{2,4})*$/.test(e)};e.handle=function(e,i){var s=/^\d{6,20}$/.test(e);if(e&&/^\w{6,20}$/.test(e)&&!s){o("lgn/checkhandle",{ch:e},i);return t}else{if(i.callback)i.callback({exists:r,badFormatting:n,allNumeric:s});return r}};e.storehandle=function(e,i){var s=/^\d{6,20}$/.test(e);if(e&&/^\w{6,20}$/.test(e)&&!s){o("store/checkhandle",{gl:e},i);return t}else{if(i.callback)i.callback({exists:r,badFormatting:n,allNumeric:s});return r}};e.integer=function(e){return e%1===0};e.loginEmail=function(t,n){return e.email(t)&&e.serviceValidator("lgn/checkloginemail",{em:t},this,n)};e.nonEmpty=function(e){return!Uize.isEmpty(e)};e.radio=function(e){return e!=t&&e!=s};e.state=function(e,n,r){function i(e){if(r.callback)r.callback({success:e})}var s=n.toLowerCase();if(!n||s!="united states"&&s!="canada"&&s!="mexico"&&s!="spain"&&s!="brazil"){var u=!!n;i(u);return u}else{o("my/account/validatestate",{state:e,country:n},r);return t}};e.zid=function(e,t){if(!e)return false;return e.length==18&&(new RegExp("^"+t+"(\\d{15})$")).test(e)};e.serviceValidator=function(e,i,s,u){s.set({busy:n});o(e,i,{commObject:s.getInherited("commObject"),envUrl:s.getInherited("env").service,callback:function(e){s.set({busy:r});u(e.isValid,e.warningMessage)}});return t};return e}});Uize.module({name:"Uize.Util.PropertyAdapter",superclass:"Uize.Class",builder:function(e){"use strict";function t(e){if(e){var t=Uize.isArray(e);if(t||Uize.isInstance(e))e=t?{instance:e[0],property:e[1]}:{instance:e};e.property||(e.property="value")}return e}function n(){function n(e){for(var n=-1,r=t.length,i;++n<r;)(i=t[n]).c_j[e](i.c_k,i.c_l)}var e=this,t=e.c_d;if(t)t=e.c_d=n("unwire");if(e.c_m){var r=e.c_n,i=e.c_o,s=e.c_p,o,u=function(e){var t=e?r:i,n=e?i:r;if(o!=n){var u=t.instance.get(t.property);o=t;n.instance.set(n.property,s?s[e?"aToB":"bToA"](u):u);o=null}};if(r&&i){u(true);t=e.c_d=[{c_j:r.instance,c_k:"Changed."+r.property,c_l:function(){u(true)}},{c_j:i.instance,c_k:"Changed."+i.property,c_l:function(){u()}}];n("wire")}}}return e.subclass({stateProperties:{c_m:{name:"connected",onChange:n,value:true},c_n:{name:"propertyA",conformer:t,onChange:n},c_o:{name:"propertyB",conformer:t,onChange:n},c_p:{name:"valueAdapter",onChange:n}}})}});Uize.module({name:"Zazzle.DroplistPalette.ComboBox",required:["Uize.Widget.FormElement.Text","Uize.Util.PropertyAdapter"],builder:function(e){"use strict";var t={nearest:"round",up:"ceil",down:"floor"};var n=e.subclass(null,function(){var e=this,n=e.children.value,r=e.addChild("input",Uize.Widget.FormElement.Text);Uize.Util.PropertyAdapter({propertyA:n,propertyB:r,valueAdapter:{aToB:function(e){return e},bToA:function(n){var i=e.i_e,s=e.i_f,o=Uize.constrain(n,e.i_h,e.i_i);if(i&&i!=1){s=s&&t[s]?s:"nearest";var u=function(e){return Math.round(e*Math.pow(10,14))/Math.pow(10,14)};o=Uize.isNumber(+o)?u(Math[t[s]](u(o/i))*i):o}n!=o&&r.set("value",o);return o}}})});n.stateProperties({i_i:{name:"maxValue",value:-Infinity},i_h:{name:"minValue",value:Infinity},i_f:{name:"roundDirection",value:"nearest"},i_e:{name:"valueIncrement",value:1}});return n}});Uize.module({name:"Zazzle.Droplist.ComboBox",builder:function(e){"use strict";var t={nearest:"round",up:"ceil",down:"floor"};var n=e.subclass(),r=n.prototype;r.valueConformer=function(n){var r=this,i=r.j_d,s=r.j_e,o=Uize.constrain(e.doMy(r,"valueConformer",[n]),r.j_g,r.j_h);if(i&&i!=1){s=s&&t[s]?s:"nearest";var u=function(e){return Math.round(e*Math.pow(10,14))/Math.pow(10,14)};o=Uize.isNumber(+o)?u(Math[t[s]](u(o/i))*i):o}return o};r.wireUi=function(){var t=this;if(!t.isWired){var n=t.web("inputLabel");if(t.children.selector.getNode()){t.wire("Changed.value",function(){n.html(t+"")});t.web("input").hide();n.display()}e.doMy(t,"wireUi")}};n.stateProperties({j_h:{name:"maxValue",value:-Infinity},j_g:{name:"minValue",value:Infinity},j_e:{name:"roundDirection",value:"nearest"},j_d:{name:"valueIncrement",value:1}});return n}});Uize.module({name:"Uize.Widget.mHtmlBindings",builder:function(){"use strict";var e=Uize,t=e.forEach,n=e.pairUp,r=e.applyAll;return function(i){i.declare({alphastructor:function(){var e=this;e.whenever("wired",function(){var t=e.Class.mHtmlBindings_bindings;for(var n in t)r(e,t[n],[e.get(n)])})},staticMethods:{htmlBindings:function(r){var i=this,s=i.mHtmlBindings_bindings;t(r,function(r,o){function a(e){if(typeof e=="string"){var t=e.split(":"),r=t[0],s=t[1]||"value";if(s=="value"){e=function(e){this.setNodeValue(r,e==null?"":e)}}else if(s=="html"||s=="innerHTML"){e=function(e){this.setNodeInnerHtml(r,e==null?"":e)}}else if(s=="?"){e=function(e){this.displayNode(r,!!e)}}else if(s=="show"||s=="hide"){e=function(e){this.setNodeStyle(r,{display:!!e==(s=="show")?"":"none"})}}else if(s.charCodeAt(0)==64){var a=s.slice(1);e=function(e){var t=this.getNode(r);t&&t.setAttribute(a,e)}}else if(s.slice(0,6)=="style."){var f=s.slice(6);e=function(e){this.setNodeStyle(r,n(f,e))}}else{e=function(e){this.setNodeProperties(r,n(s,e))}}e.propertyName=o;e.nodeName=r;e.bindingType=s}u.push(e);i.stateProperties(Uize.pairUp(o,{onChange:function(t){this.isWired&&e.call(this,t[o])}}))}var u=s[o]||(s[o]=[]);e.isArray(r)?t(r,a):a(r)})}},staticProperties:{mHtmlBindings_bindings:{}}})}}});Uize.module({name:"Uize.Widget.mCssBindings",required:"Uize.Widget.mHtmlBindings",builder:function(){"use strict";function f(e){var r=e[n],i=t.keys(r),s=i.join();e.stateProperties({mCssBindings_rootNodeClasses:{derived:a[s]||(a[s]=Function.apply(0,i.concat("extraClasses","var "+"m=this,c=m.Class,b=c."+n+Uize.map(i,function(e,t){return",p"+t+"=b['"+e+"'](m.get('"+e+"')),c"+t+"=p"+t+"&&m.cssClass(p"+t+")"}).join("")+",e=m.extraClasses"+";"+"return "+"m.cssClass('')"+Uize.map(i,function(e,t){return"+(c"+t+"?' '+c"+t+":'')"}).join("")+"+(e?' '+e:'')"+";")))}})}var e,t=Uize,n="mCssBindings_bindings",r={},i={},s={},o={},u={},a={};return function(a){a.declare({mixins:Uize.Widget.mHtmlBindings,alphastructor:function(){function e(t){var n=t.moduleName;if(i[n]!=r){i[n]=r;t.superclass&&e(t.superclass);t.cssModule&&t.cssModule.add()}}e(this.Class)},instanceMethods:{rootNodeCssClasses:function(){return this.mCssBindings_rootNodeClasses},cssClass:function(t){var n=this.Class,r=n.moduleName,i=u[r]||(u[r]={}),s=i[t];if(!s){var a=o[r];if(!a){var f=n,l,c=[],h={};while(f){if((l=n.cssClassPrefix.call(f))!=e&&!h[l]){h[l]=1;c.unshift('"'+l+'"+cs')}f=f.superclass}a=o[r]=Function("cn",'var cs=(cn||"")&&"-"+cn;return '+c.join('+" "+')+";")}s=i[t]=a(t)}return s}},staticMethods:{cssClassPrefix:function(){var e=this.cssModule,t;return e&&(s[t=e.moduleName]||(s[t]=t.replace(/\./g,"_")))},cssBindings:function(e){t.copyInto(this[n],t.map(e,t.resolveTransformer));f(this)}},staticProperties:{mCssBindings_bindings:{}},stateProperties:{extraClasses:{value:""}},htmlBindings:{mCssBindings_rootNodeClasses:":@class"}});f(a)}}});Uize.module({name:"Uize.Widget.mEventBindings",builder:function(){"use strict";var e=Uize,t=e.forEach,n=e.returnTrue,r=e.isFunction,i=e.isPlainObject,s=e.pairUp;return function(e){e.declare({alphastructor:function(){function f(t,n,r,i){return function(s){(!n.required||o.isMet(n.required))&&e.isMet(n.fireIf||i)&&n.handler.call(t,s,r)}}var e=this,r=e.Class,i=r.mEventBindings_dom,o=e.addedChildren,u=e.children,a={};e.whenever("wired",function(){for(var t in i){for(var n=i[t],r=e.getNode(t),s=-1,o=n.length;++s<o;){var u=n[s];e.wireNode(r,u[0],f(e,u[1],r,"enabledInherited,!busyInherited"))}}});t(r.mEventBindings_widget,function(t,r){function i(i){for(var o=-1,u=t.length;++o<u;){var l=t[o],c=s(l[0],f(e,l[1],i,n));i.wire(c);(a[r]||(a[r]=[])).push(c)}}if(r){var l;o.wire("Changed."+r,function(){if(o.get(r))i(l=u[r]);else{for(var e=a[r],t=-1;++t<e.length;)l.unwire(e[t]);delete a[r];l=undefined}})}else i(e)})},staticMethods:{eventBindings:function(e){var n=this,o=n.mEventBindings_dom,u=n.mEventBindings_widget,a;t(e,function(e,f){function p(e,t){if(!c&&h==u&&r(e)&&!t.indexOf("Changed.")){var o=t.slice(8);n.stateProperties(s(o,{onChange:function(){var n=this;e.call(n,{name:t,source:n,newValue:n.get(o)},n)}}))}else(h[c]||(h[c]=[])).push([t,i(e)?e:{handler:e}])}var l=f.split(":"),c=l[0],h=(!c.indexOf("#")?c=c.substr(1):a)!=a?o:u;l.length>1?p(e,l[1]):t(e,p)})}},staticProperties:{mEventBindings_dom:{},mEventBindings_widget:{}}})}}});Uize.module({name:"Uize.Widget.mDeclarativeChildren",builder:function(){"use strict";var e=Uize;return function(t){t.declare({omegastructor:function(){var t=this,n=t.Class.mDeclarativeChildren_children;for(var r in n){var i=n[r],s=i.d_e,o=i.d_g;if(i.d_h){o=e.copy(o.call(t,r));s=o.widgetClass;delete o.widgetClass}s&&t.mDeclarativeChildren_getContainer(r).addChild(r,s,o)}},staticMethods:{children:function(t){var n=this.mDeclarativeChildren_children;for(var r in t){var i=t[r],s=e.isFunction(i)&&!i.declare,o=e.isPlainObject(i),u=!s&&!o?{widgetClass:i}:i,a=!s&&u.widgetClass;if(!s&&o&&a){u=e.copy(u);delete u.widgetClass}n[r]=e.copyInto(n[r]||{},{d_e:a,d_g:u,d_h:s})}}},staticProperties:{mDeclarativeChildren_children:{}},instanceMethods:{mDeclarativeChildren_getContainer:function(){return this}}})}}});Uize.module({name:"Zazzle.Widget.mV2",required:["Uize.Widget.mHtmlBindings","Uize.Widget.mCssBindings","Uize.Widget.mEventBindings","Uize.Widget.mDeclarativeChildren","Uize.Widget.mChildBindings"],builder:function(){"use strict";var e=Uize,t=e.Widget;return function(n){n.declare({mixins:[t.mHtmlBindings,t.mCssBindings,t.mEventBindings,t.mDeclarativeChildren,t.mChildBindings],staticMethods:{cssClassPrefix:function(){return this.v2CssClassPrefix}}});e.copyInto(n.nonInheritableStatics,{v2CssClassPrefix:1})}}});Uize.module({name:"Zazzle.ColorPickerButton",superclass:"Uize.Widget.Button",required:"Zazzle.Widget.mV2",builder:function(e){"use strict";return e.subclass({mixins:Zazzle.Widget.mV2,stateProperties:{e__:{name:"color",value:null},e_a:{name:"colorCssBackground",derived:function(e){var t=e||"cccccc";t=t.indexOf("#")?"#"+t:t;return t.toLowerCase()=="#00ffffff"?"url("+this.get("urls").transparentImage+")":t}},e_b:"size"},set:{classNamingForStates:""},cssBindings:{size:"value"},htmlBindings:{color:"stroke:hide",colorCssBackground:"color:style.background"}})}});Uize.module({name:"Zazzle.Picker.Color",superclass:"Uize.Widget.Picker",required:["Zazzle.ColorPickerButton","Zazzle.Widget.mV2"],builder:function(e){"use strict";return e.subclass({mixins:Zazzle.Widget.mV2,stateProperties:{f__:"dialogMooringNode",f_a:{name:"dialogOffsetX",value:0},f_b:{name:"dialogOffsetY",value:0},f_c:"usedColors"},set:{allowManualEntry:false,pipedProperties:["usedColors"],selectorButtonWidgetClass:Zazzle.ColorPickerButton,dialogWidgetClass:"Zazzle.Dialog.Picker.Color"},childBindings:{value:"->selector.color"},eventBindings:{"selector:Click":function(){this.set({focused:true})}},instanceMethods:{getMooringNode:function(){return this.f__},getDialogWidgetProperties:function(){var t=this;return Uize.copyInto(e.doMy(t,"getDialogWidgetProperties")||{},{offsetX:t.f_a,offsetY:t.f_b})}}})}});Uize.module({name:"Uize.Widget.mWebBindings",required:["Uize.Widget.mWeb","Uize.Widget.mHtmlBindings","Uize.Widget.mCssBindings","Uize.Widget.mEventBindings","Uize.Web"],builder:function(){"use strict";var e=Uize.Widget;return function(t){t.declare({mixins:[e.mWeb,e.mHtmlBindings,e.mCssBindings,e.mEventBindings],instanceMethods:{webSelect:function(e){var t=this;return Uize.Web((e||"").replace(/[\.|\#]\w+/g,function(e){var n=e[0];return n+t[n=="#"?"nodeId":"cssClass"](e.substr(1))}),t.getNode())}}})}}});Uize.module({name:"Zazzle.Widget.mV2Web",required:["Uize.Widget.mWebBindings","Zazzle.Widget.mV2"],builder:function(){"use strict";return function(e){e.declare({mixins:[Uize.Widget.mWebBindings,Zazzle.Widget.mV2]})}}});Uize.module({name:"Zazzle.Widget.V2",required:"Zazzle.Widget.mV2Web",builder:function(e){"use strict";return e.subclass({mixins:Zazzle.Widget.mV2Web})}});Uize.module({name:"Zazzle.FontSelector",superclass:"Zazzle.Widget.V2",required:["Zazzle.Droplist","Uize.Web"],builder:function(e){"use strict";var t=Uize,n=t.Web;return e.subclass({alphastructor:function(){this.f_b=[];this.f_c={}},children:{fontCategories:Zazzle.Droplist},stateProperties:{f_d:{name:"mruLength",value:50},f_e:"fontCategory",f_f:"fonts",f_g:"value",f_h:{name:"valueDetails",derived:function(e,n){var r=e&&t.findRecord(e,{name:n});return r&&r.valueDetails}}},childBindings:{fontCategory:"fontCategories.value"},htmlBindings:{fontCategory:function(e){var r=this,i=e==="mru",s=r.f_f,o=i?t.lookup(r.f_b):null;n("."+r.cssClass("font")).each(function(t,n){r.web(n).display(i?s[t].name in o:e in s[t].valueDetails.attributes)});r.scrollToSelected()},value:function(e){var t=this,r=t.cssClass("selected"),i=t.f_p(e);n("."+r).removeClass(r);i>-1&&t.web(i+"").addClass(r)}},eventBindings:{":Changed.value":function(){var e=this,t=e.f_b,n=e.f_c,r=e+"";if(r in n){for(var i=t.length;--i>=0;){if(t[i]===r){t.splice(i,1);break}}}t.unshift(r);n[r]=1;if(t.length>e.f_d)delete n[t.pop()]},"#fonts:click":function(e){var t=this,n=e.target||e.srcElement,r=n.id||n.parentElement.id||n.parentElement.parentElement.id;r&&t.set({f_g:t.f_f[r.substring(r.lastIndexOf("-")+1)].name})}},instanceMethods:{f_p:function(e){return t.findRecordNo(this.f_f,{name:e||this+""})},scrollToSelected:function(){var e=this,t=e.f_p();if(e.isWired&&t>-1){setTimeout(function(){var n=e.getNode(t+""),r=n?Uize.Node.getCoords(n):null;if(r&&!r.seen)Uize.require("Uize.Fx.Scroll",function(e){e.scrollToNode(n)})},0)}}}})}});Uize.module({name:"Zazzle.Picker.Font",superclass:"Uize.Widget.Picker",required:"Zazzle.FontSelector",builder:function(e){"use strict";return e.subclass({stateProperties:{f__:"dialogMooringNode",f_a:{name:"dialogOffsetX",value:0},f_b:{name:"dialogOffsetY",value:0}},omegastructor:function(){var e=this;e.wire("Changed.valueDetails",function(){var t=e.get("valueDetails");e.children.selector.set({text:t?t.displayName:"?"})})},instanceMethods:{getMooringNode:function(){return this.f__},getMoreDialogEventHandlers:function(){return Uize.copyInto(e.doMy(this,"getMoreDialogEventHandlers")||{},{"After Show":function(e){e.source.children.value.scrollToSelected()}})},getDialogWidgetProperties:function(){var t=this;return Uize.copyInto(e.doMy(t,"getDialogWidgetProperties")||{},{valueWidgetClass:Zazzle.FontSelector,offsetX:t.f_a,offsetY:t.f_b})}}})}});Uize.module({name:"Zazzle.Checkbox",superclass:"Uize.Widget.FormElement",required:["Zazzle.SelectorValueDisplay","Uize.Util.PropertyAdapter"],builder:function(e){var t=e.subclass(null,function(){var e=this,t=Uize.Util.PropertyAdapter,n=e.addChild("valueDisplay",e.e_c||Zazzle.SelectorValueDisplay,e.e_d);new t({propertyA:{instance:e,property:"value"},propertyB:{instance:n,property:"selected"},valueAdapter:{aToB:function(t){return e.valueAtoB(t)},bToA:function(t){return e.valueBtoA(t)}}});new t({propertyA:{instance:n,property:"valueDetails"},propertyB:{instance:e,property:"label"},valueAdapter:{aToB:function(e){return e?e.displayName:""},bToA:function(e){return Uize.copyInto({},n.get("valueDetails"),{displayName:e})}}});n.wire({Over:function(){e.set({tentativeValue:true})},Out:function(){e.set({tentativeValue:e.valueOf()})}});e.wire("Changed.value",function(){e.validate()})}),n=t.prototype;n.valueAtoB=function(e){return e===true||e=="true"};n.valueBtoA=function(e){return e};n.updateUi=function(){var t=this;if(t.isWired){t.children.valueDisplay.updateUi();e.doMy(t,"updateUi")}};t.stateProperties({e_g:"label",e_c:"valueDisplayWidgetClass",e_d:{name:"valueDisplayWidgetProperties",onChange:function(){var e=this.children.valueDisplay;e&&e.set(this.e_d)}}});return t}});Uize.module({name:"ZazzleWww.TemplateDesigner",superclass:"Uize.Widget",required:["Zazzle.Checkbox","Zazzle.Droplist","Uize.Widget.FormElement.Text","Uize.Util.PropertyAdapter"],builder:function(e){"use strict";var t=true,n=false,r=null,i,s=Uize.Util.PropertyAdapter;var o=e.subclass(r,function(){var t=this;new s({propertyA:{instance:t,property:"isTemplate"},propertyB:{instance:t.addChild("enable",Zazzle.Checkbox,{value:!!t.d_f}),property:"value"}});t.children.enable.wire("Click",function(){!!t.children.enable&&t.set({d_g:n})});new s({propertyA:{instance:t,property:"title"},propertyB:{instance:t.addChild("title",e.FormElement.Text,{maxLength:200,validator:/^[^<>]*$/}),property:"value"}});new s({propertyA:{instance:t,property:"urlKey"},propertyB:{instance:t.addChild("urlkey",e.FormElement.Text,{maxLength:200,valueConformer:function(e){return(e||"").toLowerCase().replace(/[^a-z0-9]/g,"")}}),property:"value"}});new s({propertyA:{instance:t,property:"fitMode"},propertyB:{instance:t.addChild("fitMode",Zazzle.Droplist),property:"value"}});new s({propertyA:{instance:t,property:"showOnProductPage"},propertyB:{instance:t.addChild("ppageedit",Zazzle.Checkbox),property:"value"}})}),u=o.prototype;u.wireUi=function(){var t=this;if(!t.isWired){t.wire("Changed.enabled",function(){var e=t.get("enabled");t.children.enable.displayNode("",!!e);t.displayNode("body",!!t.get("isTemplate"))});e.doMy(t,"wireUi")}};u.d_k=function(){var e=this;if(e.isWired)e.displayNode("body",!!(e.d_f&&!e.d_g))};u.d_l=function(){var e=this;e.isWired&&e.children.fitMode.displayNode("shell",e.d_m==="image")};u.updateUi=function(){var t=this;if(t.isWired){t.d_k();t.d_l();e.doMy(t,"updateUi")}};o.stateProperties({d_n:{name:"fitMode",onChange:function(){this.updateUi()}},d_f:{name:"isTemplate",onChange:function(){var e=this;e.updateUi()},value:n},d_g:{name:"hasMultiple",onChange:function(){var e=this;e.updateUi();e.d_g&&e.set({d_f:n})}},d_m:{name:"mode",onChange:function(){this.d_l()},value:n},d_o:{name:"showOnProductPage",onChange:function(){this.updateUi()}},d_p:{name:"title",onChange:function(){this.updateUi()},value:""},d_q:{name:"urlKey",conformer:function(e){return(e||"").toLowerCase().replace(/[^a-z0-9]/g,"")},onChange:function(){this.updateUi()},value:""}});return o}});Uize.module({name:"Uize.Comm",superclass:"Uize.Class",required:"Uize.Url",builder:function(e){"use strict";function i(e){return"response"+Uize.capFirstChar(e.returnType)}function s(e){e.url=Uize.Url.resolve(e.url)}function o(e,t){return t.cache=="memory"?e.c_g[t.url]:null}function u(e,t){var n=t.returnType,s=t.callback,u=t.errorCallback,a=o(e,t);if(t.error)return u&&u(t.error);if(a){var f=n=="object";if(s){t.responseText="";t.responseJson=t.responseXml=null;if(f||n=="xml")t.responseXml=r(a.responseXml);if(f||n=="text")t.responseText=a.responseText;if(f||n=="json")t.responseJson=r(a.responseJson)}}else{if(t.cache=="memory")e.c_g[t.url]={responseXml:r(t.responseXml),responseJson:r(t.responseJson),responseText:t.responseText}}s&&s(n=="object"?t:t[i(t)])}function a(e){e.fire("Request Queue Updated")}var t=true,n=false,r=Uize.clone;return e.subclass({alphastructor:function(){var e=this;e.c_o=[];e.c_g={};e.requestQueue=e.c_o},instanceMethods:{performRequest:function(e,t){t()},flush:function(){this.c_o.length=0;a(this)},flushCache:function(e){arguments.length?delete this.c_g[typeof e=="string"?e:e.url]:this.c_g={}},request:function(e){var t=this;s(e);if(o(t,e)){setTimeout(function(){u(t,e)},0)}else{t.queueRequest(e);t.useQueue()}},queueRequest:function(e){var t=this;s(e);delete e.completed;if(!e.requestMethod)e.requestMethod="GET";if(!e.returnType)e.returnType="object";if(typeof e.cache!="string")e.cache=e.cache?"memory":"never";t.c_o[e.cutToHead?"unshift":"push"](e);a(t)},useQueue:function(){var e=this,r=e.c_o,s=r.length;if(!e.c_s&&s){e.c_s=t;var f=function(){var t;while((t=r[0])&&(o(e,t)||t.completed))u(e,r.shift());e.c_s=n;a(e);r.length&&setTimeout(function(){e.useQueue()},1)},l=function(n){if(o(e,n)){f()}else{e.fire({name:"Perform Request",request:n});e.performRequest(n,function(e){n.completed=t;n.error=e;f()})}};if(s==1){l(r[0])}else{var c=[];var h;for(var p=-1;++p<s;){var d=r[p],v=d.batchingAgent;if(!v||h&&v!=h||d.cache=="browser"){break}else{if(!h)h=v;c.push(d)}}var m=c.length;if(m>1){var g=[];for(var p=-1;++p<m;){var d=c[p];if(!o(e,d)){d.completed=n;g.push(d)}}var y=g.length;if(y){if(y==1){l(g[0])}else{var b=h.buildRequest(g);e.fire({name:"Perform Request",request:b});e.performRequest(b,function(e){var n=h.responseParser(b),r=0;for(var s=-1;++s<m;){var o=c[s];if(o.completed!==undefined){o[i(o)]=n[r++];o.completed=t;o.error=e}}f()})}}else{f()}}else{l(r[0])}}}}},staticMethods:{processArrayAsync:function(e,t,r,i){function u(a){(o+=i)>=0&&o<=s&&a!==n?t(e[o],u,o):r?r(s+1):0}if(!i)i=1;var s=e.length-1,o=(i>0?0:s)-i;u()}}})}});Uize.module({name:"Uize.Tooltip",required:["Uize.Dom.Basics","Uize.Dom.Pos","Uize.Fade"],builder:function(){"use strict";function l(e){return i.getById(Uize.isFunction(e)?e():e)}function c(){p()}function h(e){if(e!=a){if(e){if(a){d.stop();v()}if(!e.b_q){i.wire(document.body,"scroll",c,o);i.wire(document.documentElement,"mousemove",c,o)}a=e;i.setStyle(a.b_r,{position:"absolute",zIndex:5e3,left:-5e4,top:-5e4});i.display(a.b_r);p()}else{d.get("duration")>0?d.start():v()}}else if(e){d.stop();i.setOpacity(a.b_r,1)}}function v(){a.b_q||i.unwireEventsByOwnerId(o);i.display(a.b_r,n);i.setOpacity(a.b_r,1);a=null}var e=function(){},t=true,n=false,r,i=Uize.Dom.Basics,s=Uize.Dom.Pos,o=Uize.getGuid(),u=[],a,f=16;e.showTooltip=function(e,t,r){if(e=l(e)){if(t!==n){u.push({b_r:e,b_q:r})}else{for(var i=u.length;--i>-1;)if(u[i].b_r==e)break;i>-1&&u.splice(i,1)}h(u[u.length-1])}};e.hideTooltip=function(t){e.showTooltip(t,n)};var p=e.positionTooltip=function(e,t){a&&(e===r?e=a.b_r:a.b_r==l(e))&&s.setAbsPos(e,s.getEventAbsPos(t),f)};var d=e.fade=Uize.Fade({duration:0});d.wire({"Changed.value":function(){i.setOpacity(a.b_r,1-d.get("progress"))},Done:v});return e}});Uize.module({name:"Uize.Widget.Collection.Dynamic",required:["Uize.Dom.Basics","Uize.Dom.Pos","Uize.Widget.Drag","Uize.Tooltip"],builder:function(e){"use strict";function f(e,t){var n=t.properties,r=e.makeItemWidgetName(n);e.get("items").push(n);return e.addItemWidget(r,t)}function l(e){e.fire("Items Changed")}var t=true,n=false,r=null,i=Uize.Dom,s=i.Basics,o=i.Pos,u=Uize.Tooltip,a={selected:t};return e.subclass({omegastructor:function(){function k(n){var r=n?e.e_J:1,i=e.getNode("tooltipDragging");for(var o=c;--o>-1;)f[o].setNodeOpacity("",r);n&&s.setInnerHtml(i,e.localize("draggingToReorder"+(c>1?"Plural":"Singular"),{totalItems:c}));u.showTooltip(i,n,t)}var e=this;var i,a,f,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N=e.addChild("drag",Uize.Widget.Drag,{nodeMap:{"":r}}),C=n;N.wire("Changed.inDrag",function(t){e.set({e_G:t.newValue})});N.wire({"Drag Start":function(){a=e.e_M=="reverse"?1:0;i.set({over:n});var s=i.get("selected");if(!s){e.selectAll(n);e.e_O&&i.set({selected:t})}if(!e.e_P){if(s){for(var u=-1,l=e.getSelected(),p=l.length;++u<p;)l[u].get("locked")&&l[u].set({selected:n});C=!e.get("totalSelected")}else if(i.get("locked"))C=t}f=s?e.getSelected():[i];c=f.length;h=[];e.forAll(function(e){h.push(o.getCoords(e.getNode()))});var d=h.length,N=d-1,L=h[a?N:0],A=h[a?N-1:1];w=N&&A.top>=L.bottom?1:0;x=w?"top":"left";T=w?"height":"width";v=m=g=y=b=r;E=e.getNode("insertionMarker");S=o.getDimensions(E);for(var O=-1,M=N?A[x]-(L[x]+L[T]-1):0,_=M/2;++O<d;){var D=h[O];D[x]-=_;D[T]+=M}k(t)},"Drag Update":function(){function n(e){return e&&o.doRectanglesOverlap(e.left,e.top,e.width,e.height,t[0],t[1],1,1)}var t=N.eventPos;u.positionTooltip(e.getNode("tooltipDragging"),{pageX:t[0],pageY:t[1]});if(!n(d)){p=d=r;e.forAll(function(e,t){var r=h[t];if(n(r)){p=e;d=r}return!p})}if(!n(g)){v=g=r;if(p&&!Uize.isIn(f,p)){var i=d[T],s=i/2,a=d[x],l=a+s;v=p;m=t[w]<l?0:1;g=Uize.clone(d);g[x]=m?l:a;g[T]=s}}if(v!=y||m!=b){e.displayNode(E,!!v);if(v){var c=Uize.clone(g);c[x]+=(m?g[T]:0)-S[T]/2;delete c[T];o.setCoords(E,c)}y=v;b=m}N.set({cursor:v||p?e.e_$_:"not-allowed"})},"Drag Done":function(){if(N.get("dragStarted")){k(n);e.displayNode("insertionMarker",n);var t=function(){if(v&&!C&&!N.get("dragCancelled")){var t=e.itemWidgets;if(m^a){var n=t.length,i=Uize.indexIn(t,v)+1;v=r;while(i<n){var s=t[i];if(!Uize.isIn(f,s)){v=s;break}else{i++}}}for(var o=-1;++o<c;)e.move(f[o],v);e.fire("Items Reordered");l(e)}};e.e_d_?e.confirm({state:"warning",title:e.localize("confirmDragToReorderTitle"),message:e.localize("confirmDragToReorderPrompt"),yesHandler:function(){e.e_d_=n;e.fire("Drag Confirmed");t()},noHandler:function(){N.set({dragCancelled:true})}}):t()}}});e.wire("Item Mouse Down",function(t){if(e.e_e_){i=t.source;N.initiate(t.domEvent)}t.bubble=n})},instanceMethods:{add:function(e){var t=this,i=[];if(!Uize.isArray(e))e=[e];var s=e.length;if(s){t.e_i_&&t.selectAll(n);var o=t.e_i_?a:r;for(var u=-1;++u<s;)i.push(f(t,Uize.copyInto(e[u],o)))}l(t);return i},getItemWidgetProperties:function(){var e=this;return Uize.copyInto({previewTooltip:function(){return e.e_e_?e.getNode("tooltipDragToReorder"):r}},e.get("itemWidgetProperties"))},move:function(e,t){var n=this,i=n.e_M=="reverse",s=t?t.getNode():r,o=n.get("items"),u=n.itemWidgets,a=e.getNode().parentNode,f=e.getNode(),l=i?s?s.nextSibling:a.childNodes[0]:s;l?a.insertBefore(f,l):a.appendChild(f);var c=Uize.indexIn(u,e),h=o[c];u.splice(c,1);o.splice(c,1);var p=t?Uize.indexIn(u,t):u.length;u.splice(p,0,e);o.splice(p,0,h)},getTemplateHtml:function(e){return e.innerHTML},processItemTemplate:function(e){var t=this.getTemplateHtml(e);return Uize.Template&&e.tagName=="SCRIPT"&&e.type=="text/jst"?Uize.Template.compile(t,this.e_y_||{openerToken:"[%",closerToken:"%]"}):function(e){return t.replace(/ITEMWIDGETNAME/g,e.name)}},afterWireUi:function(){},wireUi:function(){var t=this;if(!t.isWired){var r=document.body,i=t.getNode("insertionMarker"),s={},o=t.getNode("itemTemplate");if(i&&i.parentNode!=r){r.insertBefore(i,r.childNodes[0]);t.setNodeStyle(i,{display:"none",position:"absolute",zIndex:1e4,left:"",top:"",right:"",bottom:""})}if(o)s.html=t.processItemTemplate(o);s.built=n;s.container=t.getNode("items");s.insertionMode=t.e_M=="reverse"?"inner top":"inner bottom";t.get("built")||t.forAll(function(e){e.set(s)});t.set({itemWidgetProperties:Uize.copyInto(s,t.get("itemWidgetProperties")||{})});e.doMy(t,"wireUi");t.afterWireUi()}}},stateProperties:{e_d_:{name:"confirmToDrag",value:n},e_$_:{name:"dragCursor",value:"move"},e_P:{name:"dragIgnoresLocked",value:t},e_e_:{name:"dragToReorder",value:n},e_O:{name:"ensureItemDraggedIsSelected",value:n},e_G:"inDrag",e_M:{name:"itemDisplayOrder",value:"normal"},e_i_:{name:"makeNewlyAddedSelected",value:t},e_J:{name:"itemVestigeOpacity",value:.2},e_y_:"templateTokens"}})}});Uize.module({name:"Uize.Widget.CollectionItem",required:["Uize.Node","Uize.Widget.Button","Uize.Dom.Classes","Uize.Dom.Event"],builder:function(e){"use strict";function i(e){if(e.isWired){var t=e.d_d;t!=r&&e.setNodeInnerHtml("title",t)}}function s(e){if(e.isWired){Uize.Dom.Classes.setState(e.getNode(),["",e.d_f,e.d_g],(e.d_h?2:e.d_i&&1)||0);var t=e.d_j,n=e.d_k;typeof t=="string"&&typeof n=="string"&&Uize.Dom.Classes.setState(e.getNode("preview"),[t,n],e.d_i)}}function o(){s(this)}function u(e,t,n){e.fire({name:"Click Selected",domEvent:t,forceToggle:n})}function a(e){var t=e.children.select;t.get("state")!="over"&&t.set({selected:e.d_h})}var t=true,n=false,r;return e.subclass({alphastructor:function(){this.d_r={}},omegastructor:function(){var e=this;e.addChildButton("select",function(n){u(e,n.domEvent,t)}).set({clickToSelect:t,clickToDeselect:t});a(e);e.addChildButton("remove",function(){e.fire({name:"Remove",byUser:t})})},instanceMethods:{addChildButton:Uize.Widget.Button.addChildButton,updateUi:function(){s(this);i(this)},wireUi:function(){var r=this;if(!r.isWired){var i=r.getNode();if(r.d_u&&i)i.className=r.d_u;var s=r.getNode("previewShell")||"imageLink",o=function(e){r.fire({name:"Item Mouse Down",domEvent:e,bubble:t})};var a=null;var f=function(){var e=a;a=null;if(e){o(e)}};r.wireNode(s,{mouseover:function(){r.set({d_i:t})},mouseout:function(e){f(e);r.set({d_i:n})},touchend:o,mousedown:function(e){if(typeof e.pageX==="undefined"){o(e);return}a=e;Uize.Dom.Event.preventDefault(e)},mousemove:function(e){if(!a)return;var t=e.pageX-a.pageX;var n=e.pageY-a.pageY;var r=2;if(Math.sqrt(t*t+n*n)>r){f(e)}},mouseup:function(){a=null}});if(r.d_A)r.wireNode(s,"click",function(e){var n=r.d_A=="Toggle Selected";n||r.d_A=="Select"?u(r,e,n):r.fire({name:"Click Preview",bubble:t})});e.doMy(r,"wireUi")}}},instanceProperties:{isCollectionItem:t},stateProperties:{d_g:"cssClassActive",d_u:"cssClassBase",d_j:"cssClassImage",d_k:"cssClassImageOver",d_f:"cssClassOver",d_B:{name:"locked",value:n},d_i:{name:"over",onChange:[function(){var e=this;e.isWired&&e.d_C&&Uize.Tooltip&&Uize.Tooltip.showTooltip(e.d_C,e.d_i)},o],value:n},d_A:"previewClickAction",d_C:"previewTooltip",d_r:{name:"properties",onChange:function(){var e=this.d_r;e&&"title"in e&&this.set({d_d:e.title})}},d_h:{name:"selected",onChange:[function(){this.children.select&&a(this)},o],value:n},d_d:{name:"title",onChange:function(){var e=this,n=e.d_r;if(n){n.title=e.d_d;i(e);e.fire({name:"Title Changed",bubble:t,value:e.d_d})}}}}})}});Uize.module({name:"ZazzleWww.DesignObjectUi",superclass:"Uize.Widget.CollectionItem",required:["Uize.Widget.Button","Uize.Url","Zazzle.FormElementWarning","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=true,n=false,r=null,i;var s=e.subclass(r,function(){var e=this;e.e_e("edit",function(){e.fire("Edit")});e.e_e("recolor",function(){e.fire("Recolor")});e.wire({"Changed.locked":function(){e.e_f()},"Changed.title":function(){e.e_g()}});e.addChild("warning",Zazzle.FormElementWarning,{shown:!!e.e_h,message:e.e_i,focused:!!e.e_j})}),o=s.prototype;s.mixins(Uize.Widget.mWeb);o.e_e=Uize.Widget.Button.addChildButton;o.e_l=function(){var e=this;if(e.isWired){var n=e.e_m,r=e.e_n,i=n&&n.imageid;if(i&&r==="image"){var s=e.getNode("icon"),o=Uize.Node.getDimensions(s),u=n&&n.getProperty("physwidth"),a=u&&n.getProperty("state")!="done",f=u&&!a&&n.colors;e.setNodeStyle(s,{backgroundImage:"url("+Uize.Url.resolve([e.getInherited("env").imageRealview,{action:"getimage",max_dim:Math.min(o.height,o.width),id:i,square_it:t},a?{pendstitch:1}:{},f?{colors:f}:{}])+")"})}}};o.e_f=function(){var e=this;if(e.isWired){var t=e.get("locked"),n=!t,r={enabled:n},i=e.children;i.edit.set(r);i.remove.set(r);e.web("locked").display(t)}};o.e_y=function(){var e=this;if(e.isWired){var t=e.get("locked"),n=e.e_n==="image",r=e.e_m,i=r&&r.getProperty("state"),s=n&&!t&&i==="done";e.setNodeStyle("recolorspan",{display:s?"inline":"none"})}};o.e_C=function(){var e=this;if(e.isWired)e.setNodeInnerHtml(["displayPrice","displayPrice2"],e.e_D||"");e.e_E()};o.e_g=function(){var e=this;e.isWired&&e.web("title").property("title",e.get("title"))};o.e_E=function(){var e=this,t=!!e.e_D,n=e.e_m,r=e.e_n==="image",i=n&&n.getProperty("state")!="done",s=n&&n.getProperty("physwidth"),o=n&&n.getProperty("physheight"),u=r&&s&&o&&(+s).toFixed(2)+'" x '+(+o).toFixed(2)+'"';e.setNodeInnerHtml(["physicalSize","physicalSize2"],u);e.displayNode("stitchInfoShell",u&&!i);e.displayNode("conversionInfoShell",u&&i&&t)};o.wireUi=function(){var r=this;if(!r.isWired){r.wireNode("",{click:function(e){r.fire({name:"Click Selected",domEvent:e});e.cancelBubble=t;return n}});e.doMy(r,"wireUi");r.updateUi()}};o.updateUi=function(){var t=this;if(t.isWired){t.set({e_D:"100.00"});t.e_l();t.e_f();t.e_y();t.e_g();t.e_E();e.doMy(t,"updateUi")}};s.stateProperties({e_h:{name:"hasError",onChange:function(){this.children.warning&&this.children.warning.set({shown:this.e_h})},value:n},e_j:{name:"warningIsFocused",onChange:function(){this.children.warning&&this.children.warning.set({focused:this.e_j})}},e_K:"hotspotTemplate",e_L:"hotspotParent",e_n:"type",e_m:{name:"model",onChange:function(){var e=this,t=e.e_m,n=t instanceof zazzle.rlv.DesignImage?"image":t instanceof zazzle.rlv.DesignText?"text":"";e.set({type:n,value:(n==="image"?t.imageid:i)||t.text})}},e_D:{name:"price",onChange:o.e_C},e_M:{name:"value",onChange:function(){this.e_n==="image"&&this.e_l()}},e_i:{name:"warningMessage",onChange:function(){this.children.warning&&this.children.warning.set({message:this.e_i})}}});return s}});Uize.module({name:"ZazzleWww.ControlPopupPalette",superclass:"Uize.Widget.PopupPalette",required:"Uize.Widget.Options",builder:function(e){"use strict";var t=e.subclass(null,function(){var e=this;e.e_a=e.addChild("options",Uize.Widget.Options,{idPrefixConstruction:"same as parent",value:e.e_b,values:e.e_c});e.e_a.wire({Click:function(){e.set({shown:!e.get("hideOnClick")});e.fire({name:"Option Clicked",value:e.e_a+""})},"Changed.value":function(){e.set({e_b:e.e_a+""})},"Changed.values":function(){e.set({values:e.e_a.get("values")})}});e.e_d={};for(var t=-1;++t<e.e_c.length;)e.e_d[e.e_c[t]]=t}),n=t.prototype;n.updateUi=function(){var t=this;e.doMy(t,"updateUi");if(t.isWired){var n=t.children.selector,r=t.e_a.children["option"+t.e_d[t.e_b]],i=r.getNode("frames"),s=r.getNode("label");if(i){n.setNodeStyle("frames",{background:"url("+i.getAttribute("src")+") "+t.e_k});if(s)n.setNodeInnerHtml("label",s.innerHTML);n.updateUi()}}};t.stateProperties({e_b:{name:"value",onChange:function(){var e=this;if(e.e_a)e.e_a.set({value:e.e_b});e.updateUi()},value:""},e_c:{name:"values",onChange:function(){var e=this;if(e.e_a)e.e_a.set({values:e.e_c});e.updateUi()},value:[]},e_k:{name:"backgroundUrlAttributes",value:""}});t.set({positioning:"none"});return t}});Uize.module({name:"Uize.Widget.Population",required:"Uize.Dom.Basics",builder:function(e){"use strict";function r(e,t){return t+e.replace(/\\/g,"\\\\").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(new RegExp(t,"g"),"\\"+t)+t}function i(e,t,s,o,u,a,f,l){var c=[],h=0,p=e.length;while(h<p){var d="",v="",m=p,g=function(t,n){var i;for(var s in t){var o=t[s],u=typeof o=="object",a="("+n+" || {}) ["+r(s,"'")+"]";if(u&&typeof o.length!="number"){g(o,a)}else{if(u){var f=o[0];i=e.indexOf(f.OPENER_TOKEN,h);if(i>-1){var l=e.indexOf(f.CLOSER_TOKEN,i+f.OPENER_TOKEN.length);if(l>-1){o=e.slice(i,l+f.CLOSER_TOKEN.length)}else{i=-1}}}else{i=e.indexOf(o,h)}if(i>-1&&i<m){d=a;v=o;m=i}}}};g(t,"obj");c.push({d_D:e.slice(h,m),d_A:d,d_E:d?Function("obj","return "+d):0,d_y:v});h=m;if(d)h+=v.length}var y=[f];for(var b=-1,w=s.length;++b<w;){var E=s[b];y.push(u);for(var S=-1,x=c.length;++S<x;){var T=c[S],N=T.d_A;y.push(T.d_D);if(N){if(N=="(obj || {}) ['GENERATED_itemNo']"){y.push(b)}else{var C=T.d_E,k=C(E);if(k===n)k=C(o);if(k!==n){if(Uize.isFunction(k)){k=k.call(E)}else if(Uize.isArray(k)){var L=C(t)[0];k=i(T.d_y.slice(L.OPENER_TOKEN.length,T.d_y.length-L.CLOSER_TOKEN.length),L,k,"","","","")}y.push(k!=null?k:T.d_y)}}}}y.push(a)}y.push(l);return y.join("")}var t=true,n;return e.subclass({alphastructor:function(){this.d_O={d_f:t,d_h:t}},instanceMethods:{getOutput:function(){var e=this;return i(e.d_f,e.d_g,e.d_h,e.d_i,e.d_j,e.d_k,e.d_l,e.d_m)},getHtml:function(){return this.getOutput().replace(/[\t\n\r ]+/g," ").replace("> <","><")},updateUi:function(){var e=this,t=e.d_O;if(e.isWired&&(t.d_f||t.d_h)&&e.get("enabledInherited")){var n=Uize.Dom.Basics.getById(e.get("container"))||e.getNode("shell")||e.getNode();if(n){if(!e.d_f)e.d_f=n.innerHTML;var r=e.getHtml();if(r!==e.d_R)n.innerHTML=e.d_R=r;t.d_f=t.d_h=false}}}},staticMethods:{makeTemplateItem:function(e,t){function r(e,t,i){for(var s in e){var o=e[s];typeof o=="object"?r(o,t[s]={},s+"."):t[s]=n(i+s)}return t}var n=function(e){return e};if(typeof t=="string"&&t){n=function(e){return t.replace("KEY",e)}}else if(Uize.isFunction(t)){n=t}return r(e,{},"")},replaceByTemplateItem:function(e,t,r){return i(e,r,[t],n,"","","","")},replaceByToken:function(e,t,n){return d_1.replaceByTemplateItem(e,t,d_1.makeTemplateItem(t,n||"{KEY}"))}},stateProperties:{d_l:{name:"outputPrefix",value:""},d_m:{name:"outputSuffix",value:""},d_j:{name:"itemPrefix",value:""},d_k:{name:"itemSuffix",value:""},d_h:{name:"items",onChange:function(){this.d_O.d_h=t;this.updateUi()},value:[]},d_i:"itemPhantomProperties",d_g:"templateItem",d_f:{name:"templateStr",onChange:function(){this.d_O.d_f=t;this.updateUi()}}}})}});Uize.module({name:"ZazzleWww.ControlPoptions",superclass:"Uize.Widget",required:["Uize.Widget.Options","Uize.Widget.Population"],builder:function(e){"use strict";var t;var n=e.subclass(function(){var e=this;e.d_b=e.addChild("options",Uize.Widget.Options,{idPrefixConstruction:"same as parent",nodeMap:{"":"options"},built:false,html:true})}),r=n.prototype;r.d_d=function(){var e=this,t=this.d_e,n=e.d_g[t];e.set({d_h:n?typeof n.shownIndex=="number"?n.shownIndex:t:-1})};r.d_i=function(){var e=this;if(e.isWired){var t=e.children.options,n=t.children,r=e.d_g,i=Math.min(t.get("values").length,r.length);for(var s=-1;++s<i;){var o=r[s].shownIndex;if(typeof o=="number"){var u=n["option"+s];u.displayNode(u.getNode("shell")||u.getNode("bed")||u.getNode(),o>-1)}}}};r.createOptionButtons=function(){var e=this;if(e.isWired){var t=e.d_g,n=t.length;if(n){e.insertUiHtml();e.d_b.set({values:t});e.d_b.set({value:e.d_n});e.set({d_o:n})}e.d_i()}};r.filter=function(e){var t=this,n=t.d_g;if(n){var r=0;for(var i=-1,s=n.length;++i<s;){var o=n[i],u=!e||e(o);o.shownIndex=u?r:-1;if(u)r++}t.d_i();t.set({d_o:r});t.d_d()}};r.insertUiHtml=function(){if(this.d_r){this.d_r.wireUi();this.d_r.set({items:this.d_g})}};r.updateUi=function(){var t=this;t.isWired&&t.d_s&&t.displayNode("shell",t.d_g&&t.d_g.length>1);e.doMy(t,"updateUi")};r.wireUi=function(){var t=this;if(!t.isWired){if(t.d_r)t.d_r.set({container:t.getNode("options")});var n=t.d_b,r=function(e,r){var i=t.d_g,s=n.get(r);if(s==-1)s=Uize.findRecordNo(i,{name:n.get(e)});t.set(r,s);if(i[s])t.set(e,i[s].name)};n.wire({Click:t,"Changed.tentativeValue":function(){r("tentativeValue","tentativeValueNo")},"Changed.value":function(){r("value","valueNo")},"Option Event":t,"Before Value Change":t});e.doMy(t,"wireUi");t.updateUi();t.createOptionButtons()}};var i=function(e){var n=this,r=n.d_n,i=e.value!==t,s=e.values!==t,o=function(){var e=-1,t=n.d_g,i=t.length;for(var s=-1;++s<i;){if(r==t[s].name){e=s;break}}var o=e>-1?t[e].name:null;n.set({d_D:e,d_E:o});if(e!=n.d_e){n.d_e=e;n.d_n=o;if(n.d_b)n.d_b.set({value:o})}n.updateUi()};if(i&&s){n.d_h=-1;n.createOptionButtons();o();n.d_d()}else if(i){if(!n.d_F){o();n.d_d()}}else if(s){n.set({d_e:-1,d_D:-1});n.d_F=true;n.set({d_E:null,d_n:null});n.d_F=false;n.updateUi();n.createOptionButtons();n.d_d()}};n.stateProperties({d_s:"hideOnSingleValue",d_G:{name:"isDirty",value:true},d_H:{name:"templateOption",onChange:function(){var e=this;(e.d_r||(e.d_r=e.population=new Uize.Widget.Population)).set({templateItem:e.d_H});e.d_b.set({built:true,html:null})}},d_E:{name:"tentativeValue",value:null},d_D:{name:"tentativeValueNo",value:-1},d_n:{name:"value",onChange:i,value:null},d_e:{name:"valueNo",value:-1},d_h:{name:"valueShownIndex",value:-1},d_g:{name:"values",onChange:i,value:[]},d_o:"valuesShown"});return n}});Uize.module({name:"Uize.Widget.Bar",required:"Uize.Node",builder:function(e){"use strict";function r(e){var n=this,r=n.d_e==t?n.d_d:n.d_e,i=n.d_f;return Uize.constrain(i?r+Math.round((e-r)/i)*i:e,r,n.d_g==t?n.d_h:n.d_g)}function i(){var e=this;if(e.isWired){var t=e.d_j,r=n.getDimensions(e.d_l),i=[r.width,r.height],s=e.d_n,o=n.getDimensions(s),u=[o.width,o.height],a=e.d_q,f=a(e.d_d),l=a(e.d_h),c=a(e.d_c),h=Math.round((c-f)/(l-f)*(i[t]-u[t])),p=t?i[1]-u[1]-h:h,d=Math.round(p+u[t]/2),v=Uize.isNumber(e.d_x)?e.d_c.toFixed(e.d_x):e.d_c;if(s){s.style[t?"top":"left"]=p+"px";s.title=v}e.d_y&&n.setClipRect(e.d_y,t?d:0,t?i[0]:d,i[1],0);e.d_z&&n.setClipRect(e.d_z,0,i[0],t?d:i[1],t?0:d);e.d_A&&n.setInnerHtml(e.d_A,Uize.isNumber(e.d_x)?e.d_c.toFixed(e.d_x):e.d_c)}}function s(){var e=this;e.set({d_c:r.call(e,e.d_c)});i.call(e)}var t,n=Uize.Node;return e.subclass({instanceMethods:{updateUi:i,wireUi:function(){var t=this;if(!t.isWired){t.d_l=t.getNode("track");t.d_n=t.getNode("knob");t.d_y=t.getNode("full");t.d_z=t.getNode("empty");t.d_A=t.getNode("value");e.doMy(t,"wireUi")}}},staticProperties:{presets:{}},stateProperties:{d_x:"decimalPlacesToDisplay",d_f:{name:"increments",onChange:s,value:1},d_e:{name:"minValidValue",onChange:s},d_d:{name:"minValue",onChange:s,value:0},d_g:{name:"maxValidValue",onChange:s},d_h:{name:"maxValue",onChange:s,value:100},d_C:{name:"orientation",value:"vertical"},d_j:{derived:function(e){return e=="vertical"?1:0},onChange:i},d_q:{name:"scaleFunc",value:function(e){return e}},d_c:{name:"value",conformer:r,onChange:i,value:0}}})}});Uize.module({name:"Uize.Widget.Bar.Slider",required:["Uize.Dom.Pos","Uize.Widget.Drag"],builder:function(e){"use strict";function r(){this.e_c=null;this.fire("Value Change After Rest")}function i(e){var t=this,n=+t;t.set({value:e});if(+t!=n){if(t.isWired&&t.children.drag.get("inDrag")){if(t.e_c)clearTimeout(t.e_c);t.e_c=setTimeout(function(){r.call(t)},t.e_g)}else{r.call(t)}}}var t=Uize.Dom.Pos,n=Uize.Widget.Drag;return e.subclass({instanceMethods:{wireUi:function(){var s=this;if(!s.isWired){var o=s.getNode("track"),u=s.getNode("knob"),a,f,l,c,h,p=s.get("scaleFunc"),d=s.get("valueFunc"),v=function(){a=s.get("orientation")=="vertical"?1:0;f=t.getDimensions(o);l=[f.width,f.height];c=t.getDimensions(u);h=[c.width,c.height]},m=function(e){var t=p(s.get("maxValue")),n=p(s.get("minValue"));return e*(1-a*2)*(t-n)/(l[a]-h[a])};var g=s.addChild("drag",n,{node:u}),y;g.wire({"Drag Start":function(){s.set({e_x:true});v();y=+s},"Drag Update":function(){i.call(s,d(p(y)+m([g.eventDeltaPos[0],g.eventDeltaPos[1]][a])))},"Drag Done":function(){s.set({e_x:false});clearTimeout(s.e_c);s.e_c=null;r.call(s)}});var b=function(e){if(s.get("enabledInherited")){v();var n=t.getCoords(o),r=t.getEventAbsPos(e);i.call(s,d(p(s.get("minValue"))+m((a?r.top:r.left)-h[a]/2*(1-a*2)-(a?n.bottom:n.x))));return g.initiate(e)}};s.wireNode([o,"full","empty"],{mousedown:b,touchstart:b});e.doMy(s,"wireUi")}}},staticProperties:{presets:{}},stateProperties:{e_x:{name:"inDrag",value:false},e_g:{name:"restTime",value:250},e_p:{name:"valueFunc",value:function(e){return e}}}})}});Uize.module({name:"Uize.Widget.Bar.Slider.Plus",required:"Uize.Widget.Button",builder:function(e){"use strict";return e.subclass({omegastructor:function(){function t(t,n){function r(e){return Math.round(e*Math.pow(10,14))/Math.pow(10,14)}var i=n.shiftKey?e.f_f:n.ctrlKey?e.f_g:e.f_h,s=e.get("minValue"),o=(e.get("maxValue")-s)/i;e.set({value:(Math[t<0?"ceil":"floor"](r((e-s)/o))+t)*o+s})}var e=this;e.addChildren({setToMin:{action:function(){e.set({value:e.get("minValue")})}},setToMax:{action:function(){e.set({value:e.get("maxValue")})}},stepToMin:{action:function(e){t(-1,e)}},stepToMax:{action:function(e){t(1,e)}}},{widgetClass:Uize.Widget.Button});e.onChange("value",function(t){var n=e.children,r=t!=e.get("minValue")?"inherit":false,i=t!=e.get("maxValue")?"inherit":false;n.setToMin.set({enabled:r});n.setToMax.set({enabled:i});n.stepToMin.set({enabled:r});n.stepToMax.set({enabled:i})})},stateProperties:{f_f:{name:"stepsCoarse",value:2},f_g:{name:"stepsFine",value:25},f_h:{name:"stepsNormal",value:5}}})}});Uize.module("Uize.Util.Html");Uize.module({name:"Uize.Util.Html.Entities",builder:function(){"use strict";var e={quot:34,amp:38,apos:39,lt:60,gt:62,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,copy:169,ordf:170,laquo:171,not:172,shy:173,reg:174,macr:175,deg:176,plusmn:177,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,sup1:185,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,Agrave:192,Aacute:193,Acirc:194,Atilde:195,Auml:196,Aring:197,AElig:198,CCedil:199,Egrave:200,Eacute:201,Ecirc:202,Euml:203,Igrave:204,Iacute:205,Icirc:206,Iuml:207,ETH:208,Ntilde:209,Ograve:210,Oacute:211,Ocirc:212,Otilde:213,Ouml:214,times:215,Oslash:216,Ugrave:217,Uacute:218,Ucirc:219,Uuml:220,Yacute:221,THORN:222,szlig:223,agrave:224,aacute:225,acirc:226,atilde:227,auml:228,aring:229,aelig:230,ccedil:231,egrave:232,eacute:233,ecirc:234,euml:235,igrave:236,iacute:237,icirc:238,iuml:239,eth:240,ntilde:241,ograve:242,oacute:243,ocirc:244,otilde:245,ouml:246,divide:247,oslash:248,ugrave:249,uacute:250,ucirc:251,uuml:252,yacute:253,thorn:254,yuml:255,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,"int":8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};return Uize.package({entityNameToCharCodeLookup:e,charCodeToEntityNameLookup:Uize.reverseLookup(e)})}});Uize.module({name:"Uize.Util.Html.Encode",required:["Uize.Str.Replace","Uize.Util.Html.Entities"],builder:function(){"use strict";var e=Uize.Util.Html.Entities.entityNameToCharCodeLookup;return Uize.package({encode:Uize.Str.Replace.replacerByLookup({"&":"&",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;","\n":"&#10;","\r":"&#13;"}),decode:function(t){return(t+="")&&t.replace(/&(?:(\w+)|#(\d{1,4}|x[0-9a-fA-F]{1,4}));/g,function(t,n,r){return String.fromCharCode(r?+(r.charAt(0)=="x"?"0"+r:r):e[n])})}})}});Uize.module({name:"Uize.Xml",required:"Uize.Util.Html.Encode",builder:function(){"use strict";function s(e){return{upper:"toUpperCase",lower:"toLowerCase"}[e.nameCase]||"valueOf"}var e={},t=Uize.Util.Html.Encode,n=t.encode,r=t.decode,i=/\s*([^=\s]+)\s*(=\s*("([^"]*)"|'([^']*)'|(\S*))|$|)/g;return Uize.package({toAttributeValue:n,fromAttributeValue:r,fromAttributes:function(t,n){var o={};if(t){n=n||e;var u=s(n),a;while(a=i.exec(t))o[a[1][u]()]=r(a[4]||a[5]||a[6]||"")}return o},toAttributes:function(t,r){var i=s(r=r||e),o=r.quoteChar||'"',u="="+o,a=[];if(i!="valueOf"){var f=t;t={};for(var l in f)t[l[i]()]=f[l]}for(var l in t)l&&a.push(l+u+n(t[l])+o);return a.join(" ")}})}});Uize.module({name:"Zazzle.DesignModel",builder:function(e){Uize.global().zazzle=function(){var e={rlv:{DesignState:{SYNCHRONIZED:1,DIRTY:2,NEEDSYNCH:3,WAITINGFORSERVER:4,ERROR:5},DesignObjectSpace:{OBJECT:1,DESIGN:2,SCREEN:3},DesignTextAlign:{CENTER:1,LEADING:2,TRAILING:3},DesignTextParagraphAlign:{CENTER:1,NEAR:2,FAR:3},DesignTextScaleMode:{FIT:1,NONE:2,USER:3},DesignTextPath:{HORZ:1,VERT:2,ARC:3,RARC:4},DesignImageType:{JPG:1,PNG:2,ZTR:3,OFM:4}},ajax:{},util:{}};return e}();(function(){var e;var t;var n=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];for(e=0;e<n.length;e++){try{t=n[e]();zazzle.ajax.create=n[e]}catch(r){}}})();(function(){function e(e){var t=e.status;return t>=200&&t<300||t===304}function t(e){var t;var n;var r=e.getResponseHeader("Content-Type");n=r.indexOf(";");if(n>0){r=r.substring(0,n)}switch(r){case"text/html":t=e.responseXML;break;case"text/javascript":case"text/json":case"application/json":t=(new Function("var a=["+e.responseText+"];return a.pop()"))();break;default:t=e.responseText}return t}function n(e){var t;var n;var r;var i=[];for(t in e){if(e.hasOwnProperty(t)){n=e[t].toString();r=encodeURIComponent(t)+"="+encodeURIComponent(n);i.push(r)}}return i.join("&")}function r(e){var t;var n;var r;var i=/%20/g;var s=[];for(t in e){if(e.hasOwnProperty(t)){n=e[t].toString();r=encodeURIComponent(t).replace(i,"+")+"="+encodeURIComponent(n).replace(i,"+");s.push(r)}}return s.join("&")}function i(n,r,i,s,o){var u;var a=r;var f=zazzle.ajax.create();f.onreadystatechange=function(){if(f.readyState===4){if(e(f)){i(t(f),o)}else{if(s){s(f.status,f.statusText,o)}else{i(null,o)}}}};f.open("POST",n);if(typeof r==="string"){u="text/xml";a=r}else{u="application/x-www-form-urlencoded";a=zazzle.ajax.encodeFormData(r)}f.setRequestHeader("Content-Type",u);f.send(a)}if(!zazzle.ajax.create){return}zazzle.ajax.buildQueryString=n;zazzle.ajax.encodeFormData=r;zazzle.ajax.post=i})();(function(){function r(e){return n[e]}function i(e,t){var n=e;if(e&&typeof e==="string"){if(t){n=e.replace(/[&\n\r"'<>]/g,r)}else{n=e.replace(/[&<>]/g,r)}}return n}function s(e,t,n){var r;var i;var s="<"+e;if(t&&typeof t==="object"){for(r in t){if(t.hasOwnProperty(r)){i=t[r];s=s+" "+r+'="'+zazzle.util.xmlSafe(i,true)+'"'}}}if(n){s=s+"/>"}else{s=s+">"}return s}function o(e){var t="</"+e+">";return t}function u(){var t=e;e=e+1;return t}function a(e){return e&&typeof e==="object"&&e.constructor===Array}function f(){var e=new Date;var n=String(e.valueOf())+String(Math.round(Math.random()*1e3))+String(t++);return n}function l(e){var t=0;if(a(e)&&e.length===6){t=e[0]*e[3];t-=e[1]*e[2]}return t}function c(e){var t=[1,0,0,1,0,0];var n;var r;var i;var s;var o;var u;var f;var c;if(a(e)&&e.length===6){r=l(e);n=r;if(r<0){n=-r}if(n>1e-4){i=e[3];s=-e[2];o=e[2]*e[5]-e[3]*e[4];u=-e[1];f=e[0];c=e[4]*e[1]-e[0]*e[5];t[0]=i/r;t[1]=u/r;t[2]=s/r;t[3]=f/r;t[4]=o/r;t[5]=c/r}}return t}var e=1;var t=1;var n={"&":"&",'"':"&quot;","'":"&apos;","<":"&lt;",">":"&gt;","\n":"&#10;","\r":"&#13;"};zazzle.util.xmlSafe=i;zazzle.util.xmlStartElement=s;zazzle.util.xmlEndElement=o;zazzle.util.getNextSequenceId=u;zazzle.util.isArray=a;zazzle.util.defeatCacheStr=f;zazzle.util.matrixDeterminant=l;zazzle.util.matrixInverse=c})();zazzle.rlv.DesignOptions=function(t){if(!(this instanceof zazzle.rlv.DesignOptions)){return new zazzle.rlv.DesignOptions(t)}var n;var r;if(t&&typeof t==="object"){for(n in t){if(t.hasOwnProperty(n)){r=t[n];this[n]=r}}}};zazzle.rlv.DesignViewOptions=function(t){if(!(this instanceof zazzle.rlv.DesignViewOptions)){return new zazzle.rlv.DesignViewOptions(t)}if(t&&typeof t==="object"){if(t.max_dim){this.max_dim=t.max_dim}if(t.rvtype){this.rvtype=t.rvtype}if(t.view){this.view=t.view}if(t.context){this.context=t.context}}this.mergeOpts=function(e){if(e.max_dim&&!this.max_dim){this.max_dim=e.max_dim}if(e.rvtype&&!this.rvtype){this.rvtype=e.rvtype}if(e.context&&!this.context){this.context=e.context}}};zazzle.rlv.ZDesign=function(t){function x(e,t,n,r){var i;var s;var o=new zazzle.rlv.DesignEvent(e,t,n,r);for(i=0;i<w.length;i++){s=w[i];s.callback(o)}}function T(e){var t={};var n;var r;var i;var s;var o;if(typeof e==="string"){n=e.split("&");for(i=0;i<n.length;i++){r=n[i].split("=");if(r&&r.length>1){s=r[0];o=r[1];t[s]=o}}}return t}function N(e,t){var r;var o;var u;var b;var w;var E=[];var S;var N;var C;var k;if(localStorage&&localStorage.doublecheckTest){console.log("DesignModel is loading data",e)}if(e&&typeof e==="object"&&t&&t instanceof zazzle.rlv.ZDesign){t.serverResult=e;if("undo"in e){v=e.undo}if("paste"in e){g=e.paste}if("redo"in e){m=e.redo}if("canpublish"in e){y=e.canpublish}if(e.design){if(e.design.id){c=e.design.id}if(e.design.attributes){h=T(e.design.attributes)}p=[];if(zazzle.util.isArray(e.design.constraints)){for(r=0;r<e.design.constraints.length;r++){S=e.design.constraints[r];if(S&&typeof S==="object"){N=new zazzle.rlv.DesignConstraint(S.area,S.level,S.objects,S.type);p.push(N)}}}d=[];if(zazzle.util.isArray(e.design.templates)){for(r=0;r<e.design.templates.length;r++){C=e.design.templates[r];if(C&&typeof C==="object"){k=new zazzle.rlv.DesignTemplate(C);d.push(k)}}}if(h.view){b=t.getView({view:h.view});if(b){b.setNeedsAreaRefresh(false);if(zazzle.util.isArray(e.design.wireframes)){b.handleResponseWireframes(e.design.wireframes)}}}for(r=0;r<s.length;r++){s[r].setMarked(true)}if(e.design.areas){for(r=0;r<e.design.areas.length;r++){E.push(e.design.areas[r].name)}for(r=0;r<e.design.areas.length;r++){o=e.design.areas[r];u=null;if(o&&o.name){u=t.getArea(o.name)}if(u&&u.handleServerResponse){u.setMarked(false);if(o.isdefault){if(b){w=b.getViewName();u.setAsDefaultForView(w)}}u.handleServerResponse(o,b)}}}if(e.design.missingAreaGroups){n.missingAreaGroups=e.design.missingAreaGroups}for(r=0;r<s.length;r++){u=s[r];if(u&&u.getMarked()){u.handleAreaIsNowEmpty()}}i=zazzle.rlv.DesignState.SYNCHRONIZED;x("sync",true,t,b)}else{if(e.Code){a=e.Code}else{a=-1}if(e.Message){f=e.Message}else{f="UNKNOWN"}if(e.Category){l=e.Category}else{l="UNKNOWN"}i=zazzle.rlv.DesignState.ERROR;x("error",false,t,null)}}}function C(e,t,n){if(e){a=e}else{a=-1}if(t){f=t}else{f="UNKNOWN"}i=zazzle.rlv.DesignState.ERROR;x("error",false,n)}if(!(this instanceof zazzle.rlv.ZDesign)){return new zazzle.rlv.ZDesign(t)}var n=this;this.opts=new zazzle.rlv.DesignOptions(t);this.serverRequest="";this.serverResult={};this.missingAreaGroups=[];var r="/rlv/svc/edit";var i=zazzle.rlv.DesignState.DIRTY;var s=[];var o=[];var u;var a=0;var f="";var l="";var c;var h={};var p=[];var d=[];var v=false;var m=false;var g=false;var y=false;var b=true;var w=[];var E=[];var S=[];if(this.opts.id){c=this.opts.id}this.getOpts=function(){return this.opts};this.useDesignSpace=function(e){if(typeof e==="boolean"){b=e}};this.getView=function(e){var t;var n;for(n=0;n<o.length;n++){if(o[n].matches(e)){t=o[n];break}}if(t){t.mergeOptions(e)}else{if(!e.max_dim&&this.opts.max_dim&&typeof this.opts.max_dim==="number"){e.max_dim=this.opts.max_dim}t=new zazzle.rlv.DesignView(this,e);o.push(t);this.setDirty()}return t};this.hasDefaultAreaForView=function(e){var t=false;var n;var r;var i;var o;if(e instanceof zazzle.rlv.DesignView){n=e.getOpts().view;for(o=0;o<s.length;o++){i=s[o];r=i.getName()}for(o=0;o<s.length;o++){if(s[o].isDefaultForView(n)){t=true;break}}}return t};this.getDefaultAreaForView=function(e){var t;var n;var r;if(e instanceof zazzle.rlv.DesignView){n=e.getOpts().view;for(r=0;r<s.length;r++){if(s[r].isDefaultForView(n)){t=s[r];break}}}return t};this.setActiveView=function(e){if(e instanceof zazzle.rlv.DesignView){if(e!==u){e.setNeedsAreaRefresh(true);this.setDirty()}u=e}};this.forceReturnAllAreas=function(){if(u){u.setNeedsAreaRefresh(true);u.setNeedsGridRefresh(true)}};this.getArea=function(e){var t;var n;for(n=0;n<s.length;n++){if(s[n].getName()===e){t=s[n];break}}if(!t){if(e){t=new zazzle.rlv.DesignArea(this,e,"","");s.push(t)}}return t};this.removeArea=function(e){var t;var n;if(e){for(n=0;n<s.length;n++){t=s[n];if(t.getName()===e){t.markDeleted()}}}};this.addDesignListener=function(e){var t;var n;if(e&&typeof e==="function"){n={};n.seq=zazzle.util.getNextSequenceId();n.callback=e;w.push(n);t=new zazzle.rlv.DesignListener(n.seq)}return t};this.removeDesignListener=function(e){var t;var n;var r;var i;if(e&&e instanceof zazzle.rlv.DesignListener){t=e.getSequenceId();r=-1;for(n=0;n<w.length;n++){if(w[n].seq===t){r=n;break}}if(r>=0){i=[];for(n=0;n<w.length;n++){if(n!==r){i.push(w[n])}}w=i}}};this.getState=function(){return i};this.getErrorCode=function(){return a};this.getErrorMessage=function(){return f};this.getErrorCategory=function(){return l};this.getId=function(){return c};this.getAreas=function(){return s};this.getAttributes=function(){return h};this.getConstraints=function(){return p};this.getTemplates=function(){return d};this.isUndoable=function(){return v};this.isRedoable=function(){return m};this.canPaste=function(){return g};this.canPublish=function(){return y};this.setProperty=function(e,t){var n;var r;var i=false;for(n=0;n<S.length;n++){r=S[n];if(r&&r instanceof zazzle.rlv.DesignProperty){if(r.name===e){i=true;break}}}if(i){r.value=t;r.changed=true}else{r=new zazzle.rlv.DesignProperty(e,t);r.changed=true;S.push(r)}};this.update=function(){var e;var t;if(i===zazzle.rlv.DesignState.DIRTY){e=this.buildServerRequest();t=r+"?output=js";zazzle.ajax.post(t,e,N,C,this);i=zazzle.rlv.DesignState.WAITINGFORSERVER}};this.updateWithResponse=function(e){if(i===zazzle.rlv.DesignState.DIRTY){N(e,this)}};this.undo=function(){if(this.isUndoable()){var e={};var t={};e.verb="undo";e.attribs=t;E.push(e);this.setDirty()}};this.save=function(){var e={};var t={};e.verb="save";e.attribs=t;E.push(e);this.setDirty()};this.redo=function(){if(this.isRedoable()){var e={};var t={};e.verb="redo";e.attribs=t;E.push(e);this.setDirty()}};this.finish=function(e){var t={};var n={};t.verb="finish";if(e){n.forsale="true"}t.attribs=n;E.push(t);this.setDirty()};this.buildParamAttribs=function(){var e={};var t;var n;var r;var i;var o;if(c){e.id=c}else{if(this.opts.pid){e.pid=this.opts.pid}if(this.opts.pdt){e.pdt=this.opts.pdt}}if(this.opts.pending){e.pending=this.opts.pending}if(u){t=u.getOpts();if(t.max_dim){e.max_dim=t.max_dim}if(t.rvtype){e.rvtype=t.rvtype}if(t.view){e.view=t.view}if(t.context){e.context=t.context}if(u.needsAreaRefresh()){e.returnallareas="true"}else{e.returnallareas="false"}}else{e.rvtype="none";if(s.length===0){e.returnallareas="true";e.returngrids="true"}}for(n in this.opts){if(this.opts.hasOwnProperty(n)){if(n!=="id"&&n!=="pid"&&n!=="pending"&&n!=="max_dim"&&n!=="context"&&n!=="rvtype"&&n!=="returngrids"&&n!=="returnallareas"){r=this.opts[n];e[n]=r}}}if(b&&e.rvtype!=="none"){e.returngrids="false";e.coordspace="design";if(u){if(u.needsGridRefresh()){e.returngrids="true";e.returnallareas="true"}}}for(o=0;o<S.length;o++){i=S[o];n=i.name;if(n!=="id"&&n!=="pid"&&n!=="pending"&&n!=="max_dim"&&n!=="context"&&n!=="rvtype"&&n!=="returngrids"&&n!=="returnallareas"){r=i.value;e[n]=r}}S=[];return e};this.buildServerRequest=function(){var e;var t;var n;var r;var i=zazzle.util.xmlStartElement("edit",{version:1});r=this.buildParamAttribs();i=i+zazzle.util.xmlStartElement("params",r,true);for(e=0;e<s.length;e++){t=s[e];i=i+t.buildServerRequest()}for(e=0;e<E.length;e++){n=E[e];if(n){i=i+zazzle.util.xmlStartElement(n.verb,n.attribs,true)}}E=[];i=i+zazzle.util.xmlEndElement("edit");this.serverRequest=i;return i};this.setDirty=function(){if(i===zazzle.rlv.DesignState.SYNCHRONIZED||i===zazzle.rlv.DesignState.ERROR){i=zazzle.rlv.DesignState.DIRTY}}};zazzle.rlv.createZDesign=function(e){var t=new zazzle.rlv.ZDesign(e);return t};zazzle.rlv.DesignView=function(t,n){if(!(this instanceof zazzle.rlv.DesignView)){return new zazzle.rlv.DesignView(t,n)}this.design=t;this.opts=new zazzle.rlv.DesignViewOptions(n);var r="/rlv/svc/view";var i=false;var s;var o=[];var u=[];var a=true;var f=true;this.getOpts=function(){return this.opts};this.getViewName=function(){var e="";if(this.opts&&this.opts.view){e=this.opts.view}return e};this.getZDesign=function(){return this.design};this.needsSync=function(){return i};this.needsAreaRefresh=function(){return a};this.setNeedsAreaRefresh=function(e){if(typeof e==="boolean"){a=e}};this.needsGridRefresh=function(){return f};this.setNeedsGridRefresh=function(e){if(typeof e==="boolean"){f=e}};this.matches=function(e){var t=false;if(typeof e==="object"){if(e.view===this.opts.view){t=true}}return t};this.mergeOptions=function(e){if(this.opts&&e){this.opts.mergeOpts(e)}};this.setSync=function(e){if(typeof e==="boolean"){i=e}};this.sync=function(){};this.getDefaultArea=function(){if(!s){s=t.getDefaultAreaForView(this)}return s};this.getViewArea=function(e){var t;var n;var r;for(n=0;n<o.length;n++){if(o[n].getName()===e){t=o[n];break}}if(!t){r=this.design.getArea(e);t=new zazzle.rlv.DesignViewArea(this,r);o.push(t)}return t};this.getViewAreas=function(){return o};this.getAnnotations=function(){return u};this.getJpegImageSource=function(e){var t;var n=this.buildParamAttribs();n.image_type="jpg";if(e&&typeof e==="number"){n.max_dim=e}t=r+"?"+zazzle.ajax.buildQueryString(n);t=t+"&rnd="+zazzle.util.defeatCacheStr();return t};this.getPngImageSource=function(e){var t;var n=this.buildParamAttribs();n.image_type="png";if(e&&typeof e==="number"){n.max_dim=e}t=r+"?"+zazzle.ajax.buildQueryString(n);t=t+"&rnd="+zazzle.util.defeatCacheStr();return t};this.buildParamAttribs=function(){var e={};var n=t.getOpts();var r=t.getId();if(r){e.id=r}else{if(n.pid){e.pid=n.pid}if(n.pdt){e.pdt=n.pdt}}if(n.pending){e.pending=n.pending}if(this.opts.max_dim){e.max_dim=this.opts.max_dim}if(this.opts.rvtype){e.rvtype=this.opts.rvtype}if(this.opts.view){e.view=this.opts.view}if(this.opts.context){e.context=this.opts.context}if(n.title){e.title=n.title}if(n.style){e.style=n.style}if(n.color){e.color=n.color}if(n.size){e.size=n.size}return e};this.handleResponseWireframes=function(e){var t;var n;u=[];for(t=0;t<e.length;t++){n=new zazzle.rlv.DesignViewAnnotation(this);n.handleServerResponse(e[t]);if(n.isValid()){u.push(n)}}}};zazzle.rlv.DesignArea=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignArea)){return new zazzle.rlv.DesignArea(t,n,r,i)}var s=n;this.groupName="";this.insideBleed=[];this.outsideSafe=[];var o=r;var u=i;var a=null;var f=[];var l=[];var c=0;var h=false;var p=false;var d=false;var v=[];var m=[];var g=false;var y=false;var b;var w=false;var E=true;var S=[];this.design=t;var x=function(e){var t;var n;var r=[];var i;var s;if(zazzle.util.isArray(e)){for(n=0;n<e.length;n++){i=e[n];if(i&&typeof i==="object"&&i.getName&&typeof i.getName==="function"){s=i.getName();r.push(s)}}if(r.length>0){t=r.join(",")}}return t};this.getName=function(){return s};this.setName=function(e){if(e&&typeof e==="string"){if(s&&s!==e){y=true;this.setDirty();this.design.forceReturnAllAreas()}b=e}};this.getColors=function(){return m};this.setFill=function(e){if(e&&e instanceof zazzle.rlv.DesignFill){a=e;w=true;this.setDirty()}};this.getFill=function(){return a};this.getProperties=function(){return f};this.getChildObjects=function(e,t){return l};this.getStitches=function(){return c};this.getMarked=function(){return h};this.setMarked=function(e){if(typeof e==="boolean"){h=e}};this.reorderAbove=function(e,t){var n={};var r={};var i=x(e);if(i){if(t&&typeof t==="object"){r.above=t.getName()}n.verb="reorder";n.names=i;n.attribs=r;v.push(n);this.setDirty()}};this.group=function(e,t){var n;if(e&&typeof e==="string"&&t){n=new zazzle.rlv.DesignGroup(this,e,t,true);l.push(n);this.setDirty()}return n};this.moveDesignSpace=function(e,t,n,r,i){var s={};var o={};var u=x(e);if(u){o.space="design";if(typeof t==="number"&&typeof n==="number"){o.x=t;o.y=n}if(typeof r==="number"&&typeof i==="number"){o.dx=r;o.dy=i}s.verb="move";s.names=u;s.attribs=o;v.push(s);this.setDirty()}};this.addPendingAction=function(e){v.push(e);this.setDirty()};this.moveObjectSpace=function(e,t,n,r,i){var s={};var o={};var u=x(e);if(u){o.space="object";if(typeof t==="number"&&typeof n==="number"){o.x=t;o.y=n}if(typeof r==="number"&&typeof i==="number"){o.dx=r;o.dy=i}s.verb="move";s.names=u;s.attribs=o;v.push(s);this.setDirty()}};this.scale=function(e,t,n,r){var i={};var s={};var o=x(e);if(o){if(o.indexOf(",")===-1){s.xscale=t;s.yscale=n}else{s.scale=t}s.abs=r?"true":"false";i.verb="scale";i.names=o;i.attribs=s;v.push(i);this.setDirty()}};this.transfer=function(e,t){var n={};var r={};var i=x(e);if(i){if(typeof t==="string"){r.area=t;n.verb="transfer";n.names=i;n.attribs=r;v.push(n);this.setDirty()}}};this.rotate=function(e,t,n){var r={};var i={};var s=x(e);if(s){i.angle=t;i.abs=n?"true":"false";r.verb="rotate";r.names=s;r.attribs=i;v.push(r);this.setDirty()}};this.layout=function(e,t,n,r){var i={};var s={};var o="";var u;var a;var f=x(e);if(f){if(t&&typeof t==="string"){if(n&&typeof n==="string"){o=n}else if(zazzle.util.isArray(n)){for(u=0;u<n.length;u++){a=n[u];if(a&&a instanceof zazzle.rlv.DesignProperty){if(o.length){o=o+"&"}o=o+a.name+"="+a.value}}}if(r){this.setProperty(e,"layout",t);this.setProperty(e,"layoutparams",o)}else{s.type=t;s.layoutparams=o;i.verb="layout";i.names=f;i.attribs=s;v.push(i);this.setDirty()}}}};this.setProperty=function(e,t,n){var r;var i;if(t&&n&&typeof t==="string"&&typeof n==="string"&&zazzle.util.isArray(e)){for(r=0;r<e.length;r++){i=e[r];if(i&&typeof i==="object"&&i.setProperty&&typeof i.setProperty==="function"){i.setProperty(t,n)}}}};this.setAttribute=function(e,t,n){var r;var i;if(t&&n&&typeof t==="string"&&typeof n==="string"&&zazzle.util.isArray(e)){for(r=0;r<e.length;r++){i=e[r];if(i&&typeof i==="object"&&i.setAttribute&&typeof i.setAttribute==="function"){i.setAttribute(t,n)}}}};this.cut=function(e){var t={};var n={};var r=x(e);if(r){t.verb="cut";t.names=r;t.attribs=n;v.push(t);this.design.forceReturnAllAreas();this.setDirty()}};this.remove=function(e){var t={};var n={};var r=x(e);if(r){t.verb="delete";t.names=r;t.attribs=n;v.push(t);this.design.forceReturnAllAreas();this.setDirty()}};this.copy=function(e){var t={};var n={};var r=x(e);if(r){t.verb="copy";t.names=r;t.attribs=n;v.push(t);this.setDirty()}};this.paste=function(){var e={};var t={};e.verb="paste";e.attribs=t;v.push(e);this.setDirty()};this.markDeleted=function(){p=true;this.setDirty()};this.canDelete=function(){return d};this.setDirty=function(){g=true;this.design.setDirty()};this.addImage=function(e,t,n){var r;if(e&&typeof e==="string"&&t&&typeof t==="string"){r=new zazzle.rlv.DesignImage(this,e,t,true);r.setAddAfterObject(n);l.push(r);this.setDirty()}return r};this.addText=function(e,t,n){var r;if(e&&typeof e==="string"&&t&&typeof t==="string"){r=new zazzle.rlv.DesignText(this,e,t,true);r.setAddAfterObject(n);l.push(r);this.setDirty()}return r};this.addEmbeddedDesign=function(e,t,n,r,i){var s;if(e&&typeof e==="string"&&t&&typeof t==="string"&&n&&typeof n==="string"){s=new zazzle.rlv.DesignEmbed(this,e,t,n,r,true);s.setAddAfterObject(i);l.push(s);this.setDirty()}return s};this.addPath=function(e,t,n){var r;if(e&&typeof e==="string"&&t&&t instanceof zazzle.rlv.DesignFill){r=new zazzle.rlv.DesignPath(this,e,t,true);r.setAddAfterObject(n);l.push(r);this.setDirty()}return r};this.isDefaultForView=function(e){var t=false;var n;if(e&&typeof e==="string"){for(n=0;n<S.length;n++){if(e===S[n]){t=true;break}}}return t};this.setAsDefaultForView=function(e){if(e&&typeof e==="string"){if(!this.isDefaultForView(e)){S.push(e)}}};this.buildServerRequest=function(){var e="";var t;var n;var r;var i;if(g){if(p){if(s){e=zazzle.util.xmlStartElement("delarea",{name:s},true)}p=false}else if(y){e=zazzle.util.xmlStartElement("chgarea",{from:s,to:b},true);y=false}else{t={};if(s){t.name=s}if(o){t.group=o}if(u){t.selector=u}e=zazzle.util.xmlStartElement("area",t,true);if(w&&a){t={};if(a.solid){t.type="solid"}if(a.fillcolor){t.fillcolor=a.fillcolor}if(a.strokecolor){t.strokecolor=a.strokecolor}if(a.strokewidth){t.strokewidth=a.strokewidth}e=e+zazzle.util.xmlStartElement("fill",t,true)}for(n=0;n<l.length;n++){r=l[n];e=e+r.buildServerRequest()}for(n=0;n<v.length;n++){i=v[n];if(i){if(i.names){e=e+zazzle.util.xmlStartElement("select",{name:i.names},true)}e=e+zazzle.util.xmlStartElement(i.verb,i.attribs,true)}}v=[]}g=false}return e};this.handleAreaIsNowEmpty=function(){l=[];c=0;h=false;v=[];m=[];a=null;y=false;g=false};this.handleServerResponse=function(e,t){var n;var r;var i;var s;var o;var u;var c;var h;var p;var d;var v;var y;var b;var w;var S;if(e&&typeof e==="object"){if(e.name){i=e.name}if(e.group){this.groupName=e.group}if(t){w=t.getViewArea(i);if(w){w.handleServerResponse(e)}}S=false;if(e.objects&&e.objects.length>0){S=true}if(E||S||e.changed){m=[];a=null;if(e.colors&&typeof e.colors==="string"){m=e.colors.split(",")}if(e.fill&&typeof e.fill==="object"){d=e.fill.fillcolor;v=e.fill.strokewidth;y=e.fill.strokecolor;if(d){b=true}else{b=false}a=new zazzle.rlv.DesignFill(b,d,y,v)}f=zazzle.rlv.convertToPropertyArray(e.properties);if(e.insideBleed&&zazzle.util.isArray(e.insideBleed)){this.insideBleed=e.insideBleed}else{this.insideBleed=[]}if(e.outsideSafe&&zazzle.util.isArray(e.outsideSafe)){this.outsideSafe=e.outsideSafe}else{this.outsideSafe=[]}l=[];if(e.objects){for(n=0;n<e.objects.length;n++){r=e.objects[n];if(r&&typeof r==="object"&&r.type){s=undefined;if(r.type==="image"){o=zazzle.rlv.lookupResponseProperty(r.properties,"imageid");if(!o){o=""}s=new zazzle.rlv.DesignImage(this,r.name,o,false)}else if(r.type==="text"){u=zazzle.rlv.lookupResponseProperty(r.properties,"value");if(!u){u=""}s=new zazzle.rlv.DesignText(this,r.name,u,false)}else if(r.type==="embed"){c=zazzle.rlv.lookupResponseProperty(r.properties,"productid");h=zazzle.rlv.lookupResponseProperty(r.properties,"designid");s=new zazzle.rlv.DesignEmbed(this,r.name,h,c,undefined,false)}else if(r.type==="path"){d=zazzle.rlv.lookupResponseProperty(r.properties,"fillcolor");v=zazzle.rlv.lookupResponseProperty(r.properties,"strokewidth");y=zazzle.rlv.lookupResponseProperty(r.properties,"strokecolor");if(d){b=true}else{b=false}p=new zazzle.rlv.DesignFill(b,d,y,v);s=new zazzle.rlv.DesignPath(this,r.name,p,false)}else if(r.type==="group"){s=new zazzle.rlv.DesignGroup(this,r.name,[],false)}if(s){l.push(s);s.handleServerResponse(r)}}}}}E=false}g=false}};zazzle.rlv.DesignViewArea=function(t,n){if(!(this instanceof zazzle.rlv.DesignViewArea)){return new zazzle.rlv.DesignViewArea(t,n)}var r=[];var i=[];var s=[1,0,0,1,0,0];var o=[1,0,0,1,0,0];var u=false;this.view=t;this.design=t.getZDesign();this.area=n;var a=function(e){var t;var n;var r=[];var i;var s;if(zazzle.util.isArray(e)){for(n=0;n<e.length;n++){i=e[n];if(i&&typeof i==="object"&&i.getName&&typeof i.getName==="function"){s=i.getName();r.push(s)}}if(r.length>0){t=r.join(",")}}return t};this.getName=function(){var e="unknown";if(this.area){e=this.area.getName()}return e};this.getOutline=function(){return r};this.getGrid=function(){return i};this.getDesignToGridMatrix=function(){return s};this.getgridtodesignmatrix=function(){return o};this.canMapScreenToDesign=function(){var e=false;if(i&&i.length>0){e=true}return e};this.isVisible=function(){return u};this.moveScreenSpace=function(e,t,n,r,i){var s=a(e);var o={};var u={};var f;var l;var c;var h;this.design.setActiveView(this.view);if(this.canMapScreenToDesign()){f=new zazzle.rlv.Point(t,n);l=new zazzle.rlv.Point(t+r,n+i);c=this.screenSpaceToDesignSpace(f);h=this.screenSpaceToDesignSpace(l);u.space="design";u.x=c.x;u.y=c.y;u.dx=h.x-c.x;u.dy=h.y-c.y}else{u.space="screen";u.x=t;u.y=n;u.dx=r;u.dy=i}o.verb="move";o.names=s;o.attribs=u;this.area.addPendingAction(o);return this};this.screenSpaceToDesignSpace=function(e){var t=new zazzle.rlv.Point(0,0);var n=512;var r=this.view.getOpts();var s;var u;var a;var f;var l;var c;var h;var p;var d;var v=Number.MAX_VALUE;var m;var g=-1;this.design.setActiveView(this.view);if(e instanceof zazzle.rlv.Point&&i){if(r&&r.max_dim&&typeof r.max_dim==="number"){n=r.max_dim}s=e.x/n;u=e.y/n;for(m=0;m<i.length;m=m+12){h=s-i[m];p=u-i[m+1];d=h*h+p*p;if(d<v){v=d;g=m}}if(g>=0){h=s-i[g];p=u-i[g+1];a=i[g+2];f=i[g+3];a+=i[g+4]*h;f+=i[g+5]*h;a+=i[g+6]*p;f+=i[g+7]*p;l=o[0]*a;l=l+o[2]*f;l=l+o[4];c=o[1]*a;c=c+o[3]*f;c=c+o[5];t.x=l;t.y=c}}return t};this.designSpaceToScreenSpace=function(e){var t=new zazzle.rlv.Point(0,0);var n=512;var r=this.view.getOpts();var o;var u;var a;var f;var l;var c;var h;var p;var d;var v=Number.MAX_VALUE;var m;var g=-1;this.design.setActiveView(this.view);if(e instanceof zazzle.rlv.Point&&i){if(r&&r.max_dim&&typeof r.max_dim==="number"){n=r.max_dim}l=e.x;c=e.y;a=s[0]*l;a=a+s[2]*c;a=a+s[4];f=s[1]*l;f=f+s[3]*c;f=f+s[5];for(m=0;m<i.length;m=m+12){h=a-i[m+2];p=f-i[m+3];d=h*h+p*p;if(d<v){v=d;g=m}}if(g>=0){h=a-i[g+2];p=f-i[g+3];o=i[g];u=i[g+1];o+=i[g+8]*h;u+=i[g+9]*h;o+=i[g+10]*p;u+=i[g+11]*p;t.x=o*n;t.y=u*n}}return t};this.handleServerResponse=function(e){var n;if(e&&typeof e==="object"){n=zazzle.rlv.convertToPointArray(e.outline);if(n.length>0){r=n}if(e.grid){i=e.grid;t.setNeedsGridRefresh(false)}if(e.designtogridmatrix){if(zazzle.util.isArray(e.designtogridmatrix)){s=e.designtogridmatrix;o=zazzle.util.matrixInverse(s)}}if(e.visible){u=true}else{u=false}}}};zazzle.rlv.DesignImage=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignImage)){return new zazzle.rlv.DesignImage(t,n,r,i)}this.designArea=t;this.name=n;this.imageid=r;this.title=r;this.addToArea=i;this.dirty=false;this.children=[];this.properties=[];this.attributes=[];this.template={};this.removeTheTemplate=false;this.bounds=[];this.outline=[];this.matrix=[];this.contentOutline=[];this.colors=[];this.pendingActions=[];this.addAfterName=undefined;this.urlkey=undefined;this.getImageid=function(){return this.imageid};this.setImageid=function(e){if(e&&typeof e==="string"){if(e!==this.imageid){this.imageid=e;if(!this.addToArea){this.setProperty("imageid",e)}}}return this};this.getTitle=function(){return this.title};this.buildServerRequest=function(){var e="";if(this.addToArea){if(this.addAfterName){e=zazzle.util.xmlStartElement("select",{name:this.addAfterName},true);this.addAfterName=undefined}e=e+zazzle.util.xmlStartElement("image",{name:this.name,imageid:this.imageid},true)}if(this.dirty){if(!this.addToArea){e=zazzle.util.xmlStartElement("select",{name:this.name},true)}e=e+this.buildSubRequest()}this.addToArea=false;this.dirty=false;return e};this.handleServerResponseSpecialized=function(e){this.imageid=this.getProperty("imageid");this.title=this.getProperty("title")}};zazzle.rlv.DesignText=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignText)){return new zazzle.rlv.DesignText(t,n,r,i)}this.designArea=t;this.name=n;this.text=r;this.addToArea=i;this.align="center";this.paragraphAlign="center";this.arcRadius=undefined;this.path=undefined;this.scaleMode=undefined;this.wrap=true;this.clip=true;this.styleRuns=[];this.dirty=false;this.children=[];this.properties=[];this.attributes=[];this.template={};this.removeTheTemplate=false;this.bounds=[];this.outline=[];this.matrix=[];this.contentOutline=[];this.color=undefined;this.pendingActions=[];this.addAfterName=undefined;this.urlkey=undefined;this.colors=[];this.setAlign=function(e){var t="center";if(e===zazzle.rlv.DesignTextAlign.LEADING){t="leading"}else if(e===zazzle.rlv.DesignTextAlign.TRAILING){t="trailing"}if(this.align!==t){this.align=t;if(!this.addToArea){this.setProperty("align",t)}this.setDirty()}return this};this.getAlign=function(){var e=zazzle.rlv.DesignTextAlign.CENTER;if(this.align==="leading"){e=zazzle.rlv.DesignTextAlign.LEADING}else if(this.align==="trailing"){e=zazzle.rlv.DesignTextAlign.TRAILING}return e};this.setParagraphAlign=function(e){var t="center";if(e===zazzle.rlv.DesignTextParagraphAlign.NEAR){t="near"}else if(e===zazzle.rlv.DesignTextParagraphAlign.FAR){t="far"}if(this.paragraphAlign!==t){this.paragraphAlign=t;if(!this.addToArea){this.setProperty("palign",t)}this.setDirty()}return this};this.getParagraphAlign=function(){var e=zazzle.rlv.DesignTextParagraphAlign.CENTER;if(this.paragraphAlign==="near"){e=zazzle.rlv.DesignTextParagraphAlign.NEAR}else if(this.paragraphAlign==="far"){e=zazzle.rlv.DesignTextParagraphAlign.FAR}return e};this.setArc=function(e){if(e&&typeof e==="number"){if(e!==this.arcRadius){this.arcRadius=e;if(!this.addToArea){this.setProperty("arcradius",e.toString())}this.setDirty()}}return this};this.getArc=function(){return this.arcRadius};this.setPath=function(e){var t;if(e===zazzle.rlv.DesignTextPath.HORZ){t="horz"}else if(e===zazzle.rlv.DesignTextPath.VERT){t="vert"}else if(e===zazzle.rlv.DesignTextPath.ARC){t="arc"}else if(e===zazzle.rlv.DesignTextPath.RARC){t="rarc"}if(t&&t!==this.path){this.path=t;if(!this.addToArea){this.setProperty("path",t)}this.setDirty()}return this};this.getPath=function(){var e=zazzle.rlv.DesignTextPath.HORZ;if(this.path==="vert"){e=zazzle.rlv.DesignTextPath.VERT}else if(this.path==="arc"){e=zazzle.rlv.DesignTextPath.ARC}else if(this.path==="rarc"){e=zazzle.rlv.DesignTextPath.RARC}return e};this.setScaleMode=function(e){var t="fit";if(e===zazzle.rlv.DesignTextScaleMode.NONE){t="none"}else if(e===zazzle.rlv.DesignTextScaleMode.USER){t="user"}if(t!==this.scaleMode){this.scaleMode=t;if(!this.addToArea){this.setProperty("scalemode",t)}this.setDirty()}return this};this.getScaleMode=function(){var e=zazzle.rlv.DesignTextScaleMode.FIT;if(this.scaleMode==="none"){e=zazzle.rlv.DesignTextScaleMode.NONE}else if(this.scaleMode==="user"){e=zazzle.rlv.DesignTextScaleMode.USER}return e};this.setWrap=function(e){if(typeof e==="boolean"){if(e!==this.wrap){this.wrap=e;if(!this.addToArea){this.setProperty("wrap",e?"true":"false")}this.setDirty()}return this}};this.getWrap=function(){return this.wrap};this.setClip=function(e){if(typeof e==="boolean"){if(e!==this.clip){this.clip=e;if(!this.addToArea){this.setProperty("clip",e?"true":"false")}this.setDirty()}return this}};this.getClip=function(){return this.clip};this.getValue=function(){return this.text};this.setValue=function(e){if(e&&typeof e==="string"){if(e!==this.text){this.text=e;if(!this.addToArea){this.setProperty("value",e)}this.setDirty()}}return this};this.addStyleRun=function(e,t,n){var r;if(e&&e instanceof zazzle.rlv.DesignFont){r={};if(e.face){r.face=e.face}if(e.style){r.style=e.style}if(e.height){r.height=e.height}if(e.weight){r.weight=e.weight}if(e.color){r.color=e.color}if(e.minheight){r.minheight=e.minheight}if(e.maxheight){r.maxheight=e.maxheight}if(t&&typeof t==="number"){r.start=t}if(n&&typeof n==="number"){r.end=n}this.styleRuns.push(r);this.setDirty()}return this};this.clearStyleRuns=function(){this.styleRuns=[];this.setDirty();return this};this.buildServerRequest=function(){var e="";var t;var n;var r={};if(this.addToArea){if(this.addAfterName){e=zazzle.util.xmlStartElement("select",{name:this.addAfterName},true);this.addAfterName=undefined}r.name=this.name;r.align=this.align;if(this.path){r.path=this.path}if(this.arcRadius){r.arc=this.arcRadius}if(this.paragraphAlign){r.palign=this.paragraphAlign}r.wrap=this.wrap?"true":"false";r.clip=this.clip?"true":"false";if(this.scaleMode){r.scalemode=this.scaleMode}e=e+zazzle.util.xmlStartElement("text",r,false);if(this.text){e=e+zazzle.util.xmlStartElement("value");e=e+zazzle.util.xmlSafe(this.text);e=e+zazzle.util.xmlEndElement("value")}if(this.styleRuns.length>0){for(t=0;t<this.styleRuns.length;t++){n=this.styleRuns[t];e=e+zazzle.util.xmlStartElement("font",n,true)}}e=e+zazzle.util.xmlEndElement("text")}if(this.dirty){if(!this.addToArea){e=zazzle.util.xmlStartElement("select",{name:this.name},true)}e=e+this.buildSubRequest()}this.addToArea=false;this.dirty=false;return e};this.handleServerResponseSpecialized=function(e){var t;var n;var r;var i;if(zazzle.util.isArray(e.styles)){this.styleRuns=[];for(t=0;t<e.styles.length;t++){n=e.styles[t];r={};if(n.face){r.face=n.face}if(n.style){r.style=n.style}if(n.color){r.color=n.color}if(n.weight){r.weight=n.weight}if(n.height){r.height=n.height}if(n.minheight){r.minheight=n.minheight}if(n.maxheight){r.maxheight=n.maxheight}if(n.start){r.start=n.start}if(n.end){r.end=n.end}this.styleRuns.push(r)}}i=this.getProperty("align");if(i){this.align=i}i=this.getProperty("path");if(i){this.path=i}i=this.getProperty("palign");if(i){this.paragraphAlign=i}i=this.getProperty("scalemode");if(i){this.scalemode=i}i=this.getProperty("arcradius");if(i){this.arcRadius=i}i=this.getProperty("wrap");if(typeof i==="boolean"){this.wrap=i}i=this.getProperty("clip");if(typeof i==="boolean"){this.clip=i}i=this.getProperty("value");if(i){this.text=i}}};zazzle.rlv.DesignGroup=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignGroup)){return new zazzle.rlv.DesignGroup(t,n,r,i)}this.designArea=t;this.name=n;this.addToArea=i;this.objnames=[];this.markDeleted=false;this.okToDelete=false;this.dirty=false;this.children=[];this.properties=[];this.attributes=[];this.template={};this.removeTheTemplate=false;this.bounds=[];this.outline=[];this.matrix=[];this.contentOutline=[];this.color=undefined;this.pendingActions=[];this.addAfterName=undefined;this.urlkey=undefined;var s;var o;var u;if(r){for(s=0;s<r.length;s++){o=r[s];if(o&&o.getName&&typeof o.getName==="function"){u=o.getName();if(u&&typeof u==="string"){this.objnames.push(u)}}}}this.canDelete=function(){return this.okToDelete};this.ungroup=function(){this.markDeleted=true;this.setDirty()};this.buildServerRequest=function(){var e="";var t;if(this.addToArea){if(this.objnames.length>0){t=this.objnames.join(",");e=e+zazzle.util.xmlStartElement("select",{name:t},true);e=e+zazzle.util.xmlStartElement("group",{name:this.name},true)}}if(this.dirty){if(!this.addToArea){e=zazzle.util.xmlStartElement("select",{name:this.name},true);if(this.markDeleted){e=e+zazzle.util.xmlStartElement("ungroup",{},true)}}if(!this.markDeleted){e=e+this.buildSubRequest()}}this.addToArea=false;this.dirty=false;return e};this.handleServerResponseSpecialized=function(e){var t;var n;var r;var i;var s;var o;var u;var a;var f;var l;var c;var h;if(e.objects){for(t=0;t<e.objects.length;t++){n=e.objects[t];if(n&&typeof n==="object"&&n.type){r=undefined;if(n.type==="image"){i=zazzle.rlv.lookupResponseProperty(n.properties,"imageid");if(!i){i=""}r=new zazzle.rlv.DesignImage(this.designArea,n.name,i,false)}else if(n.type==="text"){s=zazzle.rlv.lookupResponseProperty(n.properties,"value");if(!s){s=""}r=new zazzle.rlv.DesignText(this.designArea,n.name,s,false)}else if(n.type==="embed"){o=zazzle.rlv.lookupResponseProperty(n.properties,"productid");u=zazzle.rlv.lookupResponseProperty(n.properties,"designid");r=new zazzle.rlv.DesignEmbed(this.designArea,n.name,u,o,undefined,false)}else if(n.type==="path"){a=zazzle.rlv.lookupResponseProperty(n.properties,"fillcolor");f=zazzle.rlv.lookupResponseProperty(n.properties,"strokewidth");l=zazzle.rlv.lookupResponseProperty(n.properties,"strokecolor");if(a){h=true}else{h=false}c=new zazzle.rlv.DesignFill(h,a,l,f);r=new zazzle.rlv.DesignPath(this.designArea,n.name,c,false)}else if(n.type==="group"){r=new zazzle.rlv.DesignGroup(this.designArea,n.name,[],false)}if(r){this.children.push(r);r.handleServerResponse(n)}}}}}};zazzle.rlv.DesignEmbed=function(t,n,r,i,s,o){if(!(this instanceof zazzle.rlv.DesignEmbed)){return new zazzle.rlv.DesignEmbed(t,n,r,i,s,o)}this.designArea=t;this.name=n;this.embedId=r;this.embedProductId=i;this.embedArea=s;this.addToArea=o;this.params=[];this.dirty=false;this.children=[];this.properties=[];this.attributes=[];this.template={};this.removeTheTemplate=false;this.bounds=[];this.outline=[];this.matrix=[];this.contentOutline=[];this.color=undefined;this.pendingActions=[];this.addAfterName=undefined;this.urlkey=undefined;this.setParam=function(e,t){this.setPropertyHelper(this.params,e,t);this.setDirty();return this};this.buildServerRequest=function(){var e="";var t;var n={};var r;var i;var s;var o=/%20/g;var u=[];if(this.addToArea){if(this.addAfterName){e=zazzle.util.xmlStartElement("select",{name:this.addAfterName},true);this.addAfterName=undefined}n.name=this.name;n.designid=this.embedId;n.productid=this.embedProductId;if(this.embedArea){n.area=this.embedArea}if(this.params.length>0){for(t=0;t<this.params.length;t++){r=this.params[t].name;i=this.params[t].value;s=encodeURIComponent(r).replace(o,"+")+"="+encodeURIComponent(i).replace(o,"+");u.push(s)}n.params=u.join("&")}e=e+zazzle.util.xmlStartElement("embed",n,true)}if(this.dirty){if(!this.addToArea){e=zazzle.util.xmlStartElement("select",{name:this.name},true)}e=e+this.buildSubRequest()}this.addToArea=false;this.dirty=false;return e};this.handleServerResponseSpecialized=function(e){this.embedId=this.getProperty("designid");this.embedProductId=this.getProperty("productid");this.embedArea=this.getProperty("designarea")}};zazzle.rlv.DesignPath=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignPath)){return new zazzle.rlv.DesignPath(t,n,r,i)}this.designArea=t;this.name=n;this.fill=r;this.addToArea=i;this.segment="";this.dirty=false;this.children=[];this.properties=[];this.attributes=[];this.template={};this.removeTheTemplate=false;this.bounds=[];this.outline=[];this.matrix=[];this.contentOutline=[];this.color=undefined;this.pendingActions=[];this.addAfterName=undefined;this.urlkey=undefined;this.setSegment=function(e){if(e&&typeof e==="string"){this.segment=e;this.setDirty()}return this};this.getSegment=function(){return this.segment};this.setFill=function(e){if(e&&e instanceof zazzle.rlv.DesignFill){this.fill=e;this.setDirty()}return this};this.getFill=function(){return this.fill};this.buildServerRequest=function(){var e="";var t;if(this.addToArea){if(this.addAfterName){e=zazzle.util.xmlStartElement("select",{name:this.addAfterName},true);this.addAfterName=undefined}e=e+zazzle.util.xmlStartElement("path",{name:this.name},false);if(this.segment){e=e+zazzle.util.xmlStartElement("segment");e=e+zazzle.util.xmlSafe(this.segment);e=e+zazzle.util.xmlEndElement("segment")}if(this.fill){t={};if(this.fill.solid){t.type="solid"}if(this.fill.fillcolor){t.fillcolor=r.fillcolor}if(this.fill.strokecolor){t.strokecolor=r.strokecolor}if(this.fill.strokewidth){t.strokewidth=r.strokewidth}e=e+zazzle.util.xmlStartElement("fill",t,true)}e=e+zazzle.util.xmlEndElement("path")}if(this.dirty){if(!this.addToArea){e=zazzle.util.xmlStartElement("select",{name:this.name},true)}e=e+this.buildSubRequest()}this.addToArea=false;this.dirty=false;return e};this.handleServerResponseSpecialized=function(e){var t;var n;var r;var i;var s;var o;o=this.getProperty("segments");if(o){this.segment=o}t=this.getProperty("filltype");n=t==="solid";r=this.getProperty("fillcolor");i=this.getProperty("strokecolor");s=this.getProperty("strokewidth");this.fill=new zazzle.rlv.DesignFill(n,r,i,s)}};(function(){var e=function(e){function t(e,t){var n;var r;var i;for(r=0;r<e.length;r++){i=e[r];if(i&&i instanceof zazzle.rlv.DesignProperty){if(i.name===t){n=i.value;break}}}return n}function n(e,t,n){var r;var i;var s=false;for(r=0;r<e.length;r++){i=e[r];if(i&&i instanceof zazzle.rlv.DesignProperty){if(i.name===t){s=true;break}}}if(s){i.value=n;i.changed=true}else{i=new zazzle.rlv.DesignProperty(t,n);i.changed=true;e.push(i)}}function r(){var e={};var t;var n;for(t=0;t<this.properties.length;t++){n=this.properties[t];if(n&&n instanceof zazzle.rlv.DesignProperty){e[n.name]=n.value}}return e}function i(e){return t(this.properties,e)}function s(e,t){n(this.properties,e,t);this.setDirty();return this}function o(e,t){n(this.attributes,e,t);this.setDirty();return this}function u(){return this.children}function a(e,t,n){this.template={};if(e&&typeof e==="string"){this.template.urlkey=e}if(t&&typeof t==="string"){this.template.title=t}if(typeof n==="boolean"){this.template.ppshow=n}this.setDirty();return this}function f(){this.removeTheTemplate=true;this.template={};this.setDirty();return this}function l(){return this.name}function c(){return this.matrix}function h(){var e=0;var t;var n;var r;var i;var s;if(this.matrix&&this.matrix.length===6){n=this.matrix[0];i=this.matrix[1];s=Math.sqrt(n*n+i*i);if(s>1e-4){r=n/s;t=Math.acos(r);if(i>0){t=Math.PI*2-t}e=360*(t/(Math.PI*2));if(e>359.5){e=0}}}return e}function p(e){var t=null;var n="unknown";if(e&&e instanceof zazzle.rlv.DesignView){if(this.designArea){n=this.designArea.getName();t=e.getViewArea(n)}}return t}function d(e){var t=this.bounds;var n;var r;var i;var s;var o;var u;o=this.getViewAreaForView(e);if(this.bounds&&this.bounds.length>=2&&o&&o.canMapScreenToDesign()){t=[];u=[];n=new zazzle.rlv.Point(this.bounds[0].x,this.bounds[0].y);u.push(n);n=new zazzle.rlv.Point(this.bounds[1].x,this.bounds[0].y);u.push(n);n=new zazzle.rlv.Point(this.bounds[1].x,this.bounds[1].y);u.push(n);n=new zazzle.rlv.Point(this.bounds[0].x,this.bounds[1].y);u.push(n);r=new zazzle.rlv.Point(Number.MAX_VALUE,Number.MAX_VALUE);i=new zazzle.rlv.Point(-Number.MAX_VALUE,-Number.MAX_VALUE);for(s=0;s<u.length;s++){n=o.designSpaceToScreenSpace(u[s]);r.x=Math.min(r.x,n.x);r.y=Math.min(r.y,n.y);i.x=Math.max(i.x,n.x);i.y=Math.max(i.y,n.y)}t.push(r);t.push(i)}return t}function v(e){var t=this.outline;var n;var r;var i;i=this.getViewAreaForView(e);if(this.outline&&i&&i.canMapScreenToDesign()){t=[];for(r=0;r<this.outline.length;r++){n=i.designSpaceToScreenSpace(this.outline[r]);t.push(n)}}return t}function m(e){var t=this.contentOutline;var n;var r;var i;i=this.getViewAreaForView(e);if(this.contentOutline&&i&&i.canMapScreenToDesign()){t=[];for(r=0;r<this.contentOutline.length;r++){n=i.designSpaceToScreenSpace(this.contentOutline[r]);t.push(n)}}return t}function g(){return this.colors}function y(){var e=false;var t=this.getProperty("locked");if(t&&t==="true"){e=true}return e}function b(e,t,n,r,i){var s={};var o={};var u;var a;var f;var l;var c;c=this.getViewAreaForView(e);if(c&&c.canMapScreenToDesign()){u=new zazzle.rlv.Point(t,n);a=new zazzle.rlv.Point(t+r,n+i);f=c.screenSpaceToDesignSpace(u);l=c.screenSpaceToDesignSpace(a);o.space="design";o.x=f.x;o.y=f.y;o.dx=l.x-f.x;o.dy=l.y-f.y}else{o.space="screen";o.x=t;o.y=n;o.dx=r;o.dy=i}s.verb="move";s.attribs=o;this.pendingActions.push(s);this.setDirty();return this}function w(e,t,n,r){var i={};var s={};s.space="design";if(typeof e==="number"&&typeof t==="number"){s.x=e;s.y=t}if(typeof n==="number"&&typeof r==="number"){s.dx=n;s.dy=r}i.verb="move";i.attribs=s;this.pendingActions.push(i);this.setDirty();return this}function E(e,t,n,r){var i={};var s={};s.space="object";if(typeof e==="number"&&typeof t==="number"){s.x=e;s.y=t}if(typeof n==="number"&&typeof r==="number"){s.dx=n;s.dy=r}i.verb="move";i.attribs=s;this.pendingActions.push(i);this.setDirty();return this}function S(e,t,n){var r={};var i={};i.xscale=e;i.yscale=t;i.abs=n?"true":"false";r.verb="scale";r.attribs=i;this.pendingActions.push(r);this.setDirty();return this}function x(e,t){var n={};var r={};r.angle=e;r.abs=t?"true":"false";n.verb="rotate";n.attribs=r;this.pendingActions.push(n);this.setDirty();return this}function T(){this.dirty=true;this.designArea.setDirty()}function N(){var e="";var t;var n;var r;var i={};var s;var o;var u;var a;var f;s=false;o=false;i={};u=/[\t\n\v\f\r]/;for(t=0;t<this.properties.length;t++){n=this.properties[t];if(n&&n instanceof zazzle.rlv.DesignProperty){if(n.changed){i[n.name]=n.value;if(typeof n.value==="string"&&n.value.search(u)!==-1){o=true}s=true;n.changed=false}}}if(s){if(o){e=e+zazzle.util.xmlStartElement("set",{},false);for(a in i){if(i.hasOwnProperty(a)){f=i[a];e=e+zazzle.util.xmlStartElement(a,{},false);e=e+zazzle.util.xmlSafe(f,false);e=e+zazzle.util.xmlEndElement(a)}}e=e+zazzle.util.xmlEndElement("set")}else{e=e+zazzle.util.xmlStartElement("set",i,true)}}s=false;i={};for(t=0;t<this.attributes.length;t++){n=this.attributes[t];if(n&&n instanceof zazzle.rlv.DesignProperty){if(n.changed){i[n.name]=n.value;s=true;n.changed=false}}}if(s){e=e+zazzle.util.xmlStartElement("setattr",i,true)}if(this.removeTheTemplate){e=e+zazzle.util.xmlStartElement("template",{},true);this.removeTheTemplate=false}if(this.template.urlkey){e=e+zazzle.util.xmlStartElement("template",this.template,true);this.template={}}if(this.pendingActions.length>0){for(t=0;t<this.pendingActions.length;t++){r=this.pendingActions[t];e=e+zazzle.util.xmlStartElement(r.verb,r.attribs,true)}this.pendingActions=[]}return e}function C(e){var t;if(e&&typeof e==="object"){if(e.name){this.name=e.name}t=zazzle.rlv.convertToPointArray(e.bounds);if(t.length>0){this.bounds=t}t=zazzle.rlv.convertToPointArray(e.outline);if(t.length>0){this.outline=t}t=zazzle.rlv.convertToPointArray(e.contentoutline);if(t.length>0){this.contentOutline=t}this.properties=zazzle.rlv.convertToPropertyArray(e.properties);if(e.matrix){this.matrix=e.matrix}if(e.urlkey){this.urlkey=e.urlkey}if(e.colors&&typeof e.colors==="string"){this.colors=e.colors.split(",")}this.handleServerResponseSpecialized(e);this.dirty=false}}function k(e){if(e&&e instanceof zazzle.rlv.DesignObject){this.addAfterName=e.getName()}}function L(){return this.urlkey}e.setPropertyHelper=n;e.getProperties=r;e.getProperty=i;e.setProperty=s;e.setAttribute=o;e.getChildObjects=u;e.setTemplate=a;e.removeTemplate=f;e.getName=l;e.getMatrix=c;e.getRotationAngle=h;e.getViewAreaForView=p;e.getBounds=d;e.getOutline=v;e.getContentOutline=m;e.getColors=g;e.isLocked=y;e.moveScreenSpace=b;e.moveDesignSpace=w;e.moveObjectSpace=E;e.scale=S;e.rotate=x;e.setDirty=T;e.buildSubRequest=N;e.handleServerResponse=C;e.setAddAfterObject=k;e.getUrlKey=L};e(zazzle.rlv.DesignImage.prototype);e(zazzle.rlv.DesignText.prototype);e(zazzle.rlv.DesignGroup.prototype);e(zazzle.rlv.DesignEmbed.prototype);e(zazzle.rlv.DesignPath.prototype)})();(function(){zazzle.rlv.DesignEvent=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignEvent)){return new zazzle.rlv.DesignEvent(t,n,r,i)}this.type=t;this.success=n;this.design=r;this.view=i};zazzle.rlv.DesignListener=function(t){if(!(this instanceof zazzle.rlv.DesignListener)){return new zazzle.rlv.DesignListener(t)}this.getSequenceId=function(){return t}}})();zazzle.rlv.DesignViewAnnotation=function(t){if(!(this instanceof zazzle.rlv.DesignViewAnnotation)){return new zazzle.rlv.DesignViewArea(t)}var n=[];var r="";this.view=t;this.design=t.getZDesign();this.isValid=function(){var e=false;if(r.length>0&&n.length===12){e=true}return e};this.getIdent=function(){return r};this.getBounds=function(){var e;var t;var r;var i;var s=new zazzle.rlv.Point(0,0);var o=new zazzle.rlv.Point(0,0);var u=this.view.opts.max_dim;if(typeof u!=="number"){u=512}if(n.length===12){e=n[0];t=n[1];r=n[8];i=n[9];s.x=(e-r/2)*u;s.y=(t-i/2)*u;o.x=(e+r/2)*u;o.y=(t+i/2)*u}var a=[s,o];return a};this.handleServerResponse=function(e){var t;if(e&&typeof e==="object"){t=zazzle.rlv.convertToPointArray(e.grid);if(t.length>0){n=t}if(e.annotation&&typeof e.annotation==="string"){r=e.annotation}}}};zazzle.rlv.DesignConstraint=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignConstraint)){return new zazzle.rlv.DesignConstraint(t,n,r,i)}this.area="";if(t&&typeof t==="string"){this.area=t}this.level="";if(n&&typeof n==="string"){this.level=n}this.objects="";if(r&&typeof r==="string"){this.objects=r}this.type="";if(i&&typeof i==="string"){this.type=i}};zazzle.rlv.DesignTemplate=function(t){if(!(this instanceof zazzle.rlv.DesignTemplate)){return new zazzle.rlv.DesignTemplate(t)}this.type=0;this.value="";this.ppshow=false;this.title="";this.urlkey="";for(var n in t){var r=t[n];var i=this[n];if(i!==undefined&&typeof r!==typeof i){continue}this[n]=r}};zazzle.rlv.DesignProperty=function(t,n){if(!(this instanceof zazzle.rlv.DesignProperty)){return new zazzle.rlv.DesignProperty(t,n)}this.name=t;this.value=n;this.changed=false};zazzle.rlv.DesignFill=function(t,n,r,i){if(!(this instanceof zazzle.rlv.DesignFill)){return new zazzle.rlv.DesignFill(t,n,r,i)}if(typeof t==="boolean"){this.solid=t}if(n&&typeof n==="string"){this.fillcolor=n}if(r&&typeof r==="string"){this.strokecolor=r}if(i&&typeof i==="number"){this.strokewidth=i}};zazzle.rlv.DesignFont=function(t,n,r,i,s,o,u){if(!(this instanceof zazzle.rlv.DesignFont)){return new zazzle.rlv.DesignFont(t,n,r,i,s,o,u)}this.face=t;this.style=n;this.height=r;this.weight=i;this.color=s;this.minheight=o;this.maxheight=u};zazzle.rlv.Point=function(t,n){if(!(this instanceof zazzle.rlv.Point)){return new zazzle.rlv.Point(t,n)}this.x=t;this.y=n};zazzle.rlv.convertToPointArray=function(e){var t=[];var n;var r;if(zazzle.util.isArray(e)){for(r=0;r<e.length;r=r+2){n=new zazzle.rlv.Point(e[r],e[r+1]);t.push(n)}}return t};zazzle.rlv.convertToPropertyArray=function(e){var t=[];var n;var r;var i;var s;var o;if(zazzle.util.isArray(e)){for(o=0;o<e.length;o++){n=e[o];if(n&&typeof n==="object"){r=n.name;i=n.value;if(r&&i&&typeof r==="string"){s=new zazzle.rlv.DesignProperty(r,i);t.push(s)}}}}return t};zazzle.rlv.lookupResponseProperty=function(e,t){var n;var r;var i;if(zazzle.util.isArray(e)&&t&&typeof t==="string"){for(n=0;n<e.length;n++){r=e[n];if(r&&typeof r==="object"&&t===r.name){i=r.value;break}}}return i};if(typeof zazzle.product==="undefined")zazzle.product={};zazzle.product.Realviews=function(t){function o(e){if(e&&typeof e==="object"){s.ready=true;if(e.success&&e.data){s.success=true;s.realviews=e.data.realviews;s.contexts=e.data.contexts;r&&r(s)}else{s.errorMessage=errmsg||"UNKNOWN";i&&i(s)}}}function u(e,t){s.ready=true;s.err=e;s.errorMessage=t||"UNKNOWN";i&&i(s)}if(!(this instanceof zazzle.product.Realviews))return new zazzle.product.Realviews(t);this.opts=t;this.ready=false;this.success=false;var n="/svc/product/realviews/get?output=js";var r;var i;var s=this;if(t&&typeof t==="object"){r=t.onsuccess;i=t.onerror;for(var a in{pt:1,pd:1,dz:1,att:1,ppd:1,patt:1}){var f=t[a];if(f)n=n+"&"+a+"="+escape(f)}zazzle.ajax.post(n,"",o,u,this)}}}});Uize.module({name:"ZazzleWww.DesignUi",superclass:"Zazzle.Widget",required:["Uize.Comm","Uize.Widget.Collection.Dynamic","ZazzleWww.DesignObjectUi","Uize.Widget.Button","Uize.Widget.PopupPalette","Uize.Template","Uize.Data","Zazzle.Picker.Color","Zazzle.Checkbox","Zazzle.Droplist","Zazzle.Menu","Uize.Url","Zazzle.Picker.Font","ZazzleWww.ControlPopupPalette","ZazzleWww.TemplateDesigner","ZazzleWww.ControlPoptions","Uize.Widget.Bar.Slider.Plus","Uize.Util.PropertyAdapter","Uize.Xml","Uize.Widget.DirectionalPad","Uize.Widget.FormElement","Uize.Widget.FormElement.Text","Zazzle.DesignModel","Zazzle.Droplist.ComboBox","Uize.Widget.mChildBindings"],builder:function(e){"use strict";var t=true,n=false,r=null,i,s=Uize,o=s.Widget.Button,u=Zazzle,a=ZazzleWww,f=zazzle.rlv;var l=e.subclass(function(){this.e_j=[]},function(){var e=this,l,c=e.children,h={e_n:1,e_o:"always"},p={e_n:1,e_o:"exist"},d={e_n:1,e_o:"selected-unlocked"},v={e_n:1,e_o:"multi-selected-unlocked"},m={image:1,ztimage:1,e_o:"selected-unlocked"},g={text:1,image:1,ztimage:1,combined:1,e_o:"selected-unlocked"},y={image:1,ztimage:1,combined:1,e_o:"selected-unlocked"},b={text:1,e_o:"selected-unlocked"},w={text:1,combined:1,image:1,ztimage:1,e_o:"always"},E=e.e_y==="stitch",S=e.e_j,x=function(t,n,r,u,a){var f=n==o?e.e_F(t,r):e.addChild(t,n,r);(e.e_G||(e.e_G=[])).push(s.copyInto({e_A:t},u));if(a!==i){a.e_H=f;S.push(a)}else if(t==="move"){var l=f.get("buttonDictionary"),c;for(c in l)S.push({e_H:f,e_K:c})}return f},T=function(){if(!e.e_M&&!e.e_N){var t=e.children.template,n=t.get("isTemplate");if(!t.get("hasMultiple")||n){e.e_Q("T",s.copyInto({name:"Set Template",isTemplate:n},n?{urlkey:t.get("urlKey"),title:t.get("title"),ppshow:t.get("showOnProductPage"),fitMode:t.get("fitMode")}:i))}}};e.e_R={};(l=e.e_k=e.addChild("designObjects",s.Widget.Collection.Dynamic,{dragToReorder:t,dragIgnoresLocked:n,itemRemoveActsOnSelection:t,ensureItemDraggedIsSelected:t,itemDisplayOrder:"reverse",itemWidgetClass:a.DesignObjectUi,makeNewlyAddedSelected:n})).wire({"Changed.inDrag":function(){e.set({e_S:!l.get("inDrag")})},Remove:function(n){if(!e.e_M){var r=n.itemWidgets,i=r.length,s=-1,o=[];for(;++s<i;)o.push(r[s].get("model"));e.e_Q("x",{name:"Remove",designObjects:o});n.handled=t}},"Items Reordered":function(){var t=l.getSelected(),n=l.itemWidgets,i=s.isArray(n)?n.length:0,o=s.isArray(t)?t.length:0,u=o?t[0]:r,a=[],f=-1;if(o){for(;++f<o;)a.push(t[f].get("model"));for(f=-1;++f<i;){if(n[f]==u){f--;break}}e.e_Q("z",{name:"Reordered",reorderedModels:a,above:f==i||f<0?undefined:n[f].get("model")})}},"Item Selected":function(t){e.fire({name:"Design Object UI Selected",designObjectUi:t.itemWidget})}});var N=e.addChild("areas",u.Droplist,{values:e.e_5,value:e.e_6});new s.Util.PropertyAdapter({propertyA:{instance:e,property:"area"},propertyB:{instance:N,property:"value"}});N.wire("Changed.values",function(){e.e_7()});var C=e.addChild("areaGroups",u.Droplist);new s.Util.PropertyAdapter({propertyA:{instance:e,property:"areaGroup"},propertyB:{instance:C,property:"value"}});new s.Util.PropertyAdapter({propertyA:{instance:e,property:"areaGroups"},propertyB:{instance:C,property:"values"}});e.e_9={};x("addImage",o,function(){e.e_$_(t,function(t){var n=[];for(var r=-1,i=t.length,s;++r<i;){s=t[r];s.e_e_&&n.push({type:"image",id:s.e_e_,title:s.e_f_||""})}n.length&&e.e_Q("i",{name:"Add",properties:n})})},h,{});x("addText",o,function(){e.e_g_("",function(t){t&&e.e_Q("t",{name:"Add",properties:[{type:"text",title:t+""}]})})},h,{});x("edit",u.Menu,i,h).wire({"Item.undo":function(){e.e_Q("u","Undo")},"Item.redo":function(){e.e_Q("r","Redo")},"Item.selectAll":function(){e.e_k.selectAll()},"Item.selectNone":function(){e.e_k.selectNone()},"Item.cut":function(){e.e_Q("c","Cut")},"Item.copy":function(){e.e_Q("o","Copy")},"Item.paste":function(){e.e_Q("p","Paste")},"Item.delete":function(){e.e_Q("d","Remove")},"Item.bg":function(){var t=e.e_j_?e.e_j_.fillcolor:"";if(!e.e_k_)e.e_k_={name:"Zazzle.Widgets.Dialogs.ColorSwatchList",params:{value:t}};e.callInherited("useDialog")({component:e.e_k_,widgetProperties:{name:"colorPalette",shieldOpacity:.01,value:t},dismissHandler:function(){e.fire({name:"Background Changed",bg:t})},widgetEventHandlers:{"Changed.value":function(t){e.e_Q("b",{name:"Background Changed",bg:t.source+""})}}})},"Item.border":function(){var t=e.e_j_,n=t&&t.strokecolor||"000000",r=t&&t.strokewidth||10,i=function(t){e.e_Q("J",{name:"Border Changed",border:t.source+"",strokewidth:t.source.get("thickness")})};e.callInherited("useDialog")({component:{name:"Zazzle.Widgets.Dialogs.ColorSwatchList.Border"},widgetProperties:{name:"borderColorPalette",shieldOpacity:.01,value:n,thickness:r},dismissHandler:function(){e.fire({name:"Border Changed",border:n,strokewidth:r})},widgetEventHandlers:{"Changed.value":i,"Changed.thickness":i}})},"Item.clear":function(){e.confirm({state:"warning",message:e.localize("clearSideWarning",[e.e_o_,e.e_p_]),yesHandler:function(){e.e_Q("l","Clear")}})},"Item Selected":function(t){!t.item.indexOf("moveTo")&&e.e_Q("m",{name:"Transfer",area:t.itemDetails.attributes.area})}});e.e_q_={selectAll:{e_n:1,e_o:"unselected"},selectNone:{e_n:1,e_o:"selected"},cut:d,copy:d,"delete":d,clear:p};x("arrange",u.Menu,i,d).wire({"Item.align":function(){e.callInherited("useDialog")({component:{name:"ZazzleWww.Dialog.Align"},widgetProperties:{name:"alignDialog"},submitHandler:function(r){var i=r.groupPinX,s=r.groupPinY;e.e_Q("a",{name:"Move",snap:t,alignto:"objects",hcenter:i===.5,vcenter:s===.5,left:i===0,right:i===1,top:s===0,bottom:s===1,group:n})}})},"Item.spaceH":function(){e.e_Q("h",{name:"Space",horizontal:1})},"Item.spaceV":function(){e.e_Q("v",{name:"Space",vertical:1})},"Item.centerX":function(){e.e_Q("e",{name:"Move",snap:t,hcenter:1})},"Item.centerY":function(){e.e_Q("n",{name:"Move",snap:t,vcenter:1})},"Item.fill":function(){e.e_Q("f","Fill")},"Item.fit":function(){e.e_Q("g","Fit")},"Item.rotateCcw":function(){e.e_Q("j",{name:"Rotate",rotation:45})},"Item.rotateCw":function(){e.e_Q("k",{name:"Rotate",rotation:-45})},"Item.sendToFront":function(){var t=l.itemWidgets,n=t.length,r,i;for(;--n>=0;){r=t[n];if(!r.get("selected")){i=r.get("model");break}}i&&e.e_Q("q",{name:"Reordered",above:i})},"Item.sendToBack":function(){e.e_Q("s",{name:"Reordered"})}});e.e_w_={align:v,spaceH:v,spaceV:v,fill:m,fit:m};x("move",s.Widget.DirectionalPad,{mode:"mini",useLinks:t},d).wire("Move",function(t){var n=t.direction,r=function(e){return n.indexOf(e)>=0};if(n){n=n.toLowerCase();var i=t.domEvent,s=i.shiftKey?.15:i.ctrlKey||i.metaKey?.01:.05,o=r("north"),u=r("south"),a=r("west"),f=r("east"),l=n==="center",c=!l&&/edge$/.test(n);e.e_Q("w",{name:"Move",snap:c||l,space:"design",dx:s*(a?-1:f?1:0),dy:s*(o?-1:u?1:0),alignto:"design",hcenter:l,vcenter:l,top:o,bottom:u,left:a,right:f})}});x("centerX",o,function(t){e.e_Q("y",{name:"Move",direction:t.source.get("name"),domEvent:t.domEvent})},g,{});x("centerY",o,function(t){e.e_Q(0,{name:"Move",direction:t.source.get("name"),domEvent:t.domEvent})},g,{});x("fill",o,function(){e.e_Q(1,"Fill")},m,{});x("fit",o,function(){e.e_Q(2,"Fit")},m,{});x("scaleLarger",o,function(t){var n=t.domEvent;e.e_Q(3,{name:"Scale",direction:"+",accelerate:n.shiftKey,decelerate:n.ctrlKey||n.metaKey})},y,{});x("scaleSmaller",o,function(t){var n=t.domEvent;e.e_Q(4,{name:"Scale",direction:"-",accelerate:n.shiftKey,decelerate:n.ctrlKey||n.metaKey})},y,{});x("rotateCw",o,function(t){var r=t.domEvent;if(r.ctrlKey||r.metaKey){var i=e.e_J_.getSelected(),s=i.length===1;e.e_L_({useTextArea:n},{name:"rotationInputDialog",value:s?Math.round(i[0].getRotationAngle()*1e3)/1e3:0,title:e.localize("rotateDialogTitle"),validator:function(e){return Uize.isNumber(+e)}},function(t){e.e_Q(5,{name:"Rotate",rotation:t%360,isAbsolute:s})})}else{var o=t.domEvent&&t.domEvent.shiftKey;e.e_Q(o?6:7,{name:"Rotate",rotation:o?45:-45})}},g,{});x("face",Zazzle.Picker.Font,i,b,{e_E:"selector"}).set({fontFilter:E?1:0});c.face.wire("Changed.value",function(){!e.e_N&&e.e_Q(8,{name:"Font Face Changed",face:e.children.face+""})});x("color",u.Picker.Color,i,b,{e_E:"selector"}).wire("Changed.value",function(){e.e_Q(9,{name:"Color Changed",color:e.children.color+""})});if(E)c.color.set({paletteTemplate:"udtStitchPalette"});x("fontheight",u.Droplist.ComboBox,i,b).wire("Changed.value",function(){!e.e_N&&e.e_Q("B",{name:"Font Height Changed",fontheight:+e.children.fontheight})});x("align",a.ControlPopupPalette,{hideOnClick:false,values:["left","center","right"],value:"center",backgroundUrlAttributes:"no-repeat",positioning:"absolute"},b,{e_K:"title"}).wire("Changed.value",function(){var t=e.children.align+"";e.e_Q("C",{name:"Align",align:f.DesignTextAlign[t==="left"?"LEADING":t==="right"?"TRAILING":"CENTER"]})});x("advancedOptions",s.Widget.PopupPalette,{hideOnClick:false},w,{e_E:"selector"});x("tile",u.Checkbox,i,{image:1,e_o:"selected-unlocked"}).set({clickToSelect:t,clickToDeselect:t,enabled:t});c.tile.wire("Changed.value",function(){e.e_Q("K",{name:"Tile",tile:c.tile.get("value")})});x("lock",u.Checkbox,i,w).set({clickToSelect:t,clickToDeselect:t,enabled:t});c.lock.wire("Changed.value",function(){!e.e_M&&!e.e_N&&e.e_Q("L",{name:"Lock",isLocked:c.lock.get("value")})});x("template",a.TemplateDesigner,i,{image:1,text:1,e_o:"selected-unlocked"}).wire({"Changed.isTemplate":T,"Changed.title":T,"Changed.urlKey":T,"Changed.fitMode":T,"Changed.showOnProductPage":T});x("transparent",u.Checkbox,i,{image:1,e_o:"selected-unlocked"}).set({clickToSelect:t,clickToDeselect:t,enabled:t});c.transparent.wire("Changed.value",function(){e.e_Q("D",{name:"Set As Transparent",isTransparent:e.children.transparent.get("value")})});x("path",s.Widget.FormElement,i,b).wire("Changed.value",function(){var t=e.children.path+"";e.e_Q("P",{name:"Path Changed",path:t})});x("radius",s.Widget.FormElement.Text,i,b).wire("Changed.value",function(t){e.e_Q("E",{name:"Radius Changed",radius:+e.children.radius})});x("mirror",a.ControlPoptions,{templateOption:{GENERATED_itemNo:"999",displayName:"DISPLAYNAME"}},{e_o:"selected-unlocked"}).wire("Changed.value",function(){e.e_Q("F",{name:"Mirroring Mode Changed",mode:e_Q_+""})})}),c=l.prototype;l.mixins(s.Widget.mChildBindings);c.e_F=o.addChildButton;c.e_S_=function(e){this.fire({name:"Track",code:e})};c.e_Q=function(e,t){this.e_S_(e);this.fire(t)};c.e_U_=function(e){var n=this,r=n.e_9,i=s.isArray(r)?r.length:0,o=0,u=e?"imageTemplateKey":"textTemplateKey",a=n.localize(u).replace("{index}",""),f,l;for(;--i>=0;){f=r[i].urlkey;if(!f.indexOf(a)){l=+f.replace(a,"");if(s.isNumber(l))o=Math.max(o,l+1)}}return{urlKey:n.localize(u,{index:o}),title:n.localize(e?"imageTemplateTitle":"textTemplateTitle",{index:o}),fitMode:"none",showOnProductPage:t}};c.e_$_=function(e,t){var n=this,r=n.e_y==="stitch";n.callInherited("useMediaBrowser")({selectionMode:e?"multi":"single",imageType:r?"ztimage":"image",checkZT:r,reloadFlag:n.e_k.get("totalItems")>0},function(e){var r=[],i=e.length,s=-1;for(;++s<i;)r.push(e[s].attributes.id);n.filterAddImages(r,t)})};c.e_L_=function(e,t,r){this.callInherited("useDialog")({component:Uize.copyInto({name:"Zazzle.Dialog.Input"},e?{params:e}:i),widgetProperties:Uize.copyInto({persistText:n},t),submitHandler:r})};c.e_g_=function(e,t){var r=this;r.e_L_(i,{name:"addTextDialog",value:e,title:r.localize("addTextDialogTitle"),validator:function(e,t){var i=!!e,s=this,o="";if(e.length>32767){i=n;o=r.localize("invalidLengthError",{limit:32767,length:e.length})}else{var u="",a=e.match(/[^\x0a\x0d\x20-\xFF\u0100-\u017F\u2018\u2019\u201C\u201D\u2460-\u2473\u2F00-\u31FF\u4E00-\u9FCB\uFF00-\uFFEE\uAC00-\uD7A3]+/),f=a?a.length:0,l=-1;for(;++l<f;){var c=a[l],h=c.charCodeAt(0);u+=(h<32?"[#"+h+"]":c)+" "}if(!(i=!u))o=r.localize("invalidCharactersError",{invalidCharacters:u})}t(i,o)}},t)};c.e_ga=function(e,t){var n=this,r=e.length,i=-1,o=n.getInherited("commObject"),u=0,a=[],f=function(e){e&&a.push(e);++u==r&&s.isFunction(t)&&t(a)};if(r){!n.e_na&&(n.e_na={buildRequest:function(e){var t={action:"batch"};for(var r=-1,i=e.length;++r<i;)t["command"+r]=s.Url.from(e[r].url).query+"&comm_mode=ajax&output=xml";return{category:"BATCH REQUEST",cache:"never",returnType:"json",requestMethod:"POST",url:[n.getInherited("env").realviewService,t]}},responseParser:function(e){var t=e.responseJson,n=[],r=t.children,i=r.length;for(var s=-1;++s<i;)n.push(r[s].children[0]);return n}});for(;++i<r;)o.queueRequest({url:[n.getInherited("env").realviewService,{action:"getimageinfo",id:e[i].toLowerCase()}],returnType:"json",requestMethod:"POST",cache:"memory",callback:f,batchingAgent:n.e_na});o.useQueue()}else s.isFunction(t)&&t()};c.select=function(e,t){var r=this,i=e.length,s=r.e_R,o,u=t!==n;for(;--i>=0;){o=s[e[i].getName()];o&&o.set({selected:u})}r.updateUi()};c.setDesignObjectState=function(e,t){var n=this,r=n.e_R[t.getName()];r&&r.set({over:e=="over"})};c.e_Da=function(e){var t=this,n=e.objects.split(","),r=s.isArray(n)?s.lookup(n):i,o=[];if(r){for(var u=t.e_k.itemWidgets,a=u.length,f;--a>=0;){f=u[a];f.get("name")in r&&o.push(f)}}return o};c.setConstraint=function(e){for(var n=this.e_Da(e),r=n.length;--r>=0;)n[r].set({hasError:t,warningMessage:this.localize("constraint_"+e.type)})};c.focusWarning=function(e,t){for(var n=this.e_Da(e),r=n.length;--r>=0;)n[r].set({warningIsFocused:t})};c.syncDesignObjects=function(e,r,i){var o=this,u=e.length,a=-1,l=o.e_9,c=[],h=o.e_k,p={},d,v,m,g,y,b;if(!o.e_M){o.e_M=t;for(;++a<u;){v=e[a];m=v.type;g=v instanceof f.DesignText?"text":v instanceof f.DesignImage?"image":"";if(g){d=v.name;b=g==="image";!l[g]&&(l[g]=s.Template.compile(o.getNode(g+"PodTemplate").innerHTML.replace("\n","").replace("	",""),{openerToken:"[%",closerToken:"%]"}));if(b){var w=v.imageid.toLowerCase();y=v.getProperty("title")||r[w]||w}else y=s.Xml.toAttributeValue(v.text);c.push(s.copyInto({html:l[g]({itemWidgetName:d}),cssClassBase:o.e_Ra,cssClassActive:o.e_Sa,cssClassOver:o.e_Ta,properties:{id:d,title:y},draggable:h.get("dragToReorder"),model:v,selected:d in i,locked:v.isLocked()}))}}h.remove(h.itemWidgets);h.setNodeInnerHtml("items","");for(var E=h.add(c),S=-1,x=E.length,T,N={"Changed.over":function(e){var t=e.source;o.fire({name:"Design Object UI "+(t.get("over")?"Over":"Out"),designObjectUi:t})},"Changed.selected":function(e){var t=e.source;!t.get("selected")&&o.fire({name:"Design Object UI Unselected",designObjectUi:t})},Edit:function(e){var r=e.source;o.e_k.selectNone();r.set({selected:t});r.get("type")=="image"?o.e_$_(n,function(e){e[0]&&o.e_Q("G",{name:"Edit",id:e[0].e_e_})}):o.e_g_(e.source+"",function(e){if(e)o.e_Q("H",{name:"Edit",text:e+""});else{o.e_S_("I");r.fire({name:"Remove",byUser:t})}})}};++S<x;){T=E[S];T.wire(N);p[T.get("properties").id]=T}h.isWired&&h.displayNode("items",!!E.length);o.e_R=p;o.updateUi();o.e_M=n}};c.filterAddImages=function(e,t){var n=this,i=n.e_y==="stitch";n.e_ga(e,function(e){var o=[];s.Comm.processArrayAsync(e,function(e,t){var u=e.attributes?e.attributes.id:r;if(u){var a=e.children,f=s.Data.findRecords(a,{name:"title"}),l={e_e_:u,e_f_:f&&f[0]&&f[0].value||""},c=s.Data.findRecords(a,{name:"image_type"}),h=c&&c[0]&&c[0].value||"";if(i&&h!="ofm"){n.callInherited("useDialog")({component:{name:"ZazzleWww.Dialog.StitchConversion",params:{im:u}},widgetClassName:"Uize.Widget.Dialog.Confirm",widgetProperties:{name:"confirmConversionDialog",mode:"confirmCustom"},submitHandler:function(e){if(e)o.push(l);else o=[];t(e)}})}else{o.push(l);t()}}},function(){t(o)})})};c.wireUi=function(){var r=this;if(!r.isWired){var i=r.children,s=i.move,o=i.advancedOptions;s.wireNode("",{mouseover:function(){s.get("enabled")&&s.get("enabledInherited")&&s.set({mode:"full"})},mouseout:function(){s.get("enabled")&&s.get("enabledInherited")&&s.set({mode:"mini"})}});o.wire("Changed.enabled",function(){!o.get("enabled")&&r.displayNode("palette",n)});r.wireNode("viewOther","click",function(){r.e_Q("V",{name:"View Pair",bubble:t})});e.doMy(r,"wireUi");for(var u,a,f=r.e_j,l=f.length;--l>=0;){a=f[l];u=a.e_H;this.callInherited("wireTooltip")({node:a.e_K?u.getNode(a.e_K):a.e_E?u.children[a.e_E].getNode():u.getNode()})}}r.e_bb()};c.updateUi=function(){var t=this;if(t.isWired){t.e_bb();t.e_7();t.e_cb();e.doMy(t,"updateUi")}};c.e_cb=function(){var e=this,r=e.children.edit;if(r){var i=r.get("values"),o=s.findRecord(i,{name:"bg"}),u=s.findRecord(i,{name:"border"}),a=e.e_j_,f=n;if(o){o.valueDetails.thumbnailUrl="#"+(a&&a.fillcolor||"ffffff");f=t}if(u){u.valueDetails.thumbnailUrl="#"+(a&&a.strokecolor||"ffffff");f=t}f&&r.set({values:s.clone(i)})}};c.e_7=function(){var e=this;if(e.isWired){var t=e.children,n=t.areaGroups,r=t.areas,i=n.get("values"),o=r.get("values");e.web(n).display(s.isArray(i)&&i.length>1);e.web(r).display(s.isArray(o)&&o.length>1&&t.designObjects.get("totalItems"))}};c.e_bb=function(){var e=this;if(e.isWired){e.e_N=t;var r=e.children,i=r.designObjects,o=e.e_J_,u=o?o.getSelected():[],a=u.length,l=i.get("totalItems"),c=a,h=e.e_nb,p=o?o.getSelected({locked:t}).length:0,d=p&&p===o.get("numLocked"),v=e.e_G,m=v.length,g=[],y=[],b={},w=function(e){var t=e.e_o;return(e.e_n||e[h])&&(t=="selected-unlocked"&&a&&!d||t=="always"||t=="selected"&&!!a||t=="unselected"&&a!=l||t=="exist"&&!!l||t=="multi-selected-unlocked"&&a>1&&!d)},E,S,x,T,N;for(;--m>=0;){E=v[m];T=E.e_A;x=E.e_o;S=r[T];N=E[h];S.displayNode("shell",!!(E.e_n||N));S.set({enabled:w(E)});if(N){if(T==="fontheight")b.fontheight=S;else if(T==="color")b.color=S;else if(T==="align")b.align=S;else if(T==="path")b.path=S;else if(T==="radius")b.radius=S;else if(T==="face")b.face=S;else if(T=="lock")S.set({value:!!d});else if(T==="template")b.template=S;else if(T==="transparent")b.transparent=S;else if(T==="tile")b.tile=S}}for(var C in e.e_q_){!w(e.e_q_[C])&&g.push(C)}!e.e_zb&&g.push("undo");!e.e_Ab&&g.push("redo");!e.e_Bb&&g.push("paste");r.edit.set({disabledList:g});for(var k in e.e_w_){!w(e.e_w_[k])&&y.push(k)}r.arrange.set({disabledList:y});if(!s.isEmpty(b)&&a){var L=e.e_U_(c&&u[0]instanceof f.DesignImage),A,O,M,_,D,P,H,B,j,F,I,q="",R,U,z,W={},X,V=0,$,J,K,Q,G,Y,Z,et,tt,nt,rt,it,st={};for(;--c>=0;){A=u[c];if(($||($=b.fontheight))&&V!==W){j=A.getProperty("height");V=!V||V===j?j:W}if((J||(J=b.color))&&X!==W){B=A.getProperty("color");X=!X||B===X?B:W}if((K||(K=b.align))&&R!==W){M=A.getAlign();_=M===f.DesignTextAlign.LEADING?"left":M===f.DesignTextAlign.TRAILING?"right":"center";R=!R||R===_?_:W}if((G||(G=b.path))&&U!==W){D=A.getPath();P=D===f.DesignTextPath.RARC?"rarc":D===f.DesignTextPath.ARC?"arc":D===f.DesignTextPath.VERT?"vert":"horz";U=!U||U===P?P:W}if((Y||(Y=b.radius))&&z!==W){H=A.getArc();z=!z||z===H?H:W}if((Q||(Q=b.face))&&q!==W){O=A.getProperty("face");q=!q||q===O?O:W}if(Z||(Z=b.template)){F=A.urlkey;tt=c==u.length-1||tt==F?F:W}if((et||(et=b.transparent))&&(et.get("value")||c==u.length-1)){rt=A.getProperty("whitetransparent")==="true"}if((nt||(nt=b.tile))&&(nt.get("value")||c==u.length-1)){I=A.getProperty("layout")==="tile";it=!it||it===I?I:W}}if(Z){if(tt){if(tt!==W){var ot=e.e_9,ut,at=s.isArray(ot)?ot.length:0;for(;--at>=0;){ut=ot[at];if(ut.urlkey===tt){L={urlKey:ut.urlkey,title:ut.title,fitMode:A.getProperty("fillmode"),showOnProductPage:ut.ppshow};break}}}}Z.set(s.copyInto({isTemplate:!!tt&&tt!==W,hasMultiple:tt===W,mode:e.e_nb},L))}if(Q&&q&&q!==W&&Q.get("value")!==q){Q.set({value:q,valueDetails:{displayName:q}});st.face=q}if(K&&R&&R!==W){K.set({value:R})}if(J&&X&&X!==W){J.set({value:X});st.color=X}if($&&V&&V!==W){$.set({value:V/10});st.height=V}if(G&&U&&U!==W){G.set({value:U})}if(Y&&z&&z!==W){Y.set({value:z})}if(nt){nt.set({value:!!(it!==W&&it)})}if(et){et.set({value:!!rt})}e.fire({name:"Update Default Design Object Properties",newDefaults:{text:st}})}e.displayNode("none",!p&&l);r.lock&&r.lock.set({enabled:e.e_9b?"inherit":n});e.e_N=n}};l.stateProperties({e_6:{name:"area"},e_5:{name:"areas",onChange:function(){this.children.areas&&this.children.areas.set("values",this.e_5)}},e_$c:{name:"areaGroup"},e_o_:"areaGroupDisplayName",e_ib:"areaGroups",e_j_:{name:"areaFillProperties",onChange:c.e_cb},e_S:{name:"canSave",value:t},e_Bb:{name:"canPaste",value:n,onChange:c.e_bb},e_zb:{name:"canUndo",value:n,onChange:c.e_bb},e_Ab:{name:"canRedo",value:n,onChange:c.e_bb},e_Sa:"cssClassDesignObjectUiActive",e_Ra:"cssClassDesignObjectUiBase",e_Ta:"cssClassDesignObjectUiOver",e__c:"dialogMooringNode",e_ac:{name:"dialogOffsetX",value:0},e_bc:{name:"dialogOffsetY",value:0},e_9b:{name:"lockIsEditable",value:t},e_nb:{name:"mode",conformer:function(e){return e==="image"||e==="text"||e==="combined"?e:this.e_k.get("totalItems")?"noneSelected":"noneExist"},onChange:c.e_bb},e_y:"process",e_p_:"productTypeDisplayName",e_J_:"selectedDesignObjectsModel",e_dc:{value:0},e_9:"templates",e_ec:{name:"transferableAreas",onChange:function(){var e=this,t=e.e_ec,n=e.children.edit;if(n){var r=n.get("values"),i=e.e_q_,o=-1,u=-1;for(var a=-1;++a<r.length;){var f=r[a];if(f.name=="delete")o=a;else if(f.name=="clear")u=a}if(o>-1){if(u-o>1){r.splice(o+1,u-o-1);for(var l in i){if(!l.indexOf("moveTo"))delete i[l]}}if(t.length)for(var c=-1;++c<t.length;){var h="moveTo"+c,p=t[c];r.splice(o+1+c,0,{name:h,valueDetails:{name:h,displayName:e.localize("moveToMenuItem",{sideName:p.displayName}),attributes:{e_nc:!c,area:p.name}}});i[h]={e_n:1,e_o:"selected"}}n.set({values:s.clone(r)})}}}}});l.childBindings({dialogMooringNode:["face","color"],dialogOffsetX:["face","color"],dialogOffsetY:["face","color"]});return l}});Uize.module({name:"Uize.Widget.Scrolly",required:["Uize.Fade","Uize.Widget.Button"],builder:function(e){"use strict";function t(e,t,n,r){e.isWired&&e.displayNode([e.children[n].getNode(),e.children[r].getNode()],e.d_d||e.get("isScrollable"+t))}function n(e,t){if(e.isWired){var n=e.getNode("view"),r=t=="X"?"Width":"Height";e.set("maxPage"+t,n?Math.max(Math.ceil(n["scroll"+r]/n["offset"+r])-1,0):0)}}function r(e,t,r){n(e,r);return Uize.isNumber(t=+t)?Uize.constrain(t,0,e.get("maxPage"+r)||0):e.get("page"+r)}function i(e,t){function i(e,t){var n=r[e];n&&n.set({enabled:t?"inherit":false})}var n=e.get("page"+t),r=e.children;i(t=="X"?"left":"up",n);i(t=="X"?"right":"down",(e.get("maxPage"+t)-n+1||2)>1)}function s(){var e=this;if(e.isWired){var t=e.getNode("view");e.fade.start({startValue:{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop},endValue:{scrollLeft:e.d_s*t.offsetWidth,scrollTop:e.d_t*t.offsetHeight}})}}function o(){i(this,"X")}function u(){i(this,"Y")}function a(){t(this,"X","left","right")}function f(){t(this,"Y","up","down")}return e.subclass({alphastructor:function(){var e=this;e.fade=Uize.Fade({duration:400,curve:Uize.Fade.celeration(0,1),quantization:1});e.fade.wire("Changed.value",function(t){e.isWired&&e.setNodeProperties("view",t.newValue)})},omegastructor:function(){function t(t,n,r){e.addChild(t,Uize.Widget.Button,{action:function(t){var i=t.shiftKey?Infinity:1,s={};if(n)s.d_s=e.d_s+n*i;if(r)s.d_t=e.d_t+r*i;e.set(s)}})}var e=this;t("left",-1,0);t("right",1,0);t("up",0,-1);t("down",0,1)},instanceMethods:{updateUi:function(){n(this,"X");n(this,"Y")}},stateProperties:{d_F:{name:"isScrollableX",onChange:a,value:false},d_G:{name:"isScrollableY",onChange:f,value:false},d_H:{name:"maxPageX",onChange:[function(){this.set({d_F:(this.d_H+1||2)>1})},o]},d_I:{name:"maxPageY",onChange:[function(){this.set({d_G:(this.d_I+1||2)>1})},u]},d_s:{name:"pageX",conformer:function(e){return r(this,e,"X")},onChange:[s,o],value:0},d_t:{name:"pageY",conformer:function(e){return r(this,e,"Y")},onChange:[s,u],value:0},d_d:{name:"showButtonsWhenNotScrollable",onChange:[a,f],value:true}}})}});Uize.module({name:"Uize.Comm.Ajax",required:"Uize.Url",builder:function(e){"use strict";var t=Uize.nop;return e.subclass({instanceMethods:{performRequest:function(e,n){var r=this,i=e.returnType,s=i=="object",o=Uize.Url.fromParams(e.url),u=Uize.Url.resolve(e.url,Uize.copyInto({rnd:e.cache=="never"?Uize.Url.getCacheDefeatStr():null},o.comm_mode?null:{comm_mode:"ajax"},o.output?null:{output:"js"})),a=e.data||"",f=e.requestMethod,l=f=="POST",c=r.d_j||(r.d_j=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"));c.onreadystatechange=function(){if(c.readyState==4){c.onreadystatechange=t;if(c.status==200){var r=c.responseText;if(s||i=="xml")e.responseXml=c.responseXML;if(s||i=="text")e.responseText=r;if(s||i=="json")e.responseJson=r?Function("var a=["+r+"];return a.pop()")():null;c.abort();n()}else{c.abort();n({status:c.status,statusText:c.statusText})}}};if(c.upload){c.upload.onprogress=function(e){r.fire({name:"Progress",xhrEvent:e});r.fire({name:"Progress",xhrEvent:e})}}if(l&&!a){var h=u.indexOf("?");a=u.substr(h+1);u=u.slice(0,h)}r.d_j.open(f,u,true);if(l){e.contentType!="multipart/form-data"&&r.d_j.setRequestHeader("Content-type",e.contentType||"application/x-www-form-urlencoded")}r.d_j.send(a)}}})}});Uize.module({name:"Zazzle.ProductRealviewsModel",superclass:"Uize.Class",required:["Uize.Comm.Ajax","Uize.Url"],builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize;var s=e.subclass(function(){this.c_e=t;this.c_f=new i.Comm.Ajax;this.c_g=0},function(){this.c_e=n}),o=s.prototype;o.c_i=function(e){var s=this;if(!s.c_e&&s.c_f){clearTimeout(s.c_k);s.c_k=setTimeout(function(){s.set({c_l:t});s.c_f.request({url:[s.c_m,{pt:s.c_n,pd:s.c_o,att:i.Url.toParams(i.copy(s.c_p,{"design.areas":s.c_q})),dz:s.c_r,ppd:s.c_s,patt:s.c_t?i.Url.toParams(s.c_t):r,r:s.c_g,returnareas:s.c_u,includeAnnotationsUi:s.c_v,experience:s.c_w,view:s.c_x}],cache:"memory",requestMethod:"POST",returnType:"json",callback:function(r){var i=r.data;s.c_e=t;s.set({c_A:i.realviews});s.c_e=n;s.set({c_l:n});var o=[];for(var u=-1;++u<s.c_A.length;){var a=s.c_A[u];a.type!="design"&&o.push(a)}s.fire({name:"Realviews Info Updated",views:o});e&&e()}})},s.c_D)}};o.getDesignViewInfo=function(e){var t=this.getPrimaryViewInfo(e,"design");return t&&t.realviewParams};o.getPrimaryArea=function(e){var t=this.c_G(e);return t&&t.primaryAreas&&t.primaryAreas.length?t.primaryAreas[0]:null};o.getPrimaryViewInfo=function(e,t){var n=this.c_A||[],r=n.length,i,s;for(var o=-1;++o<r;){var u=n[o];if(!t||u.type==t){if(u.primaryAreas&&u.primaryAreas.length&&Uize.isIn(u.primaryAreas,e)){i=u;break}else if(!s&&u.areas&&u.areas.length&&Uize.isIn(u.areas,e))s=u}}return i||s};o.getViewInfo=o.c_G=function(e){return i.findRecord(this.c_A,{name:e})};o.getViewsForArea=function(e){var t=this.c_A||[],n=t.length,r=[];for(var s=-1;++s<n;){var o=t[s];o.type=="product"&&o.areas&&i.isIn(o.areas,e)&&r.push(o.name)}return r};o.getVisibleAreas=function(e){var t=this.c_G(e);return t?t.areas:r};o.update=o.c_N=function(e){this.c_g++;this.c_i(e)};var u=function(){this.c_i()};s.stateProperties({c_l:{name:"busy",value:n},c_r:{name:"designId",onChange:u},c_q:{name:"designAreas",onChange:u},c_w:{name:"experience",onChange:u},c_v:{name:"includeAnnotationsUi",onChange:u},c_s:{name:"parentProductId",onChange:u},c_t:{name:"parentProductOption",onChange:u},c_e:"preventServiceCall",c_o:{name:"productId",onChange:u},c_p:{name:"productOption",onChange:u},c_n:{name:"productType",onChange:u},c_A:"realviewsInfo",c_D:{name:"requestDelay",value:150},c_u:{name:"returnAreas",onChange:function(){this.c_u&&this.c_i()}},c_x:"view",c_m:"serviceUrl"});return s}});Uize.module({name:"Zazzle.MaxHotspotUi",superclass:"Uize.Widget.Button",required:["Uize.Url","Uize.Widget.mWeb"],builder:function(e){"use strict";var t="Left",n="Right",r=["Chiclet","Selection","View"],i=function(){var e=this;e.isWired&&e.web().setClassState([e.e_d,e.e_e,e.e_f],Uize.indexIn(r,e.e_g))},s=function(){var e=this;e.isWired&&e.web().setClassState([e.e_i,e.e_j],e.e_k==n)},o=function(){var e=this;e.isWired&&e.web().setClassState(e.e_m,e.get("selected"))},u=function(){var e=this;e.isWired&&e.web("thumbnail").value(e.e_o?Uize.Url.resolve(e.e_o,{max_dim:e.e_p}):e.getInherited("env").assets+"s.gif")};return e.subclass({mixins:Uize.Widget.mWeb,omegastructor:function(){var e=this;e.wire("Changed.selected",function(){e.e_l()})},instanceMethods:{e_c:i,e_h:s,e_l:o,e_n:u,updateUi:function(){var t=this;if(t.isWired){t.e_c();t.e_l();t.e_h();t.e_n();e.doMy(t,"updateUi")}}},stateProperties:{e_d:"cssClassDisplayModeChiclet",e_e:"cssClassDisplayModeSelection",e_f:"cssClassDisplayModeView",e_i:"cssClassLeft",e_j:"cssClassRight",e_m:"cssClassSelected",e_g:{name:"displayMode",onChange:i},e_k:{name:"layout",onChange:s,value:t},e_p:"thumbnailSizeMax",e_o:{name:"thumbnailUrl",onChange:u}}})}});Uize.module({name:"Zazzle.ProductViewHotspotUi",superclass:"Uize.Widget.CollectionItem",required:["Zazzle.MaxHotspotUi","Uize.Util.Coupler","Uize.Widget.mWeb"],builder:function(e){var t=e.subclass(null,function(){var e=this,t=e.e_a=e.addChild("hotspot",Zazzle.MaxHotspotUi,{clickToDeselect:true,clickToSelect:true,cssClassDisplayModeChiclet:e.e_b,cssClassDisplayModeSelection:e.e_c,cssClassDisplayModeView:e.e_d,cssClassLeft:e.e_e,cssClassRight:e.e_f,cssClassSelected:e.e_g,thumbnailSizeMax:e.e_h}),n=function(t){e.fireAnnotationEvent(t)};new Uize.Util.Coupler({instances:[e,t],properties:["selected"]});t.wire({Click:n,Over:n,Out:n,Down:n});e.wire({"Changed.properties":function(){e.e_k()},"Changed.selected":n})}),n=t.prototype;t.mixins(Uize.Widget.mWeb);n.e_k=function(){var e=this;if(e.isWired){var t=e.e_a,n="",r="",i="";if(e.e_p){var s=e.get("properties"),o=s.type,u=s.infoText,a=s.posX,f=e.e_v&&a>0,l=function(e){return 100*e+50},c=l(a);if(o=="option")u=s.displayName||(e.getInherited("primaryOptions")||{})[s.optionName]||s.optionName;else if(o=="area")u=s.displayName||(e.getInherited("areas")||{})[s.areaName]||s.areaName;t.set({text:u,displayMode:s.displayMode,layout:f?"Right":"Left",thumbnailUrl:s.thumbnailUrl});r=f?"":c+"%";i=f?100-c+"%":"";n=l(s.posY)+"%"}else{n="110%";if(t.get("layout")=="Right")i="50%";else r="50%"}e.web(t).css({opacity:e.e_p?1:0,left:r,right:i,top:n})}};n.fireAnnotationEvent=function(e){var t=this,n=t.e_a;t.fire({name:"Annotation Event",type:e.name,data:t.get("properties"),bubble:true,mooringNode:n.getNode("dot"),domEvent:e.domEvent})};n.updateUi=function(){var t=this;if(t.isWired){t.e_k();e.doMy(t,"updateUi")}};t.stateProperties({e_b:"cssClassDisplayModeChiclet",e_c:"cssClassDisplayModeSelection",e_d:"cssClassDisplayModeView",e_e:"cssClassLeft",e_f:"cssClassRight",e_g:"cssClassSelected",e_p:{name:"shown",onChange:n.e_k,value:false},e_v:{name:"smartPositioning",value:true},e_h:"thumbnailSizeMax"});return t}});Uize.module({name:"Zazzle.ProductViewUi",superclass:"Zazzle.Widget",required:["Uize.Widget.Collection","Uize.Widget.CollectionItem","Uize.Widget.Options","Uize.Widget.Scrolly","Uize.Widget.Button","Uize.Util.Coupler","Uize.Util.PropertyAdapter","Zazzle.ProductRealviewsModel","Uize.Node.Classes","Uize.Url","Uize.Node","Uize.Data","Uize.Template","Zazzle.ProductViewHotspotUi","Uize.Widget.mWeb"],builder:function(e){"use strict";function y(e){var t=this,n=e.productOption!==h,r=e.value!==h;if(r&&!n)t.z_h_&&t.z_h_.set({value:t.z_U});else if(t.isWired&&r&&n)t.z_r_=e.value}function b(e,n){return t.Data.identical(e,n)?n:e}var t=Uize,n=t.Node,r=t.Url,i=Zazzle,s=t.Util.Coupler,o=n.getCoords,u=n.getDimensions,a=n.Classes.setState,f=true,l=false,c=null,h,p=1,d=2,v=4;t.module({name:"Zazzle.ProductViewMainViewUi",superclass:"Zazzle.Widget",builder:function(e){t.module({name:"Zazzle.ProductViewHotspotsUi",superclass:"Uize.Widget.Collection",builder:function(e){var n=e.subclass(),r=n.prototype;n.mixins(t.Widget.mWeb);r.wireUi=function(){var n=this;if(!n.isWired){var r=n.web("hotspotTemplate").value();r&&n.set({itemWidgetProperties:t.copyInto(n.get("itemWidgetProperties")||{},{built:l,container:n.getNode(),insertionMode:"inner bottom",html:t.Template.compile(r,{openerToken:"[%",closerToken:"%]"})})});n.wire("Annotation Event",function(e){if(e.type=="Click"){n.z_s&&n.z_s.set({selected:l});(n.z_s=e.source).set({selected:f})}});e.doMy(n,"wireUi")}};n.set({itemWidgetClass:i.ProductViewHotspotUi});return n}});var n=e.subclass(c,function(){this.z_t=this.addChild("hotspots",i.ProductViewHotspotsUi)}),s=n.prototype;s.z_u=function(e){var t=this,n=t.z_w,i=t.z_x;return r.resolve(e,{max_dim:e.indexOf("_"+n+".")==-1?n:c,bg:i&&i.indexOf("ffffff")==-1?i:c})};s.z_y=function(){var e=this;e.isWired&&e.set({z_z:e.web().width()})};s.z_A=function(){var e=this,t=e.z_t;if(t){var n={},r,i=e.z_D||[],s=i.length,o=-1,u=e.z_G,a=e.z_H,c=e.z_I,h=function(e){return(c&e)==e},m=t.itemWidgets,g=-1,y=m.length;for(;++o<s;){r=i[o];if(r){var b=r.type,w=n[b]=n[b]||{};if(b=="info"&&h(p)||b=="option"&&h(d)&&(!u||u[r.optionName])||b=="area"&&h(v)&&a&&a[r.areaName])w[r.name]=r}}for(;++g<y;){var E=m[g],S=E.get("properties"),b=S.type,x=S.name,w=n[b];if(w&&w[x]){E.set({properties:w[x],shown:f});delete w[x]}else{E.set({shown:l})}}for(var b in n){var w=n[b];for(var x in w){var S=w[x];t.addItemWidget(t.makeItemWidgetName(S),{properties:S,shown:f})}}}};s.z_T=function(){var e=this;if(e.isWired){var t=e.z_u(e.z_U);e.getNodeValue("realview")!==t&&e.setNodeValue("realview",t)}};s.updateUi=function(){var t=this;if(t.isWired){t.z_y();t.z_T();t.z_A();e.doMy(t,"updateUi")}};s.wireUi=function(){var t=this;if(!t.isWired){if(!t.z_U){var n=t.getNodeValue("realview"),i=t.getNode("realviewMask"),s=l,o=function(){s&&t.setNodeStyle(i,{opacity:.25})},u=function(e){var n=e.type;s=n=="Over";if(t.isWired&&(s||n=="Out")){var u=e.data,a=function(){return r.resolve(t.z_u(t.z_U),{design:c,areamask:4,areacolor:"4c7fd3",maskcolor:"ffffff",area:u.areaName,image_type:"png"})};if(u.type=="area"){if(s){var f=i.src,l=a();if(f==l)o();else i.src=l}else t.setNodeStyle(i,{opacity:0})}}};n&&t.set({z_U:n});if(i){t.wire("Annotation Event",u);t.wireNode(i,"load",o)}}e.doMy(t,"wireUi")}};n.stateProperties({z_D:{name:"annotations",onChange:s.z_A},z_H:"areas",z_x:{name:"imageBackgroundColor",value:"0xffffff"},z_z:{name:"imageSize",onChange:function(){var e=this,n=e.z_z,r=n,i=e.z_3,s=e.z_4;if(t.isArray(i)){for(var o=-1;++o<i.length;){var u=i[o];if(u<=s&&n<=u){r=u;break}}}e.set({z_w:r})},value:700},z_I:"includeAnnotationsUi",z_4:{name:"maxRequestedImageSize",value:700},z_G:"primaryOptions",z_w:{name:"requestedImageSize",value:700},z_3:"validRequestedImageSizes",z_U:{name:"value",onChange:s.z_T}});return n}});t.module({name:"Zazzle.ProductViewSelectorUi",superclass:"Uize.Widget.Options",builder:function(e){return e.subclass({stateProperties:{z_7:{name:"viewUrls",derived:function(e){var n=this,i=n.callInherited("getUrlBase")(),s=n.callInherited("getRealviewParams")(),o=n.getInherited("templateParams"),u=n.getInherited("viewSelectorImageSize"),a=r.getCacheDefeatStr();return t.map(e,function(e){return r.resolve(i,t.copy(e.realviewParams,s,o,{r:a,max_dim:u}))})}}},set:{html:f,insertionMode:"inner bottom",optionWidgetProperties:{classNamingForStates:""}}})}});var m=e.subclass(c,function(){function v(t){e.z_B_&&e.z_T(t)}var e=this,n=["designAreas","designId","parentProductId","parentProductOption","productId","productOption","productType","view"],o=e.addChild("mainView",i.ProductViewMainViewUi),u=e.model=e.z_e_=new i.ProductRealviewsModel(t.copyInto({serviceUrl:e.z_f_,returnAreas:!!e.z_g_},e.get(n))),a=e.z_h_=e.addChild("viewSelector",i.ProductViewSelectorUi),c=new s({instances:[e,u],properties:n,coupled:e.isWired}),p,d;e.addChild("scrolly",t.Widget.Scrolly);new t.Util.PropertyAdapter({propertyA:{instance:o,property:"imageSize"},propertyB:{instance:e,property:"maxDim"}});o.wire("Changed.requestedImageSize",function(){e.z_l_()});new t.Util.PropertyAdapter({propertyA:{instance:o,property:"requestedImageSize"},propertyB:{instance:e,property:"requestedMaxDim"}});u.wire({"Realviews Info Updated":function(t){var n=t.views,r=l,i=l,s=l,o;if(e.z_r_){d={name:e.z_r_};e.z_r_=h}a.forAll(function(e){e.removeUi()});for(var u=-1;++u<n.length;){var c=n[u];if(d){if(c.name==d.name){o=c;break}else if(c.displayName==d.displayName){if(!r&&c.contextId==d.contextId){o=c;r=f}else if(!i&&!r){o=c;i=f}}else if(!s&&!i&&!r&&c.contextId==d.contextId){o=c;s=f}}if(!o)o=c}if(e.z_v_||e.z_w_){var p=n,m;if(e.z_v_){p=[];for(var u=-1;++u<n.length;){m=n[u];if(m.type!="product"||m.contextId==o.contextId)p.push(m)}}if(e.z_w_){var g=[];for(var u=-1;++u<p.length;){m=p[u];if(m.canBePreferred)g.push(m)}if(!g.length)g=p;p=g}n=p}d=o;a.set({values:n,value:o.name});v()},"Changed.busy":function(){e.set({busy:u.get("busy")?f:"inherit"})}});a.wire({"Changed.value":function(){var t=a+"";d=a.getValueObject();v();e.set({z_U:t})},"Changed.tentativeValue":function(){function n(){e.z_T(t)}clearTimeout(p);var t=a.get("tentativeValue");if(t!=a.get("value"))p=setTimeout(n,250);else n()}});d=t.findRecord(a.get("values"),{name:a+""});e.addChild("toggleButtonStrip",t.Widget.Button,{classNamingForStates:""}).wire("Click",function(){e.set({z_E_:!e.z_E_})});e.setToolTip(e.children.toggleButtonStrip,function(){return e.localize(e.z_E_?"openButtonStrip":"closeButtonStrip")});e.setToolTip(e.z_F_("largeView",function(){var t=e.getCurrentViewInfo().maskParams;e.callInherited("useDialog")({component:{name:"Zazzle.TransparentRealviewOverlay"},widgetProperties:{name:"transparentRealviewOverlay",imageUrl:r.resolve(o+"",{bg:"0xdddddd"}),maskUrl:r.resolve(e.getUrlBase(),[{areamask:"pr"},t&&t.design&&{r:r.getCacheDefeatStr()},t])}})}));e.wire("Changed.wired",function(){u.set("preventServiceCall",true);c.set("coupled",e.isWired);u.set("preventServiceCall",false)})}),g=m.prototype;g.z_F_=Uize.Widget.Button.addChildButton;g.z_H_=function(){var e=this;e.isWired&&a(e.children.toggleButtonStrip.getNode(),[e.z_I_,e.z_J_],e.z_E_)};g.z_T=function(e){var n=this,i=n.children,s=n.z_h_,o=s.getValueObject(e);if(o){i.mainView.set({value:r.resolve(n.getUrlBase(),t.copy(o.realviewParams,{wm:n.z_L_},n.getRealviewParams(f),n.z_$_,{r:n.z_a_||c,max_dim:h})),annotations:o.annotations})}};g.z_l_=function(){var e=this;e.isWired&&e.web().setClassState(e.z_M_,e.children.mainView.get("requestedImageSize")>=700)};g.getCurrentViewInfo=function(){return this.z_h_.getValueObject()};g.getUrlBase=function(){return this.get("urls").rlvBase};g.getRealviewParams=function(){return{pending:!this.z_N_,pdt:this.z_O_}};g.refresh=function(){var e=this,n=e.children.viewSelector;if(n&&e.isWired){var i=n.get("values");e.z_T();n.forAll(function(n,s){n.setNodeValue("image",r.resolve(e.getUrlBase(),t.copy(i[s].realviewParams,e.getRealviewParams(),e.z_$_,{r:e.z_a_||c,max_dim:e.z_R_})))})}};g.setToolTip=function(e,t){var n={node:e.getNode(),direction:"Right"};t&&(n.message=t);this.callInherited("wireTooltip")(n);return e};g.updateUi=function(){var t=this;if(t.isWired){var n=t.children;n.mainView.updateUi();n.scrolly.updateUi();t.z_H_();t.z_l_();e.doMy(t,"updateUi")}};m.stateProperties({z_C:"annotation",z_a_:{name:"cacheDefeat",onChange:g.refresh,value:0},z_I_:"cssClassCollapseButtonStrip",z_J_:"cssClassExpandButtonStrip",z_2_:"cssClassSelectedInView",z_3_:"cssClassShowSelected",z_4_:"cssClassViewSelectorWithButtons",z_M_:"cssClassViewCrop",z_5_:"designId",z_6_:"designAreas",z___:{name:"maxDim",value:700},z_7_:{name:"requestedMaxDim",value:700},z_8_:"modelRequiresDesignAreas",z_g_:{name:"modelReturnAreas",onChange:function(){this.z_e_&&this.z_e_.set("returnAreas",this.z_g_)}},z_f_:{name:"modelServiceUrl",onChange:function(){this.z_e_&&this.z_e_.set({serviceUrl:this.z_f_})}},z_9_:"parentProductId",z_$a:"parentProductOption",z_w_:{name:"preferredViewsOnly",value:false},z_N_:"productId",z__a:{name:"productOption",conformer:b,onChange:y},z_O_:"productType",z_v_:{name:"singleProductContext",value:false},z_$_:{name:"templateParams",conformer:b,onChange:function(){this.z_B_&&this.refresh()}},z_aa:"tentativeAnnotation",z_ba:"urls",z_B_:{name:"updateViewsOnDataChange",value:f},z_U:{name:"value|view",onChange:y},z_R_:{name:"viewSelectorImageSize",onChange:g.refresh},z_ca:{name:"watermarkDesign",value:0},z_L_:{name:"watermarkProduct",value:0},z_E_:{name:"toggleButtonStripExpanded",onChange:g.z_H_,value:l}});return m}});Uize.module({name:"ZazzleWww.ProductViewUi",superclass:"Zazzle.ProductViewUi",required:["Uize.Node","Uize.Node.Classes"],builder:function(e){"use strict";var t=true,n=false,r=Uize,i=r.Node,s=i.Classes;var o=e.subclass(function(){this.f_f={}},function(){var e=this;e.wire({"Changed.isDesigning":function(){e.f_g?e.f_h():e.updateUi();e.model&&e.model.set({returnAreas:e.f_g})},"Changed.requestedMaxDim":function(){var t=e.f_i;if(t){t.opts.max_dim=e.get("requestedMaxDim");e.updateModelView(t)}},"Changed.maxDim":function(){e.updateUi()}});e.f_g&&e.f_h()}),u=o.prototype;u.f_h=function(){var e=this,s=e.children;if(!e.f_l){r.require(["Uize.Widget.Resizer.Marquee","Uize.Widget.Collection.Dynamic","ZazzleWww.DesignObjectHotspot","Uize.Widget.Button"],function(o,u,a,f){var l=function(n,i){e.setToolTip(e.addChild(n,f,{clickToSelect:t,clickToDeselect:t,classNamingForStates:""})).wire("Changed.selected",i||r.nop)},c=function(t,n){var r=e.children[t]||e.addChild(t,f);r.wire("Click",function(){e.fire(n)});e.setToolTip(r)},h=function(){if(e.f_g){var i=e.f_y,s=e.model.getVisibleAreas(e+""),o=r.isArray(s)?s.length:0,u=-1,a=n;for(;++u<o;){if(s[u]==i){a=t;break}}if(!a&&e.f_i){var f=e.f_i.getViewAreas(),l=r.isArray(f)?f.length:0,c,h,p=e+"",d=e.model,v;for(u=l;--u>=0;){h=f[u].area;v=h.getName();if(h&&r.isIn(s,v)&&h.getChildObjects().length)c=v}if(!c){c=d.getPrimaryArea(p);if(!c){var g=d.getVisibleAreas(p);if(r.isArray(g))c=g[0]}}e.set({f_y:c})}}},p=function(){s.marquee.displayNode("",!!(e.f_g&&e.children.viewSelector.get("tentativeValue")==e+""))};l("toggleArtView",function(){e.f_L()});l("toggleGrid",function(){e.refresh()});c("undo","Undo");c("redo","Redo");e.wire("Changed.value",function(){s.toggleArtView.set({selected:n});e.set({f_M:e+""});h()});e.children.viewSelector.wire({"Changed.tentativeValue":p,"Changed.value":p});e.set({f_M:e+""});e.model.wire("Realviews Info Updated",function(){e.children.toggleArtView.get("selected")&&e.f_L();h()});e.addChild("marquee",o,{constrain:n,dragRestTime:500,handleCssClass:e.f_N,rotateCssClass:e.f_O,handlesAlign:{northWest:[1,1],north:[.5,1],northEast:[0,1],west:[1,.5],east:[0,.5],southWest:[1,0],south:[.5,0],southEast:[0,0]},minWidth:2,minHeight:2,built:n,left:-1e3,top:-1e3,width:1,height:1}).wire({"Changed.creatingNew":function(){var n=s.marquee,o=n.get("creatingNew");if(!o&&e.isWired){var u=n.get("top"),a=n.get("left"),f=n.get("width"),l=n.get("height"),c=e.f_V.itemWidgets,h=r.isArray(c)?c.length:0,p,d;e.f_V.selectNone();for(;--h>=0;){p=c[h];if(!p.get("model").isLocked()){d=p.getCoords();i.doRectanglesOverlap(a,u,f,l,d.left,d.top,d.width,d.height)&&p.set({selected:t})}}e.f_V.get("totalSelected")||e.f_Y?e.f_Z():e.set({f_Y:undefined})}else if(o){n.set({aspectRatio:null})}},"Changed.inDrag":function(){e.set({f_0:!s.marquee.get("inDrag")})},"Drag Done":function(){var t=s.marquee;if(!t.get("creatingNew")&&!e.f_1){var n=t.get("rotation"),r=e.get("maxDim"),i=e.get("requestedMaxDim"),o=Uize.isNumber(r)&&Uize.isNumber(i),u=function(e){return o?e/r*i:e};n?e.fire({name:"Rotate",rotation:t.get("rotation")*-1}):e.fire({name:"Bounds Changed",top:u(t.get("top")),left:u(t.get("left")),width:u(t.get("width")),height:u(t.get("height"))})}}});(e.f_V=e.addChild("designObjects",u,{itemWidgetClass:ZazzleWww.DesignObjectHotspot,makeNewlyAddedSelected:n})).wire({"Item Selected":function(t){e.f_Z();e.fire({name:"Hotspot Selected",hotspot:t.itemWidget})}});e.isWired&&r.callOn(s,"insertOrWireUi");e.f_l=t})}};u.f_L=function(){var e=this,t=e.children.toggleArtView.get("selected")?e.model.getPrimaryViewInfo(e.f_y,"design"):null;e.set({f_M:t?t.name:e+""});e.children.toggleGrid.set("selected",!!t)};u.f_$_=function(){this.isWired&&this.children.toggleArtView&&this.showNode("artViewLegend",!!this.children.toggleArtView.get("selected"))};u.f_Z=function(){var e=this,t=e.f_Y;if(e.isWired){var n=e.f_V.getSelected(),i=n.length==1&&n[0].get("model"),s=i&&(i instanceof zazzle.rlv.DesignText||i.getProperty("fillmode")!="none"),o=t&&!r.isEmpty(t),u=e.children.marquee,a=e.get("maxDim"),f=e.get("requestedMaxDim"),l=Uize.isNumber(a)&&Uize.isNumber(f),c=function(e){return l?e/f*a:e};u.set({rotation:0,left:o?c(t.left):-1e3,top:o?c(t.top):-1e3,width:o&&t.width+1!=t.width?c(t.width):0,height:o&&t.height+1!=t.height?c(t.height):0,aspectRatio:o&&!s?t.width/t.height:null})}};u.getCurrentViewInfo=function(){var t=this,n=t.children;return n.toggleArtView&&n.toggleArtView.get("selected")?t.model.getPrimaryViewInfo(t.f_y,"design"):e.doMy(t,"getCurrentViewInfo")};u.getUrlBase=function(){return this.f_g?this.get("urls").designRlvBase:e.doMy(this,"getUrlBase")};u.getRealviewParams=function(t){var n=this,i=e.doMy(n,"getRealviewParams");if(n.f_g){var s=n.children,o=function(e){var t=s[e];return t&&t.get("selected")},u=o("toggleArtView");return r.copyInto(i,{design:n.get("designId")},!o("toggleGrid")?{hide:"bleed,safe,visibleMask"}:u?null:{area_grid:"1"},t&&u?n.model.getDesignViewInfo(n.f_y):null,{wm:n.get(u?"watermarkDesign":"watermarkProduct")})}else return i};u.setHotspotState=function(e,t){var n=this,r=n.f_f[t.getName()];r&&r.set({over:e=="over"})};u.select=function(e,t,r){var i=this,s=e.length,o=i.f_f,u,a=r!==n;for(;--s>=0;){u=o[e[s].getName()];u&&u.set({selected:a})}i.set({f_Y:t})};u.syncDesignObjects=function(e,i,s){var o=this,u=e.length,a=-1,f=[],l=o.f_V,c=o.get("maxDim"),h=o.f_i,p={},d,v;if(!o.f_1){o.f_1=t;l.remove(l.itemWidgets);for(;++a<u;){v=e[a];d=v.name;f.push({html:(o.f_t_||(o.f_t_=r.Template.compile(o.web("hotspotTemplate").html(),{openerToken:"[%",closerToken:"%]"})))({itemWidgetName:d}),properties:{id:d},model:v,maxDim:c,selected:d in i,cssClassBase:o.f_u_,cssClassActive:o.f_v_,cssClassOver:o.f_w_})}for(var m=l.add(f),g=-1,y=m.length,b,w={"Changed.over":function(e){var t=e.source;o.fire({name:"Hotspot "+(t.get("over")?"Over":"Out"),hotspot:t})},"Changed.selected":function(e){var t=e.source;if(!t.get("selected")){o.fire({name:"Hotspot Unselected",hotspot:e.source});o.f_Z()}},"Click Selected":function(e){o.children.marquee.initiateDrag(e.domEvent)}};++g<y;){b=m[g];b.wire(w);b.updateModelView(h);p[b.get("properties").id]=b}o.f_f=p;o.set({f_Y:s});o.updateUi();o.f_1=n}};u.updateModelView=function(e){var t=this,n=t.f_V;t.set({f_i:e});n&&n.forAll(function(t){t.updateModelView(e)})};u.updateUi=function(){var t=this;if(t.isWired){var n=t.children,r=t.f_g;for(var i in{toggleButtonStrip:1,toggleArtView:1,toggleGrid:1,undo:1,redo:1,marquee:1}){var o=n[i];o&&o.displayNode("",r)}t.displayNode("dropzone",r);s.setState(t.getNode(),["",t.f_G_],r);if(r){t.f_$_();t.f_Z()}e.doMy(t,"updateUi")}};u.wireUi=function(){var n=this;if(!n.isWired){var r=n.getNode("viewPortShell"),i,o=function(e){clearTimeout(i);s.setState(r,["",n.f_L_],e)};n.wireNode(r,{mouseover:function(){o(t)},mouseout:function(){i=setTimeout(o,750)}});n.callInherited("wireNodeForDataTransfer")(n,n.getNode("dropzone"),n.get("urls").upload,function(e){e.length&&n.fire({name:"Add",properties:e})});e.doMy(n,"wireUi")}};o.stateProperties({f_M:"activeView",f_y:{name:"area",onChange:function(){var e=this;if(e.model){if(!r.isIn(e.model.getVisibleAreas(e+""),e.f_y)){var t=e.model.getPrimaryViewInfo(e.f_y,"product");if(t)e.set({value:t.name});else{}}if(e.children.toggleArtView.get("selected"))e.f_L()}}},f_Y:{name:"bounds",value:{},onChange:u.f_Z},f_O_:{name:"canRedo",onChange:function(){var e=this.children.redo;e&&e.set({enabled:!this.f_O_?n:"inherit"})},value:n},f_0:{name:"canSave",value:t},f_Q_:{name:"canUndo",onChange:function(){var e=this.children.undo;e&&e.set({enabled:!this.f_Q_?n:"inherit"})},value:n},f_v_:"cssClassHotspotActive",f_u_:"cssClassHotspotBase",f_w_:"cssClassHotspotOver",f_G_:"cssClassIsDesigning",f_N:"cssClassMarqueeHandle",f_O:"cssClassRotateHandle",f_L_:"cssClassViewPortShellOver",f_S_:{name:"hasDesignUi",conformer:function(e,t){return t||e},value:n},f_g:{name:"isDesigning",value:n},f_k_:{value:[]},f_i:"modelView",f_V_:{value:[]},f_W_:{onChange:u.f_Z}});return o}});Uize.module({name:"Uize.Widget.Resizer",required:["Uize.Node","Uize.Widget.Drag"],builder:function(e){"use strict";function u(e,t,n){var r=n[t];return r!=.5&&(r=="both"||!(t?e.d_j:e.d_k))}function a(){var e=this;if(e.isWired){for(var t in o){var r=o[t];e.children[t].set({enabled:u(e,0,r)||u(e,1,r)?"inherit":n})}}}function f(e){if(e.isWired&&!(e.d_o=e.d_p)){var t=r.getDimensions(e.getNode("shell"));if(t.width&&t.height)e.d_o=[0,0,t.width-1,t.height-1]}}function l(){var e=this;f(e);var t=e.d_o;if(t){e.d_s=[t[2]-t[0]+1,t[3]-t[1]+1];c.call(e)}}function c(){var e=this;if(e.isWired&&(!e.d_u||e.d_v)){f(e);if(e.d_o){var t=e.d_w,n=e.d_o,r=e.d_s,i=e.d_x,s=e.d_y,o=e.d_z,u=e.d_A,a,l,c=e.d_D;if(c!=null){a=o;l=u}else{a=Uize.constrain(o,e.d_E,t?r[0]:Infinity);l=Uize.constrain(u,e.d_F,t?r[1]:Infinity)}var h=t?Uize.constrain(i,n[0],n[2]-a+1):i,p=t?Uize.constrain(s,n[1],n[3]-l+1):s;if(h!=i||p!=s||a!=o||l!=u)e.set({d_x:h,d_y:p,d_z:a,d_A:l})}}}var t=true,n=false,r=Uize.Node,i=r.isIe,s=i&&document.compatMode!="CSS1Compat",o={northWest:[0,0],north:[.5,0],northEast:[1,0],west:[0,.5],move:["both","both"],east:[1,.5],southWest:[0,1],south:[.5,1],southEast:[1,1]};var h="updateUi",p=[h,a],d=[c,h];return e.subclass({alphastructor:function(){this.d_L={}},instanceMethods:{setPositionDuringDrag:function(e,t,n,r){var i=this;if(e!=i.d_x||t!=i.d_y||n!=i.d_z||r!=i.d_A){i.set({left:e,top:t,width:n,height:r});i.fire("Position Changed")}},getCoords:function(){var e=this;return{left:e.d_x,top:e.d_y,width:e.d_z,height:e.d_A}},initiateDrag:function(e){this.children.move.initiate(e)},updateUi:function(){var e=this;if(e.isWired){var o=t;Uize.forEach(e.d_O,function(u){var a=e.getNode(u);if(a){var f=function(e){return parseInt(r.getStyle(a,"border"+e+"Width"))||0},l=Math.max(e.d_z-(s?f("Left")+f("Right"):0),0),c=Math.max(e.d_A-(s?f("Top")+f("Bottom"):0),0);if(i)l==e.d_L[u]?e.displayNode("jiggler",e.d_W=!e.d_W):e.d_L[u]=l;r.setStyle(a,{left:e.d_x,top:e.d_y,width:l,height:c});if(Uize.isNumber(e.d_X)&&o){var h=e.d_X,p=h?"rotate("+Math.round(e.d_X)+"deg)":"",d=h?e.d_x+l/2+"px "+(e.d_y+c/2)+"px":"";e.setNodeStyle("",{mozTransformOrigin:d,webkitTransformOrigin:d,oTransformOrigin:d,msTransformOrigin:d,transformOrigin:d,mozTransform:p,webkitTransform:p,msTransform:p,oTransform:p,transform:p});o=n}}})}},wireUi:function(){var s=this;if(!s.isWired){var f,c,h,p,d=Uize.Widget.Drag,v=function(e){h=o[e];var r=s.addChild(e,d,{cursor:e=="move"?e:e.charAt(0)+e.match(/[A-Z]|$/)[0]+"-resize",dragRestTime:s.d_5,node:s.getNode(e),resizerInfo:{d_m:e,d_h:h}});r.wire({"Before Drag Start":function(e){s.fire(e)},"Drag Start":function(e){s.d_7=e.source;s.set({d_u:t});l.call(s);f=s.d_o;c=[f[2]/2,f[3]/2];p=[s.d_x,s.d_y,s.d_x+s.d_z-1,s.d_y+s.d_A-1];s.fire(e)},"Drag Update":function(){var e=s.d_D,t=s.d_7.resizerInfo,n=t.d_h,i=n.concat(),o=p.concat(),a=function(t){if(u(s,t,n)){var a=n[t],l=r.eventDeltaPos[t];if(a=="both"){if(s.d_w)l=Uize.constrain(l,f[t]-o[t],f[t+2]-o[t+2]);o[t]+=l;o[t+2]+=l}else{var c=t+a*2;o[c]+=l;if(s.d_w)o[c]=Uize.constrain(o[c],f[t],f[t+2]);if(e==null&&o[t]>o[t+2]){var h=o[t];o[t]=o[t+2];o[t+2]=h;i[t]=1-i[t]}}}};a(0);a(1);var l=[Math.max(o[2]-o[0]+1,s.d_E),Math.max(o[3]-o[1]+1,s.d_F)],h=[(o[0]+o[2])/2,(o[1]+o[3])/2];if(e!=null){if(l[0]/l[1]!=e){var d=[l[1]*e,l[0]/e],v=function(t,n){l[t]=d[t];if(s.d_w){l[t]=Math.min(l[t],n);l[1-t]=l[t]*Math.pow(e,t*2-1)}},m=function(e){v(e,(h[e]<c[e]?h[e]+.5:f[e+2]-h[e])*2)},g=function(e){v(e,(n[e]?f[e+2]-o[e]:o[e+2])+1)};if(n[0]==.5){m(0)}else if(n[1]==.5){m(1)}else if(l[1]*d[0]>l[0]*d[1]){g(0)}else{g(1)}}var y=function(e){if(!n[e]){o[e]=o[e+2]-l[e]+1}else if(n[e]==.5){o[e]=h[e]-(l[e]-1)/2}};y(0);y(1)}s.set({activeHandleEffectivePointIdX:i[0],activeHandleEffectivePointIdY:i[1]});s.setPositionDuringDrag(o[0],o[1],l[0],l[1])},"Drag Rest":function(e){s.fire(e)},"Drag Done":function(e){s.set({d_u:n});s.fire(e);s.set({d_v:n});s.updateUi()}})};for(var m in o)v(m);a.call(s);if(i){var g=s.getNode(s.d_O[0]);if(g){var y=document.createElement("div");y.id=s.get("idPrefix")+"-jiggler";r.setStyle(y,{position:"absolute"});g.appendChild(y)}}e.doMy(s,"wireUi");l.call(s)}}},stateProperties:{d_m_:"activeHandleEffectivePointIdX",d_n_:"activeHandleEffectivePointIdY",d_O:{name:"areaNodes",value:[""]},d_D:{name:"aspectRatio",onChange:h,value:null},d_w:{name:"constrain",value:t,onChange:c},d_p:{name:"constrainBounds",value:null,onChange:l},d_v:{name:"creatingNew",value:n},d_5:{name:"dragRestTime",onChange:function(){Uize.callOn(this.children,"set",[{dragRestTime:this.d_5}])},value:250},d_k:{name:"fixedX",onChange:p,value:n},d_j:{name:"fixedY",onChange:p,value:n},d_A:{name:"height",onChange:d,value:200},d_u:{name:"inDrag",value:n},d_x:{name:"left",onChange:d,value:0},d_F:{name:"minHeight",value:10,onChange:c},d_E:{name:"minWidth",value:10,onChange:c},d_X:{name:"rotation",onChange:d},d_y:{name:"top",onChange:d,value:0},d_z:{name:"width",onChange:d,value:200}},staticProperties:{pointIdsMap:o}})}});Uize.module({name:"Uize.Widget.Resizer.Marquee",required:"Uize.Node",builder:function(e){"use strict";function o(e){if(e.isWired){var t=e.get("inDrag"),n=e.get("creatingNew"),r=e.get("fixedX"),i=e.get("fixedY"),s=e.get("activeHandleEffectivePointIdX"),o=e.get("activeHandleEffectivePointIdY"),u=e.Class.pointIdsMap;for(var a in u){if(a!="move"){var f=u[a];e.displayNode(a,!n&&(!r||f[0]==.5)&&(!i||f[1]==.5)&&(!e.e_o||!t||f[0]==s&&f[1]==o))}}}}function u(e){if(e.isWired){var t=e.get("left"),n=e.get("top"),o=e.get("width")-1,u=e.get("height")-1,a=e.Class.pointIdsMap,f=e.e_u||s;for(var l in a){if(l!="move"){var c=a[l],h=e.getNode(l),p=r.getDimensions(h),d=f[l]||i;r.setStyle(h,{left:t+c[0]*o-(p.width-1)*d[0],top:n+c[1]*u-(p.height-1)*d[1]})}}}}function a(e){var t=!!e.e_z;if(e.isWired&&t){var n=e.getNode("rotate");e.displayNode(n,t);e.children.rotate.set({node:n})}}var t=true,n=false,r=Uize.Node,i=[.5,.5],s={};return e.subclass({alphastructor:function(){function t(){o(e);u(e)}var e=this;e.wire({"Changed.inDrag":t,"Changed.creatingNew":t,"Changed.fixedX":t,"Changed.fixedY":t,"Changed.activeHandleEffectivePointIdX":t,"Changed.activeHandleEffectivePointIdY":t})},instanceMethods:{updateUi:function(){var t=this;if(t.isWired){e.doMy(t,"updateUi");u(t);a(t)}},wireUi:function(){var n=this;if(!n.isWired){if(n.e_C){var i=n.getNode("shell"),s=function(e){if(n.get("enabledInherited")){e||(e=event);var s=n.get("aspectRatio")==null?"northWest":"southEast",o=r.getCoords(i),u=r.getEventAbsPos(e);n.set({creatingNew:t});n.setPositionDuringDrag(u.left-o.left,u.top-o.top,n.get("minWidth"),n.get("minHeight"));return n.children[s].initiate(e)}};r.setStyle(i,{cursor:"crosshair"});n.wireNode(i,{mousedown:s,touchstart:s})}e.doMy(n,"wireUi");o(n)}}},stateProperties:{e_z:{name:"canRotate",onChange:function(){var e=this;if(e.e_z&&!e.children.rotate)Uize.require("Uize.Widget.Drag",function(i){var s,o,u,f;e.set({rotation:0});e.addChild("rotate",i).wire({"Before Drag Start":function(n){var i=r.getCoords(e.getNode("rotate")),a=r.getCoords(e.getNode(e.get("areaNodes")[0]));s=e.get("rotation");o=a.x+a.width/2;u=a.y+a.height/2;f=Math.atan(Math.abs((u-(i.y+i.height/2))/(i.x+i.width/2-o)))*180/Math.PI;if(i.x<o)f=180-f;if(i.y>u)f*=-1;e.set({inDrag:t});e.fire(n)},"Drag Update":function(r){if(!e.e_P){e.e_P=t;var i=r.source.get("eventPos"),a=Math.atan(Math.abs((u-i[1])/(i[0]-o)));if(i[0]<o)a=Math.PI-a;if(i[1]>u)a*=-1;e.set({rotation:s+f+a*-180/Math.PI});e.e_P=n}},"Drag Done":function(t){e.set({inDrag:n});e.fire(t)}});a(e)});else a(e)}},e_u:"handlesAlign",e_S:"handleCssClass",e_o:{name:"hideOtherHandlesInDrag",value:t},e_T:"rotateCssClass",e_C:{name:"shellLive",value:t}},set:{areaNodes:["move","border"],html:{process:function(e){function t(t){return'<img id="'+e.idPrefix+"-"+t+'" src="'+e.blankGif+'"'+(e.handleCssClass?' class="'+e.handleCssClass+'"':"")+' style="position:absolute; z-index:1000; display:none;'+(e.handleCssClass?"":" width:19px; height:19px; background:#888; border:1px solid #fff; opacity:.5; filter:alpha(opacity=50);")+'"/>'}return'<div id="'+e.idPrefix+'-border" style="position:absolute; left:0px; top:0px; width:200px; height:200px; border:1px solid #000; background:url('+e.blankGif+'); z-index:999;">'+'<a href="javascript://" id="'+e.idPrefix+'-rotate"'+(e.rotateCssClass?' class="'+e.rotateCssClass+'"':"")+' style="display:none;position:absolute;'+(e.rotateCssClass?"":"right:-30px;top:-30px;width:18px;height:18px;background:#000")+';"></a>'+"</div>"+'<a id="'+e.idPrefix+'-move" href="javascript://" style="display:block; position:absolute; left:0px; top:0px; width:200px; height:200px; border:1px dashed #fff; z-index:1000; background:url('+e.blankGif+');"></a>'+t("northWest")+t("north")+t("northEast")+t("west")+t("east")+t("southWest")+t("south")+t("southEast")}},nodeMap:{shell:""}}})}});Uize.module({name:"ZazzleWww.DesignObjectHotspot",superclass:"Uize.Widget.CollectionItem",builder:function(e){"use strict";var t=true,n=false,r=null,i;var s=e.subclass(),o=s.prototype;o.getCoords=function(){var e=this,t=e.e_f,n=e.e_g,r=e.e_h,s=r&&r.opts?r.opts.max_dim:i,o;if(t&&n&&r){var u=t.getBounds(r),a=u[0].y,f=u[0].x,l=Uize.isNumber(n)&&Uize.isNumber(s),c=function(e){return l?e/s*n:e};o={top:c(a),left:c(f),width:c(u[1].x-f),height:c(u[1].y-a)}}return o||{}};o.updateModelView=function(e){this.set({e_h:e});this.e_r()};o.wireUi=function(){var r=this;if(!r.isWired){r.wireNode("",{mousedown:function(e){r.e_f.isLocked()||r.fire({name:"Click Selected",domEvent:e,forceToggle:!!r.get("selected")});e.cancelBubble=t;return n}});e.doMy(r,"wireUi")}};o.updateUi=function(){var t=this;if(t.isWired){t.e_r();e.doMy(t,"updateUi")}};o.e_r=function(){var e=this;e.isWired&&e.setNodeStyle("",e.getCoords())};s.stateProperties({e_f:{name:"model",onChange:o.e_r},e_g:{name:"maxDim",onChange:o.e_r,value:700},e_h:{}});return s}});Uize.module({name:"Zazzle.ProductOptionMetaInfo",superclass:"Zazzle.Widget",builder:function(e){"use strict";var t=e.subclass(),n=t.prototype;n.e_b=function(){var e=this,t=e.e_c;if(e.isWired){e.web().display(t&&e.e_d);if(t&&e.e_d){var n=e.e_d||{},r=function(t,n,r,i){i=i||t[r];e.web(n+Uize.capFirstChar(r)).display(!!i).html(i)};for(var i=-1;++i<t.length;){var s=t[i],o=n[s],u=o&&(o.description||o.summary);e.web(i+"").display(!!u);if(u){r(o,i,"displayName");r(o,i,"description",u)}}}}};n.updateUi=function(){var t=this;if(t.isWired){t.e_b();e.doMy(t,"updateUi")}};t.stateProperties({e_c:"attributes",e_l:"value",e_d:{name:"valueDetails",onChange:n.e_b}});return t}});Uize.module({name:"Uize.Widget.FormWarnings",required:"Uize.Template",builder:function(e){"use strict";var t=false,n=Uize,r=function(e){var t=this,r=t.d_d;if(r&&r.length){if(!e)e=r;else if(!n.isArray(e))e=[e];var i={};for(var s=-1;++s>e.length;){var o=e[s];i[o.get("idPrefix")]=o}for(var u=-1;++u<r.length;){var a=r[u],f=a.get("idPrefix");i[f]&&a.unwire(t.d_k[f])}}},i=function(){var e=this,t=e.d_m;if(e.isWired){e.setNodeInnerHtml("toggleCollapsed",e.localize(t?"showLinkText":"hideLinkText"));e.displayNode("warnings",!t)}},s=function(){var e=this;if(e.isWired&&e.d_o){var r=[],i=0;while(true){var s="message"+i,o=e.getNode(s);e.flushNodeCache(s);if(o)e.unwireNode(o,"click");else break;i++}(function u(e){for(var n=-1;++n<e.length;){var i=e[n],s=i.get("warningMessage");if(i.get("isValid")==t){if(i.isForm)u(i.getFormElement());else if(s)r.push(i)}}})(e.d_d);e.setNodeInnerHtml("warnings",e.d_o({warningElements:r}));n.forEach(r,function(n,r){function i(e){n.set({focused:e})}e.wireNode("message"+r,{mouseover:function(){i(true)},mouseout:function(){i(t)}})})}};return e.subclass({alphastructor:function(){this.d_k={};this.d_d=[]},instanceMethods:{d_b:r,d_l:i,d_n:s,d_B:function(e){function n(){t.d_n()}var t=this;var r={"Changed.warningShown":n,"Changed.warningMessage":n};e.wire(r);t.d_k[e.get("idPrefix")]=r},addWatchedElements:function(e){var t=this,r=t.d_d||[],i=n.isArray(e)?e:[e],s=i.length,o=-1;for(;++o<s;){var u=i[o];r.push(u);t.d_B(u)}t.d_d=r;t.fire("Changed.watchedElements")},removeWatchedElements:r,updateUi:function(){var t=this;if(t.isWired){t.d_n();t.d_l();e.doMy(t,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){var r=t.getNode("template");if(r)t.d_o=n.Template.compile(r.innerHTML,{openerToken:"[%",closerToken:"%]"});t.wireNode("toggleCollapsed","click",function(){t.toggle("collapsed")});e.doMy(t,"wireUi")}}},stateProperties:{d_m:{name:"collapsed",onChange:i,value:t},d_H:{name:"shown",onChange:function(){var e=this,t=e.d_H===true;if(e.isWired){e.displayNode("",t);t&&e.d_n()}},value:t},d_d:{name:"watchedElements",conformer:function(e){this.d_b(this.d_d);return e},onChange:function(){var e=this;n.forEach(e.d_d,function(t){e.d_B(t)});e.d_n()}}}})}});Uize.module({name:"Zazzle.RatingContinuous",superclass:"Uize.Widget",builder:function(e){"use strict";var t=e.subclass(),n=t.prototype;n.updateUi=function(){var t=this;if(t.isWired){var n=+t.d_c,r=Math.floor(n),i=n-r;for(var s=0;s<t.d_g;s++){t.setNodeStyle("star"+s,{width:(s<r?100:s==r?Math.round(i*100):0)+"%"});t.setNodeProperties("shell"+s,{title:t.d_h})}e.doMy(t,"updateUi")}};t.stateProperties({d_c:{name:"value",onChange:n.updateUi},d_g:"outOf",d_h:"tooltip"});return t}});Uize.module({name:"Zazzle.OverallReviewRating",superclass:"Uize.Widget",required:"Zazzle.RatingContinuous",builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize;var s=e.subclass(r,function(){this.addChild("rating",Zazzle.RatingContinuous)}),o=s.prototype;o.wireUi=function(){var r=this;if(!r.isWired){r.wireNode("detailLabel","click",function(){if(r.d_f=="MoreReviewsDialog"){var e="OnProductType",i=r.d_i,s=n,o;if(r.d_l=="OnProduct"&&r.d_m>0){e="OnProduct";i=r.localize("moreReviewsTitle",{product:r.d_n})}o=e=="OnProductType"?"Good":"Low";r.callInherited("useDialog")({component:{name:"Zazzle.Dialog.MoreReviews",params:{reviewsSet:e,pd:r.d_o,qualifiedType:r.d_p,unqualifiedType:r.d_q,productAttributes:r.d_r,isPublic:r.d_s,privateView:r.d_t,reviewQuality:o}},widgetProperties:{parent:r,name:"moreReviews",title:i}})}else if(r.d_f=="ReviewHash"){Uize.require("Uize.Fx.Scroll",function(e){e.scrollToNode(r.d_v);r.fire({name:"Track Event",bubble:t,extra:{ax:"scrollreviews",pd:r.d_o}})})}else if(r.d_f=="ReviewForm"){r.callInherited("ensureLoggedIn")({callback:function(e){r.ajax({serviceUrl:"/svc/product/productreviews/canreview",mbr:r.getInherited("user").id,pt:r.d_q,atts:r.d_r},function(e){var t=e.data;r.d_z=t.hasOthers;r.d_A=t.goToForm;r.d_B=t.reviewUrl;if(r.d_A){location.href=r.d_B}else{var n=r.localize("message")+"<br /><br />";r.d_z&&(n+='<a href="'+r.get("urls").productsToReviewUrl+'">'+r.localize("linkMessage")+"</a>");r.inform({title:r.localize("title"),message:n,state:"info"})}})}})}});e.doMy(r,"wireUi")}};o.reset=function(){var e=this;if(e.isWired){e.d_k="Low";e.ajax({serviceUrl:"/svc/product/productreviews/readptpdreviews",pg:1,ps:5,callerId:e.getInherited("user").id,pd:e.d_o,pt:e.d_p,atts:e.d_r,isPublic:e.d_s,privateView:e.d_t,minRating:0},{cache:"memory",callbackSuccess:function(t){if(t.success){var n=t.data,r=n.pdResults,i=n.ptResults;e.d_m=r.numResults;e.d_F=i.numResults;e.d_G=r.avgRating;e.d_H=i.avgRating;e.d_I=r.avgRatingDisplay;e.d_J=i.avgRatingDisplay;e.d_i=i.similarReviewsTitle;e.d_K()}}})}};o.d_K=function(){var e=this;if(e.isWired){e.d_L=0;if(e.d_l=="OnProduct"){e.d_L=e.d_m}else if(e.d_l=="OnProductType"){e.d_L=e.d_F}e.d_M=0;e.d_N="0";if(e.d_l=="OnProduct"){e.d_M=e.d_G;e.d_N=e.d_I;if(!(e.d_m>0)&&e.d_O=="ShowFilledPtStars"){e.d_M=e.d_H;e.d_N=e.d_J}}else if(e.d_l=="OnProductType"){e.d_M=e.d_H;e.d_N=e.d_J}var r=e.d_M>0?e.localize("xStarsTooltip",{num:e.d_N}):e.localize("noReviewsTooltip");e.children.rating.set({tooltip:r,value:e.d_M});if(e.d_l=="OnProduct"){if(e.d_F==0&&e.d_m==0){e.d_f="ReviewForm"}else{e.d_f=e.d_Q=="MoreReviewsDialog"?"MoreReviewsDialog":"ReviewHash"}}else if(e.d_l=="OnProductType"){if(e.d_F>0){e.d_f=e.d_Q=="MoreReviewsDialog"?"MoreReviewsDialog":"ReviewHash"}else{e.d_f="ReviewForm"}}var i="";i+=e.d_S&&e.d_f!="ReviewForm"&&e.d_M>0?e.d_N+"  ":"";i+='<a id="'+e.get("idPrefix")+'-reviewLabel" href="javascript://">';if(e.d_f=="ReviewForm")i+=e.localize("writeAReview");else if((e.d_f=="ReviewHash"||e.d_f=="MoreReviewsDialog")&&e.d_m==0&&e.d_l=="OnProduct"&&e.d_O=="ShowFilledPtStars"){i+=e.localize(e.d_T?"xReviewsForStyle":"xReviews",{num:e.d_F});e.d_k="Good"}else if((e.d_f=="ReviewHash"||e.d_f=="MoreReviewsDialog")&&e.d_l=="OnProductType"){i+=e.localize(e.d_T?"xReviewsForStyle":"xReviews",{num:e.d_F});e.d_k="Good"}else if((e.d_f=="ReviewHash"||e.d_f=="MoreReviewsDialog")&&e.d_m==0){i+=e.localize(e.d_T?"xReviewsForStyle":"readOtherReviews",{num:e.d_F});e.d_k="Good"}else if((e.d_f=="ReviewHash"||e.d_f=="MoreReviewsDialog")&&e.d_l=="OnProduct")i+=e.localize("xReviews",{num:e.d_L});else if((e.d_f=="ReviewHash"||e.d_f=="MoreReviewsDialog")&&e.d_l=="OnProductType")i+=e.localize(e.d_T?"xReviewsForStyle":"xReviews",{num:e.d_L});i+="</a>";e.setNodeInnerHtml("detailLabel",i);if(e.d_O=="DisplayNone"&&e.d_l=="OnProduct"&&e.d_m==0)e.displayNode("",n);else if(e.d_O=="DisplayNone"&&e.d_l=="OnProduct"&&e.d_m>0)e.displayNode("",t);if(e.d_U=="DisplayNone"&&e.d_l=="OnProductType"&&e.d_F==0)e.displayNode("",n);else if(e.d_U=="DisplayNone"&&e.d_l=="OnProductType"&&e.d_F>0)e.displayNode("",t)}};s.stateProperties({d_r:{name:"attributes",onChange:o.reset},d_z:"canReviewItems",d_A:"canReviewThis",d_f:"detailAction",d_V:"displayName",d_s:"isPublic",d_O:"noPdReviewsFallbackAction",d_U:"noReviewsFallbackAction",d_Q:"hasReviewsDetailAction",d_F:"numPtReviews",d_m:"numPdReviews",d_L:"numReviews",d_W:"outOf",d_t:"privateView",d_X:{name:"productTypeDisplayName",value:""},d_B:"reviewFormUrl",d_k:"reviewQuality",d_l:"reviewsSet",d_o:"rootId",d_p:"qualifiedType",d_v:"scrollToNodeId",d_S:"showValue",d_i:"similarReviewsTitle",d_n:"productTitle",d_q:"unqualifiedType",d_T:"useStyleText",d_G:"valuePdReviews",d_H:"valuePtReviews",d_I:"valueDisplayPdReviews",d_J:"valueDisplayPtReviews",d_M:"value",d_N:"valueDisplay"});return s}});Uize.module({name:"Uize.Widget.FormElements",required:"Uize.Widget.FormElement",builder:function(e){"use strict";var t=e.subclass();t.prototype.addChild=function(t,n,r){var i=this,s=i.parent,o=e.doMy(i,"addChild",[t,n||Uize.Widget.FormElement,Uize.copyInto({value:s?(i.parent.get("value")||{})[t]:null},r)]);i.fire({name:"Element Added",element:o});return o};return t}});Uize.module({name:"Uize.Widget.Committer",required:"Uize.Widget.Button",builder:function(e){"use strict";function r(e){if(e.d_c)clearTimeout(e.d_c)}function i(e,t){var n=e.d_f,r=e.d_g,i=e.get(t+"Values"),s;for(var o in r){var u=n[o];u.instance.set(u.name,i&&i[o]!=s?i[o]:"")}}function s(e){var r=t,i=t,s=n,o=n,u=e.d_g,a=e.d_q,f=e.d_r,l=e.d_f;for(var c in u){var h=l[c].instance;if(!e.d_t||h.get("enabledInherited")!==n){var p=a[c];if(!s)s=p!==u[c];if(!o)o=p!==f[c];if(i)i=p=="";if(r)r=h.get("isValid")===t}}e.set({d_n:i,d_m:r,d_o:s,d_p:o,d_v:s&&r})}function o(e,t,n){function u(){s(e)}var i=n.instance,o=n.name;i.wire("Changed."+o,function(){e.d_q[t]=i.get(o);e.fire("Changed.uncommittedValues");s(e);if(e.d_v&&e.d_A){r(e);e.d_c=setTimeout(function(){e.commit()},e.d_A)}});i.wire({"Changed.isValid":u,"Changed.enabledInherited":u})}var t=true,n=false;return e.subclass({alphastructor:function(){var e=this,t=Uize.Widget.Button.addChildButton;e.d_c;e.d_C=t.call(e,"commit",function(){e.commit()});e.d_D=t.call(e,"clearAll",function(){e.clearAll()});e.d_E=t.call(e,"restoreInitial",function(){e.restoreInitial()});e.d_F=t.call(e,"restorePrevious",function(){e.restorePrevious()})},instanceMethods:{clearAll:function(){i(this,"clear")},commit:function(){var e=this;r(e);if(e.d_v){e.set({d_g:Uize.copy(e.d_q)});e.fire("Commit");s(e)}},addWatchedProperties:function(e){var t=-1,n=e?e.length:0,r=this,i={},u={},a={},f={};for(;++t<n;){var l=e[t];if(l){var c=l.alias,h=l.name,p=l.instance,d={instance:p,name:h};f[c]=d;o(r,c,d);i[c]=u[c]=a[c]=p.get(h)}}Uize.copyInto(r.d_f||(r.d_f={}),f);r.set({d_g:Uize.copy(r.d_g,i),d_q:Uize.copy(r.d_q,u),d_r:Uize.copy(r.d_r,a)});s(r);r.fire({name:"Watched Properties Added",properties:f})},removeWatchedProperties:function(e){var t=-1,n={},r=e?e.length:0,i=this,o=i.d_g,u=i.d_r,a=i.d_q,f=i.d_f;for(;++t<r;){var l=e[t],c=f[l];if(c){var h=c.instance;h.unwire("Changed.isValid");h.unwire("Changed.enabledInherited");h.unwire("Changed."+c.name);delete f[l];delete o[l];delete a[l];delete u[l];n[l]=c}}s(i);i.fire({name:"Watched Properties Removed",properties:n})},restoreInitial:function(){i(this,"initial")},restorePrevious:function(){i(this,"committed")}},stateProperties:{d_n:{name:"allClear",onChange:function(){this.d_D.set({enabled:this.d_n?n:"inherit"})},value:n},d_m:{name:"allValid",value:n},d_p:{name:"anyNotInitial",onChange:function(){this.d_E.set({enabled:this.d_p?"inherit":n})},value:n},d_o:{name:"anyNotCommitted",onChange:function(){this.d_F.set({enabled:this.d_o?"inherit":n})},value:n},d_A:"autoCommitDelay",d_g:{name:"committedValues",value:{}},d_t:{name:"ignoreDisabled",onChange:function(){s(this)},value:n},d_r:{name:"initialValues",value:{}},d_v:{name:"readyToCommit",onChange:function(){this.d_C.set({enabled:this.d_v?"inherit":n})},value:n},d_q:{name:"uncommittedValues",value:{}},d_f:{name:"watchedProperties",onChange:function(){var e=this,t=e.d_f,n={},r={},i={};if(t)for(var u in t){var a=t[u];n[u]=r[u]=i[u]=a.instance.get(a.name);o(e,u,a)}e.set({d_g:n,d_r:i,d_q:r});s(e)}}}})}});Uize.module({name:"Uize.Data.Compare",builder:function(){"use strict";var e=Uize.Data;return Uize.package({identical:e.identical,conjoined:e.conjoined,clones:e.clones,intersection:e.intersection})}});Uize.module({name:"Uize.Widget.Form",required:["Uize.Widget.FormElements","Uize.Widget.FormElement","Uize.Widget.Committer","Uize.Widget.FormWarnings","Uize.Widget.Button","Uize.Node","Uize.Dom.Event","Uize.Data.Compare","Uize.Widget.mDeclarativeChildren","Uize.Widget.mEventBindings"],builder:function(e){"use strict";var t=true,n=false,r=null,i,s=Uize,o=s.Widget,u=s.Data.Compare.identical,a="never",f="valueChanged",l="validated",c="finished",h="validatedAfterFirstFinish",p=function(){var e=this,t=e.d_m,r=e.d_o(),i=e.d_q;e.set({d_q:e.d_r&&e.d_s==n&&(r?r.get("warningShown"):e.d_t&&(t==l||t==c&&(e.d_u||i)||t==h&&(e.d_v||i)))})},d=function(){this.d_w("restoreInitial")},v=function(){this.set({d_y:t,d_u:t,d_z:!this.d_A})},m=function(){var e=this;if(e.isWired){e.setNodeProperties("form",{action:e.d_C,enctype:e.d_D,method:e.d_E,target:e.d_F})}},g=function(){this.set({d_A:this.d_z&&this.d_s})},y=function(){var e=this,t=e.d_I,r=e.d_q;if(e.isWired){if(t){t.set({shown:r});if(r&&e.isWired){e.displayNode("serverWarnings",n);if(e.d_J){var i=t.getNode();i&&Uize.require("Uize.Fx.Scroll",function(e){e.scrollToNode(i)})}}}}},b=function(){var e=this,t=e.d_N;e.set({d_O:s.copy(e.d_O,t.get("committedValues"),t.get("uncommittedValues"))})},w=function(){this.set({d_s:this.d_N.get("allValid")})};return e.subclass({mixins:[o.mDeclarativeChildren,o.mEventBindings],alphastructor:function(){this.isForm=this.d_Q=t},children:{committer:{widgetClass:o.Committer,ignoreDisabled:t},elements:o.FormElements,formWarnings:o.FormWarnings,submit:o.Button},omegastructor:function(){var e=this,r=e.children,o=e.d_S=r.elements,u=o.children,a=o.addedChildren,f=function(r){var o=u[r];o.wire({"Changed.isDirtyInherited":function(n){n.newValue&&e.set({d_y:t})},Ok:function(){e.d_x()},"Changed.focused":function(t){if(!t.newValue)e.d_Z(function(e,t,n){if(!n){var r=e.getNodeValue("input");r!==i&&e.valueOf()!=r&&e.get("placeholder")!=r&&e.set({value:r})}});else e.set({d_z:n})},"Changed.tentativeValue":function(){e.set({d_z:n});e.set({d_3:s.copy(e.d_3,s.pairUp(o.get("name"),o.get("tentativeValue")))})}});if(o.isForm){o.set({d_4:n});o.wire("Changed.isSubmitting",function(t){t.newValue&&e.d_x()})}e.d_I.addWatchedElements(o);e.d_N.addWatchedProperties([{alias:o.get("name"),instance:o,name:"value"}])},l=function(e){s.forEach(e,function(e,t){e&&f(t)})};e.d_N=r.committer;e.d_I=r.formWarnings;l(a.get());o.addedChildren.wire("Changed.*",function(e){l(e.properties)});e.d_8=t},instanceMethods:{d_9:function(e,t,n){return this.d_S.addChild(e,t,n)},d_l:p,d_Z:function(e){if(this.d_S){var t=this.d_S.children;for(var r in t){var i=t[r];if(e(i,i.get("name"),i.isForm)===n)break}}},d_o:function(){var e=this.parent,t;if(e&&e.parent){t=e.parent;if(!t.isForm)t=r}return t},d_w:function(e){var t=this;t.set({d_v:n,d_z:n,d_y:"inherit"});t.d_Z(function(e){e.restore()});t.d_N[e]()},d_x:v,d_B:m,d_M:b,d_H:y,d_P:w,addForm:function(e,t,n){return this.d_9(e,t||o.Form,n)},addFormElement:function(e,t,n){return this.d_9(e,t||o.FormElement,n)},checkIsEmpty:function(){var e=this.d_S.children,r=t;if(e){for(var i in e){if(!e[i].get("isEmpty")){r=n;break}}}return r},checkWarningShown:p,clear:function(){this.d_w("clearAll")},getFormElement:function(e){var t;if(this.d_S){var n=this.d_S.children;t=e==i?s.values(n):n[e]}return t},removeFormElement:function(e){var t=this,n=t.d_O,r=t.d_S,i=t.d_N,o=t.d_I,u=t.getFormElement(e),a=s.isArray(u)?u:[u];s.forEach(a,function(e){if(e){var t=e.get("name");delete n[t];i.removeWatchedProperties([t]);o.removeWatchedElements(e);e.removeUi();r.removeChild(e)}})},reset:d,restore:d,submit:v,updateUi:function(){var t=this;if(t.isWired){t.d_B();t.d_H();t.d_Z(function(e){e.updateUi()});e.doMy(t,"updateUi")}},validate:w,wireUi:function(){var t=this;if(!t.isWired){var n=t.getNode("form");if(n){var i=function(e){return e==r};if(i(t.d_C))t.d_C=n.action;if(i(t.d_D))t.d_D=n.enctype;if(i(t.d_E))t.d_E=n.method;if(i(t.d_F))t.d_F=n.target;t.wireNode(n,"submit",function(e){s.Dom.Event.abort(e);t.d_x()})}e.doMy(t,"wireUi");t.d_M();t.d_P()}}},stateProperties:{d_C:{name:"action",onChange:m},d_D:{name:"enctype",onChange:m},d_j_:{name:"isEmpty",value:t},d_y:{name:"isDirty",onChange:function(){var e=this,t=e.d_o(),r=e.d_y=="inherit"?t?t.get("isDirtyInherited"):n:e.d_y;e.set({d_t:r})},value:"inherit"},d_t:{name:"isDirtyInherited",onChange:p,value:n},d_u:{name:"isFinished",onChange:[function(){var e=this;if(e.d_u){e.d_q_==c&&e.d_P();!e.d_v&&e.d_8&&e.set({d_v:t})}else e.set({d_v:n})},p],value:t},d_z:{name:"isSubmitting",onChange:[function(){var e=this;e.d_z&&e.d_N&&e.d_N.commit()},p,g],value:n},d_s:{name:"isValid",onChange:[function(){var e=this;e.d_s==n&&e.set({d_z:n})},p,g],value:n},d_E:{name:"method",onChange:m},d_A:{name:"okToSubmit",onChange:function(){var e=this;if(e.d_A&&e.d_4){var t=e.getNode("form");t&&t.submit()}},value:n},d_J:{name:"scrollToWarnings",value:t},d_F:{name:"target",onChange:m},d_3:{name:"tentativeValue",conformer:function(e){return u(e,this.d_3)?this.d_3:e},value:r},d_4:{name:"useNormalSubmit",value:t},d_q_:{name:"validateWhen",value:f},d_O:{name:"value",conformer:function(e){return u(e,this.d_O)?this.d_O:e},onChange:function(){var e=this;e.set({d_3:s.clone(e.d_O)});if(e.d_S){var t=e.d_S.children,r=e.d_O||{};for(var i in r){var o=t[i];o&&o.set({value:r[i]})}e.set({d_z:n,d_u:n,d_j_:e.checkIsEmpty()});e.d_q_==f&&e.d_P()}}},d_s_:{name:"warningAllowed",onChange:function(){var e=this,n=e.d_o(),r=e.d_s_=="inherit"?n?n.get("warningAllowedInherited"):t:e.d_s_;e.set({d_r:r})},value:"inherit"},d_r:{name:"warningAllowedInherited",onChange:p,value:n},d_q:{name:"warningShown",onChange:[function(){var e=this;e.d_Z(function(e){e.checkWarningShown()})},y],value:n},d_m:{name:"warningShownWhen",onChange:p,value:h},d_v:{onChange:p,value:n}},eventBindings:{committer:{"Changed.committedValues":b,"Changed.uncommittedValues":b,"Changed.allValid":w},"submit:Click":function(){this.d_x()}}})}});Uize.module("Zazzle.Util");Uize.module({name:"Zazzle.Util.ProductAttributes",builder:function(){"use strict";return Uize.package({shrinkValues:function(e,t,n){var r=e.length;if(t!=undefined&&t<r){var i=[],s=t,o=false,u=-1,a;for(var f=-1;++f<r;){var l=e[f];if(l.name==n){u=f;a=l;break}}if(u>=t&&s>0&&a){i.push(a);s--;o=true}for(f=0;f<s&&f<r;f++){if(u!=f||!o)i.push(e[f])}e=i}return e}})}});Uize.module({name:"Zazzle.ProductAttributeUi",superclass:"Uize.Widget.FormElement",required:["Uize.Url","Uize.Json","Zazzle.Util.ProductAttributes","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=true,n=false,r=Uize,i,s=function(){var e=this,t=e.e_e,n=e.children.picker;if(t&&e.e_g){var s=t.values,o=r.clone(s),u=function(e){var n;if(e!=i&&o)n=r.findRecord(o,{name:e})||r.findRecord(o,{name:t.defaultValue})||(o.length?o[0]:i);return n};var a=e.valueOf(),f=u(a),l=f?f.valueDetails:i,c=l!==i;if(c)e.set({e_o:l});var h=r.copyInto({value:l?l.name:a},c?{valueDetails:l}:i);n?n.set(r.copyInto({inputWidgetProperties:{values:Zazzle.Util.ProductAttributes.shrinkValues(o,e.e_r,a),allValues:s}},h)):e.set(h)}},o=function(){var e=this,t=e.e_e,n=e.children.picker;if(e.isWired&&t&&n){var r=t.values;if(r!=i){var s=r.length;e.web().display(e.e_v<s);n.set({count:s})}}};return e.subclass({mixins:r.Widget.mWeb,omegastructor:function(){var e=this,s=e.e_w?e.addChild("picker",e.e_w,e.e_x):null,o=n,u=function(t){return e.getInherited(t)},a=function(e){return Uize.Url.toParams(e)};e.e_g=t;e.e_d();s&&s.wire({"Changed.value":function(){o=t;e.set({value:s.valueOf()});o=n},"Changed.valueDetails":function(){e.set({e_o:s.get("valueDetails")})},"Changed.focused":function(){e.set({focused:s.get("focused")})},"Changed.tentativeValue":function(){e.set({tentativeValue:s.get("tentativeValue")})}});e.wire({"Changed.value":function(){var t=e.valueOf();s&&s.set({value:t});if(e.e_e&&t&&(!e.e_n||e.e_n.name!=t)){var n=r.findRecord(e.e_e.values,{name:t});e.set(r.copyInto({e_n:n},n?{valueDetails:n.valueDetails}:null))}e.fire({name:"Value Changed",allowRefresh:!o})},"Changed.valueDetails":function(){s&&s.set({valueDetails:e.e_o})},"Launch Full Dialog":function(t){var n=u("productType"),s=e.get("elementName");e.callInherited("useDialog")({component:{name:"Zazzle.Dialog.ProductAttributeUi",params:{pt:n,op:s,pd:u("productId")||n,experience:u("experience"),section:u("section"),ta:a(u("templateParams")),attributeDependencyInfo:r.Json.to(u("dependencyGraph"),"miniStrict"),mu:u("markup"),sf:u("skuFilter"),skuFilterUseType:u("skuFilterUseType"),po:a(u("productOption")),view:u("view"),accd:u("accessoryId"),ppd:u("parentProductId"),patt:a(u("parentProductOption")),ver:u("version")}},widgetProperties:{name:"productAttributeUiDialog",value:e.valueOf(),productType:e.e_E,attributeName:s,pickerWidgetProperties:{filter:t.filter},title:t.label},submitHandler:function(t,n){setTimeout(function(){t&&!n.keepOpen&&e.set(Uize.copyInto({value:t.value},t.valueDetails!==i?{e_o:t.valueDetails}:i))},0)}})},"Help Clicked":function(){if(e.e_I){e.callInherited("launchPopup")({url:e.e_I,name:"helpPopup"})}else{var t=u("productType");e.callInherited("useDialog")({component:{name:"Zazzle.Dialog.ProductAttributeHelp",params:{pt:t,op:e.get("elementName"),pd:u("productId")||t,po:Uize.Url.toParams(u("productOption"))}},widgetProperties:{name:"attributeHelpDialog"}})}}})},instanceMethods:{e_d:s,e_s:o,updateUi:function(){var t=this;if(t.isWired){var n=t.children.picker;t.e_s();n&&n.updateUi();e.doMy(t,"updateUi")}}},stateProperties:{e_e:{name:"attributeInfo",onChange:[o,s]},e_F:"attributeName",e_K:"defaultValue",e_L:"forceSelection",e_I:"helpUrl",e_v:{name:"hideUiWhen",onChange:o,value:0},e_w:"pickerWidgetClass",e_x:{name:"pickerWidgetProperties",onChange:function(){var e=this.children.picker;e&&e.set(this.e_x)}},e_r:"quantity",e_o:"valueDetails"}})}});Uize.module({name:"Zazzle.ProductAttributesUi",superclass:"Uize.Widget.Form",required:["Zazzle.ProductAttributeUi","Uize.Widget.Button","Uize.Node.Classes"],builder:function(e){"use strict";var t=true,n=false,r=Uize,i=r.Node.Classes,s;var o=e.subclass(null,function(){var e=this,o=Zazzle.ProductAttributeUi;r.forEach(e.e_g,function(n,r){var i=e.addFormElement("attributeUi"+n,o);i.wire("Changed.value",function(){!e.e_k&&e.fire({name:"Attribute Value Changed",attributeName:r,value:i.valueOf(),bubble:t})})});e.addChild("toggleUiCollapsed",r.Widget.Button).wire("Click",function(){e.toggle("uiCollapsed")});e.wire({"Attributes Updated":function(i){var o=i.productOption,u=i.attributesInfo,a=e.e_g;e.set({e_k:t});r.forEach(i.changedAttributes,function(t){var n=a[t],r=e.e_p(n);if(n!=s)r.set({value:!r.get("forceSelection")||r.valueOf()!=null?o[t]:null,attributeInfo:u[t]})});e.set({e_k:n})},Highlight:function(t){if(e.isWired){var n=function(){i.addClass(e.getNode(),e.e_r)},r=function(){i.removeClass(e.getNode(),e.e_r)},s=t.mode||"Click";(({Over:n,Out:r,Click:function(){n();setTimeout(r,500)}}))[s]()}}})}),u=o.prototype;u.e_p=function(e){return this.getFormElement("attributeUi"+e)};u.e_w=function(){var e=this;if(e.isWired){var t=e.e_g;for(var n in t)e.e_p(t[n]).updateUi()}};u.e_x=function(){var e=this,t=e.e_z;if(e.isWired){e.children.toggleUiCollapsed.set({text:t?"+":"&minus;"});e.displayNode("attributes",!t);!t&&e.e_w();i.setState(e.getNode(""),e.e_A,t)}};u.updateUi=function(){var t=this;if(t.isWired){t.e_w();t.e_x();e.doMy(t,"updateUi")}};u.wireUi=function(){var t=this;if(!t.isWired){t.wireNode("title","click",function(){t.toggle("uiCollapsed")});e.doMy(t,"wireUi")}};o.stateProperties({e_g:"attributes",e_r:"cssClassHighlight",e_A:"cssClassCollapsed",e_z:{name:"uiCollapsed",onChange:u.e_x,value:n},e_k:{name:"updating",onChange:function(){this.set({busy:this.e_k?t:"inherit"})}}});return o}});Uize.module({name:"Zazzle.ProductConfiguratorSectionUi",superclass:"Uize.Widget.Form",required:["Zazzle.ProductAttributesUi","Uize.Widget.Button","Uize.Url","Uize.Data","Uize.Json","Uize.Node.Classes"],builder:function(e){var t=null,n=Uize,r=.1;var i=e.subclass(null,function(){function i(t,n){e.fire({name:"Attribute Value Changed",attributeName:t,value:n,bubble:true})}var e=this,r=Zazzle.ProductAttributesUi;n.forEach(e.e_e,function(t){e.addForm("attributesUi"+t,r)});e.e_j("toggleUiCollapsed",function(){e.toggle("uiCollapsed")});e.e_j("applyDownsell",function(){i(e.e_k,e.e_l)});e.e_j("applyUpsell",function(){i(e.e_k,e.e_m)});e.wire("Attributes Updated",function(r){e.once("!updatingLayout",function(){for(var t=-1;++t<e.e_e;)e.e_o(t).fire(r)});if(e.isWired&&e.e_k){var i=e.e_k,s=r.productOption[i],o=r.attributesInfo[i],u=o.values,a=o.upsellInfo,f=a.lowest.name!=s?n.findRecord(u,{name:a.lowest.name}):t,l=!f&&a.higher.name!=s?n.findRecord(u,{name:a.higher.name}):t;e.displayNode("downsellMessage",f);if(f){e.setNodeInnerHtml("downsellMessagePriceDiff",a.lowest.displayPriceDiff);e.setNodeInnerHtml("downsellMessageTitle",f.valueDetails.displayName);e.e_l=a.lowest.name}e.displayNode("upsellMessage",l);if(l){e.setNodeInnerHtml("upsellMessagePriceDiff",a.higher.displayPriceDiff);e.setNodeInnerHtml("upsellMessageTitle",l.valueDetails.displayName);e.e_m=a.higher.name}e.displayNode("upsellUi",f||l)}})}),s=i.prototype;s.e_j=n.Widget.Button.addChildButton;s.e_w=function(){var e=this,t=function(t){return e.getInherited(t)},r=n.Url.toParams,i=t("productType");return{pt:i,pd:t("productId")||i,experience:t("experience"),section:t("section"),ta:r(t("templateParams")),attributeDependencyInfo:n.Json.to(t("dependencyGraph"),"miniStrict"),mu:t("markup"),sf:t("skuFilter"),skuFilterUseType:t("skuFilterUseType"),po:r(t("productOption")),view:t("view"),accd:t("accessoryId"),ppd:t("parentProductId"),patt:r(t("parentProductOption"))}};s.e_B=function(e){return this.removeFormElement("attributesUi"+e)};s.e_D=function(){var e=this;if(e.isWired){for(var t=-1;++t<e.e_e;)e.e_o(t).set({uiCollapsed:e.e_E})}};s.e_F=function(){var e=this,t=e.e_E,r=e.children;if(e.isWired){if(e.getNode("title")){r.toggleUiCollapsed.set({text:t?"+":"&minus;"});r.elements.displayNode("",!t)}n.Node.Classes.setState(e.getNode(""),e.e_I,t);e.e_D()}};s.getAttributesUi=s.e_o=function(e){return this.getFormElement("attributesUi"+e)};s.updateUi=function(){var t=this;if(t.isWired){t.e_F();e.doMy(t,"updateUi")}};s.wireUi=function(){var t=this;if(!t.isWired){t.wireNode("title","click",function(){t.toggle("uiCollapsed")});e.doMy(t,"wireUi")}};i.stateProperties({e_l:"downsellValue",e_J:{name:"experience",conformer:function(e){this.e_K=this.e_J;return e},onChange:function(){var e=this,t=e.e_J;if(e.isWired){e.set({e_L:true});e.ajax({service:"product/ppl/getlayout",productType:e.getInherited("productType"),productId:e.getInherited("productId"),experience:t,section:e.e_M,version:r},function(i){var s=e.getInherited("variations"),o=e.e_w(),u=e.e_Q[t]=i.data;if(s&&s[t]||!n.Data.identical(u,e.e_Q[e.e_K])){var a=e.children.elements.get("idPrefix"),f=u.length,l=function(t){e.callInherited("loadHtmlIntoNode")({node:e.getNode("attributesUiShell"),injectMode:"inner bottom"},n.copyInto({cp:"Zazzle.ProductAttributesUi",idPrefix:a+"_attributesUi"+t,layout:n.Json.to(u[t],"miniStrict"),ver:r},o),{cache:"memory",callback:function(){t==f-1&&e.set({e_e:f,e_L:false})}})};for(var c=e.e_e;--c>=0;)e.e_B(c);e.set({e_e:0});e.setNodeInnerHtml("attributesUiShell","");n.forEach(f,l)}else{e.set({e_L:false})}})}},value:"None"},e_Q:"layout",e_e:{name:"numAttributesUi",value:0},e_M:{name:"section",value:"PrimaryUi"},e_E:{name:"uiCollapsed",onChange:s.e_F,value:false},e_k:"upsellAttribute",e_m:"upsellValue",e_I:"cssClassCollapsed",e_L:{name:"updatingLayout",value:false}});return i}});Uize.module({name:"Zazzle.ProductQuantitySelector",superclass:"Zazzle.Droplist.ComboBox",builder:function(e){"use strict";var t="None",n="Match",r="All";var i=e.subclass(null,function(){var e=this;e.wire("Changed.value",function(){e.k_d()})}),s=i.prototype;s.k_f=function(){var e=this,i=e.k_g;if(e.k_h&&i!=t){var s=e.k_h,o=e.get("values"),u=o.length,a=[];if(s.length){var f=s.length,l=0,c=0,h=e.k_o;while(l<u||c<f){var p=o[l],d=p&&p.name||null,v=s[c];if(!v||p&&d<v.min){a.push(p);l++}else{var m=v.min,g=m+"";if(a.length&&i==r){var y=a.pop();if(y.valueDetails.importantInfo||m-m*h>y.name)a.push(y)}if(i!=n||p&&d==m)a.push({name:g,valueDetails:{value:g,displayName:g,importantInfo:e.localize(v.disc.indexOf("%")>-1?"quantitySelectorDiscountMsgPct":"quantitySelectorDiscountMsgAmt",{discount:v.disc})}});c++;if(p&&(p.importantInfo||d-d*h<m))l++}}}else{for(var b=-1;++b<u;){var w=o[b].name;a.push({name:w,valueDetails:{value:w,displayName:w}})}}e.set({values:a})}};s.k_d=function(){var e=this;if(e.isWired){var t=e.localize(+e==1?"unitLabelSingular":"unitLabelPlural",{number:e.k_y});t&&e.setNodeInnerHtml("unitLabel",t);e.setNodeStyle("unitLabelShell",{display:t?"inline":"none"})}};s.fireOkOnEnter=Uize.returnFalse;s.valueConformer=function(t){t=e.doMy(this,"valueConformer",[t]);return this.getProvider("replaceFullWidthNumbers")?this.callInherited("replaceFullWidthNumbers")(t):t};s.updateUi=function(){var t=this;if(t.isWired){t.k_d();t.k_f();e.doMy(t,"updateUi")}};i.stateProperties({k_o:{name:"closenessThreshold",onChange:s.k_f,value:.25},k_h:{name:"discounts",onChange:s.k_f},k_g:{name:"includeDiscounts",value:r},k_y:{name:"quantityMultiplier",onChange:s.k_d,value:1}});return i}});Uize.module({name:"Uize.Widget.Flip",required:"Uize.Fade",builder:function(e){"use strict";return e.subclass({alphastructor:function(){this.d__="idle";this.fade=Uize.Fade({duration:400})},instanceMethods:{changeContent:function(e,t){var n=this;if(e!=n.d_c){n.d_c=e;n.d__="out";n.set({d_b:t});n.fade.start({startValue:0,endValue:n.d_b=="down"?0-n.d_d:n.d_d-0,curve:Uize.Fade.celeration(1,0)})}},wireUi:function(){var t=this;if(!t.isWired){var n=t.getNode();t.fade.wire({"Changed.value":function(){t.setNodeStyle("",{top:Math.round(t.fade)})},Done:function(){if(t.d__=="out"){t.setNodeInnerHtml(n,t.d_c);t.fade.set({startValue:t.d_b=="down"?t.d_d-0:0-t.d_d,endValue:0,curve:Uize.Fade.celeration(0,1)});t.d__="in";t.fade.start();t.fire("Content Changed")}else if(t.d__=="in"){t.d__="idle";t.fire("Updated")}}});if(n)t.d_c=n.innerHTML;e.doMy(t,"wireUi")}}},stateProperties:{d_b:{name:"direction",value:"down"},d_d:{name:"offset",value:"20"}}})}});Uize.module({name:"Zazzle.ProductConfiguratorSectionUi.PurchaseUi",required:["Zazzle.ProductQuantitySelector","Uize.Widget.Flip","Uize.Url","Uize.Json","Uize.Util.PropertyAdapter","Uize.Widget.mWeb"],builder:function(e){"use strict";var t=null,n=Uize;var r=e.subclass(t,function(){function r(){e.f_d()}var e=this,t=e.addFormElement("quantity",Zazzle.ProductQuantitySelector);e.addChild("price",n.Widget.Flip,{offset:32});new n.Util.PropertyAdapter({propertyA:{instance:t,property:"value"},propertyB:{instance:e,property:"quantity"}});t.wire("Changed.quantityMultiplier",function(){e.f_e()});e.wire({"Attributes Updated":function(i){r();e.ajax({service:"product/volumedisc/get",pt:e.getInherited("productType"),ea:n.Url.toParams(n.copy(e.getInherited("productOption"),e.getInherited("designAttributes")))},{cache:"memory",callbackSuccess:function(e){t.set({discounts:e.success?e.data:[]})}});e.set({f_h:i.inStock});t.set("quantityMultiplier",i.quantityMultiplier)},"Price Check":r})}),i=r.prototype;r.mixins(n.Widget.mWeb);i.f_j=function(){var e=this;if(e.isWired){var t=e.f_h==false&&!e.f_l;e.web("oosOverlay").display(t);e.children.submit.set({enabled:t?false:"inherit"})}};i.f_e=function(){var e=this;e.isWired&&e.web("perUnitLabel").html(e.localize("perUnitLabel",{number:e.getFormElement("quantity").get("quantityMultiplier")}))};i.f_d=function(){var e=this;if(e.isWired){var r=function(t){return e.getInherited(t)},i=e.children,s=r("productId"),o=r("designId");e.ajax({service:"price",data:n.Json.to({products:[n.copyInto({pt:r("productType"),qty:+e.f_r,atts:n.Url.toParams(n.copy(r("productOption"),r("designAttributes")))},s?{pd:s}:t,o?{dz:o}:t)]})},{cache:"memory",callbackSuccess:function(t){e.set({priceInfo:t});if(t.error!="invalid"){var n=e.f_t,r=t.unitPriceAdj,s=t.totalPrice,o=n?e.f_x:e.f_y,u=n?s:r,a=n&&s!=r,f=!!t.priceDigitizing;i.price.changeContent(t[n?"dispTotalPrice":"dispUnitPriceAdj"]+(f?"*":""),typeof o!="number"||u>o?"up":"down");e.web("priceOriginal").html(t[n?"dispTotalPriceUnadj":"dispUnitPrice"]);e.web("unitPriceMessage").html(e.localize("unitPriceMessage",{price:t.dispUnitPriceAdj,unitLabel:e.localize("perUnitLabel",{number:e.getFormElement("quantity").get("quantityMultiplier")})}));e.web("priceOriginal").display(n?t.totalPriceUnadj!=s:t.unitPrice!=r);e.web("perUnitLabel").display(!a);e.web("unitPriceMessage").display(a);e.web("conversionFeeShell").display(f);e.f_y=r;e.f_x=s}}})}};i.updateUi=function(){var t=this;if(t.isWired){t.f_d();t.f_e();t.f_j();e.doMy(t,"updateUi")}};i.wireUi=function(){var t=this;if(!t.isWired){t.web("conversionFeeLink").click(function(){if(t.f_s){var e=t.f_s,r=e.digitizing;t.callInherited("useDialog")({component:{name:"ZazzleWww.Dialog.ConversionFee",params:{productPrice:e.totalPrice/100,qty:+t.f_r,digitizingTotal:e.priceDigitizing,conversionsText:r?n.Json.to(r,"mini"):""}},widgetProperties:{name:"conversionFeeDialog",mode:"alertCustom",state:"info"}})}});e.doMy(t,"wireUi")}};r.stateProperties({f_h:{onChange:i.f_j},f_l:{name:"allowOos",onChange:i.f_j,value:false},f_s:"priceInfo",f_r:{name:"quantity",onChange:i.f_d},f_t:{name:"showTotalPricing",onChange:i.f_d,value:false}});return r}});Uize.module({name:"Zazzle.ProductAttributesModel",superclass:"Uize.Class",required:["Uize.Comm.Ajax","Uize.Json","Uize.Data"],builder:function(e){"use strict";function u(){this.c_l()}function a(e,t){return i.Data.identical(e,t)?t:e}var t=true,n=false,r=null,i=Uize;var s=e.subclass(function(){this.c_e=t;this.c_f=new i.Comm.Ajax},function(){var e=this;e.c_g=[e.c_h];e.c_i=0;e.c_j=0;e.c_e=n}),o=s.prototype;o.c_l=function(e){var r=this;if(!r.c_e&&r.c_f){var s=r.c_o();clearTimeout(r.c_p);r.c_p=setTimeout(function(){r.set({c_q:t});r.c_f.request({url:[r.c_r.get,{model:i.Json.to(s,"miniStrict"),r:r.c_j}],cache:"memory",requestMethod:"POST",returnType:"json",callback:function(s){var o=s.data;r.c_e=t;r.set(o);r.c_e=n;r.c_i++;r.c_g.length=r.c_i;r.c_g.push(r.c_h);r.set({c_q:n});r.fire({name:"Attributes Info Updated",attributes:i.keys(o.attributesInfo),priceChanged:t,priceDiffs:o.priceDiffs,componentPriceDiffs:o.componentPriceDiffs});e&&e()}})},r.c_u)}};o.c_o=function(){var e=this.get(),t={};for(var n in e){var s=e[n];if(s!=r)t[n]=s}t.productOption=i.copy(t.productOption,t.designAttributes);delete t.serviceUrls;delete t.attributesInfo;delete t.designAttributes;delete t.requestDelay;delete t.busy;return t};o.setAttributeValue=function(e,t){var n=this,r;if(n.c_h[e]!==r){var s=n.c_o();s.productOption=i.copy(s.productOption,i.pairUp(e,t));n.c_f.request({url:[n.c_r.validate,{model:i.Json.to(s,"miniStrict")}],cache:"memory",requestMethod:"POST",returnType:"json",callback:function(e){var t=e.data.productOption,r={},i;if(t){for(i in t){if(!i.indexOf("design.")){r[i]=t[i];delete t[i]}}}n.set({productOption:t,supportedAreas:e.data.supportedAreas,designAttributes:r})}})}};o.undo=function(){var e=this;if(e.c_i>0){e.c_i--;e.set({c_h:e.c_g[e.c_i--]})}};o.update=o.c_D=function(e){this.c_j++;this.c_l(e)};s.stateProperties({c_H:{name:"accessoryId",onChange:u},c_I:"attributesInfo",c_q:{name:"busy",value:n},c_J:{name:"dependencyGraph",conformer:a,onChange:u},c_B:{name:"designAttributes",conformer:a,onChange:u,value:{}},c_K:{name:"includeDesignInThumbnail",onChange:u,value:n},c_L:"inStock",c_M:{name:"markup",onChange:u},c_N:{name:"originalPricing",onChange:u},c_O:"oosList",c_P:{name:"parentProductId",onChange:u},c_Q:{name:"parentProductOption",onChange:u},c_e:"preventServiceCall",c_R:{name:"productId",onChange:u},c_h:{name:"productOption",conformer:a,onChange:u},c_S:{name:"productType",onChange:u},c_T:"quantityMultiplier",c_u:{name:"requestDelay",value:150},c_r:"serviceUrls",c_U:{name:"skuFilter",onChange:u},c_V:{name:"skuFilterUseType",onChange:u},c_W:"supportedAreas",c_X:{name:"templateParams",onChange:u},c_Y:{name:"view",onChange:u}});return s}});Uize.module({name:"Zazzle.ProductConfiguratorUi",superclass:"Uize.Widget.Form",required:["Zazzle.ProductConfiguratorSectionUi","Zazzle.ProductConfiguratorSectionUi.PurchaseUi","Zazzle.ProductAttributesModel","Uize.Util.Coupler","Uize.Data"],builder:function(e){"use strict";function r(e){var t=this,n=t.e_h;t.e_f&&t.e_f.set({experience:n,includeDesignInThumbnail:n!="ProductDesign"&&!!+t.e_i,productId:t.e_i});if("experience"in e){var r={experience:n},i=t.getFormElement("primaryUi"),s=t.getFormElement("purchaseUi");i&&i.set(r);s&&s.set(r)}}function i(){var e=this,n=t.copy(e.e_s,e.e_m),r={},i={},o;for(o in n)(o.indexOf("design.")?i:r)[o]=n[o];e.set({e_m:s(r,e.e_m),e_s:s(i,e.e_s)})}function s(e,n){return t.Data.identical(e,n)?n:e}var t=Uize;var n=e.subclass(null,function(){var e=this,n=Zazzle.ProductConfiguratorSectionUi,r=["accessoryId","dependencyGraph","designAttributes","markup","parentProductId","parentProductOption","productId","productOption","productType","skuFilter","skuFilterUseType","supportedAreas","templateParams","view"],i=e.addForm("primaryUi",n.PrimaryUi),s=e.addForm("purchaseUi",n.PurchaseUi),o=e.e_f=e.model=new Zazzle.ProductAttributesModel(t.copyInto({serviceUrls:e.e_g,includeDesignInThumbnail:e.e_h=="ProductConfiguration"&&e.e_i!="0"},e.get(r))),u=new t.Util.Coupler({instances:[e,o],properties:r,coupled:e.isWired});o.wire({"Attributes Info Updated":function(n){var r=t.copyInto({name:"Attributes Updated",changedAttributes:n.attributes,productOption:t.copy(e.e_m,o.get("productOption")),priceChanged:n.priceChanged},o.get(["attributesInfo","inStock","quantityMultiplier"]));i.fire(r);s.fire(r)},"Changed.busy":function(){e.set({busy:o.get("busy")?true:"inherit"})}});e.wire({"Attribute Value Changed":function(e){e.bubble=false;o.setAttributeValue(e.attributeName,e.value)},"Annotation Event":i,"Changed.wired":function(){o.set("preventServiceCall",true);u.set("coupled",e.isWired);o.set("preventServiceCall",false)}});new t.Util.Coupler({instances:[s,e],properties:["quantity"]});s.children.submit.wire("Click",e)});n.stateProperties({e_x:"accessoryId",e_y:"dependencyGraph",e_h:{name:"experience",onChange:r,value:"None"},e_m:{name:"designAttributes",conformer:s,onChange:[i,function(){var e=this.children.elements,n=e?e.children.purchaseUi:undefined;n&&!t.isEmpty(this.e_m)&&n.fire("Price Check")}],value:{}},e_A:"markup",e_g:{name:"modelServiceUrls",onChange:function(){this.e_f&&this.e_f.set({serviceUrls:this.e_g})}},e_B:"parentProductId",e_C:"parentProductOption",e_i:{name:"productId",onChange:r},e_s:{name:"productOption",conformer:s,onChange:i},e_D:"productType",e_E:"quantity",e_F:"skuFilter",e_G:"skuFilterUseType",e_H:"supportedAreas",e_I:{name:"templateParams",conformer:s},e_J:"view"});n.set({useNormalSubmit:false});return n}});Uize.module({name:"Zazzle.ProductUi",superclass:"Zazzle.Widget",required:["Zazzle.ProductConfiguratorUi","Zazzle.ProductViewUi","Zazzle.ProductOptionMetaInfo","Uize.Util.Coupler","Uize.Util.PropertyAdapter","Uize.Data","Uize.Widget.FormWarnings"],builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize,s=Zazzle,o;Uize.module({name:"Zazzle.FormWarningsWatchedElement",superclass:"Uize.Widget",builder:function(e){var t=e.subclass();t.stateProperties({z_g:"isValid",z_h:"warningMessage",z_i:"warningShown"});return t}});var u=e.subclass(r,function(){function c(){e.z_u()}var e=this,t=i.Util,r=i.Util.Coupler,o=e.addChild("view",e.z_m||s.ProductViewUi,{designAreas:e.z_n["design.areas"]}),u=e.addChild("configurator",s.ProductConfiguratorUi),a=e.addChild("metaInfo",s.ProductOptionMetaInfo),f=e.addChild("formWarnings",i.Widget.FormWarnings,{watchedElements:[]}),l=["parentProductId","parentProductOption","productId","productOption","productType","templateParams"];e.z_s={};new r({instances:[u,e],properties:l.concat(["accessoryId","designAttributes","experience","markup","quantity","view"])});new r({instances:[o,e],properties:l});new t.PropertyAdapter({propertyA:{instance:o,property:"value"},propertyB:{instance:e,property:"view"}});u.wire({Click:function(){e.z_v(function(t,r){t!==n&&e.fire({name:"Submit",data:r})})},"Changed.isValid":function(){c();e.z_y()}});u.model.wire({"Changed.attributesInfo":function(e){var t=u.get("productOption"),n={},r=e.newValue;if(r){for(var s in t){var o=r[s];if(o){var f=i.findRecord(o.values,{name:t[s]});if(f)n[s]=f.valueDetails}}a.set({value:i.clone(t),valueDetails:n})}},"Changed.productOption":function(){e.testConfiguration()}});c();o.wire("Annotation Event",function(e){var t=e.data;t.type=="option"&&u.fire({name:"Annotation Event",annotation:t,type:e.type})})}),a=u.prototype;var f=function(e,t){e&&e.apply(this,t)};a.z_v=function(e){this.beforeFinishAction("buy",e)};a.z_y=function(e){var t=this,r=t.children.formWarnings,o=t.z_s,u=r.get("watchedElements"),a=t.get("idPrefix"),l=[],c=s.FormWarningsWatchedElement;i.forEach(o,function(e,r){var s=new c({idPrefix:a+"_"+r,isValid:n,warningMessage:e.z_S}),o=e.z_U;if(o){s.z_V=new i.Util.Coupler({instances:[o,s],properties:["focused","isValid","warningMessage","warningShown"]})}else s.wire("Changed.focused",function(n){t.fire({name:"Focus Warning",constraint:e.z_W,focused:n.source.get("focused"),sourceEvent:n})});l.push(s)});var h=!i.isEmpty(l);r.set({watchedElements:l});i.callOn(l,"set",[{warningShown:h}]);r.set({shown:h});for(var p=-1;++p<u.length;){var d=u[p];delete d.z_V;d.kill()}f(e,[o])};a.z_Z=function(e){var r=this;if(r.isWired){var s=r.web("left"),o=r.web("extraProductTitleShell").css("display")!="none";if(!e){var u=r.children,a=u.view,f=r.web(a.getNode("mainViewShell")),l=r.web(a.children.scrolly);f.contentWidth("");f.contentWidth(f.width()-(l.offset(r.getNode()).top+l.height()-r.web(r.z_6||window).height()));a.updateUi()}if(o&&!r.z_7||!o&&r.z_7){i.require("Uize.Web.xDom",function(){var e=r.web("right"),i=r.children.configurator.getFormElement("purchaseUi");if(o&&!r.z_7){r.z_7=t;r.web("metaInfoShell").detach().each(function(){e[0].appendChild(this)});r.web(i.getNode("priceDisplay")).detach().each(function(){var e=i.getNode("buttons");e.parentNode.insertBefore(this,e)})}else if(!o&&r.z_7){r.z_7=n;r.web("metaInfoShell").detach().each(function(){s[0].appendChild(this)});r.web(i.getNode("priceDisplay")).detach().each(function(){i.getNode("titleAndPrice").appendChild(this)})}})}r.fire("Responsive Sizing")}};a.z_u=function(){var e=this,r=e.children,s=r.configurator,o=e.z___;e.z_s={};e.z_a_&&function p(t){for(var r=-1;++r<t.length;){var i=t[r],s=i.get("warningMessage");if(i.get("isValid")==n){if(i.isForm)p(i.getFormElement());else if(s){var o=i.get("elementName");e.z_s[o]={z_f_:o,z_g_:"nobuy",z_S:s,z_U:i}}}}}([s]);if(o){var u=e.z_h_,a=e.z_j_,f={};if(!i.isArray(o))o=[o];for(var l=-1;++l<o.length;){var c=o[l],h=c.type;if(h!="none"&&(!u||u["constraint_"+h])&&!f[h]){e.z_s[h]={z_f_:h,z_g_:a&&c.level==="nopost"?"nobuy":c.level,z_S:e.localize("constraint_"+h),z_U:e.getConstraintFormElement(c),z_W:c};f[h]=t}}}};a.beforeFinishAction=function(e,r){var s=this;s.z_a_=t;s.z_u();s.z_y(function(o){function u(e){e?s.ensureAllOptionsSelected(function(e){e!==n?s.finalize(r):f(r,[n])}):f(r,[n])}if(i.isEmpty(o))u(t);else{var a=n,l=0,c=function(){var e=[];for(var t in o)e.push('<p><span class="error">'+o[t].z_S+"</span></p>");return e.join("")};for(var h in o){var p=o[h];if(!a&&p.z_g_=="no"+e)a=p;l++}a?u(n):s.confirm({state:"warning",message:"<p>"+s.localize("finishActionWarningMessage")+"</p>"+c()+"<p>"+s.localize("finishActionWarningClosing")+"</p>",callback:u})}})};a.ensureAllOptionsSelected=function(e){f(e,[this.children.configurator.get("isValid")])};a.finalize=function(e){f(e,[t,{productId:this.z_u_}])};a.getConstraintFormElement=function(e){return r};a.getProductInfo=function(){var e=this;return{productType:e.z_v_,productId:e.z_u_,title:e.z_w_,productOption:i.clone(e.z_x_),designAttributes:i.clone(e.z_n),view:e.z_y_,quantity:e.z_z_,templateParams:e.z_A_,realview:e.children.view.children.mainView+""}};a.getProductParams=function(e){var t=this,n=t.z_x_,r=t.z_C_,s=t.z_y_,o=t.z_n,u={};if(e&&!i.isEmpty(r)){for(var a in n)if(n[a]!=r[a])u[a]=n[a];if(s!=r.view)u.view=s;for(var f in o)if(o[f]!=r[f])u[f]=o[f]}else u=i.copyInto({view:s},n,o);return u};a.productize=function(e){this.finalize(e)};a.setConstraints=function(e,t){function f(){n.z_u();n.z_y()}var n=this,r=[];if(e){var s=n.z_h_;if(!i.isArray(e))z_H_=[e];for(var o=-1;++o<e.length;){var u=e[o],a=u.type;if(a!="none"&&(!s||s["constraint_"+a]))r.push(u)}}n.z___=r;t?t(n.z___,f):f()};a.testConfiguration=function(e){var n=this;i.require("Uize.Xml",function(s){n.ajax({serviceUrl:n.getInherited("env").rlvNetService+"edit",readonly:t,rvtype:"none"},{cache:"never",contentType:"text/xml",data:'<edit version="1"><params '+s.toAttributes(i.copy(n.get("productId")?{pid:n.get("productId")}:undefined,n.get("designId")?{id:n.get("designId")}:undefined,n.getProductParams(t)))+" /></edit>",callbackSuccess:function(t){n.set({z_L_:t});if(t&&t.changed){var s=t.design?t.design.attributes:r;if(s){var o=i.Url.fromParams(s)["design.areas"],u=n.z_n["design.areas"];o!==u&&n.set({z_n:i.copyInto({},{areas:o})})}}n.setConstraints(t.design&&t.design.constraints,e)}})})};a.updateUi=function(){var n=this;if(n.isWired){var r=n.children,i=n.web(r.view.children.mainView),s=function(){var e=function(e){clearInterval(u);n.z_Z(e)};if(i.height()>=i.width())e();else if(++o>=200)e(t)},o=-1,u=setInterval(s,100);s();for(var a in{view:1,configurator:1,metaInfo:1})r[a].updateUi();e.doMy(n,"updateUi")}};a.wireUi=function(){var t=this;if(!t.isWired){t.web(window).resize(function(){t.z_Z()},500);e.doMy(t,"wireUi");t.z_u();var n=t.children;!n.metaInfo.get("valueDetails")&&n.configurator.model.update()}};var l=function(){var e=this;e.set({z_A:i.copyInto({},e.z_x_,{view:e.z_y_},e.z_n)})},c=function(e){var t={},n={},i={},s=r,o;for(o in e){if(o==="view")s=e[o];else(o.indexOf("design.")?i:n)[o]=e[o]}return{z_n:n,z_x_:i,z_y_:s}},h=function(e){var t=c(e);this.set(i.copyInto({z_n:p(t.z_n,this.z_n),z_x_:p(t.z_x_,this.z_x_)},t.view?{z_y_:t.view}:o))},p=function(e,t){return i.Data.identical(e,t)?t:e};u.stateProperties({z_5_:"accessoryId",z_h_:"constraintsToTest",z_j_:"constraintNoPostIsNoBuy",z_n:{name:"designAttributes",conformer:p,onChange:[function(){h.call(this,i.copyInto({},this.z_x_,this.z_n))},l,function(){var e=this.children.view;e&&this.z_n&&e.set({designAreas:this.z_n["design.areas"]})}],value:{}},z_6_:"designId",z_7_:{name:"experience",value:"None"},z_t_:"markup",z_6:"offsetParent",z_C_:"originalProductAttributes",z_8_:"parentProductId",z_9_:"parentProductOption",z_u_:"productId",z_x_:{name:"productOption",conformer:function(e){return i.Data.identical(e,this.z_x_)?this.z_x_:e},onChange:[function(){h.call(this,i.copyInto({},this.z_n,this.z_x_))},l]},z_v_:"productType",z_z_:"quantity",z_A_:"templateParams",z_L_:"templateEditResp",z_$a:"skuFilter",z__a:"skuFilterUseType",z_w_:"title",z_A:{name:"value",onChange:function(){h.call(this,i.copyInto({},this.z_A))}},z_y_:{name:"view",onChange:l},z_m:"viewWidgetClass"});return u}});Uize.module("Zazzle.Widgets");Uize.module("Zazzle.Widgets.Doublecheck");Uize.module({name:"Zazzle.Widgets.Doublecheck.mDoublecheckFlow",required:["Uize.Url","Uize.Json","Uize.Widget.mWeb","Zazzle.DesignModel"],builder:function(){"use strict";function e(e,t){var n={};for(var r in e){var i=e[r];if(t(i)){n[r]=i}}return n}function t(e){if(e===null)return"null";if(typeof e!=="object")return""+e;var n=[];for(var r in e){n.push({d_c:r,Value:t(e[r])})}n.sort(function(e,t){return e.d_c-t.d_c});return Uize.Json.to(n)}function n(e,t){var n={};var r=e.properties;for(var i=0;i<r.length;i++){var s=r[i];n[s.name]=s.value}var o={};o.Name=e.name;o.Value=n["value"];o.IsLocked=n["locked"]==="true";o.TemplateName=e.urlkey||"";if(o.TemplateName){var u=t[o.TemplateName];if(!u){console.warn("Cannot find template for childObject: "+o.Name+" templateName: "+o.TemplateName)}else{o.DisplayName=u.title;o.Unmodified=!u.applied}}return o}function r(e,t){var r=[];var i=e.getChildObjects();for(var s=0;s<i.length;s++){var o=i[s];if(o.constructor.name==="DesignText"){r.push(n(o,t))}}var o={};o.Texts=r;o.Name=e.getName();o.IsBlank=i.length===0;o.GroupName=e.groupName;o.BleedProblems=e.insideBleed;o.SafeProblems=e.outsideSafe;return o}function i(e){var t={};t.GroupName=e;t.IsBlank=true;return t}function s(e,t,n){var s=n;var o=e.getTemplates();for(var u=0;u<o.length;u++){var a=o[u];s[a.urlkey]=a}if(t){for(var f in t){var l=t[f];if(s[f]){s[f].value=l;continue}var a={title:"",applied:true,value:t[f],urlkey:f.substring(2)};s[f.substring(2)]=a}}var c=s;var h={};var p=e.getAreas();for(var u=0;u<p.length;u++){var d=p[u];h[d.getName()]=d}var v=e.getAttributes()["design.areas"];var m=v.split(/[\]|\[|,]/g);for(var u=m.length-1;u>=0;u--){if(!m[u]){m.splice(u,1)}}var g={};for(var u=0;u<m.length;u++){var y=m[u];var b=h[y];if(!b){console.error("Could not find area for areaName: "+y);continue}var w=r(b,c);g[w.GroupName]=w}var E=e.missingAreaGroups;for(var u=0;u<E.length;u++){var S=E[u];g[S]=i(S)}var x=[];for(var T in g){x.push(g[T])}return x}var o={DialogCheckSides:{name:"DialogCheckSides",inDesignView:true,hide:"bleed,safe,visible",width:50,shouldShow:function(e){return!Uize.isEmpty(e)},getAssociatedData:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n];if(r.IsBlank){t.push(r.GroupName)}}return t}},DialogCheckTemplates:{name:"DialogCheckTemplates",inDesignView:true,hide:"bleed,safe,visible",width:40,shouldShow:function(e){return!Uize.isEmpty(e)},getAssociatedData:function(t){var n={};for(var r=0;r<t.length;r++){var i=t[r];var s=e(i.Texts,function(e){return e.Unmodified});if(!Uize.isEmpty(s)){n[i.Name]=s}}return n}},DialogCheckBleed:{name:"DialogCheckBleed",inDesignView:true,width:50,shouldShow:function(e){return!Uize.isEmpty(e)},getAssociatedData:function(e){var t={};for(var n=0;n<e.length;n++){var r=e[n];var i={};if(!Uize.isEmpty(r.BleedProblems)){i.BleedProblems=r.BleedProblems}if(!Uize.isEmpty(r.SafeProblems)){i.SafeProblems=r.SafeProblems}if(!Uize.isEmpty(i)){t[r.Name]=i}}return t}},DialogCheckSpelling:{name:"DialogCheckSpelling",inDesignView:true,hide:"bleed,safe,visible",width:40,shouldShow:function(e){return!Uize.isEmpty(e)},getAssociatedData:function(t,n){var r={};for(var i=0;i<t.length;i++){var s=t[i];var o={};var u=e(s.Texts,function(e){return!e.IsLocked||e.TemplateName});if(!Uize.isEmpty(u)){r[s.Name]=u}}var o=[];for(var a in n){if(a.indexOf("t_")===0){var f={};f[a]=n[a];o.push(f)}}if(!Uize.isEmpty(o)){r.d_g=o}return r}}};var u={};var a={DialogCheckSides:"A",DialogCheckTemplates:"B",DialogCheckBleed:"C",DialogCheckSpelling:"D",d_T:"E",d_U:"F",d_V:"G",d_W:"H",d_X:"J",d_Y:"K"};var f=[];var l=true;return function(e){e.declare({mixins:Uize.Widget.mWeb,staticMethods:{clearDoublecheckCache:function(){u={}}},instanceMethods:{preStartDoublecheckFlow:function(e,t,n){function s(i,s){if(!t){n(true);return}var o=[];if(r.get("moreSidesCostExtra")){o.push("DialogCheckSides")}if(i){o.push("DialogCheckBleed")}r.startDoublecheckFlow(t,o,e==="post",function(){n(true)},function(){n(false)},s)}function o(e){if(t){e();return}var n=r.get("templateParams");if(!n){t=null;e();return}var i=e;e=function(){i(true,n)};var s=r.get("templateEditResp");if(s){var o=true;var u={};var a=s.design.d_g||[];for(var f=0;f<a.length;f++){var l=a[f];if(l.type!==2)continue;u["t_"+l.urlkey]=l}for(var c in n){if(c.lastIndexOf("_txt")!==c.length-4){continue}if(!u[c]){o=false;break}}if(o){t=new zazzle.rlv.ZDesign(r.get("productOption"));t.updateWithResponse(s);e();return}}var h=Uize.clone(r.getProductParams(true));h.pid=r.get("productId");var p=new zazzle.rlv.ZDesign(h);p.addDesignListener(function(n){if(n.type=="error")throw n;t=p;e()});p.update()}var r=this;if(localStorage&&localStorage["dontreallypostforsale"]){var i=n;n=function(t){alert("Did action: "+e+" "+t);i(false)}}o(s)},startDoublecheckFlow:function(e,n,r,i,c,h){function E(e){var t={};for(var n in e){var r=e[n];t["t_"+r.urlkey]=r.value}return Uize.Url.toParams(t)}function A(){if(v.length===0){if(r){f.push(a.d_V)}else{f.push(a.d_W)}i&&i();return}var e=v.shift();var n=e.name;w.InDesignView=e.inDesignView;w.Hide=e.hide;if(localStorage&&localStorage.doublecheckTest){var s=e.getAssociatedData(b,w);console.log("Showing "+n+" with:"+"\n"+JSON.stringify(w,"","	")+"\n-->\n"+JSON.stringify(s,"","	"))}var o="Zazzle.Widgets.Dialog.Doublecheck."+n;f.push(a[n]);p.callInherited("useDialog")({component:{name:o,params:w},widgetProperties:{name:n,width:k+"em"},widgetEventHandlers:{Ok:function(){u[n]=t(s);A()},Cancel:function(){c()},Error:function(e){console.error(e);f.push(a.d_X);A()}}})}var p=this;if(l){l=false;p.web(window).unload(function(){f.push(a.d_Y);p.fire({name:"Track Event",extra:{ax:"doublecheck",params:Uize.Json.to(f)}})})}if(r){f.push(a.d_T)}else{f.push(a.d_U)}var d=["DialogCheckSides","DialogCheckTemplates","DialogCheckBleed","DialogCheckSpelling"];if(r){d.splice(1,1)}var v=[];for(var m=0;m<d.length;m++){var g=d[m];if(n.indexOf(g)>=0)continue;v.push(o[g])}var y={};var b=s(e,h,y);var w={};w.dz=e.getOpts().id||e.getId();w.pd=e.getOpts().pid;w.ta=E(y);var S=e.getOpts();var x=Uize.clone(S);delete x.id;delete x.pid;delete x.dz;delete x.pd;if(Uize.isEmpty(x)){S=null}else{w.po=Uize.Url.toParams(S)}for(var m=v.length-1;m>=0;m--){var T=v[m];var N=T.name;var C=T.getAssociatedData(b,w);if(localStorage&&localStorage.getItem("showAllDoubleCheckDialogs")){continue}if(t(C)===u[N]){if(localStorage&&localStorage.doublecheckTest){console.log("Skipping "+N+" with:\n"+JSON.stringify(C,"","	"))}v.splice(m,1)}else if(!T.shouldShow(C)){if(localStorage&&localStorage.doublecheckTest){console.log("Skipping cached "+N+" with:\n"+JSON.stringify(C,"","	"))}v.splice(m,1)}}var k=0;for(var m=0;m<v.length;m++){var L=v[m].width;if(L>k){k=L}}w.CheckDesignData=Uize.Json.to(b);if(localStorage&&localStorage.doublecheckTest){console.log("Starting flow with"+"\n"+JSON.stringify(w,"","	")+"\n\n"+JSON.stringify(b,"","	"))}A()}}})}}});Uize.module({name:"ZazzleWww.ProductUi",superclass:"Zazzle.ProductUi",required:["Uize.Util.Coupler","ZazzleWww.ProductViewUi","Zazzle.Widgets.Doublecheck.mDoublecheckFlow","Uize.Node.Classes","Uize.Widget.Fleeting","Uize.Widget","Uize.Url"],builder:function(e){"use strict";var t=Uize,n=t.Widget,r=t.Node.Classes,i=ZazzleWww,s=true,o=false,u=null,a;var f=e.subclass(u,function(){var e=this,r=e.children,i=r.configurator,a=r.view,f=function(){e.f_m=o;e.f_n=s;e.f_o()},l=e.addChild("lastSavedFleeting",n.Fleeting,{lifeSpan:3e3});new t.Util.Coupler({instances:[e,a],properties:["isDesigning","designId"]});new t.Util.Coupler({instances:[e,i],properties:["supportedAreas"]});a.wire("Annotation Event",function(t){if(t.type=="Click"){var n=t.data;n.type=="area"&&e.set({isDesigning:s,area:n.areaName})}});e.f_s("save",function(){e.callInherited("ensureLoggedIn")({callback:function(){e.fire("Save");l.set({shown:s})}})});e.f_s("publish",function(){e.f_t&&e.callInherited("ensureLoggedIn")({callback:function(){var n=e.f_v;e.f_w=s;e.set({f_v:o});e.beforeFinishAction("post",function(r){if(r&&i.get("isValid")&&!e.f_y){var s=e.getInherited("env").params;e.children.publish.set({enabled:o});location.href=t.Url.resolve([e.getInherited("urls").postDesign,{pt:e.get("productType"),istmp:e.f_A.isTemplate(),rpd:e.f_B,cmid:s.cmid||u,rcmid:s.rcmid||u,gl:s.gl||u,cg:s.cg||u,ifr:s.ifr||u,tag:s.tag},e.children.view.getRealviewParams(),e.getProductParams()])}else{e.f_w=o;e.set({f_v:n})}})}})});e.f_s("share",function(){var n=e.get("designId");e.callInherited("ensureLoggedIn")({callback:function(){var r=a+"";e.fire("Save");e.callInherited("showShareDialog")({dialogProperties:{emailParams:{rlvBase:e.get("urls").rlvBase,useRealviewService:s,design:{id:n,pending:s,type:e.get("productType"),params:t.copyInto(t.clone(e.get("productOption")),{dv:a.get("cacheDefeat")})},showImage:s,url:{svcRelativeLink:"email/sendproductemail",params:{dz:n,papid:e.get("productId")}},view:r,realviewParams:a.model.getViewInfo(r).realviewParams}},showEmailThis:s,showImageBox:s})}})});e.f_s("help",function(){e.callInherited("launchPopup")({url:e.get("urls").help})});e.f_s("toggleDesignUi",function(){e.toggle("designUiCollapsed")});e.wire({"Focus Warning":function(e){r.designUi&&r.designUi.focusWarning(e.constraint,e.focused)},"Changed.designId":function(){var t=e.f_E,n=e.get("designId");if(t&&t.getId()!==n){var r=e.f_A,i=r?r.get("isControlling"):o;r&&i&&r.set({isControlling:o});e.f_H(s);r&&r.set({isControlling:i})}},"Changed.isDesigning":function(){e.f_I?f():e.updateUi()}});if(e.f_m){var c=e.addChild("templateFields",Zazzle.TemplateFieldsUi);c.wire("Values Set",function(){e.set({templateParams:t.copy(e.f_K,c.getValues(s))});e.testConfiguration(function(n,r){var i=c.getFormElement(),o={},u;for(var a=-1;++a<n.length;){u=n[a];if(u.urlkeys){var f=u.urlkeys.split(",");for(var l=-1;++l<f.length;)o[f[l]]=u}}for(var h=-1;++h<i.length;){var p=i[h],d=p.get("elementName");(u=o[d])?p.set({isValid:false,warningMessage:e.localize("constraint_"+u.type)}):p.set({isValid:s})}var v=t.isEmpty(o);c.set({isValid:v,warningShown:!v});e.set({f_y:!v});r()})});e.addChild("toggleTemplateFieldsUi",t.Widget.Button).wire("Click",function(){e.toggle("templateFieldsUiCollapsed")})}e.f_I&&f()}),l=f.prototype;f.mixins([Zazzle.Widgets.Doublecheck.mDoublecheckFlow]);l.f_H=function(e){var n=this,r=n.get("productId"),i=n.get("designId");n.set({f_E:zazzle.rlv.createZDesign(t.copyInto(r?{pid:r,max_dim:n.children.view.get("requestedMaxDim")}:i?{id:i}:{pdt:n.get("productType")},e?u:n.get("productOption")))});return n.f_E};l.f_s=n.Button.addChildButton;l.getConstraintFormElement=function(t){return this.f_m&&t.urlkeys?this.children.templateFields.getTemplateFieldFormElement(t.urlkeys.split(",")[0]):e.doMy(this,"getConstraintFormElement",[t])};l.getProductInfo=function(){return t.copyInto(e.doMy(this,"getProductInfo"),{designId:this.get("designId")})};l.getProductParams=function(n){var r=this,i=e.doMy(this,"getProductParams",[n]);if(r.f_I){var o=r.f_A.getDesignAttributes();i=t.copyInto(i,{dz:r.get("designId")},o&&"design.areas"in o?{"design.areas":o["design.areas"]}:a)}if(r.f_m){i=t.copyInto(i,this.children.templateFields.getValues(s,n))}return i};l.beforeFinishAction=function(n,r){var i=this;if(document.activeElement){document.activeElement.blur()}var o=function(e){if(i.DoubleCheckParty_AllDialogs){if(!e){r(e);return}i.preStartDoublecheckFlow(n,i.f_E,r)}else{if(i.f_I&&i.f_7&&n==="buy"){i.callInherited("useDialog")({component:{name:"ZazzleWww.Dialog.PreFinish",params:{pt:i.get("productType"),warningType:"review",isAddToCart:s,po:t.Url.toParams(t.copyInto({},i.get("productOption"),i.get("designAttributes"))),dz:i.get("designId"),dv:i.children.view.get("cacheDefeat")}},widgetClassName:"ZazzleWww.DialogPreFinish",widgetProperties:{name:"preFinishDialog"},submitHandler:function(){r(e)}})}else r(e)}};e.doMy(i,"beforeFinishAction",[n,o])};l.finalize=function(t){var n=this,r=function(){e.doMy(n,"finalize",[t])};n.f_I?n.fire({name:"Finish",callback:r}):r()};l.productize=function(n){var r=this;e.doMy(r,"productize",[function(e){var i=r.f_I,f=r.f_m,l=r.children.templateFields,c=function(t){n&&n(e,{productId:t&&t.productId||r.get("productId"),designId:t&&t.designId||r.get("designId")})};if(e&&(i||f&&r.f_a_&&l.hasDeviantParams())){r.ajax({service:"create/productize",pd:r.get("productId"),dz:i?r.get("designId"):u,pt:r.get("productType"),tl:i?r.get("title"):u,ea:t.Url.toParams(t.copyInto({},r.get("productOption"),r.get("designAttributes"))),ta:f?t.Url.toParams(t.copy(r.get("templateParams"),l.getValues(s,s))):u},function(n){r.set(t.copyInto({f_I:o},n.productId?{productId:n.productId}:a));e=!!n.success;c(n)})}else c()}])};l.testConfiguration=function(t){!this.f_I&&e.doMy(this,"testConfiguration",[t])};l.f_o=function(){var e=this,n=function(t){e.callInherited("displayLoadingOverlay")(t,{parent:e})};!e.f_f_&&e.isWired&&n(s);t.require(["ZazzleWww.ProductDesignController","Zazzle.SelectedDesignObjectsModel","Zazzle.DesignModel"],function(r,i){var u=e.get("productId"),a=e.get("designId"),f=e.f_H(),l=new i,c=e.children,h=c.designUi,p=c.view,d,v=e.get("productOption"),g,y=function(){if(e.f_A){e.f_A.set({isControlling:o});e.f_A.get("selectedDesignObjectsModel").clear()}(d=e.f_A=new r({productUi:e,productConfiguratorUi:c.configurator,productViewUi:p,designUi:h,designModel:f,selectedDesignObjectsModel:l,enableAutoSave:s,defaultObjectProperties:e.f_m_,defaultText:e.f_n_,defaultImageId:e.f_o_,launchGetStarted:e.f_p_,maxDim:c.view.get("maxDim"),requestedMaxDim:c.view.get("requestedMaxDim"),isFanMerch:e.f_q_,fanMerchLogo:e.f_r_})).wire({"Changed.canPublish":function(){c.publish.set({enabled:d.get("canPublish")})},"Changed.isSaving":function(){c.save.set({enabled:d.get("isSaving")?o:"inherit"})},"Handle Constraints":function(n){var r=n.constraints,i=t.isArray(r)?r.length:0,s=-1;for(;++s<i;)h.setConstraint(r[s]);e.setConstraints(r,function(n,r){e.set({f_y:!t.isEmpty(n)});r&&r()})},"Handle Unsupported Areas":function(t){var n=t.unsupportedAreas;if(!e.f_w_)e.f_w_=Uize.Template.compile(e.getNode("unsupportedAreasMarkup").innerHTML,{openerToken:"[%",closerToken:"%]"});e.confirm({state:"warning",message:e.localize("areaGroupUnsupportedWarning",{areaList:e.f_w_({names:n}).replace(/\n/g,"")}),yesHandler:t.yesHandler,noHandler:t.noHandler})},"Launch Get Started":function(){e.f_x_();e.set({f_p_:o})},Message:function(t){e.inform({state:t.state,message:e.localize.apply(e,t.messageArguments)})}});e.set({f_B:e.get("productId"),experience:"ProductDesign"});e.callInherited("loadHtmlIntoNode")({node:e.getNode("designUi"),alwaysReplace:o},{cp:"ZazzleWww.DesignUi",pt:e.get("productType"),pd:e.get("productId"),showAddImageButton:e.f_y_,allowTiling:e.f_z_,idPrefix:e.childId("designUi")},function(){if(e.isWired){d.set({designUi:h=c.designUi});h.set({model:f,selectedDesignObjectsModel:l,dialogMooringNode:p.getNode(),dialogOffsetX:p.get("maxDim")});h.wireUi();e.updateUi();d.wire("zDesign Initialized",function(){n(o)});d.set({isControlling:s})}e.set({f_f_:s})})};for(g in v){if(!g.indexOf("design."))delete v[g]}if(!(e.f_A_&&e.f_A_.length))e.ajax({service:"product/productareas/get",pt:e.get("productType")},{cache:"memory",callback:function(t){if(t.success){e.set(t.data);y()}}});else y()})};l.f_C_=function(){var e=this,t=e.f_E_,n=e.children,i=n.designUi;if(e.isWired){n.toggleDesignUi.set({text:t?"+":"&minus;"});e.displayNode("designUi",!t);r.setState(e.getNode("designShell"),e.f_F_,t);!t&&i&&i.updateUi()}};l.f_G_=function(){var e=this,t=e.f_H_,n=e.children;if(e.isWired){if(e.f_m){n.toggleTemplateFieldsUi.set({text:t?"+":"&minus;"});e.displayNode("templatesFieldsUi",!t);r.setState(e.getNode("templatesFieldsShell"),e.f_F_,t);!t&&n.templateFields.updateUi()}}};l.f_x_=function(){var e=this;e.callInherited("useDialog")({component:{name:"ZazzleWww.GetStartedDialogUi",params:{pd:e.get("productType")}},widgetProperties:{name:"getStartedDialog",mooringNode:e.children.configurator.getNode(),offsetX:-50},submitHandler:function(t){e.fire({name:"Submit Get Started",data:t})}})};l.wireUi=function(){var t=this;if(!t.isWired){t.wireNode("templateTitle","click",function(){t.toggle("templateFieldsUiCollapsed")});t.wireNode("designUiTitle","click",function(){t.toggle("designUiCollapsed")});e.doMy(t,"wireUi");if(t.f_f_&&t.f_I)t.f_A.set({isControlling:s})}};l.updateUi=function(){var t=this;if(t.isWired){var n=!!t.f_I;t.displayNode("designShell",n);t.displayNode("actionButtons",n);t.displayNode("templatesFieldsShell",t.f_m&&!t.f_n);t.f_C_();t.f_G_();e.doMy(t,"updateUi")}};f.stateProperties({f_I_:"area",f_J_:"areaGroup",f_A_:"areaGroups",f_K_:{name:"autoSaveDelay",value:3e4},f_t:{name:"canPublish",value:o},f_m_:"defaultObjectProperties",f_n_:"defaultText",f_o_:"defaultImageId",f_r_:"fanMerchLogo",f_v:{name:"finishOnFinalize",value:s},f_L_:{name:"hideCloseButton",value:o},f_y:{name:"hasConstraints",value:o},f_M_:{name:"hasNewDesignTemplate",value:o},f_n:"hideTemplateFieldsUi",f_m:"includeTemplateFieldsUi",f_I:{name:"isDesigning",value:o},f_q_:"isFanMerch",f_p_:"launchGetStarted",f_a_:{name:"productizeOnFinalize",value:s},f_7:{name:"reviewBeforePurchase",value:o},f_y_:{name:"showAddImageButton",value:s},f_z_:{name:"allowTiling",value:s},f_N_:"supportedAreas",f_E_:{name:"designUiCollapsed",onChange:l.f_C_,value:o},f_H_:{name:"templateFieldsUiCollapsed",onChange:l.f_G_,value:o},f_w:{name:"isPosting",value:o},f_F_:"cssClassCollapsed",f_E:{onChange:function(){var e=this,t=e.children.designUi,n=e.f_E,r=e.f_A;t&&t.set({model:n});r&&r.set({designModel:n})}},f_f_:{conformer:function(e,t){return e||t},value:o},f_B:{conformer:function(e,t){return t||e}},f_A:{}});f.set({viewWidgetClass:i.ProductViewUi});return f}});Uize.module({name:"ZazzleWww.ProductDesignController",superclass:"Uize.Class",required:["Uize.Util.Coupler","Uize.Util.PropertyAdapter","Zazzle.DesignModel","Uize.Template"],builder:function(e){"use strict";var t=true,n=false,r=null,i,s=Uize,o=s.Util.Coupler,u=s.Util.PropertyAdapter,a=s.Data,f=zazzle.rlv;var l={text:{text:1,zttext:1},image:{image:1,spimage:1,ztimage:1},embroidery:{ztimage:1,zttext:1}};var c=e.subclass(function(){var e=this;e.c_k={};e.c_l={};e.c_m=[];e.c_n=[];e.c_o=[]},function(){var e=this;(function n(){setTimeout(function(){if(e.c_q){e.save();e.c_r.children.lastSavedFleeting.set({shown:t})}n()},e.c_s)})()}),h=c.prototype;h.c_u=function(){return"designObject"+ ++this.c_v};h.c_w=function(e){var t=this.c_y,n;if(t)(function r(){if(t.getState()==f.DesignState.WAITINGFORSERVER){if(n){clearTimeout(n)}n=setTimeout(r,0)}else e()})()};h.c_B=function(e){var t=this,n=t.c_y;if(n){if(t.c_z){clearTimeout(t.c_z);delete t.c_z}t.c_D++;t.c_z=setTimeout(function(){n&&n.update();e&&e()},100)}};h.c_E=function(e){return this.c_y?this.c_y.getArea(e||this.c_G):i};h.c_H=function(){var e=this,t=e.c_y,n=e.c_I,r=e.c_J,i;if(t&&n){i=t.getView({view:n.get("activeView"),max_dim:e.c_L});e.set({c_K:i});t.setActiveView(i);n&&n.updateModelView(i);if(r){if(i===r.get("view"))r.updateBounds();else r.set("view",i)}}};h.c_M=function(){var e=this;if(e.c_K){e.c_K.opts.max_dim=e.c_L;e.c_K.setNeedsGridRefresh(t)}if(e.c_J)e.c_J.updateBounds();if(e.c_y){e.c_y.opts.max_dim=e.c_L;e.c_y.setDirty();e.c_B()}};h.c_N=function(e,r,i){var o=this.c_k,u=function(){o[e]=n};if(!o[e]){o[e]=t;r(u)}else{s.isFunction(i)&&i(u)}};h.c_S=function(e,t){!this.c_k[e]&&t()};h.isTemplate=function(){return!!(this.c_y&&this.c_y.getTemplates().length)};h.c_T=function(){var e=this,t=e.c_E();if(t)e.c_N("synchronize",function(n){var r=t.getChildObjects(),i=e.c_J,o;if(i){i.sync(r);o=i.getDictionary();if(!e.c_X&&r.length&&s.isEmpty(o))i.add(r[0]);e.c_Y&&e.c_Y.syncDesignObjects(r,e.c_l,o);e.c_I&&e.c_I.syncDesignObjects(r,o,i.get("bounds"))}n()})};h.c_Z=function(){var e=this,r=e.c_0,s=r.length,o,u,a=e.c_G,f=e.c_E(),l=t,c=e.c_6,h=c?c.getName():"",p;for(;--s>=0;){o=r[s];u=o?o.areas:null;if(u&&a in u){p=c&&c.getFill();if(c&&(c.getChildObjects().length||p&&(p.fillcolor||p.strokecolor))&&h in u){e.c_6.setName(a);l=n}e.set({c_2:o.name});o.lastArea=a;break}}if(l){var d=e.c_J;d&&d.clear();e.c_T();if(d){var v=f?f.getChildObjects():i;v&&v.length&&d.add(v[0])}}e.c_B()};h.c_$_=function(e){!s.isArray(e)&&(e=[e]);var t=this,n=e.length,r=-1,i=t.c_0,o=i.length,u,a,f=[];for(;++r<n;){for(u=o;--u>=0;){a=i[u];if(e[r]in a.areas){f.push(a);break}}}return f};h.c_e_=function(){var e=this,t=e.c_f_,r=e.c_2,o=e.c_y;if(s.isArray(t)&&o){var u=e.c_0,a=u.length,f=-1,l=t.length,c=[],h=[],p,d=e.c_G,v=n,m,g,y,b,w,E;for(;++f<l;){m=t[f];for(y=a;--y>=0;){g=u[y];if(m in g.areas){b={displayName:g.areas[m].displayName||g.displayName||g.name};h.push({name:g.name,valueDetails:b});if(!r)r=g.name;if(g.name==r){c.push({name:m,valueDetails:b});if(!v){w=e.c_E(m);E=w&&w.getFill();v=w&&w.getChildObjects().length||E&&(E.fillcolor||E.strokecolor);if(v||d==m||!p){p=m}}}break}}}e.c_Y&&e.c_Y.set(Uize.copyInto({areaGroups:h,areas:c},p?{area:p}:i))}};h.c_q_=function(){var e=this,t=e.c_2;if(e.c_y){e.c_e_();e.c_r_();if(!e.c_s_||t in e.c_s_){var n=s.Data.findRecords(e.c_0,{name:t})[0];n&&e.c_Y&&e.c_Y.set({areaGroupDisplayName:n.displayName||t})}}};h.c_u_=function(e){var t=this,n=Uize.Data.findRecords(t.c_0,{name:e})[0],r;if(n){var s=n.lastArea,o=t.c_f_,u=Uize.isArray(o)?o.length:0,a=-1,f,l=n.areas;for(;++a<u;){f=o[a];if(s==f){r=s;break}else if(!r&&f in l)r=f}}return r?Uize.copyInto({name:r},n.areas[r]):i};h.c_r_=function(){var e=this;if(e.c_Y){var t=e.c_2,n=e.c_0,r=n.length,i=[],s,o;for(;--r>=0;){o=n[r];o.name!=t&&(s=e.c_u_(o.name))&&i.push({name:s.name,displayName:s.displayName||o.displayName})}e.c_Y.set({transferableAreas:i})}};h.c_z_=function(){var e=this,t=e.c_G;if(e.c_I)e.c_I.set({area:t});if(e.c_y){e.c_Z();e.c_6=e.c_E(t);e.c_r_()}};h.c_A_=function(){var e=this,r=e.c_r,i=e.c_B_,a=e.c_I,c=e.c_Y,h=e.c_J,p=e.c_y,d=e.c_l,v=function(t){e.c_S("synchronize",function(){var n=t.properties,r=[],i=e.c_H_,o=e.c_E(),u;if(o&&n&&s.isArray(n)&&n.length){s.forEach(n,function(t){var n=t.type,s=n in l.text?"text":n in l.image?"image":"",a,f,c,h;s==="image"&&(d[t.id.toLowerCase()]=t.title||t.id.toLowerCase());if(s){u=i[s];a=e.c_u();if(s==="image"){if(e.c_P_)e.c_y.opts.t_coverimage_iid=t.id;else f=o.addImage(a,t.id)}else{if(e.c_P_)e.c_y.opts.t_covertext_txt=t.title;else f=o.addText(a,t.title)}if(f){for(c in u){h=u[c];h&&c!=="fontheight"&&f.setProperty(c,h)}t.autosize&&f.scale("autosize",1);r.push(f)}else e.c_y.setDirty()}});if(r.length&&h){h.clear();h.add(r)}if(e.c_P_){e.c_y.opts.t__smart=true;e.c_y.opts.t_coverlogo_iid=e.c_Q_;e.c_y.opts.t__pickoption=false}e.c_B(function(){e.set("isFanMerch",false);s.forEach(["t__smart","t_coverlogo_iid","t_coverimage_iid","t_covertext_txt","t__pickoption"],function(t){delete e.c_y.opts[t]})})}})};if(h)h.wire(e.c_S_={Added:function(t){e.c_N("addingSelected",function(n){e.c_N("synchronize",function(e){a&&a.select(t.objects,t.bounds);c&&c.select(t.objects,t.bounds);n();e()},function(){n()})},function(e){e()})},Removed:function(t){e.c_N("synchronize",function(e){a&&a.select(t.objects,t.bounds,n);c&&c.select(t.objects,n);e()})},"Changed.numLocked":function(){c&&c.set({numLocked:h.get("numLocked")})},"Changed.mode":function(){c&&c.set({mode:h.get("mode")})}});if(a){e.set({c_W_:a.get("maxDim"),c_L:a.get("requestedMaxDim")});a.wire(e.c_X_={"Changed.activeView":function(){if(p){s.copyInto(p.opts,{view:a.get("activeView")});e.c_K&&e.c_K.setNeedsGridRefresh(t);p.setDirty();e.c_B()}},"Changed.area":function(){var t=a.get("area"),n=e.c_G,r=e.c_2,i=e.c_$_(t)[0].name;if(i!==r)e.set({c_2:i});else if(n!==t){if(p){var s=e.c_E(n);if(s){var o=s.getFill();if(!(s.getChildObjects().length||o&&(o.fillcolor||o.fillcolor)))e.set({c_G:n})}}else e.set({c_G:n})}},"Changed.maxDim":function(){e.set({c_W_:a.get("maxDim")})},"Changed.requestedMaxDim":function(){e.set({c_L:a.get("requestedMaxDim")})},"Hotspot Over":function(e){c&&c.setDesignObjectState("over",e.hotspot.get("model"))},"Hotspot Out":function(e){c&&c.setDesignObjectState("out",e.hotspot.get("model"))},"Hotspot Selected":function(e){h&&h.add(e.hotspot.get("model"))},"Hotspot Unselected":function(e){h&&h.remove(e.hotspot.get("model"))},Add:v,"Bounds Changed":function(t){e.c_S("synchronize",function(){var n=e.c_K,r=e.c_E();if(h&&n){var i=h.get("bounds"),s=h.getSelected(),o=Math.round(i.left),u=Math.round(i.top),a=Math.round(i.width),f=Math.round(i.height),l=Math.round(t.top),c=Math.round(t.left),p=Math.round(t.width),d=Math.round(t.height),v=c+p/2-(o+a/2),m=l+d/2-(u+f/2),g=Math.round(p/a*Math.pow(10,7))/Math.pow(10,7),y=Math.round(d/f*Math.pow(10,7))/Math.pow(10,7),b=(Math.round(g*100)/100!=1||Math.round(y*100)/100!=1)&&(a!=p||f!=d),w=b||Math.round(v*100)/100||Math.round(m*100)/100,E;b&&r&&r.scale(s,g,y);if(w&&s.length){E=s[0].getBounds(n)[0];n.getViewArea(e.c_G).moveScreenSpace(s,o+a/2,u+f/2,v,m)}(w||b)&&e.c_B()}})},Rotate:function(t){e.c_S("synchronize",function(){var n=e.c_E();if(n&&h){n.rotate(h.getSelected(),t.rotation,!!t.isAbsolute);e.c_B()}})},Track:function(t){e.c_S("synchronize",function(){e.c_m.push(t.code)})},Undo:function(){e.c_S("synchronize",function(){if(p){p.undo();e.c_w(function(){e.c_fa=t});e.c_B()}})},Redo:function(){e.c_S("synchronize",function(){if(p){p.redo();e.c_B()}})}})}if(c){c.wire(e.c_ga={"Design Object UI Over":function(e){a&&a.setHotspotState("over",e.designObjectUi.get("model"))},"Design Object UI Out":function(e){a&&a.setHotspotState("out",e.designObjectUi.get("model"))},"Design Object UI Selected":function(e){h&&h.add(e.designObjectUi.get("model"))},"Design Object UI Unselected":function(e){h&&h.remove(e.designObjectUi.get("model"))},Add:v,Align:function(t){e.c_S("synchronize",function(){if(h){var n=t.align;s.forEach(h.getSelected({type:"text"}),function(e){e.setAlign(n)});e.c_B()}})},"Background Changed":function(n){e.c_S("synchronize",function(){var r=e.c_E();if(r){var i=r.getFill();r.setFill(new f.DesignFill(t,n.bg,i&&i.strokecolor||"",i&&i.strokewidth));e.c_B()}})},"Border Changed":function(t){e.c_S("synchronize",function(){var n=e.c_E();if(n){var r=n.getFill();n.setFill(new f.DesignFill(!!(r&&r.solid),r&&r.fillcolor||"",t.border,+t.strokewidth));e.c_B()}})},Clear:function(){if(e.c_ia)return;e.c_S("synchronize",function(){var t=e.c_E();if(t){t.cut(t.getChildObjects());e.c_B()}})},"Color Changed":function(t){e.c_S("synchronize",function(){if(h){var n=t.color;s.forEach(h.getSelected({type:"text"}),function(e){e.setProperty("color",n)});e.c_B()}})},Copy:function(){var t=e.c_E();if(t&&h){t.copy(h.getSelected());e.c_B()}},Cut:function(){var t=e.c_E();if(t&&h){t.cut(h.getSelected());e.c_B()}},Edit:function(t){if(h){var n=t.text,r=n||t.id;if(r){s.forEach(h.getSelected({type:n?"text":"image"}),function(e){n?e.setValue(r):e.setImageid(r)});e.c_B()}}},Fill:function(){e.c_S("synchronize",function(){var n=e.c_E();if(n&&h){n.layout(h.getSelected({type:"image"}),"fill",[new f.DesignProperty("fillto","bleed"),new f.DesignProperty("group",t)]);e.c_B()}})},Fit:function(){e.c_S("synchronize",function(){var n=e.c_E();if(n&&h){n.layout(h.getSelected({type:"image"}),"fit",[new f.DesignProperty("fillto","bleed"),new f.DesignProperty("group",t)]);e.c_B()}})},"Font Face Changed":function(t){e.c_S("synchronize",function(){if(h){var n=t.face;if(n){s.forEach(h.getSelected({type:"text"}),function(e){e.setProperty("face",n)});e.c_B()}}})},"Font Height Changed":function(t){e.c_S("synchronize",function(){if(h){var n=t.fontheight;s.forEach(h.getSelected({type:"text"}),function(e){e.setProperty("height",n*10)});e.c_B()}})},Paste:function(){var t=e.c_E();t&&t.paste();e.c_B()},Reordered:function(t){var n=e.c_E();if(n&&h){var r=t.reorderedModels||h.getSelected(),i=t.above;n.reorderAbove(r,i);e.c_B()}},Lock:function(n){e.c_S("synchronize",function(){if(h){var r=n.isLocked;s.forEach(h.getSelected({locked:t}),function(e){e.setProperty("locked",r)});e.c_B()}})},Move:function(n){e.c_S("synchronize",function(){var r=e.c_E(),i=e.c_K;if(i&&r){var s=n.space,o=n.x,u=n.y,a=n.dx,l=n.dy,c=h.getSelected();if(n.snap){for(var p in{center:1,vcenter:1,hcenter:1,top:1,bottom:1,left:1,right:1})if(n[p])r.layout(c,"align",[new f.DesignProperty("align",p),new f.DesignProperty("alignto",n.alignto||"design"),new f.DesignProperty("group","group"in n?n.group:t)])}else{s==="screen"?i.moveScreenSpace(c,o,u,a,l):s==="design"?r.moveDesignSpace(c,o,u,a,l):r.moveObjectSpace(c,o,u,a,l)}e.c_B()}})},"Path Changed":function(t){e.c_S("synchronize",function(){var n=f.DesignTextPath[t.path.toUpperCase()];s.forEach(h.getSelected({type:"text"}),function(e){e.setPath(n)});e.c_B()})},"Radius Changed":function(t){e.c_S("synchronize",function(){var n=t.radius;s.forEach(h.getSelected({type:"text"}),function(e){e.setArc(n)});e.c_B()})},RecolorImage:function(t){s.forEach(h.getSelected({type:"image"}),function(e){e.setProperty("colors",t.colors)});e.c_B()},Remove:function(t){e.c_S("synchronize",function(){var n=e.c_E();if(h&&n){var r=t.designObjects||h.getSelected();if(r.length){n.remove(r);e.c_B()}}})},Rotate:function(t){e.c_S("synchronize",function(){var n=e.c_E();if(n&&h){n.rotate(h.getSelected(),t.rotation,!!t.isAbsolute);e.c_B()}})},Scale:function(t){e.c_S("synchronize",function(){var n=e.c_E();if(n&&h){var r=t.direction,i=1+(r==="+"||-1)*(t.accelerate?.3:t.decelerate?.01:.1);n.scale(h.getSelected({type:"image"}),i,i);e.c_B()}})},"Set As Transparent":function(t){e.c_S("synchronize",function(){if(h){var n=t.isTransparent;s.forEach(h.getSelected({type:"image"}),function(e){e.setProperty("whitetransparent",n)});e.c_B()}})},"Set Template":function(t){e.c_S("synchronize",function(){if(h){var n=t.isTemplate,r=t.urlkey,i=t.title,o=t.ppshow,u=t.fitMode;s.forEach(h.getSelected(),function(e){if(n)e.setTemplate(r,i,o);else e.removeTemplate();e instanceof f.DesignImage&&e.setProperty("fillmode",n?u:"none")});e.c_B()}})},Space:function(t){e.c_S("synchronize",function(){var n=e.c_E();if(n&&h){n.layout(h.getSelected(),t.horizontal?"horz":"vert");e.c_B()}})},Tile:function(r){e.c_S("synchronize",function(){var i=r.tile?"tile":"",o=n;s.forEach(h.getSelected({type:"image"}),function(e){var n=e.getProperty("layout");if(n||!n&&i){e.setProperty("layout",i);o=t}});if(o)e.c_B()})},Track:function(t){e.c_S("synchronize",function(){e.c_m.push(t.code)})},Transfer:function(t){var n=e.c_E();if(h&&n){n.transfer(h.getSelected(),t.area);e.set({c_G:t.area});e.c_B()}},"Update Default Design Object Properties":function(t){e.set({c_H_:s.mergeInto(e.c_H_,t.newDefaults)})},Undo:function(){e.c_S("synchronize",function(){if(p){p.undo();e.c_w(function(){e.c_fa=t});e.c_B()}})},Redo:function(){e.c_S("synchronize",function(){if(p){p.redo();e.c_B()}})}})}if(r){var m=function(t){if(p){s.copyInto(p.opts,t);p.setDirty();e.c_B()}};r.wire(e.c_Ka={"Changed.areaGroups":function(){e.set({c_0:r.get("areaGroups")})},"Changed.productOption":function(){m(s.copyInto({},r.get("productOption"),r.get("designAttributes")))},"Changed.templateParams":function(){m(r.get("templateParams"))},Finish:function(n){if(p){a&&s.copyInto(p.opts,{view:a+""});e.c_w(function(){var i=!!r.get("isPosting");if(r.get("finishOnFinalize"))p.finish(i);else p.save();e.c_Ma=function(){e.set({c_Na:t});e.c_m.length&&(i||!(Math.round(Math.random()*10)%10))&&r.fire({name:"Track Event",bubble:t,extra:{ax:"dtool",a:e.c_m.join("").substring(0,1500),pdt:r.get("productType"),post:+i}});s.isFunction(n.callback)&&n.callback()}});e.c_B()}},"Submit Get Started":function(e){var n=e.data.templateFields,r=s.isArray(n)?n.length:0,i=-1,o,u,a,f=[],l=c&&c.get("process")==="stitch",h,p=[];for(;++i<r;){o=n[i];u=o.type,h=u==="image";a=o.value;if(a){f.push(s.copyInto({type:u},h?{id:a,autosize:t}:{title:a}));l&&h&&p.push(a)}}if(l&&p.length>0){c.filterAddImages(p,function(e){e&&e.length&&v({properties:f})})}else v({properties:f})},Save:function(){e.save()}});e.set({c_0:r.get("areaGroups"),c_Va:r.get("templateParams"),c_Wa:r.get("designAttributes")});!s.isEmpty(r.get("templateParams"))&&r.set("templateParams",{})}var g=function(e){for(var t in e)return t},y=e.c_n,b=e.c_o;if(r){b.push(new o({instances:[r,e],properties:["launchGetStarted"]}));y.push(new u({propertyA:{instance:r,property:"hasNewDesignTemplate"},propertyB:{instance:e,property:g({c_Za:1})}}));y.push(new u({propertyA:{instance:r,property:"area"},propertyB:{instance:e,property:g({c_G:1})}}));y.push(new u({propertyA:{instance:r,property:"areaGroup"},propertyB:{instance:e,property:g({c_2:1})}}));y.push(new u({propertyA:{instance:r,property:"productOption"},propertyB:{instance:e,property:g({c_0a:1})}}));y.push(new u({propertyA:{instance:r,property:"designId"},propertyB:{instance:e,property:g({c_1a:1})}}));y.push(new u({propertyA:{instance:r,property:"designAttributes"},propertyB:{instance:e,property:g({c_Wa:1})}}));y.push(new u({propertyA:{instance:r,property:"supportedAreas"},propertyB:{instance:e,property:g({c_f_:1})}}));if(a){b.push(new o({instances:[r,a],properties:["designId"]}));e.c_2a={};e.c_2a["Changed."+g({c_Wa:1})]=function(){a.set({designAreas:e.c_Wa["design.areas"]})};e.wire(e.c_2a)}if(c)b.push(new o({instances:[r,c],properties:["area","areaGroup"]}))}e.c_e_();if(p){p.addDesignListener(e.c_3a=function(t){e.c_4a(t)});p.useDesignSpace(t);e.c_H();s.copyInto(p.opts,e.c_0a,e.c_Wa,e.c_Va);e.c_B()}};h.c_5a=function(){var e=this,t=e.c_n,r=e.c_o,s;if(e.c_J&&e.c_S_){e.c_J.unwire(e.c_S_);e.c_S_=i}if(e.c_I&&e.c_X_){e.c_I.unwire(e.c_X_);e.c_X_=i;Uize.isFunction(e.c_2a)&&e.unwire(e.c_2a)}if(e.c_Y&&e.c_ga){e.c_Y.unwire(e.c_ga);e.c_ga=i}if(e.c_r&&e.c_Ka){e.c_r.unwire(e.c_Ka);e.c_Ka=i}for(s=r.length;--s>=0;)r[s].set({coupled:n,instances:i,properties:i});for(s=t.length;--s>=0;)t[s].set({connected:n,propertyA:i,propertyB:i,valueAdapter:i});e.set({c_n:[],c_o:[]});if(e.c_y&&e.c_3a){e.c_y.removeDesignListener(e.c_3a);e.c_3a=i}};h.c_6a=function(){if(this.c_7a){this.c_5a();this.c_A_()}};h.c_4a=function(e){var o=this,u=o.c_y;if(e.success){if(s.isFunction(o.c_Ma)){o.c_Ma();delete o.c_Ma}else{if(o.c_Va){var f=o.c_Va,l;for(l in f)if(l in u.opts)delete u.opts[l];o.set({c_Va:r})}var c=s.clone(u.getAttributes()),h=o.c_Wa,p=o.c_0a,d,v={},m,g=o.c_1a;delete c.view;delete c.context;delete c.title;for(d in p){m=!d.indexOf("design.");d in c&&!m&&(v[d]=c[d]);if(!m)delete c[d]}v=s.copyInto(s.clone(p),v);if(a.identical(v,p)){if(!o.c_cb)o.c_cb={};var y=o.c_cb,b=o.c_$_(o.c_f_),w={},E=b.length,S=o.c_0,x=[],T,N=function(){var e={},n=u.getAreas(),f=n.length,l=f,p,d,v;for(;--l>=0;){d=n[l];if(d.getChildObjects().length){p=d.getName();v=o.c_$_(p)[0];e[v.name]={c_pb:v,c_G:p}}}o.c_cb=e;o.set(s.copyInto({c_1a:u.getId()},a.identical(c,h)?i:{c_Wa:c}));o.c_H();o.c_Y&&o.c_Y.set({canPaste:u.canPaste(),canUndo:u.isUndoable(),canRedo:u.isRedoable(),templates:u.getTemplates()});var m=o.c_2,y=Uize.Data.findRecords(S,{name:m})[0],b=y?y.areas:i,w={},E,x,T;if(b){for(l=f;--l>=0;){E=n[l];x=E.getName();if(x in b){var N=E.getFill();N&&(N.fillcolor||N.strokecolor)&&(w[x]=1);if(E.getChildObjects().length){o.set({c_G:x});T=i;break}}}}if(!Uize.isEmpty(w)&&!(o.c_G in w)){for(var C in w){o.set({c_G:C});break}}o.c_T();o.fire({name:"Handle Constraints",constraints:u.getConstraints()});o.c_I&&o.c_I.set({canUndo:u.isUndoable(),canRedo:u.isRedoable()});if(!o.c_X||o.c_D>1){o.c_wb=t;var k=o.c_I;if(k){var L=k.get("cacheDefeat");k.set("cacheDefeat",L?L+1:Uize.now())}}o.c_r&&o.c_r.set({canPublish:!!u.canPublish()});if(!o.c_yb){var A=f,O=o.c_Ab,M=o.c_Bb,_=-1,D,P=o.c_f_,H=o.c_G,B,j,F,I,q;o.c_yb=t;if(O||M){O&&H.addText(o.c_u(),O);M&&H.addImage(o.c_u(),M);o.c_B()}else if(o.c_Jb)o.fire("Launch Get Started");if(o.c_Kb||!o.c_Za){for(;--A>=0;){E=n[A];for(B=E.getChildObjects(),j=B.length;--j>=0;){q=B[j];F=B[j].getName();if(!F.indexOf("designObject")){I=+F.replace("designObject","");if(s.isNumber(I))_=Math.max(_,I)}if(!j&&!D)D=E}if(E.getName()===o.c_G)o.set({c_6:E})}}if(D){var R=D.getName();if(o.c_G==R)o.c_z_();else o.set({c_G:D.getName()})}else if(s.isArray(P)&&P.length)o.set({c_G:s.isIn(P,H)?H:P[0]});if(I!=-1)o.c_v=_;if(g===o.c_1a&&o.c_I&&!o.c_I.model.get("realviewsInfo"))o.c_I.model.update();o.fire("zDesign Initialized")}if(o.c_6&&o.c_Y){var N=o.c_6.getFill(),U=o.c_Y,z={type:N?N.solid?"bg":"border":r,fillcolor:N?N.fillcolor:"",strokecolor:N?N.strokecolor:"",strokewidth:N?N.strokewidth:""};!a.identical(z,U.get("areaFillProperties"))&&U.set("areaFillProperties",z)}};if(!o.c_fa){for(;--E>=0;)w[b[E].name]=1;for(T in y){if(!(T in w))x.push(y[T])}}else o.c_fa=n;if(x.length){var C=[],k=-1,L=x.length,A;for(;++k<L;){A=x[k];C.push(A.c_pb.areas[A.c_G].displayName||A.c_G)}o.fire({name:"Handle Unsupported Areas",unsupportedAreas:C,yesHandler:N,noHandler:function(){u.undo();o.c_w(function(){o.c_fa=t});o.c_B()}})}else N()}else o.set({c_0a:v,c_Wa:a.identical(c,h)?h:c})}o.c_Qb=0}else{var O;switch(e.design.serverResult.Code){case 301:O="imagePermissionsError";break;case 302:O="customizeError";break;case 11108:if((o.c_Qb||0)<5){o.c_Qb=(o.c_Qb||0)+1;o.c_y.setDirty();o.c_B()}break;default:O="rlvnetError"}O&&o.fire({name:"Message",messageArguments:[O],state:"error"})}o.set({c_X:n,c_D:0})};h.save=function(){var e=this;if(e.c_y&&!e.c_Na&&!e.c_X&&e.c_wb&&(!e.c_I||e.c_I.get("canSave"))&&(!e.c_Y||e.c_Y.get("canSave"))){e.set({c_X:t});e.c_y.save();e.c_B();e.set({c_wb:n})}};h.getDesignAttributes=function(){return this.c_y?this.c_y.getAttributes():i};c.stateProperties({c_7a:{name:"isControlling",onChange:function(){this.c_7a?this.c_A_():this.c_5a()},value:n},c_r:{name:"productUi",onChange:h.c_6a},c_B_:{name:"productConfiguratorUi",onChange:h.c_6a},c_I:{name:"productViewUi",onChange:h.c_6a},c_Sb:{name:"templateUi",onChange:h.c_6a},c_Y:{name:"designUi",onChange:h.c_6a},c_J:{name:"selectedDesignObjectsModel",onChange:h.c_6a},c_y:{name:"designModel",onChange:h.c_6a},c_Tb:{name:"areasModel",onChange:h.c_6a},c_s:{name:"autoSaveDelay",value:3e4},c_q:{name:"enableAutoSave",value:n},c_H_:"defaultObjectProperties",c_Ab:"defaultText",c_Bb:"defaultImageId",c_Na:{name:"isFinished",value:n},c_X:{name:"isSaving",value:n},c_Ub:{name:"hasConstraints",value:n},c_Jb:"launchGetStarted",c_P_:"isFanMerch",c_Q_:"fanMerchLogo",c_G:{onChange:h.c_z_},c_2:{onChange:h.c_q_,conformer:function(e,t){return!this.c_s_||e in this.c_s_?e:t}},c_0:{onChange:h.c_e_},c_s_:{},c_o:{},c_6:{},c_Wa:{},c_1a:{},c_K:{},c_v:{value:-1},c_Za:{value:n},c_wb:{},c_l:{},c_Va:{},c_yb:{value:n},c_k:{},c_D:{value:0},c_0a:{},c_n:{},c_2a:{},c_f_:{onChange:h.c_e_},c_W_:{},c_L:{onChange:h.c_M},c_m:{}});return c}});Uize.module({name:"Zazzle.SelectedDesignObjectsModel",superclass:"Uize.Class",builder:function(e){"use strict";var t=e.subclass(function(){var e=this;e.c_a={};e.c_b=[];e.c_c=[];e.c_d=[];e.c_e=[]}),n=t.prototype;n.c_g=function(){this.set({c_h:this.c_h+1})};n.getSelected=function(e){var t=this;if(!e)return t.c_c;var n=t.c_a,r=e.name,i=t.c_b,s=e.type==="text"?zazzle.rlv.DesignText:e.type==="image"?zazzle.rlv.DesignImage:undefined;if(s&&e.locked){for(var o=i.length,u=-1,a=[],f;++u>o;){f=i[u];f instanceof s&&a.push(f)}return a}return r in n?n[r].c_p:e.locked?i:s===zazzle.rlv.DesignText?t.c_d:t.c_e};n.getDictionary=function(){return this.c_a};n.add=function(e){Uize.isArray(e)||(e=[e]);var t=this,n=-1,r=e.length,i=t.c_a,s=t.c_b,o=t.c_c,u=t.c_d,a=t.c_e,f=t.c_s,l=t.c_t,c=zazzle.rlv.DesignImage,h,p,d,v,m,g;for(;++n<r;){h=e[n];d=h.isLocked();g=h.getName();v=i[h.getName()];if(v){if(v===h)continue;else{t.remove(v.c_p,true);if(d)l--;f=u.length&&a.length?"combined":u.length?"text":a.length?"image":""}}v=i[h.getName()]={c_p:h,c_B:s.length};s.push(h);if(!d){v.c_C=o.length;o.push(h)}else l++;if(h instanceof c){v.c_D=a.length;a.push(h);p="image"}else{v.c_E=u.length;u.push(h);p="text"}f=!f||p===f?p:"combined"}t.set({c_s:f,c_t:l});t.c_F();t.c_g();t.fire({name:"Added",objects:e,bounds:t.c_G,allBounds:t.c_H})};n.remove=function(e,t){Uize.isArray(e)||(e=[e]);var n=this,r=n.c_a,i=-1,s=e.length,o=n.c_t,u=n.c_b,a=n.c_c,f=n.c_d,l=n.c_e,c=zazzle.rlv.DesignImage,h,p,d,v,m,g,y,b,w,E;for(;++i<s;){h=e[i];d=h.getName();p=r[d];if(p){for(g=u.length;--g>=0;){y=u[g];if(y.getName()===d){u.splice(g,1);break}}if(!h.isLocked()){for(g=a.length;--g>=0;){y=a[g];if(y.getName()===d){a.splice(g,1);break}}}else o--;for(E=h instanceof c,g=E?l.length:f.length,w=E?l:f;--g>=0;){y=w[g];if(y.getName()===d){w.splice(g,1);break}}delete n.c_a[d]}}if(!t){v=f.length&&l.length?"combined":f.length?"text":l.length?"image":"";n.set({c_s:v,c_t:o});n.c_F();n.c_g();n.fire({name:"Removed",objects:e,bounds:n.c_G,allBounds:n.c_H})}};n.sync=function(e){var t=this,n=Uize.isArray(e)?e.length:0,r=t.c_a,i={},s=[],o=[],u=[],a=[],f=0,l=zazzle.rlv.DesignImage,c,h,p,d,v;for(;--n>=0;){c=e[n];p=c.getName();if(p in r){h=i[p]={c_p:c,c_B:s.length};s.push(c);if(!c.isLocked()){h.c_C=o.length;o.push(c)}else f++;if(c instanceof l){h.c_D=a.length;a.push(c)}else{h.c_E=u.length;u.push(c)}}}t.c_a=i;t.c_b=s;t.c_c=o;t.c_d=u;t.c_e=a;v=u.length&&a.length?"combined":u.length?"text":a.length?"image":"";t.set({c_s:v,c_t:f});t.c_F();t.c_g()};n.updateBounds=n.c_F=function(){var e=this,t=e.c_b,n=t.length,r=[Infinity,Infinity],i=[Infinity,Infinity],s=[-Infinity,-Infinity],o=[-Infinity,-Infinity],u,a,f,l,c;for(;--n>=0;){u=t[n];a=u.getBounds(e.c_5);if(a.length){f=a[0];l=a[1];if(!u.isLocked()){r[0]=Math.min(r[0],f.y);i[0]=Math.min(i[0],f.x);o[0]=Math.max(o[0],l.x);s[0]=Math.max(s[0],l.y)}r[1]=Math.min(r[1],f.y);i[1]=Math.min(i[1],f.x);o[1]=Math.max(o[1],l.x);s[1]=Math.max(s[1],l.y)}}e.set({c_H:r[1]===Infinity||i[1]===Infinity||s[1]===-Infinity||o[1]===-Infinity?{}:{top:r[1],left:i[1],width:o[1]-i[1],height:s[1]-r[1]},c_G:r[0]===Infinity||i[0]===Infinity||s[0]===-Infinity||o[0]===-Infinity?{}:{top:r[0],left:i[0],width:o[0]-i[0],height:s[0]-r[0]}})};n.clear=function(){var e=this;e.c_a={};e.c_b=[];e.c_c=[];e.c_d=[];e.c_e=[];e.set({c_H:{},c_G:{},c_s:undefined,c_t:0});e.c_g();e.fire("Cleared")};t.stateProperties({c_H:{name:"allBounds",value:{}},c_G:{name:"bounds",value:{}},c_s:"mode",c_t:{name:"numLocked",value:0},c_h:{name:"rev",value:0},c_5:{name:"view",onChange:n.c_F}});return t}});Uize.module({name:"Uize.Dom.VirtualEvent",required:"Uize.Dom.Basics",builder:function(){"use strict";function t(e){return e.toLowerCase().replace(/\s+/g,"")}var e={};return Uize.package({resolve:function(n){var r=n.indexOf("("),i=Uize.eval("(["+n.slice(r+1,-1)+"])");return(e[n=n.slice(0,r)]||e[t(n)]).apply(0,i)},getCached:function(t,n){return e[t]||(e[t]={virtualDomEvent:t,wire:n})},register:function(n,r){return e[n]=e[t(n)]=r}})}});Uize.module("Uize.Dom.VirtualEvents");Uize.module({name:"Uize.Dom.VirtualEvents.Remain",required:["Uize.Dom.Basics","Uize.Dom.VirtualEvent"],builder:function(){"use strict";function s(t){e[t]=e.makeRemainInStateEventMaker.apply(0,arguments)}var e=function(){},t=true,n=false,r=Uize.Dom.Basics,i=Uize.Dom.VirtualEvent;e.makeRemainInStateEventMaker=function(e,s,o,u,a,f){return i.register(e,function(l){l=Uize.toNumber(l,s);return i.getCached(e+"("+l+")",function(e,i,s){function c(t,n){if(Uize.isArray(t)){for(var i=t.length;--i>-1;)r.wire(e,t[i],n,s)}else{r.wire(e,t,n,s)}}var h={},p=n,d,v=function(){d=clearTimeout(d)};c(o,function(r){a!==n&&v();if(!d&&(!p||f!==n)){Uize.copyInto(h,r);d=setTimeout(function(){p=t;i.call(e,h)},l)}});c(u,function(){p=n;v()})})})};s("keyRemainDown",500,"keydown","keyup",n);s("keyRemainUp",500,"keyup","keydown");s("mouseRemainDown",500,"mousedown",["mouseup","mouseout"]);s("mouseRemainOut",500,"mouseout","mouseover");s("mouseRemainOver",500,["mouseover","mousemove"],["mouseout","mousedown"],n);s("mouseRemainUp",500,"mouseup","mousedown");s("mouseRest",500,["mouseover","mousemove"],["mouseout","mousedown"],t,n);s("remainBlurred",500,"blur","focus");s("remainFocused",500,"focus","blur");return e}});Uize.module({name:"Uize.Widget.CollectionItem.Zooming",required:["Uize.Node","Uize.Dom.VirtualEvents.Remain","Uize.Fade"],builder:function(e){"use strict";function i(e,t){var n="border"+Uize.capFirstChar(t);return r.getStyle(e,n+"Style")=="none"?0:+r.getStyle(e,n+"Width").replace(/px/i,"")||0}function s(e){var t=e.e_h;return Uize.isFunction(t)?t.call(e):t}function o(){this.set({e_j:this.e_k&&this.e_l>1&&!!this.e_h})}function u(){this.set({e_n:this.e_k&&this.e_o})}function a(){var e=this;e.set({e_q:(e.get("over")||e.e_k)&&e.e_l>1&&!!e.e_h})}function f(){this.set({e_s:this.e_k&&!this.e_o})}function l(){var e=this,t=e.isWired?e.getNode("previewZoom"):n;e.set({e_o:t&&t.Uize_Widget_CollectionItem_Zooming_src==s(e)})}function c(e,n,o){if(e.isWired){var u=n=="previewZoom";if(o){var a=e.getNode("preview");e.e_A=r.getCoords(e.getNode("previewShell")||(a?a.parentNode:null));var f=e.e_B=r.getDimensions(a);f.width-=i(a,"left")+i(a,"right");f.height-=i(a,"top")+i(a,"bottom");var c=a.parentNode;r.setStyle(c,{overflow:"hidden",height:c.offsetHeight-i(c,"top")-i(c,"bottom")});if(!e.getNode(n)){e.flushNodeCache(n);var h=a.cloneNode(t);r.setProperties(h,{id:e.get("idPrefix")+"-"+n,title:""});r.setStyle(h,{left:0,top:0,border:"none",width:f.width,height:f.height,position:"absolute",backgroundImage:""});a.parentNode.appendChild(h);(u?m:v).call(e);n=="previewZoom"&&e.wireNode(n,"load",function(){l.call(e)})}}e.displayNode(n,o);if(o){var p=u?s(e):e.e_G,d=e.getNode(n);p!=d.Uize_Widget_CollectionItem_Zooming_src&&p!=d.src&&e.setNodeProperties(d,{src:p,Uize_Widget_CollectionItem_Zooming_src:p})}}}function h(e){e.isWired&&e.e_G&&e.setNodeProperties("preview",{src:e.e_G})}function p(){var e=this;if(e.isWired&&(e.e_q&&e.e_s||e.e_j&&e.e_n)){var t={},n=function(n){var r=n?"height":"width";t[n?"top":"left"]=e.get(n?"alignY":"alignX")*(e.e_A[r]-(t[r]=e.e_B[r]*e.e_N))};n(0);n(1);e.setNodeStyle(e.e_n?"previewZoom":"previewZoomLowRes",t)}}function d(e,t,n){if(e.isWired){n&&p.call(e);e.showNode(t,n)}}function v(){d(this,"previewZoomLowRes",this.e_s)}function m(){d(this,"previewZoom",this.e_n)}var t=true,n=false,r=Uize.Node;return e.subclass({omegastructor:function(){var e=this;e.wire("Changed.over",function(t){if(!t.newValue){e.isWired&&e.unwireNode(document.documentElement,"mousemove");e.set({inUse:n})}a.call(e)})},instanceMethods:{updateUi:function(){h(this);e.doMy(this,"updateUi")},wireUi:function(){var n=this;if(!n.isWired){var i=n.getNode("preview"),s=n.getNode("previewShell")||(i?i.parentNode:null);n.e_G||n.set({e_G:i.src});n.wireNode(s,Uize.Dom.VirtualEvents.Remain.mouseRest(150),function(){if(!n.get("over"))return;if(n.e_l>1){n.set({inUse:t});var e=function(){function i(r){return Uize.constrain((e[r?"top":"left"]-(n.e_A[r?"y":"x"]+t))/(n.e_A[r?"height":"width"]-t*2),0,1)}var e=r.getEventAbsPos(),t=n.e_U;n.e_A&&n.set({e_W:i(0),e_X:i(1)})};e();n.wireNode(document.documentElement,"mousemove",e)}});e.doMy(n,"wireUi")}}},stateProperties:{e_W:{name:"alignX",onChange:p,value:0},e_X:{name:"alignY",onChange:p,value:0},e_U:{name:"deadMargin",value:20},e_N:{name:"displayedZoomPower",onChange:p,value:1},e_k:{name:"inUse",onChange:[u,o,f,a,function(){var e=this;if(e.isWired){if(e.e_k){var r=s(e);if(r){if(e.e_l>1){e.e_Y=t;e.e_Z||(e.e_Z=Uize.Fade()).wire("Changed.value",function(t){e.set({e_N:t.newValue})});e.e_Z.start(Uize.copyInto({startValue:1,endValue:e.e_l},e.e_0))}else{e.setNodeProperties("preview",{src:r})}e.set({e_1:t})}}else{if(e.e_Y){e.e_Z.stop();e.set({e_N:1});e.e_Y=n}else{h(e)}e.set({e_1:n})}}}],value:n},e_G:{name:"previewUrl",onChange:[l,function(){h(this)}]},e_h:{name:"previewZoomUrl",onChange:[o,a]},e_1:{name:"showingPreview",value:n},e_l:{name:"zoomPower",onChange:[o,a],value:1},e_0:{name:"zoomFadeProperties",value:{duration:600,curve:Uize.Fade.celeration(0,1)}},e_o:{onChange:[u,f],value:n},e_j:{onChange:function(){c(this,"previewZoom",this.e_j)},value:n},e_n:{onChange:m,value:n},e_q:{onChange:function(){c(this,"previewZoomLowRes",this.e_q)},value:n},e_s:{onChange:v,value:t}}})}});Uize.module({name:"Zazzle.GridCell",superclass:"Uize.Widget.CollectionItem.Zooming",required:["Uize.Node.Classes","Uize.Url","Zazzle.Checkbox"],builder:function(e){"use strict";var t=null;var n=e.subclass(t,function(){var e=this,t=e.f_c&&e.addChild("selected",Zazzle.Checkbox);t&&new Uize.Util.PropertyAdapter({propertyA:{instance:e,property:"selected"},propertyB:{instance:t,property:"value"}});e.wire("Changed.showingPreview",function(){var t=e.getNode("previewZoom"),n=e.getNode("previewZoomLowRes");if(t)Uize.Node.Classes.addClass(t,e.f_f);if(n)Uize.Node.Classes.addClass(n,e.f_f)})});n.set({cssClassActive:"selected",cssClassOver:"over",cssClassImage:"realviewImage",cssClassImageOver:"realviewImageHover",previewZoomUrl:function(){var e=this,r=t,i=e.get("previewUrl"),s=e.get("zoomPower");if(s>1)r=n.setUrlMaxDim(i,n.getUrlMaxDim(i)*s);return r},zoomPower:2.5});var r=/(max_dim=)(\d+)(.*)/,i=/(_)(\d+)(\.[^\.]*(\?|#|$))/;n.getUrlMaxDim=function(e){var t=e.match(r)||e.match(i);if(t&&t.length>1)return t[2];else return"1"};n.setUrlMaxDim=function(e,t){function s(e,r,i,s){n=true;return r+Math.min(Math.round(t),2e3)+s}var n;var o=e.replace(r,s);if(!n)o=e.replace(i,s);return o};n.stateProperties({f_c:"showSelectUi",f_f:"cssClassPreviewZoom"});return n}});Uize.module({name:"Zazzle.GridCell.Product",required:["Uize.Url","Uize.Node","Uize.Node.Classes"],builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize,s=i.Url,o=i.Node,u=o.Classes;var a=e.subclass(r,function(){var e=this,r=e.get("properties"),a;e.g_i=a=e.get("productType")||r.pt||r.pdt;if(e.getNode()){e.g_j=e.getNode("preview").src;e.g_k=r.pid||r.pd;e.g_l=r.un;var f=e.g_m=r.views,l=e.g_n=r.multiviews;if(l){e.g_o=-1;for(var h=0;h<l.length;++h){if(l[h].isCurrent){e.g_o=h;break}}e.g_o==-1&&(e.g_n=undefined)}else if(f&&a!="zazzle_shirt"){e.g_o=0;if(a=="zazzle_calendar"){e.g_m=["cover"];for(var p=-1;++p<f;)e.g_m.push("page_"+p);e.g_m.push("back")}else{if(a=="zazzle_card"){e.g_r=f[1];f=f[0]}if(typeof f=="string"){e.g_m=a=="zazzle_ornament"?f.indexOf("angle0")?["angle0",f]:[f,"angle180"]:i.clone(c[a]);while(e.g_o<e.g_m.length&&e.g_m[e.g_o]!=f)++e.g_o;e.g_o==e.g_m.length&&e.g_m.push(f)}}}var d=function(){var t=e.getNode(e.g_v),n=o.getCoords(t),r=e.getNode("hoverContentInsert"),i=o.getCoords(r),s=o.getDocumentScrollElement(),u=s.scrollTop,a=i.top-u,f=u+o.getCoords(window).height-i.bottom,l="auto",c="auto";l=(n.width-i.width)/2;c=(n.height-i.height)/2;var h=a+c<0,p=f-c<0;if(h)c=-1*a;else if(p)c=f;o.setStyle(r,{position:"absolute",left:l,top:c})};var v=function(){o.setStyle(e.getNode("hoverContentInsert"),{position:"absolute",left:0,top:0})};e.wire("Changed.hover",function(){var a=e.getNode(),f="lowRes";if(e.g_J&&e.g_K&&e.g_L){var l="hovered",c=s.fromParams(e.g_L),h=c.childControlName,p=s.fromParams(c.childWidgetProperties),g=i.copyInto(p,{cp:h,itemData:s.toParams({pd:e.get("productId"),att:s.toParams(r.att)}),idPrefix:e.get("idPrefix")+"_"+l,lowResImageUrl:e.get("previewUrl")}),y=function(){u.setState(e.getNode(),e.g_S,t);v();d()};if(!e.getNode("hoverContentInsert")){o.injectHtml(e.getNode(e.g_v),'<div id="'+e.get("idPrefix")+'-hoverContentInsert" class="'+e.g_T+'"></div>',"inner bottom");e.flushNodeCache("hoverContentInsert")}if(!e.children[l]){e.callInherited("loadHtmlIntoNode")({node:e.getNode("hoverContentInsert")},g,{cache:"memory",callback:function(t){if(e.g_K){y();e.fire("Hover Loaded")}}})}else if(e.g_K){y()}}else{u.setState(e.getNode(),e.g_S,n);v()}})}}),f=a.prototype;var l=["front","back"],c={zazzle_envelope:["angle0","angle180","angle180_2"],zazzle_binder:["angle45_outside_spinefront","angle0_outside_front","angle45_outside_front","angle0_outside_back","angle45_outside_spineback","angle0_outside_spine","angle0_outside_full"],zazzle_invitation:l,zazzle_mug:["0","270","90"],zazzle_kedsshoe:["outside","front","inside","back"],zazzle_card:["front","inside2","inside1","back"],zazzle_postcard:l,zazzle_profilecard:l,zazzle_photocard:l,zazzle_flyer:l,zazzle_rackcard:l},h={front:"viewFront",back:"viewBack",angle0:"viewFront",angle0_2:"viewFront",angle0_outside_front:"viewFront",angle0_outside_full:"viewFull",angle0_outside_spine:"viewSpine",angle0_outside_back:"viewBack",angle45:"viewFrontRight",angle45_outside_front:"viewFront",angle45_outside_back:"viewBack",angle45_outside_spinefront:"viewFront",angle45_outside_spineback:"viewBack",angle90:"viewLeft",angle180:"viewBack",angle180_2:"viewBack",angle270:"viewRight",angle315:"viewFrontLeft",cover:"viewCover",calendar:"viewMonth",inside1horz:"viewInsideTop",inside2horz:"viewInsideBottom",inside1vert:"viewInsideLeft",inside2vert:"viewInsideRight",90:"viewBack",0:"viewCenter",270:"viewLeft",shoetop:"viewUpper",shoeoutside:"viewOutsideQuarter",shoeoutsidefront:"viewOutsideFront",shoefront:"viewTongue",shoeinsidefront:"viewInsideFront",shoeinside:"viewInsideQuarter",shoeback:"viewHeel"};f.g_Y=function(e){var t=this,n=t.getNode("nextviewLink"),r=t.g_n,u=t.g_m,f=t.g_i,l=parseInt(o.getStyle(n,"borderWidth").replace("px")),c=o.getDimensions(n),h=Math.max(c.height||0,c.width||0)-l*2,p=o.getDimensions(t.getNode("preview")),d=Math.max(p.width||0,p.height||0),v=t.g_j,m=(t.g_o+1)%(r||u).length,g=r?r[m]:u[m],y=r?s.resolve(g.url,{max_dim:e?d:h>=0?h:0}):s.resolve(v,i.copyInto(f=="zazzle_mug"?{lon:g}:{view:g},{max_dim:d}));if(r){var b=s.fromParams(v),w;for(w in b)if(w.indexOf("t_"))delete b[w];y=s.resolve(y,b)}e?t.g_o=m:y=r?y:a.setUrlMaxDim(y,h);return y};f.g_$_=function(){var e=this,t=e.getNode("nextviewLink"),n=e.g_n,r=e.g_m,i=e.g_i,s=function(t){return t&&t.title||e.localize(h[t])},o=(e.g_o+1)%(n||r).length,u=n?n[o]:r[o],a;if(i=="zazzle_calendar"){a=u.indexOf("page")!=0?s(u):s("calendar").replace("{0}",o).replace("{1}",r.length-2)}else{if(i=="zazzle_ornament")u=o==0?"angle0":"angle180";else if(i=="zazzle_kedsshoe")u="shoe"+u;else if(u=="inside1"||u=="inside2")u+=e.g_r;a=s(u)}if(t){t.style.backgroundImage='url("'+e.g_Y()+'")';t.title=e.localize("clickToView",a)}};f.updateNextView=function(){var e=this,n=e.getNode("nextviewLink");if(e.isWired){e.set({previewUrl:e.g_Y(t)});e.g_$_();n&&n.blur()}};f.initNextViewLink=function(){var e=this;if(!e.g_b_){var n=e.getNode("nextviewLink"),r=e.g_n,i=e.g_m,s=(r&&r.length>1||i&&i.length)&&n;e.displayNode(n,t);e.g_$_();e.wireNode(n,"click",function(){e.updateNextView();e.g_d_("multiview")});e.wire("Changed.previewUrl",function(){e.g_j=e.getNode("preview").src;e.g_$_()});e.wire("Changed.showingPreview",function(){var t=!e.get("showingPreview");s&&e.showNode(n,t)})}e.g_b_=true};f.wireUi=function(){var t=this;if(!t.isWired&&t.getNode("")){var n=t.g_m,i=t.g_n,o=(i&&i.length>1||n&&n.length)&&t.getNode("nextviewLink"),u=t.getInherited("env"),a=u.params,f=function(){var e=t.parent.storeContext?t.parent.storeContext+"/products/styles/pd-"+t.g_k:"pd/styles/pd-"+t.g_k;location.href=s.resolve(u.www+e,{dp:a.gp?r:a.dp||"",qs:a.qs||"",tl:t.getInherited("searchTitle")||""})},l=function(){var e=u.www+(t.parent.storeContext?t.parent.storeContext+"/":"")+"gifts";location.href=s.resolve(e,{gp:t.g_k})};t.wireNode("contributorLink","click",function(){location.href=u.www+t.g_l});t.wireNode("storeLink","click",function(){location.href=u.www+(t.getInherited("storeLinksToStores")?"":"gifts/ch-")+t.g_l});t.wireNode("moreStylesLink","click",function(){f()});t.wireNode("moreStylesLink2","click",function(){f()});t.wireNode("moreProductsLink","click",function(){l()});t.wireNode("moreProductsLink2","click",function(){l()});t.wireNode("","mouseover",function(){});t.wire("Changed.showingPreview",function(){var e=!t.get("showingPreview");t.showNode("productTypeIcon",e)});if(o&&t.g_k_){t.initNextViewLink()}t.wire("Init Nextview",function(){if(o)t.initNextViewLink()});t.wire("Changed.displayedZoomPower",function(){if(t.get("displayedZoomPower")==t.get("zoomPower"))!t.g_l_&&(t.g_l_=new Date);else if(t.g_l_){t.g_d_("zoom",new Date-t.g_l_);t.g_l_=undefined}});e.doMy(t,"wireUi")}};f.g_d_=f.fireTrackEvent=function(e,n){this.fire({name:"Track Event",bubble:t,extra:{idPrefix:this.get("idPrefix"),pd:this.g_k,ax:e,ts:n}})};a.stateProperties({g_o_:"seen",g_k:"productId",g_k_:{name:"initNextviewOnLoad",value:t},g_L:"hoverItemReferenceWidget",g_J:{name:"isHoverable",onChange:function(){var e=this;if(e.g_J){e.wireNode(e.g_v,"mouseRest(200)",function(){e.set({g_K:t})});e.wireNode(e.g_v,"mouseout",function(t){e.set({g_K:n})})}else{e.unwireNode(e.g_v,"mouseRest(200)");e.unwireNode(e.g_v,"mouseout")}}},g_K:{name:"hover",conformer:function(e){return this.g_J&&e}},g_v:{name:"hoverableNode",value:""},g_r_:{name:"useStoreLinks",value:n},g_S:{name:"cssClassHovering",value:"hovering"},g_T:{name:"cssClassHoverContentInsert",value:"hoverContentInsert"}});return a}});Uize.module("Zazzle.Collection");Uize.module({name:"Zazzle.Collection.Products",superclass:"Uize.Widget.Collection.Dynamic",builder:function(e){"use strict";return e.subclass()}});Uize.module({name:"Zazzle.Results",superclass:"Zazzle.Widget",required:"Uize.Node",builder:function(e){"use strict";var t=Uize,n=t.Node,r=true,i=false,s=null,o;var u=e.subclass(s,function(){var e=this,n=e.e_g,s=e.e_h,o=t.Util,u=o.Coupler,a=o.PropertyAdapter,f=t.Widget.Button,l=Zazzle,c=l.Pagination,h=n&&e.addChild("paginationTop",c),p=s&&e.addChild("paginationBottom",c);e.addChild("collection",e.e_q,e.e_r);e.e_s=e.e_t;e.e_u=[];e.e_v=0;h&&p&&new u({instances:[h,p],properties:["classSelected","numResults","pageSize","value"]});if(h){new a({propertyA:{instance:e,property:"page"},propertyB:{instance:h,property:"value"}});new a({propertyA:{instance:e,property:"pageSize"},propertyB:{instance:h,property:"pageSize"}});new a({propertyA:{instance:e,property:"numResults"},propertyB:{instance:h,property:"numResults"}})}if(e.e_w){var d=l.Droplist,v=n&&e.e_z&&e.addChild("pageSizeTop",d),m=s&&e.e_z&&e.addChild("pageSizeBottom",d),g=n&&e.e_C&&e.addChild("sortTop",d),y=s&&e.e_C&&e.addChild("sortBottom",d),b=n&&e.e_F&&e.addChild("infiniteScrollTop",f,{clickToSelect:r,clickToDeselect:r}),w=s&&e.e_F&&e.addChild("infiniteScrollBottom",f,{clickToSelect:r,clickToDeselect:r}),E=e.e_F&&e.addChild("showMoreResults",f);if(v){m&&new u({instances:[v,m],properties:["value","values"]});new a({propertyA:{instance:e,property:"pageSize"},propertyB:{instance:v,property:"value"},valueAdapter:{aToB:function(e){return e+""},bToA:function(e){return+e}}})}if(g){y&&new u({instances:[g,y],properties:["value","values"]});new a({propertyA:{instance:e,property:"sort"},propertyB:{instance:g,property:"value"}})}if(b){w&&new o.Coupler({instances:[b,w],properties:["selected"]});new o.PropertyAdapter({propertyA:{instance:e,property:"infiniteScroll"},propertyB:{instance:b,property:"selected"}})}E&&E.wire("Click",function(){if(e.isWired){e.displayNode("showMoreResults",i);h&&h.displayNode("",i)}e.set({page:e.e_t+1})});e.e_J=i}}),a=u.prototype;a.e_L=function(e){var t=i;if(this.e_N&&e)for(var n in this.getScrollableProperties())if(e[n]!=o){t=r;break}return t};a.e_P=function(e){return this.children.collection.getNode("itemsContainer"+(e?"2":""))};a.e_R=function(e){var t=this;e=e==o?1:e;if(t.isWired){t.e_t==e?t.e_S():t.set({e_t:e})}};a.e_T=function(e,t){var n=this;if(n.isWired&&n.e_W){n.callInherited("displayLoadingOverlay")(e,{parent:n,node:t?n.getNode("infiniteScrollLoad"):s});n.displayNode("infiniteScrollLoad",t&&e)}};a.e_X=function(){this.e_Y=(this.e_Y||0)+1};a.e_S=function(e){var u=this;if(u.isWired&&u.e_w&&!u.e_Z){!e&&(u.e_J=!u.e_J);var a=u.children,f=a.collection,l=u.e_2,c,h=u.e_t,p=u.e_s,d=h-p,v=u.e_5,m=d&&u.e_6,g=(h-1)*v,y=h*v-1,b=f.itemWidgets.length,w=y-g+1,E=f.getNode(),S=f.getNode("items"),x=E.style,T=E?{height:x.height,overflow:x.overflow}:{},N=f.getNodeStyle(S,"overflow");m&&f.setNodeStyle(S,{overflow:"hidden"});var C=n.getDimensions(E),k=u.e_P(u.e_J),L=u.e_P(!u.e_J),A=i,O=0;if(a.sortTop){var M=a.sortTop.get("values");for(var _=0;_<M.length;_++){var D=M[_];D.name==l&&(c=D.valueDetails)}}var P=function(a){u.callInherited("loadHtmlIntoNode")({node:k,injectMode:"inner bottom"},t.copyInto({service:u.e_w,serviceCaller:u.get("idPrefix"),idPrefix:u.get("idPrefix"),itemNo:a,itemReferenceWidget:u.e_o_,itemWidgetNamePrefix:f.get("itemWidgetNamePrefix"),collectionReferenceWidget:u.e_p_,itemRootNodeCssClass:f.get("itemRootNodeCssClass"),rev:u.e_Y,ps:u.e_5},c?c.attributes:{st:l},u.getServiceParams()),{cache:"memory",beforeInject:function(t,n){if(!A&&E){f.setNodeStyle(E,{height:C.height,overflow:"hidden"});A=r;u.beforeAddNewItems();!m&&u.displayNode(k);!e&&!m&&u.displayNode(L,i);u.e_T(i,e);if(u.e_s_&&u.e_t_&&e&&(u.e_u_>=u.e_v_||(u.e_t-1)%Math.floor(u.e_v_/u.e_u_)==0)){var s="pageBreak"+u.e_v++,o=Math.floor((u.e_t-1)/Math.floor(u.e_v_/u.e_u_)+1);u.injectNodeHtml(k,'<div id="'+u.get("idPrefix")+"-"+s+'" class="hrsingle '+u.e_y_+'"><span class="'+u.e_z_+'">'+u.localize("page",{page:o})+"</span></div>","inner bottom");u.e_u.push(s)}}t()},callback:function(){var r="$"+u.get("idPrefix"),a=window[r];if(a){u.set(a);w=Math.min(u.e_C_,h*v)-g;window[r]=o;u.fire("Updated Data")}if(++O==w||!w&&!(O-1)){var l=f.getNode("clearDiv"+(u.e_J?"2":""));if(l){n.remove(l);k.appendChild(l)}f.setNodeStyle(E,T);if(!e){var c=function(){m&&f.setNodeStyle(S,{overflow:N});var e=f.itemWidgets,n=[];for(var r=-1;++r<b;)n.push(e[r]);f.remove(n);if(u.e_s_&&u.e_t_){u.removeNode(u.e_u);t.emptyOut(u.e_u)}};if(m){t.require(["Uize.Fade","Uize.Curve"],function(e,t){var n=C.width*(d>0?1:-1),r=new e({startValue:n,endValue:0,duration:m,curve:t.easeOutCircular()});r.wire({Start:function(){u.setNodeStyle(L,{left:0,position:"absolute",top:0});u.setNodeStyle(k,{display:"block",left:+r,position:"relative"})},"Changed.value":function(){var e=+r;u.setNodeStyle(k,{left:e});u.setNodeStyle(L,{left:e-n})},Done:function(){u.setNodeStyle(L,{display:"none",position:""});u.setNodeStyle(k,{position:""});c();u.set({e_Z:i});r=s}});r.start()})}else c()}if(!m){u.set({e_Z:i})}u.e_s_&&u.e_M_()}}})};if(g<=y){u.e_T(r,e);u.set({e_Z:r});var H=function(){for(var e=g;e<=y;e++)P(e)};if(u.e_O_)H();else Uize.require("Uize.Fx.Scroll",function(e){e.scrollToNode(u.getNode(),{callback:H})})}else f.set({items:[]})}u.e_s=u.e_t};a.e_Q_=function(){var e=this;if(e.isWired){var t=e.children,n=e.children.paginationTop,r=e.e_C_,i=e.e_5,s=r>1,o=!e.e_s_,u=function(e,n){var r=t[e];r&&r.displayNode("",n)};u("sortTop",s);u("sortBottom",s);u("pageSizeTop",o);u("pageSizeBottom",o);u("paginationTop",o);u("paginationBottom",o);var a=!o&&(e.e_t-1)%e.e_Y_==e.e_Y_-1&&e.e_t*i<e.e_Z_&&e.e_t*i<r;e.displayNode("top",s||e.e_0_);e.displayNode("bottom",s&&(o||a));e.displayNode("collection",r);e.displayNode("noResults",!r);e.displayNode("showMoreResults",a);e.set({infiniteScrollButtonDisplay:a})}};a.e_M_=function(){var e=this;if(e.isWired&&e.e_s_){var t=e.children.collection.itemWidgets,r=t?t.length:0,o=(e.e_5*.25).toFixed(),u=r>o?t[r-o]:s,a=r>0?t[r-1]:s,f=e.e_t*e.e_5<e.e_Z_&&e.e_t*e.e_5<e.e_C_;if(!e.e_Z&&f&&(e.e_t-1)%e.e_Y_!=e.e_Y_-1&&(u&&n.getCoords(u.getNode()).percentSeen>10||a&&n.getCoords(a.getNode()).percentSeen>10)){e.children.paginationTop.displayNode("",i);e.set({page:e.e_t+1})}}};a.beforeAddNewItems=function(){};a.afterAddNewItems=function(){};a.getScrollableProperties=function(){return{page:1,pageSize:1,sort:1}};a.getServiceParams=function(){return{}};a.reset=function(){var e=this;e.e_X();e.e_R()};a.updateResults=function(e){var n=this;e=e||{};e.page==o&&n.e_t!=1&&(e.page=1);if(e.page&&n.e_t!=e.page)n.set(e);else{var r=n.e_s_&&e.page!=o&&t.keys(e).length==1;n.e_O_=r||!n.e_L(e);n.e_S(r);n.e_O_=i}};a.updateUi=function(){var t=this;if(t.isWired){t.children.collection.forAll(function(e){e.updateUi()});t.e_Q_();e.doMy(t,"updateUi")}};a.wireUi=function(){var t=this,s=t.children.infiniteScrollTop;if(!t.isWired){t.displayNode(t.e_P(r),i);t.children.collection.wire("Items Removed",function(e){if(e.byUser){!t.e_w&&t.set({e_C_:t.e_C_-e.totalRemoved});t.e_X();t.e_R((t.e_t-1)*t.e_5<t.e_C_?t.e_t:Math.max(t.e_t-1,1))}});n.wire(window,{scroll:function(){t.e_M_()},load:function(){t.e_M_()}});e.doMy(t,"wireUi");s&&t.callInherited("wireTooltip")(s.getNode(),function(){return t.e_s_?t.localize("showNumResults",{num:t.e_v_?t.e_v_:t.e_5}):t.localize("showAllResults")});t.e_9_&&t.updateResults()}};var f="updateResults";u.stateProperties({e_0_:{name:"alwaysShowTop",value:i},e_6:"animatePagination",e_9_:"clientSideLoaded",e_p_:"collectionReferenceWidget",e_q:"collectionWidgetClass",e_r:"collectionWidgetProperties",e_h:"includeBottomBar",e_z:"includePageSizesUi",e_C:"includeSortsUi",e_F:"includeInfiniteScrollUi",e_g:"includeTopBar",e_s_:{name:"infiniteScroll",onChange:[a.e_Q_,function(){var e=this;if(e.e_s_){e.e_v_=e.get("pageSize");e.set({page:1,pageSize:e.e_u_})}else{e.set({page:1,pageSize:e.e_v_?e.e_v_:e.e_5})}}]},e__a:{name:"infiniteScrollButtonDisplay",value:i},e_Y_:{name:"infiniteScrollButtonInterval",value:3},e_t_:{name:"infiniteScrollPageDisplay",value:i},e_z_:"pageBreakCssClassName",e_y_:"pageBreakHrCssClassName",e_u_:{name:"infiniteScrollPageSize",value:18},e_o_:"itemReferenceWidget",e_Z_:{name:"maxResults",value:540},e_C_:{name:"numResults",onChange:a.e_Q_},e_v_:"oldPageSize",e_t:{name:"page",onChange:f,value:1},e_5:{name:"pageSize",onChange:f,value:20},e_aa:"scrollToTargetNodeId",e_N:{name:"scrollToTop",value:r},e_ba:{name:"showJumpPagination",value:r},e_2:{name:"sort",onChange:f},e_Z:{name:"updating",onChange:function(){var e=this;e.set({busy:e.e_Z?r:"inherit"});!e.e_Z&&e.e_s_&&e.e_Q_()},value:i},e_w:"serviceUrl",e_W:{name:"useLoadingOverlay",value:r}});return u}});Uize.module({name:"Zazzle.Results.Cell",required:"Uize.Widget.Collection",builder:function(e){"use strict";var t=false;var n=e.subclass(null,function(){var e=this;if(e.f_b&&e.get("serviceUrl")){var t=Uize,n=t.Widget.Options,r=t.Util,i=e.addChild("viewModeTop",n),s=e.addChild("viewModeBottom",n);new r.Coupler({instances:[i,s],properties:["value","values"]});new r.PropertyAdapter({propertyA:{instance:e,property:"viewMode"},propertyB:{instance:i,property:"value"}})}}),r=n.prototype;r.getScrollableProperties=function(){return Uize.copyInto({viewMode:1},e.doMy(this,"getScrollableProperties"))};r.beforeAddNewItems=function(){var t=this,n=t.children,r=n.collection,i=n.viewModeTop;e.doMy(t,"beforeAddNewItems");if(i){var s=Uize.findRecord(i.get("values"),{name:t.f_m});r.set({itemWidgetClass:s.itemWidgetClass});r.isWired&&Uize.Node.Classes.setState(r.getNode(),[r.get("cssClassGrid"),r.get("cssClassList")],Uize.findRecord(i.get("values"),{name:t.f_m}).viewMode=="List")}};r.getServiceParams=function(){var t=this,n=t.children.viewModeTop,r=n&&n.get("values");return Uize.copyInto(e.doMy(t,"getServiceParams"),{collectionViewMode:r&&Uize.findRecord(r,{name:t.f_m}).viewMode})};r.updateResults=function(t){t=t||{};var n=this,r="viewMode"in t;if(r){var i=n.children.viewModeTop;if(i){var s=i.get("values");s&&n.set({itemReferenceWidget:Uize.findRecord(s,{name:n.f_m}).itemReferenceWidget})}}e.doMy(n,"updateResults",[Uize.copy(t,r&&Uize.keys(t).length==1?{page:n.get("infiniteScroll")?1:n.get("page")}:null)])};r.wireUi=function(){var t=this,n=t.children.viewModeTop;if(!t.isWired){e.doMy(t,"wireUi");n&&n.forAll(function(e){t.callInherited("wireTooltip")(e.getNode())})}};n.set({collectionWidgetClass:Uize.Widget.Collection});n.stateProperties({f_b:{name:"includeViewModes",value:t},f_m:{name:"viewMode",onChange:"updateResults"}});return n}});Uize.module({name:"Zazzle.Results.Products",superclass:"Zazzle.Results.Cell",required:"Zazzle.Collection.Products",builder:function(e){"use strict";var t=e.subclass();t.set({collectionWidgetClass:Zazzle.Collection.Products});return t}});Uize.module({name:"Zazzle.RatingBars",superclass:"Uize.Widget",builder:function(e){"use strict";var t=null;var n=e.subclass(),r=n.prototype;r.draw=function(){var e=this;for(var t=0;t<e.d_d;t++){e.d_e[t]=e.d_f>0?e.d_g[t]/e.d_f*e.d_h:0;e.setNodeValue("title"+t,e.d_i[t]);e.setNodeStyle("bar"+t,{width:e.d_e[t]+"px"});e.setNodeValue("detail"+t,e.d_j[t])}};r.wireUi=function(){var t=this;if(!t.isWired){e.doMy(t,"wireUi")}};n.stateProperties({d_k:"barHeight",d_h:"barWidth",d_l:"barSpacing",d_g:{name:"values",onChange:r.draw},d_f:"totalValue",d_j:"detailLabels",d_i:"titleLabels",d_d:"numBars",d_e:"fillA"});return n}});Uize.module({name:"Zazzle.ReviewSummary",superclass:"Zazzle.Widget",required:["Zazzle.RatingContinuous","Zazzle.RatingBars"],builder:function(e){var t,n=true,r=false,i=null,s=Uize;var o=e.subclass(i,function(){var e=this;e.addChild("rating",Zazzle.RatingContinuous);e.addChild("ratingBars",Zazzle.RatingBars)}),u=o.prototype;u.e_g=function(){var e=this;if(e.isWired){var t="",n="",r="",i="";e.children.rating.set({value:e.e_l});t=e.e_m;n=e.localize("xReviews",{num:e.e_n});e.setNodeInnerHtml("ratingLabel",t);e.setNodeInnerHtml("ratingLabelInner",n);r=e.localize("percentRecommend",{number:e.e_o});e.setNodeInnerHtml("percentRecommend",r);e.e_p&&(i=e.localize("recommendedFor",{occasion:e.e_p}));e.setNodeInnerHtml("recommendedFor",i);e.children.ratingBars.set({detailLabels:e.e_q,values:e.e_r,totalValue:e.e_n});e.web("ratingStars").display(e.e_n>0);e.web("recommendText").display(e.e_n>0);e.web("noReviews").display(e.e_n==0)}};u.reset=function(){var e=this;if(e.isWired){e.ajax({serviceUrl:"/svc/product/productreviews/"+(!e.e_s?"readreviews":"readptpdreviews"),type:!e.e_s?e.e_t:null,pg:1,ps:5,callerId:e.getInherited("user").id,pd:e.e_u,pt:e.e_v,atts:e.e_w,isPublic:e.e_x,privateView:e.e_y,minRating:0},{cache:"memory",callbackSuccess:function(n){var r=n.data,i;if(e.e_s){i=e.e_t=="OnProduct"?r.pdResults:r.ptResults}else{i=r.results}if(i!=t){e.e_n=i.numResults;e.e_l=i.avgRating;e.e_m=i.avgRatingDisplay;e.e_p=i.mostRecommendedFor;e.e_r=i.ratingBreakdown;e.e_q=i.ratingBreakdownDetail;e.e_o=i.percentRecommended;e.e_g()}}})}};u.wireUi=function(){var t=this;if(!t.isWired){t.wireNode("writeAReview","click",function(){t.callInherited("ensureLoggedIn")({callback:function(e){t.ajax({serviceUrl:"/svc/product/productreviews/canreview",mbr:t.getInherited("user").id,pd:t.e_u,pt:t.e_D,atts:t.e_w},function(e){var n=e.data;t.e_E=n.hasOthers;t.e_F=n.goToForm;t.e_G=n.reviewUrl;if(t.e_F){location.href=t.e_G}else{var r=t.localize("message")+"<br /><br />";t.e_E&&(r+='<a href="'+t.get("urls").productsToReviewUrl+'">'+t.localize("linkMessage")+"</a>");t.inform({title:t.localize("title"),message:r,state:"info"})}})}})});t.wireNode("ratingLabelInnerLink","click",function(){s.require("Uize.Fx.Scroll",function(e){e.scrollToNode(t.e_J)})});e.doMy(t,"wireUi")}};o.stateProperties({e_s:{name:"ajaxBoth",value:r},e_w:{name:"attributes",onChange:u.reset},e_l:"avgRating",e_m:"avgRatingDisplay",e_E:"canReviewItems",e_F:"canReviewThis",e_x:"isPublic",e_p:"mostRecommendedFor",e_o:"percentRecommended",e_y:"privateView",e_v:"qualifiedType",e_r:"ratingBreakdown",e_q:"ratingBreakdownDetail",e_u:"rootId",e_G:"reviewFormUrl",e_K:"reviewQuality",e_t:"reviewsSet",e_J:"scrollToNodeId",e_n:"totalReviews",e_D:"unqualifiedType",e_L:"value"});return o}});Uize.module({name:"Zazzle.JumpPagination",superclass:"Uize.Widget.Form",required:"Uize.Widget.FormElement.Text",builder:function(e){"use strict";var t=e.subclass(null,function(){this.e_a=this.addFormElement("page",Uize.Widget.FormElement.Text)}),n=t.prototype;n.e_c=function(){return this.e_d?Infinity:Math.ceil(this.e_e/this.e_f)};n.e_g=function(){this.isWired&&this.displayNode("",this.e_c()>1)};n.e_h=function(){var e=this,t=e.e_a;if(t){var n=t.get("validator")||[],r=Uize.findRecord(n,{type:"Range"}),i=!!r,s=e.e_c();r=Uize.copyInto(r||{},{type:"Range",min:1,max:s,func:function(e){return e>=1&&e<=s},msg:e.localize(e.e_d?"minRangeWarning":"fullRangeWarning",{minValue:1,maxValue:s})});if(!i)n.push(r);t.validate()}};n.updateUi=function(){var t=this;if(t.isWired){t.e_g();e.doMy(t,"updateUi")}};t.stateProperties({e_d:{name:"isFuzzyNumResults",onChange:[n.e_h,n.e_g]},e_e:{name:"numResults",onChange:[n.e_h,n.e_g]},e_f:{name:"pageSize",onChange:[n.e_h,n.e_g]}});return t}});Uize.module({name:"Uize.Widget.Pagination",required:["Uize.Widget.Button","Uize.Node","Uize.Dom.Classes","Uize.Url"],builder:function(e){"use strict";function t(e){var t=e+"",n=t.length,r=[];for(var i=0;++i<=n;){r.unshift(t.charAt(n-i));!(i%3)&&i<n&&r.unshift(",")}return r.join("")}function n(e,t,n){return Uize.Widget.Button.addChildButton.call(e,t,n)}function r(e){return Math.ceil(e.d_j/e.d_k)}function i(e){var t=e.d_m,n=e.d_n,i=r(e),s=1+(e.d_q&&t>1),o=i-(e.d_s&&t<i),u=Math.ceil(n/2),a=t-u+1,f=t+(n-u);return a>=s&&f<=o?a:a>=s?Math.max(s,o-n+1):s}function s(e,t){e.set({d_m:t})}function o(){var e=this,n=e.children,s=e.d_m,o=r(e),u=o>1,a=e.d_j;if(e.isWired&&e.getNode()){e.displayNode("displayShell",a>0);e.displayNode("paginationShell",u);e.setNodeInnerHtml("displayShell",e.localize("displayInfo",{number:t((s-1)*e.d_k+1),toNumber:t(Math.min(a,s*e.d_k)),total:e.localize("numResultsDisplay",{numResults:t(a)})||t(a)}));e.setNodeInnerHtml("pageDisplay",e.localize("pageDisplayInfo",{page:t(s),totalPages:t(e.localize("numResultsDisplay",{numResults:o})||o)}));if(u){var f=function(e,t){n[e]&&n[e].displayNode("",t)},l=function(e,r){n[e]&&n[e].set({text:t(r)})};f("prev",s>1);f("next",s<o);e.d_F&&l("first",1);f("first",s>1);f("last",s<o);e.d_F&&l("last",o);var c=i(e);e.displayNode("less",c>1+e.d_q);e.displayNode("more",c+e.d_n<o-e.d_s);for(var h=-1;++h<e.d_n;){var p="page"+h,d=n[p].getNode(),v=c+h,m=v==s;l(p,m?e.localize("selectedPage",{page:v})||v:v);f(p,v==s||v<=o-e.d_s);Uize.Dom.Classes.setState(d,e.d_L,m)}}}}return e.subclass({omegastructor:function(){var e=this;n(e,"prev",function(){s(e,e.d_m-1)});n(e,"next",function(){s(e,e.d_m+1)})},instanceMethods:{updateUi:function(){var t=this;if(t.isWired){o.call(t);e.doMy(t,"updateUi")}},wireUi:function(){var t=this;if(!t.isWired){var o=function(e){return!!Uize.Node.getById(t.get("idPrefix")+"_"+e)},u=function(e){n(t,"page"+e,function(){s(t,i(t)+e)})};t.d_q=o("first");t.d_s=o("last");t.d_n=-1;while(o("page"+ ++t.d_n));t.d_q&&n(t,"first",function(){s(t,1)});t.d_s&&n(t,"last",function(){s(t,r(t))});for(var a=-1;++a<t.d_n;)u(a);e.doMy(t,"wireUi")}}},stateProperties:{d_L:{name:"classSelected",value:"selected"},d_j:{name:"numResults",onChange:o},d_k:{name:"pageSize",conformer:function(e){return e?e:30},onChange:o,value:30},d_F:{name:"setEdgeButtons",value:true},d_Q:{name:"thousandsSeparator",onChange:o,value:","},d_R:"urlAnchor",d_S:"urlBase",d_T:{name:"urlParam",value:"pg"},d_m:{name:"value",conformer:function(e){var t=r(this);return e?!t||e<t?Math.floor(e):t:1},onChange:[function(){var e=this;if(e.d_S&&e.isWired)location.href=Uize.Url.resolve(e.d_S,Uize.pairUp(e.d_T,e.d_m))},o],value:1}}})}});Uize.module({name:"Zazzle.Pagination",superclass:"Uize.Widget.Pagination",required:["Zazzle.JumpPagination","Uize.Util.Coupler","Uize.Util.PropertyAdapter"],builder:function(e){"use strict";var t=e.subclass(null,function(){var e=this,t=e.addChild("jumpPagination",Zazzle.JumpPagination),n=new Uize.Util.PropertyAdapter({propertyA:e,propertyB:t,valueAdapter:{aToB:function(e){return{page:e}},bToA:function(e){return e.page}},connected:t.get("isValid")});t.wire("Changed.isValid",function(){n.set({connected:t.get("isValid")})});new Uize.Util.Coupler({instances:[e,t],properties:["numResults","pageSize","isFuzzyNumResults"]})});t.prototype.wireUi=function(){var t=this;if(!t.isWired){e.doMy(t,"wireUi");var n=t.children;Uize.forEach(["first","prev","next","last"],function(e){var r=n[e];r&&t.callInherited("wireTooltip")(r.getNode())})}};t.stateProperties({e_g:{name:"isFuzzyNumResults",value:false}});return t}});Uize.module("Zazzle.CollectionItem");Uize.module({name:"Zazzle.CollectionItem.Review",superclass:"Uize.Widget.CollectionItem",required:["Zazzle.RatingContinuous","Zazzle.SeeMoreUi","Uize.Widget.mWeb"],builder:function(e){var t=false,n=true;var r=e.subclass(null,function(){var e=this;e.addChild("rating",Zazzle.RatingContinuous);e.addChild("review",Zazzle.SeeMoreUi)}),i=r.prototype;r.mixins(Uize.Widget.mWeb);i.e_d=function(e){var t=this;t.callInherited("ensureLoggedIn")({callback:function(){t.e_f=t.getInherited("user").id;t.ajax({serviceUrl:"/svc/product/productreviews/updatehelpfulness",ax:"UpdateHelpfulness",mbr:t.e_f,rid:t.e_g,helpful:e},function(n){if(n.success){t.web("helpfulYes").setClassState(t.e_i,e);t.web("helpfulNo").setClassState(t.e_i,!e);t.e_e=e?1:0}})}})};i.e_j=function(){var e=this;e.callInherited("ensureLoggedIn")({callback:function(){e.e_f=e.getInherited("user").id;e.ajax({serviceUrl:"/svc/product/productreviews/flagreview",mbr:e.e_f,rid:e.e_g},function(t){if(t.success){e.web("violationLink").setClassState(e.e_i,n)}})}})};i.updateUi=function(){var t=this,n=t.children,r=n.rating,i=n.review;if(t.isWired){r&&r.updateUi();i&&i.updateUi();e.doMy(t,"updateUi")}};i.wireUi=function(){var r=this;if(!r.isWired){r.wireNode("helpfulYes","click",function(){r.e_d(n)});r.wireNode("helpfulNo","click",function(){r.e_d(t)});r.wireNode("violationLink","click",function(){r.confirm({title:r.localize("violationTitle"),message:r.localize("violationMessage"),okText:r.localize("yes"),cancelText:r.localize("no"),yesHandler:function(){r.e_j()}})});r.callInherited("wireTooltip")({node:r.getNode("helpfulYes")});r.callInherited("wireTooltip")({node:r.getNode("helpfulNo")});r.callInherited("wireTooltip")({node:r.getNode("violationLink")});e.doMy(r,"wireUi");r.updateUi()}};r.stateProperties({e_e:"helpful",e_f:{name:"memberId",value:0},e_g:"reviewId",e_n:"memberIconUrl",e_i:"cssClassActionSelected"});return r}});Uize.module({name:"Zazzle.Collection.Reviews",superclass:"Uize.Widget.Collection.Dynamic",required:["Zazzle.CollectionItem.Review"],builder:function(e){var t=e.subclass(null,function(){var e=this;e.wire({"Items Changed":function(){e.f_a()},Remove:function(t){if(t.byUser){t.handled=true;var n=t.itemWidgets,r=n[0].get("memberId"),i=n[0].get("reviewId");e.ajax({serviceUrl:"/svc/product/productreviews/removereview",rid:i,mbr:r},function(r){!r.success?e.inform({message:e.localize("removeItemError")}):t.finishRemove(n,t.byUser)})}}})}),n=t.prototype;n.f_a=function(){var e=this;if(e.isWired){var t=e.get("totalItems")>0;e.displayNode("items",t);e.displayNode("noReviews",!t)}};n.updateUi=function(){var t=this;if(t.isWired){t.f_a();e.doMy(t,"updateUi")}};n.wireUi=function(){var t=this;if(!t.isWired){t.wireNode("writeAReview","click",function(){t.callInherited("ensureLoggedIn")({callback:function(e){t.ajax({serviceUrl:"/svc/product/productreviews/canreview",mbr:t.getInherited("user").id,pt:t.f_j,pd:t.f_k},function(e){var n=e.data;t.f_m=n.hasOthers;t.f_n=n.goToForm;t.f_o=n.reviewUrl;if(t.f_n){location.href=t.f_o}else{var r=t.localize("message")+"<br /><br />";t.f_m&&(r+='<a href="'+t.get("urls").productsToReviewUrl+'">'+t.localize("linkMessage")+"</a>");t.inform({title:t.localize("title"),message:r,state:"info"})}})}})});e.doMy(t,"wireUi")}};t.stateProperties({f_m:"canReviewItems",f_n:"canReviewThis",f_j:"productType",f_o:"reviewFormUrl",f_k:"rootId"});t.set({itemWidgetClass:Zazzle.CollectionItem.Review});return t}});Uize.module({name:"Zazzle.Results.Reviews",superclass:"Zazzle.Results",required:"Zazzle.Collection.Reviews",builder:function(e){var t=e.subclass(),n=t.prototype;n.getServiceParams=function(){var t=this;return Uize.copyInto(e.doMy(t,"getServiceParams"),{ax:t.f_b,useCache:true,rpd:t.f_c,pt:t.f_d,callerId:t.f_e,mbr:t.f_f,att:t.f_g,voting:t.f_h,isPublic:t.f_i,privateView:t.f_j,reviewQuality:t.f_k,minRating:t.f_l})};var r="updateResults";t.stateProperties({f_n:{name:"ajaxBoth",value:false},f_g:{name:"attributes",onChange:r},f_e:{name:"callerId",value:0},f_o:"imageBackgroundColor",f_p:{name:"memberId",onChange:r},f_l:"minRating",f_c:{name:"rootId",onChange:r},f_d:{name:"qualifiedType",onChange:r},f_b:{name:"reviewsSet",onChange:r,value:"OnProductType"},f_f:"reviewerId",f_i:"isPublic",f_j:"privateView",f_k:"reviewQuality",f_q:"similarReviewsTitle",f_r:"testHash"});t.set({collectionWidgetClass:Zazzle.Collection.Reviews});return t}});Uize.module({name:"ZazzleWww.EmailSignupForm",superclass:"Uize.Widget",builder:function(e){"use strict";var t=e.subclass();t.prototype.wireUi=function(){var t=this;if(!t.isWired){var n=t.getNode("email"),r=t.getNodeValue(n),i=function(){var e=t.getNode("form"),n="emailSignupWindow";if(e){t.callInherited("launchPopup")({url:e.action,name:n,resizable:true,scrollbars:true,width:465,innerWidth:465,height:400,innerHeight:400});e.target=n;e.submit()}return false};t.wireNode("form","submit",function(){i()});t.wireNode("submit","click",function(){i()});t.wireNode(n,{focus:function(){if(t.getNodeValue(n)==r)t.setNodeValue(n,"")},blur:function(){if(!t.getNodeValue(n))t.setNodeValue(n,r)}});e.doMy(t,"updateUi")}};return t}});Uize.module({name:"Zazzle.Palette",superclass:"Uize.Widget.Dialog",required:"Uize.Widget.mWeb",builder:function(e){"use strict";var t={Above:0,Below:1,Left:2,Right:3},n=function(){var e=this;e.isWired&&e.e_b!=null&&e.web("contents").html(e.e_b)},r=function(){var e=this;e.isWired&&e.web().setClassState([e.e_d,e.e_e,e.e_f,e.e_g],t[e.e_h])};return e.subclass({mixins:Uize.Widget.mWeb,omegastructor:function(){var e=this,t=function(t){e.web().opacity(t?1:0)};e.wire({"After Show":function(){t(true)},"After Hide":function(){t(false)}})},instanceMethods:{e_a:n,e_c:r,updateUiPositionIfShown:function(){var n=this;if(n.isWired&&n.get("shown")){var r=n.get("mooringNode"),i=n.get("offsetX");if(r&&i=="adjacent"&&i==n.get("offsetY")){var s=t[n.e_h],o=n.web(),u=o.dimensions(),a=u.width,f=u.height,l=n.web(r),c=l.dimensions(),h=c.width,p=c.height,d=l.coords(),v=d.left,m=d.top;if(h&&p){if(!s){v+=h/2-a/2;m-=f}else if(s==1){v+=h/2-a/2;m+=p}else if(s==2){v-=a;m+=p/2-f/2}else if(s==3){v+=h;m+=p/2-f/2}o.css({left:v,top:m})}else n.set({shown:false})}else e.doMy(n,"updateUiPositionIfShown")}},updateUi:function(){var t=this;if(t.isWired){t.e_a();t.e_c();t.updateUiPositionIfShown();e.doMy(t,"updateUi")}}},stateProperties:{e_d:"cssClassDirectionAbove",e_e:"cssClassDirectionBelow",e_f:"cssClassDirectionLeft",e_g:"cssClassDirectionRight",e_b:{name:"contents",onChange:n},e_h:{name:"direction",onChange:[r,"updateUiPositionIfShown"],value:"Below"}},set:{offsetX:"adjacent",offsetY:"adjacent"}})}});Uize.module({name:"ZazzleWww.ZazzleFooter",superclass:"Zazzle.Widget",required:["Zazzle.Palette","ZazzleWww.EmailSignupForm"],builder:function(e){"use strict";var t=true,n=false,r=null;var i=e.subclass(r,function(){var e=this;e.addChild("i18nPalette",Zazzle.Palette,{mooringNode:e.getNode("i18nLink"),dismissOnShieldClick:t});e.addChild("emailSignup",ZazzleWww.EmailSignupForm);e.wireNode("viewFullSite","click",function(){e.ajax({service:"mobilesetfullwidth",ax:"true"},{callbackSuccess:function(e){location.href=location.href}})});e.wireNode("viewMobileSite","click",function(){e.ajax({service:"mobilesetfullwidth",ax:"false"},{callbackSuccess:function(e){location.href=location.href}})})}),s=i.prototype;s.wireUi=function(){var t=this;if(!t.isWired){var n=t.children.i18nPalette;if(n){t.web("i18nLink").click(function(){n.set("shown",!n.get("shown"))})}e.doMy(t,"wireUi")}};i.stateProperties({});return i}});Uize.module({name:"ZazzleWww.Pixel",superclass:"Uize.Widget",required:["Uize.Node"],builder:function(d_$){var d__=d_$.subclass(null,function(){var m=this;if(m.d_a){Uize.Node.wire(window,"load",function(){m.d_a&&setTimeout(function(){m.getNode("pixel").src=m.d_a},10)})}if(m.d_b){var d_c=document.createElement("iframe"),d_d=document.getElementsByTagName("script");(d_c.frameElement||d_c).style.cssText="width: 0; height: 0; border: 0";d_d=d_d[d_d.length-1];d_d.parentNode.insertBefore(d_c,d_d);var d_e=d_c.contentWindow.document;with(d_e){open().c=function(){s=this.createElement("script");s.src=m.d_b;this.body.appendChild(s)};write("<body onload=document.c();>");close()}}}),d_f=d__.prototype;d__.stateProperties({d_a:{name:"pixelUrl",value:null},d_b:{name:"scriptUrl",value:null}});return d__}});Uize.module("Uize.Array");Uize.module({name:"Uize.Array.Join",builder:function(){"use strict";return Uize.package({hugJoin:function(e,t,n,r){return e.length?""+t+e.join(""+n+(r!=undefined?r:"")+t)+n:""}})}});Uize.module({name:"Uize.Str.Camel",builder:function(){"use strict";return Uize.package({to:function(e,t){return(Uize.isArray(e)?e.join(" "):e).toLowerCase().replace(/^\W+/,"").replace(/\W+$/,"").replace(t?/(^|\W+)./g:/\W+./g,function(e){return e.slice(-1).toUpperCase()})}})}});Uize.module({name:"Uize.Str.Has",builder:function(){"use strict";function e(e,t,n){if(!t)return true;var r=e.length,i=t.length,s=n?r-i:0,o=s+i-1;return i<=r&&e.charCodeAt(s)==t.charCodeAt(0)&&(i==1||e.charCodeAt(o)==t.charCodeAt(i-1)&&(i==2||(i==r?t==e:n?e.indexOf(t,s)==s:e.lastIndexOf(t,o)==0)))}return Uize.package({has:function(t,n){return n.length<=t.length&&(e(t,n)||e(t,n,true)||t.indexOf(n)>-1)},hasSuffix:function(t,n){return e(t,n,true)},hasPrefix:e})}});Uize.module({name:"Uize.Str.Limit",builder:function(){"use strict";var e;return Uize.package({joinUsingSuffixPriority:function(t,n,r){var i=n.length;return r<i?n.substr(0,r):r==i?n:e(t,r-i)+n},limitLength:e=function(e,t){var n="...",r=n.length;return t<1?"":t<=r?e.slice(0,t):e.length>t?e.substr(0,t-r)+n:e}})}});Uize.module({name:"Uize.Str.Repeat",builder:function(){"use strict";function i(e){if(!n)n=(t="          ".replace(/ /g,"          ")).length;if(e>n)n=(t=r(t,Math.floor(e/n))+t.substr(0,e%n)).length;return t.substr(0,e)}var e=[],t,n,r;return Uize.package({repeat:r=function(t,n){if(n<1||!t)return"";if(n==1)return t;if(t==" ")return i(n);e.length=n+1;return e.join(t)}})}});Uize.module({name:"Uize.String",required:["Uize.Array.Join","Uize.Str.Camel","Uize.Str.Has","Uize.Str.Limit","Uize.Str.Repeat","Uize.Str.Split","Uize.Str.Trim"],builder:function(){"use strict";var e=Uize.Str,t=e.Has,n=e.Limit,r=e.Split,i=e.Trim;return Uize.package({hugJoin:Uize.Array.Join.hugJoin,limitLength:n.limitLength,joinUsingSuffixPriority:n.joinUsingSuffixPriority,contains:t.has,startsWith:t.hasPrefix,endsWith:t.hasSuffix,toCamel:e.Camel.to,repeat:e.Repeat.repeat,split:r.split,splitInTwo:r.splitInTwo,hasPadding:i.hasPadding,trim:i.trim,trimLeft:i.trimLeft,trimRight:i.trimRight})}});Uize.module({name:"Uize.Web.xDom",required:"Uize.Dom.Basics",builder:function(e){"use strict";var t=true,n=Uize,r=n.Dom.Basics,i=e.prototype;var s=function(e,t,n){var i=function(t){var s=t.childNodes,o=s.length-1,u=t.parentNode;for(;o>0;o--)i(s[o]);if(n||t!=e){t.nodeType==1&&r.unwire(t);(u==e||n&&t==e)&&r.remove(t)}};t&&i(e);e.innerHTML=""},o=e.isMatch;var u=function(t,n){i[t]=function(t){return e(t)[n](this)}},a=function(e,t){i[e]=function(){var e=this,i=e.length;n.forEach(arguments,function(s){e.handleSetAction(s,function(e,s){n.forEach(n.isList(s)?s:[s],function(n){i==1&&r.isNode(n)&&r.remove(n);r.injectHtml(e,n,t)})})});return e}};a("after","outer bottom");a("append");u("appendTo","append");a("before","outer top");u("insertAfter","after");u("insertBefore","before");a("prepend","inner top");u("prependTo","prepend");u("replaceAll","replaceWith");a("replaceWith","outer replace");i.detach=function(e){return this.each(function(){o(this,e)&&r.remove(this)})};i.empty=function(){return this.each(function(){s(this,t)})};i.remove=function(e){return this.each(function(){o(this,e)&&s(this,t,t)})}}});Uize.module({name:"Uize.Widget.Page",required:"Uize.Dom.Basics",builder:function(e){"use strict";function a(e){return s.isFunction(e)&&e||e&&e.callback||Object}function f(e,t,n,i){e.useDialog({component:e.d_m.component,widgetClassName:e.d_m.widgetClassName||"Uize.Widget.Dialog.Confirm",widgetProperties:{name:"confirmDialog",title:i.title||"",message:(i.message+"").replace(/\n/g,"<br/>"),mode:t,state:i.state||n,okText:i.okText||r,cancelText:i.cancelText||r,mooringNode:i.mooringNode||r,offsetX:i.offsetX||r,offsetY:i.offsetY||r},submitHandler:function(e){var t=i.callback||(e?i.yesHandler:i.noHandler);t&&t(e)}})}function l(e,r){r=r||Object;var o=e.get("idPrefix"),u=window;var a={},f=n,l="$"+o+"_",c=l.length,h;for(var p in u){if(p.charAt(0)=="$"&&p.substr(0,c)==l&&typeof (h=u[p])=="object"&&h&&h.widgetClass){f=t;for(var d=-1,v=a,m=p.substr(c).split("_"),g,y=m.length;++d<y;){var b=v[g=m[d]];if(d<y-1){v=(b||(b=v[g]={})).children||(b.children={})}else{b?s.mergeInto(b,h):v[g]=h;u[p]=i}}}}if(f){var w=function(t,n){function r(e,r,s){var o=s.children,u=t(e,r,s);o&&i(u,o);n&&n(u)}function i(e,t){for(var n in t)r(e,n,t[n])}i(e,a)};var E={},S=[];w(function(e,t,n){var r=n.widgetClass;if(r&&!E[r]){E[r]=1;S.push(r)}});s.require(S,function(){e.set({children:a});w(function(e,t,n){var r=e.children[t];if(!r){var i=s.getModuleByName(n.widgetClass)||s.Widget;r=t.charCodeAt(0)==36&&t.charCodeAt(1)==36?i.spawn(n,e):e.addChild(t,i)}return r},e.isWired&&function(e){s.callOn(e,"insertOrWireUi")});r()})}else{r()}}var t=true,n=false,r=null,i,s=Uize,o=s.Dom.Basics,u={yes:1,on:1,1:1,"true":1};return e.subclass({omegastructor:function(){this.wireDeferredLinks&&this.wireDeferredLinks()},instanceMethods:{loadHtmlIntoNode:function(e,t,i){var s=this,u=e.rootNodeId,f=a(i);if(typeof i!=="object"){i={}}i.callback=function(t){function n(){var n=document.body,i=e.node!=undefined?s.getNode(e.node):(u?o.getById(u+"-shell"):r)||n;o.injectHtml(i,t,e.injectMode||(i==n?"inner bottom":"inner replace"));setTimeout(function(){l(s,f)},0)}if(i.beforeInject){i.beforeInject(n,t)}else{n()}};i.errorCallback=i.errorCallback||function(){};e.alwaysReplace===n&&u&&o.getById(u)?f():s.loadHtml(t,i)},performAjax:function(){},flushAjaxCache:function(){},useDialog:function(e){function p(){setTimeout(function(){function o(t,n){var r=e[t];r&&r.apply(0,n)}function u(e){var t=[e];o(e.name.toLowerCase()+"Handler",t);o("dismissHandler",t)}function f(e){var t=e.name;o(t,[e]);r.fire({name:"Dialog "+t,dialogWidget:e.source})}a.set({shown:n});a.unwire(a.eventHandlersForUseDialog||{});a.eventHandlersForUseDialog=s.copyInto({"Submission Complete":function(e){o("submitHandler",[e.result,e])},Close:u,Cancel:u,"Before Show":f,"After Show":f,"Before Hide":f,"After Hide":f},e.widgetEventHandlers);a.wire(a.eventHandlersForUseDialog);a.set(i);a.set({shown:t})},0)}function d(){function f(){var t=e.widgetClassName;s.require(t,function(e){(a=o.children[u])?a.set(i):a=o.addChild(u,e,i);a.Page_componentProfile=c;a.insertOrWireUi();p(d?"refetched":"initial");l[u]=n})}function h(t){l[u]=n;if(e.widgetEventHandlers.Error){e.widgetEventHandlers.Error(t)}else if(e.widgetEventHandlers.Cancel){e.widgetEventHandlers.Cancel(error)}else{console.error("Error when loading dialog",t)}}if(!l[u]){l[u]=t;var d=c&&!!a;if(d){a.removeUi();o.removeChild(u)}c?r.loadHtmlIntoNode({node:c.node,rootNodeId:c.rootNodeId,injectMode:"inner bottom",alwaysReplace:n},s.copyInto({cp:c.name},c.params),{cache:"memory",callback:f,errorCallback:h}):f()}}var r=this,i=s.copy(r.d_2,e.widgetProperties),o=i.parent||r,u=i.name,a=o.children[u],f=e.component,l=r.d_7=r.d_7||{},c;if(f){var h=i.idPrefix||o.get("idPrefix")+"_"+u;c={name:f.name,node:f.rootNode,rootNodeId:h,params:s.copyInto({idPrefix:h},f.params)}}if(a){if(a.Page_componentProfile==c)p("subsequent");else{s.require("Uize.Data.Compare",function(e){e.identical(a.Page_componentProfile,c)?p("subsequent"):d()})}}else{d()}},wireUi:function(){var t=this;if(!t.isWired){l(t);e.doMy(t,"wireUi")}},loadHtml:function(e,t){a(t)("")},showConfirm:function(e){f(this,"confirm","confirm",e)},showInform:function(e){f(this,"alert","info",e)}},dualContextMethods:{launchPopup:function(e){function n(t){return t+"="+e[t]}function r(t,n){return t+"="+(u[e[t]==i?n:e[t]+""]?"yes":"no")}if(!e)e={};if(e.width==i)e.width=850;if(e.height==i)e.height=600;var t=window.screen;if(e.left==i)e.left=Math.max(t.width-e.width-10>>1,0);if(e.top==i)e.top=Math.max(t.height-e.height-40>>1,0);var s=window.open(e.url||"",e.name==i?"popupWindow":e.name,[n("width"),n("height"),n("top"),n("left"),r("toolbar",0),r("location",0),r("directories",0),r("status",0),r("menubar",0),r("scrollbars",1),r("resizable",1)].join(","));s&&s.focus();return s}},stateProperties:{d_m:{name:"confirmDialog",value:{}},d_2:"dialogProperties"},set:{idPrefix:"page"}})}});Uize.module({name:"Uize.Widget.Page.xDeferredLinks",required:"Uize.Dom.Basics",builder:function(e){"use strict";e.prototype.wireDeferredLinks=function(){var e=this,t=e.deferredLinks,n=t.length,r=0;(function i(){function s(t){var n=Uize.Dom.Basics.getById(t[0]),r=t[1];if(typeof r=="string")e.setNodeProperties(n,{href:r});else e.wireNode(n,"click",function(){e.launchPopup(Uize.copyInto({url:r.href,name:r.target},r.popupParams))})}for(var o=Math.min(n,r+e.linkBatchSize);r<o;r++)s(t[r]);if(r<n)setTimeout(i,0)})()};e.stateProperties({deferredLinks:{name:"deferredLinks",value:[]},linkBatchSize:{name:"linkBatchSize",value:25}})}});Uize.module({name:"Uize.Dom.VirtualEvents.ModClick",required:["Uize.Dom.Basics","Uize.Dom.VirtualEvent"],builder:function(){"use strict";function s(t,n,s){var o=(t?"Shift":"")+(n?"Ctrl":"")+(s?"Alt":"")+"Click";e[o=o.charAt(0).toLowerCase()+o.slice(1)]=i.register(o,function(){return i.getCached(o+"()",function(e,i,o){r.wire(e,"click",function(r){r.shiftKey==t&&r.ctrlKey==n&&r.altKey==s&&!r.metaKey&&i.call(e,r)},o)})})}var e=function(){},t=true,n=false,r=Uize.Dom.Basics,i=Uize.Dom.VirtualEvent;s(n,n,n);s(t,n,n);s(n,t,n);s(n,n,t);s(n,t,t);s(t,t,n);s(t,n,t);s(t,t,t);return e}});Uize.module({name:"Uize.Node.VirtualEvent",required:["Uize.Dom.VirtualEvent","Uize.Dom.VirtualEvents.ModClick","Uize.Dom.VirtualEvents.Remain"],builder:function(){"use strict";var e=Uize,t=e.Dom,n=t.VirtualEvents;return e.package(e.copy(t.VirtualEvent,n.ModClick,n.Remain))}});Uize.module({name:"Zazzle.Page",superclass:"Uize.Widget.Page",required:["Uize.Url","Uize.Node","Uize.Data","Uize.Comm.Ajax","Uize.Widget.Page.xDeferredLinks","Uize.Node.VirtualEvent","Uize.Widget.mWeb","Uize.Dom.Event"],builder:function(e){"use strict";function l(e){i.require("Zazzle.PageUtils",e)}function c(e){f[e]=function(){var t=this,n=arguments;l(function(r){r[e].apply(0,[t].concat(Array.prototype.slice.call(n)))})}}var t=true,n=false,r=null,i=Uize,s=i.Node,o=i.Url,u=i.copyInto;var a=e.subclass(r,function(){var e=this,r=n;if(!e.e_i)e.e_i=new i.Comm.Ajax;window.onerror=function(n,i,s){var o=e.e_m;if(!r){r=t;e.ajax({service:"logjs",msg:n,url:i,ln:s,ts:new Date-o.clientStartTime})}return!o.showErrors}}),f=a.prototype;a.mixins(i.Widget.mWeb);f.loadHtml=function(e,r){var u=this,a=u.e_q,f=u.get("env").service+(e.service||"getcontrol"),l=e.serviceCaller,c=s.getById("globalContent");if(typeof r!="object"||!r)r={callback:r};u.e_u=n;u.e_q=a&&a.e_v==f&&a.e_s==l?a:{e_v:f,e_s:l,batchingAgent:{buildRequest:function(e){var t={url:[f,{comm_mode:"ajax",output:"js",js:i.keys(i.getModuleByName("*")).join("|"),css:i.keys(u.get("modules").css).join("|"),ax:"batch"}],returnType:"json",requestMethod:"POST",cache:r.cache||"browser"},n=e.length,s=-1,a={};for(;++s<n;)a["breq"+s]=o.toParams(e[s].htmlParams);t.url.push(a);return t},responseParser:function(e){var t=[],n=e.responseJson,r;for(r in n)t.push(n[r]);return t}}};var h=r.errorCallback||function(e){console.error("ERROR in loadHtml, add an errorCallback.",e)};u.e_i.queueRequest({url:[f,e,{comm_mode:"ajax",output:"js",js:i.keys(i.getModuleByName("*")).join("|"),css:i.keys(u.get("modules").css).join("|")}],htmlParams:e,returnType:"json",requestMethod:"POST",cache:r.cache,callback:function(e){var t=e.responseJson||e,o=t.dependencyModules,a=t.dependencyData;if(t.success){var f=function(e,t){var r=a[e];r&&s.injectHtml(t||document.body,r,"inner bottom");i.copyInto(u.e_N[e],i.lookup(o[e],n))};f("js");f("css",c);Uize.require(o.js,function(){(r.callback||Object)(t.controlData)})}else{h(t)}},errorCallback:h,batchingAgent:u.e_q.batchingAgent});u.e_u=t;setTimeout(function(){u.e_u&&u.e_i.useQueue()},0)};f.performAjax=function(e,t){t=Uize.isFunction(t)?{callback:t}:t||{};this.e_i.request({url:[e.serviceUrl?e.serviceUrl:this.get("env").service+e.service,{comm_mode:"ajax",output:"js"},e,{service:r,serviceUrl:r}],returnType:t.returnType||"json",requestMethod:t.requestMethod||"POST",cache:"cache"in t?t.cache:"browser",data:t.data,contentType:t.contentType,callback:t.callbackSuccess||t.callback,batchingAgent:t.batchingAgent||n})};f.flushAjaxCache=function(e){arguments.length?this.e_i.flushCache(e):this.e_i.flushCache()};f.getUrl=function(){return location.href};f.prompt=function(e){e.callback(prompt(e.message,e.inputText))};f.wireTooltip=function(e,o){var a=this,f=i.isPlainObject(e),l=f?e:{},c=l.widget,h=!f?e:l.node,p=o||l.message,d;if(c||h){var v=l.callback,m,g,y,b=function(e){v&&v(e)},w=function(){clearTimeout(g);m&&m.set({shown:false});m=y;b(n)},E=function(){var e=i.isFunction(p)?p():p;if(e||l.component){m=r;a.useDialog({component:l.component||{name:"Zazzle.Palette"},widgetProperties:u({name:"globalTooltip",mooringNode:h||c&&c.getNode(),contents:e,offsetX:"adjacent",offsetY:"adjacent",direction:l.direction||"Below"},l.widgetProperties),"Before Show":function(e){var r=e.source,i=l.hideTimeout;if(i==y)i=5e3;if(m===y){r.set({shown:n});w()}else{m=r;b(t);if(i)g=setTimeout(w,i)}}})}},S;if(c){var x=l.propertyName||"value",T=l.evalFunc;S=i.pairUp("Changed."+x,function(){var e=c.get(x);(T?T(e):!!e)?E():w()});c.wire(S);d=function(){w();c.unwire(S)}}else if(h){var N=a.web(h=s.getById(h));if(!N.supportsTouch){if(!p){p=N.property("title");N.property("title","")}S=u({mouseout:w},i.pairUp("mouseRest("+(l.restTime==y?500:l.restTime)+")",E));N.wire(S);d=function(){w();N.unwire(S)}}}}return d};f.wireUi=function(){var t=this;if(!t.isWired){e.doMy(t,"wireUi");var n=function(e){Uize.Dom.Event.preventDefault(e)};t.wireNode(document.body,{dragenter:n,dragover:n,drop:n});var r=t.e_e_;!i.isEmpty(r)&&t.e_f_&&setTimeout(function(){s.injectHtml(document.body,'<iframe id="page-prefetchIframe" style="position:absolute;visibility:hidden;bottom:0"></iframe>',"inner bottom");var e=t.getNode("prefetchIframe");try{var n=e.contentDocument||e.contentWindow.document,i=["<ht"+"ml><he"+"ad></he"+"ad><bo"+"dy>"],o=function(e,t){if(e)for(var n=-1;++n<e.length;)i.push(t.replace("#",e[n]))};o(r.css,'<link href="#" type="text/css" rel="stylesheet" />');o(r.js,'<script src="#" type="text/javascript"></script>');o(r.images,'<img src="#" />');n.open();n.write(i.join("\n")+"</b"+"ody></ht"+"ml>");n.close()}catch(u){}},t.e_f_)}};c("displayLoadingOverlay");c("getCookie");c("openIframeDialog");c("setCookie");c("wireContextMenu");c("wireNodeForDataTransfer");c("useMediaBrowser");a.getParent=f.getParent=function(){try{var e=parent.domain}catch(t){document.domain=location.hostname.replace(/^[^.]+./,"")}return parent};a.stateProperties({e_i:"commObject",e_u_:{name:"dialogMooringNode",value:"main"},e_m:{name:"env",value:{}},e_N:"modules",e_R:{name:"params",value:{}},e_f_:{name:"prefetchDelay",value:2e3},e_e_:{name:"prefetchUrls",value:{}},e_k_:{name:"urls",value:{}},e_v_:{name:"user",value:{}}});a.set({confirmDialog:{component:{name:"Zazzle.Dialog.Confirm"}}});return a}});Uize.module({name:"ZazzleWww.Page",superclass:"Zazzle.Page",required:["Uize.Url","Uize.Node","Uize.String","ZazzleWww.ZazzleHeader","Uize.Web.xDom"],builder:function(e){"use strict";var t=true,n=false,r=null,i,s=Uize,o=s.copyInto,u=s.Node,a=s.Url,f=s.String,l=ZazzleWww;var c=e.subclass(r,function(){var e=this;e.addChild("zazzleHeader",l.ZazzleHeader);if(e.f_k&&top.location!=self.location){var t=self.location.href;top.location=e.f_m?a.resolve(t,{shareThis:true}):t}e.addChild("returnToPrevious",s.Widget.Button).wire("Click",function(){window.history.go(-1)});e.wire("Track Event",function(t){var n=e.get("env"),r=e.get("tracking");if(e.isWired&&r){var f=e.getNode("imagePixel"),l=t.extra;if(!f){f=u.getById(e.get("idPrefix")+"-imagePixel");f&&e.set({nodeMap:o(e.get("nodeMap")||{},{imagePixel:f})})}f&&e.setNodeValue(f,a.resolve(r.url,s.copyInto({rnd:a.getCacheDefeatStr(),ts:n?new Date-n.clientStartTime:i,idPrefix:t.source.get("idPrefix")},typeof l!="object"?{extra:l}:l)))}})}),h=c.prototype;h.isLoggedIn=function(e){var t=this.get("user");return t.isLoggedIn||(e?t.llid!=0:n)};h.useMediaBrowser=function(t,i,u){var a=this,f=a.get("env").mediaBrowserUiVersion||1,l={uploadVideo:n};if(f>1){e.doMy(a,"useMediaBrowser",[s.copyInto({controlName:"ZazzleWww.Dialog.MediaBrowser2",name:"mediaBrowserDialog"},t,l),i,u])}else{a.useDialog({component:{name:"ZazzleWww.MediaBrowser"},widgetProperties:o({name:"mediaBrowser",sources:["MyComputer","MyZazzleImages"],selectedSource:"MyComputer",imageType:"all"},a.get("user").isLoggedIn?{selectedSource:"MyZazzleImages"}:r,f_A=="flickr"?{sources:["MyComputer","MyZazzleImages",f_A],selectedSource:f_A}:r,{tf:t&&t.imageType=="ztimage"?"stitch":"print"},t,{okText:r}),submitHandler:i,dismissHandler:u})}};h.goToLogin=function(e){location.href=a.resolve(this.get("env").login,{lru:e||this.getUrl()})};h.wwwSearchPag=function(e,t){var n=this,r=n.get("env"),i=r.allDepartmentsSuffix,s=r.www+(t||i),o=0,u=e.st;if(u=="date_created")delete e.sp;if(s.indexOf("awards")<0){delete e.at;delete e.day;if(u=="award")delete e.st}else{delete e.pt}var a={cn:"0",ch:"",dp:0,st:"popularity",sd:"desc",ps:"",pt:"all",cg:"0",pce:"0",pcr:"0",gp:"0",sp:"0",pr:"","do":"",pg:"1",awt:"",sr:"0",pst:"0",sfd:"true"};for(var l in a){if(e[l]&&e[l]==a[l])delete e[l]}if(e.qs)e.qs=encodeURI(e.qs.replace(/[  *\/]/g,"+").replace(/[\.\?#]/g,""));if(s.indexOf(i)>=0){s=n.get("env").www+(e.qs?e.qs:"")+(f.endsWith(e.qs,i)?"":"+"+i);for(var c in{dp:0,cg:0,pcr:0,pce:0,sr:0,awt:0,ccs:0,ccpid:0,hastxt:0,hasphoto:0,txtcvg:0,pst:0,st:0,at:0,sp:0,sd:0,cn:0,ch:0,"do":0,pr:0,pg:0,ps:0,day:0,hs:0,vm:0,sfd:0})if(e[c])s+=(o++?"&":"?")+c+"="+encodeURI(e[c])}else{for(var c in{qs:0,hs:0})if(e[c])s+="/"+c+"-"+encodeURI(e[c]);for(var c in{dp:0,cg:0,pcr:0,pce:0,sr:0,awt:0,pt:0,ccs:0,ccpid:0,cciid:0,hastxt:0,hasphoto:0,txtcvg:0,pst:0,st:0,at:0,sp:0,sd:0,cn:0,ch:0,gp:0,"do":0,pr:0,pg:0,ps:0,day:0,vm:0,sfd:0})if(e[c])s+=(o++?"&":"?")+c+"="+encodeURI(e[c])}return s};h.replaceFullWidthNumbers=function(e){if(e&&/[\uff10-\uff19]/g.test(e)){e=e.replace(/\uff10/g,"0");e=e.replace(/\uff11/g,"1");e=e.replace(/\uff12/g,"2");e=e.replace(/\uff13/g,"3");e=e.replace(/\uff14/g,"4");e=e.replace(/\uff15/g,"5");e=e.replace(/\uff16/g,"6");e=e.replace(/\uff17/g,"7");e=e.replace(/\uff18/g,"8");e=e.replace(/\uff19/g,"9");e=e.replace(/[\u3002\uff0e]/g,".")}return e};h.screenIsSmall=function(){return this.web(window).width()<this.f_M};h.wireUi=function(){var r=this;if(!r.isWired){r.f_N&&r.web(window).load(function(){p(function(){l.PageUtils.trackPageLoad(r)})});r.web("changeMaturity").click(function(){r.useDialog({component:{name:"ZazzleWww.ChangeContentFilterDialog",params:{mbr:r.get("user").id}},widgetProperties:{name:"changeContentFilterDialog"},submitHandler:function(){location.href=location.href}})});if(r.f_P&&!Uize.isNully(r.f_P)&&!r.children.emailSignupDialog){r.useDialog({component:{name:"ZazzleWww.Dialog.Form.EmailSignup",params:{hasRectangularBackground:r.f_P==="rectangle"}},widgetProperties:{name:"emailSignupDialog"}})}var i=r.children.zazzleHeader;if(i.get("compatibilityMode")===n){var o=r.getNode("sideMenus"),u=r.web(i.getNode("offCanvasLeftContent")),a=r.web(i.getNode("offCanvasRightContent")),f=r.web("shield"),c=r.web("leftSlider"),h=r.web("rightSlider"),d=r.web(),v=0,m=0,g=0,y=0,b=0,w=0,E=n,S=navigator.platform[0]==="i",x=Uize.Node.isIe,T=d.supportsCss("transform"),N=d.supportsCss("transition"),C=n,k=function(e,t,n){if(e){d.css(e,t);c.css(e,n||t);h.css(e,n||t)}},L=function(e,t){var n=function(e){return"translate3d("+e+(e&&s.isNumber(e)?"px":"")+", 0, 0)"};k(T,n(e),t&&n(t));if(e==0){u.display(false);a.display(false)}},A=function(){i.retrieveCartItems()},O=function(e){r.web((e?"right":"left")+"Slider").wire({touchstart:function(t){e&&A();u.display(!e);a.display(e);f.display();var n=t.touches[0];v=m=n.clientX;g=y=n.clientY;k(N,"");t.preventDefault()},touchmove:function(t){var n=m,i=t.touches[0];m=i.clientX;y=i.clientY;E=n<m;if(S){var o=(e?w:b)+(m-v),u=.8*r.web(window).width();L(e?s.constrain(o,-u,0):s.constrain(o,0,u))}t.preventDefault()},touchend:function(t){var i=E!==e,s=e?w:b,o=Math.abs(m-v),u=Math.abs(y-g),a=r.web(window).width()*.8;if(o<10&&u<10)i=!s;if(o<u&&s===b)i=n;k(N,"all 0.2s ease-out");if(e)i?L("-80%",w=-a):L(w=0);else i?L("80%",b=a):L(b=0);c.setClassState("big-slider",i);h.setClassState("big-slider",i);f.hide();t.preventDefault()},mousedown:function(){var t=function(e){if(x){d.css("left",e);c.css("marginLeft",e);h.css("marginRight",-e)}};e&&A();u.display(!e);a.display(e);d.css(N,"all 0.2s ease-out");if(C){L(0);t(0)}else{var n=r.web(window).width()*.8*(e?-1:1);L((e?"-":"")+"80%",n);t(n)}C=!C;c.setClassState("big-slider",C);h.setClassState("big-slider",C)}})};if(o){if(u.length){u.detach();o.appendChild(u[0])}if(a.length){a.detach();o.appendChild(a[0])}}O(n);O(t)}e.doMy(r,"wireUi");var M=["console","undefined","Want to work on Zazzle's UI? Run jobs.apply()","log","jobs","apply","Track Event","jobs.apply","fire","getNode",".","+","replace","getTime","Congrats!",'You know your Javascript! Give us a shout at <a href="mailto:1337ui@zazzle.com?Subject=ZUI position&Body=My code is ','.">1337ui@zazzle.com</a>. Make sure to include "','" in your email.',"inform","Nice.","Not quite right.","You thought it was that simple? Run this function in the context of the #page DOM node."];setTimeout(function(){if(typeof window[M[0]]!=M[1]){console[M[3]](M[2])}window[M[4]]=new function(){this[M[5]]=function(){r[M[8]]({name:M[6],bubble:true,extra:{ax:M[7]}});if(this==r[M[9]]()){var e=((new Date)[M[13]]().toString()/42/1e3).toString()[M[12]](M[10],M[11]);r[M[18]]({title:M[14],message:M[15]+e+M[16]+e+M[17]});return M[19]}else{if(this!=window[M[4]]){return M[20]}else{return M[21]}}}}},2e3)}};var p=function(e){s.require("ZazzleWww.PageUtils",e)},d=function(e){h[e]=function(){var t=this,n=arguments;p(function(r){r[e].apply(0,[t].concat(Array.prototype.slice.call(n)))})}};d("animateStitch");d("enableProfile");d("ensureLoggedIn");d("shareLink");d("showShareDialog");d("useProductUiDialog");d("validateContent");c.stateProperties({f_k:"framebust",f_m:"imageSearchReferred",f_P:"interstitialPromo",f_B_:"loadingOverlay",f_C_:{name:"realviewBgColor",value:"ffffff"},f_M:{name:"screenBreakPoint",value:768},f_p:"tracking",f_N:"trackClientPerformance"});return c}});Uize.module({name:"ZazzleWww.Page.ProductUi",required:["ZazzleWww.ProductUi","Uize.Url","Uize.Widget.Button"],builder:function(e){"use strict";var t=Uize,n=t.Url,r=true,i=null;var s=e.subclass(i,function(){var e=this,r=e.addChild("productUi",e.g_f||ZazzleWww.ProductUi),i=e.addChild("customize",t.Widget.Button);r.wire("Submit",function(t){e.handleAddToCart(t.data)});i.wire("Click",function(){var i=e.get("urls").customizeIt;if(e.g_j)r.set({isDesigning:true});else if(i)location.href=n.resolve(i,t.copyInto({qty:r.get("quantity")},r.getProductParams(true)))});r.once("isDesigning",function(){e.web("customizeItButtonWrapper").hide()})}),o=s.prototype;o.getUrl=function(){return n.resolve(e.doMy(this,"getUrl"),{gl:this.g_l},this.children.productUi.getProductParams(true))};o.handleAddToCart=function(e){var t=this,r=t.children.productUi,s=e&&e.productId||r.get("productId"),o=r.get("designId");if(o)s=i;else if(s)o=i;location.href=n.resolve(t.get("urls").addToCart,{multi:true,product:n.toParams(Uize.copyInto({pt:r.get("productType"),pd:s,dz:o,qty:r.get("quantity"),tl:t.g_p||r.get("title")},r.valueOf()))})};o.wireUi=function(){var n=this;if(!n.isWired){if(n.g_q){var i=false;n.web(window).wireOnce("scroll",function(){i=r});setTimeout(function(){!i&&t.require("Uize.Fx.Scroll",function(e){e.scrollToNode(n.children.productUi.getNode(),{fullVisibility:r})})},2e3)}e.doMy(n,"wireUi")}};s.stateProperties({g_p:"addToCartTitleOverride",g_j:"inlineCustomize",g_f:"productUiWidgetClass",g_q:"scrollIntoView",g_l:"skinnedStore"});return s}});Uize.module({name:"ZazzleWww.Page.ProductUi.Main",required:["ZazzleWww.AccessoriesUi","Zazzle.ProductValueMessagingUi","Uize.Url","Uize.Widget.Button"],builder:function(e){"use strict";var t=true,n=false,r=null,i=Uize,s=i.Url,o=Zazzle,u=ZazzleWww;var a=e.subclass(r,function(){var e=this,r=e.children.productUi,a=e.h_i,f=r.get("quantity"),l=e.addChild("accessoriesUi",u.AccessoriesUi,{quantity:f}),c=e.addChild("accessoriesUiMore",u.AccessoriesUi,{quantity:f}),h=e.addChild("valueMessaging",o.ProductValueMessagingUi),p=a&&e.addChild("overallRatingPurchaseUi",o.OverallReviewRating),d=a&&e.addChild("productTypeReviews",o.Results.Reviews,{ajaxBoth:t}),v=a&&e.addChild("productTypeReviewsSummary",o.ReviewSummary,{ajaxBoth:t});r.wire({"Changed.productOption":function(){var e=r.get("productOption"),t={attributes:e},n=s.toParams(e);h.set({productOption:e});l.set(t);c.set(t);i.forEach([p,d,v],function(e){e&&e.set({attributes:n})})},"Changed.quantity":function(){var e={quantity:r.get("quantity")};l.set(e);c.set(e)},"Changed.templateParams":function(){var e={templateParams:r.get("templateParams")};l.set(e);c.set(e)},"Responsive Sizing":function(){var s=e.web(r.getNode("extraProductTitleShell")).css("display")!="none";if(s&&!e.h_w||!s&&e.h_w){i.require("Uize.Web.xDom",function(){if(s&&!e.h_w){e.h_w=t;e.web(h).after(e.getNode("sharePod"));e.web("main").append(e.getNode("recommendationsShell"));p&&e.web(r.getNode("extraProductTitleShell")).append(p.getNode());e.set({h_x:t,h_y:t});h.updateUi()}else if(!s&&e.h_w){e.h_w=n;e.web("accessoriesUi").before(e.getNode("sharePod"));e.web("reviewsShell").before(e.getNode("recommendationsShell"));p&&e.web(r.children.configurator.getFormElement("purchaseUi").getNode("titleShell")).append(p.getNode());e.set({h_x:n,h_y:n});h.updateUi()}})}},"Changed.hasConstraints":function(){e.h_z()}});var m=function(e,t){var n={productId:t?null:e};t&&r.set({isDesigning:true});l.set(n);c.set(n)},g=function(t){t.wire({"Changed.values":function(){e.h_z()},"Accessory Added":function(t){if(t.bundleId)location.href=e.get("env").www+t.bundleId;else if(e.h_H)m(t.parentProductId,e.h_H)},"Before Add":function(n){e.h_H=r.get("isDesigning");n.handled=true;r.productize(function(r,i){if(r){var s=i.productId;t.set({productId:s});n.handler&&n.handler(s)}else e.inform({state:"error",message:e.localize("productizeFailedAccessory")})})},"Cancel Add":function(t){m(t.parentProductId,e.h_H)}})};g(l);g(c);e.addChild("toggleAccessoriesUi",i.Widget.Button).wire("Click",function(){e.toggle("accessoriesUiCollapsed")});d&&d.wire({"Changed.numResults":function(){e.h_K()},"Changed.similarReviewsTitle":function(){e.isWired&&e.web("productTypeReviewsTitle").html(d.get("similarReviewsTitle"))}})}),f=a.prototype;f.h_z=function(){var e=this,t=e.children,r=t.productUi;if(e.isWired){var i=function(i){var s=t[i],o=s.get("values").length;e.web(i).display(o);o&&s.set("enabled",r.get("hasConstraints")?n:"inherit")};i("accessoriesUi");i("accessoriesUiMore")}};f.h_Q=function(){var e=this,t=e.h_S;if(e.isWired){e.web("accessoriesUi").setClassState(e.h_T,t);e.web(e.children.accessoriesUi).display(!t)}};f.h_U=function(){var e=this,t=e.h_x;if(e.isWired){e.web("designInfoShell").setClassState(e.h_T,t);e.web("designInfo").display(!t)}};f.h_K=function(){var e=this;if(e.isWired){var t=e.children.productTypeReviews;t&&e.web("productTypeReviews").display(t.get("numResults")>0)}};f.h_V=function(){var e=this,t=e.h_y;if(e.isWired){e.web("productTypeReviews").setClassState(e.h_T,t);e.web("reviewsContent").display(!t)}};f.getUrl=function(){return s.resolve(e.doMy(this,"getUrl"),{gl:this.h_W},this.children.productUi.getProductParams(true))};f.updateUi=function(){var t=this;if(t.isWired){t.h_z();t.h_Q();t.h_U();t.h_K();e.doMy(t,"updateUi")}};f.wireUi=function(){var t=this;if(!t.isWired){var n=function(e,n){t.web(e).click(function(){t.toggle(n)})};n("accessoriesUiTitle","accessoriesUiCollapsed");n("designInfoTitle","designInfoCollapsed");n("reviewTitle","reviewsCollapsed");e.doMy(t,"wireUi")}};a.stateProperties({h_S:{name:"accessoriesUiCollapsed",onChange:f.h_Q,value:n},h_T:"cssClassCollapsed",h_x:{name:"designInfoCollapsed",onChange:f.h_U,value:n},h_0:"qualifiedType",h_y:{name:"reviewsCollapsed",onChange:f.h_V,value:n},h_i:"showReviews"});return a}});Uize.module({name:"ZazzleWww.Page.ProductUi.Main.DesignToolCombined",required:"Uize.Url",builder:function(e){var t=null;var n=e.subclass();n.prototype.getUrl=function(){return Uize.Url.resolve(this.get("urls").designTool,Uize.copyInto(Uize.Url.fromParams(e.doMy(this,"getUrl"),{favorQuery:false}),{pd:t,pt:t,dz:this.children.productUi.get("designId")}))};n.prototype.wireUi=function(){var t=this;if(!t.isWired){var n=t.children.productUi,r=t.web("beenHere"),i=t.web("lastLocationSearch"),s=t.web("lastInProgressProductDesignId"),o=location.search,u=t.web(n.getNode("extraProductTitleShell")).css("display")!="none";if(o!=i.value()||r.value()!=1){r.value(1);i.value(o)}else n.set({designId:s.value(),launchGetStarted:false});n.wire("Changed.designId",function(){s.value(n.get("designId"))});if(u)n.set({launchGetStarted:false});e.doMy(t,"wireUi")}};return n}})